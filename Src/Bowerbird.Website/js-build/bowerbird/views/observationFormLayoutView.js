define(["jquery","underscore","backbone","app","ich","views/editmapview","views/editmediaview","datepicker","multiselect"],function(a,b,c,d,e,f,g){var h=c.Marionette.Layout.extend({className:"form observation-form",template:"ObservationForm",regions:{media:"#media-resources-fieldset",map:"#location-fieldset"},events:{"click #cancel":"_cancel","click #save":"_save","change input#Title":"_contentChanged","change input#ObservedOn":"_contentChanged","change input#Address":"_contentChanged","change input#Latitude":"_latLongChanged","change input#Longitude":"_latLongChanged","change input#IsIdentificationRequired":"_isIdentificationRequiredChanged","change input#AnonymiseLocation":"_anonymiseLocationChanged","change #projects-field input:checkbox":"_projectsChanged","change #category-field input:checkbox":"_categoryChanged","click #media-resource-import-button":"_showImportMedia"},initialize:function(a){log("observationFormLayoutView:initialize"),this.categories=a.categories},serializeData:function(
){return log("observationFormLayoutView:serializeData"),{Model:{Observation:this.model.toJSON(),Categories:this.categories}}},onShow:function(){log("observationFormLayoutView:onShow"),this._showDetails()},showBootstrappedDetails:function(){log("observationFormLayoutView:showBootStrappedDetails"),this.initializeRegions(),this._showDetails()},_showDetails:function(){log("observationFormLayoutView:_showDetails");var c=new f({el:"#location-fieldset",model:this.model});this.map.attachView(c),c.render();var h=new g({el:"#media-resources-fieldset",model:this.model});this.media.attachView(h),h.render(),this.observedOnDatePicker=this.$el.find("#ObservedOn").datepicker(),this.categoryListSelectView=this.$el.find("#Category").multiSelect({selectAll:!1,singleSelect:!0,noOptionsText:"No Categories",noneSelected:"<span>Select Category</span>",oneOrMoreSelected:function(c){var d=a("<span />");return b.each(c,function(a){d.append("<span>"+a.text+"</span> ")}),d.children()}}),e.addTemplate("ProjectSelectItem"
,'{{#Projects}}<option value="{{Id}}">{{Name}}</option>{{/Projects}}'),this.$el.find("#Projects").append(e.ProjectSelectItem({Projects:d.authenticatedUser.projects.toJSON()})),log(e.ProjectSelectItem({Projects:d.authenticatedUser.projects.toJSON()})),this.projectListSelectView=this.$el.find("#Projects").multiSelect({selectAll:!1,messageText:"You can select more than one project",noOptionsText:"No Projects",noneSelected:"<span>Select Projects</span>",renderOption:function(a,b){var c='<label><input style="display:none;" type="checkbox" name="'+a+'[]" value="'+b.value+'"';b.selected&&(c+=' checked="checked"');var e=d.authenticatedUser.projects.get(b.value);return c+=' /><img src="'+e.get("Avatar").Files.thumbnail.RelativeUri+'" alt="" />'+e.get("Name")+"</label>",c},oneOrMoreSelected:function(c){var e=a("<div />");return b.each(c,function(a){var b=d.authenticatedUser.projects.get(a.value);e.append('<span class="selected-project"><img src="'+b.get("Avatar").Files.thumbnail.RelativeUri+'" alt="" />'+
a.text+"</span> ")}),e.children()}})},_showImportMedia:function(){alert("Coming soon")},_contentChanged:function(b){var c=a(b.currentTarget),d={};d[c.attr("id")]=c.attr("value"),this.model.set(d),c.attr("id")==="Address"&&this._latLongChanged(b)},_latLongChanged:function(b){var c={latitude:this.model.get("Latitude"),longitude:this.model.get("Longitude")},d={latitude:a("#Latitude").val(),longitude:a("#Longitude").val()};this.model.set("Latitude",d.latitude),this.model.set("Longitude",d.longitude),d.Latitude!=null&&d.Longitude!=null&&(c.Latitude!==d.Latitude||c.Longitude!==d.Longitude)&&this.editMapView.changeMarkerPosition(this.model.get("Latitude"),this.model.get("Longitude"))},_isIdentificationRequiredChanged:function(b){var c=a(b.currentTarget);this.model.set({IsIdentificationRequired:c.attr("checked")=="checked"?!0:!1})},_anonymiseLocationChanged:function(b){var c=a(b.currentTarget);this.model.set({AnonymiseLocation:c.attr("checked")=="checked"?!0:!1})},_projectsChanged:function(b){var c=
a(b.currentTarget);if(c.attr("checked")==="checked"){var d=c.attr("value");this.model.addProject(d)}else this.model.removeProject(c.attr("value"))},_categoryChanged:function(b){var c=a(b.currentTarget);c.attr("checked")==="checked"?this.model.set("Category",c.attr("value")):this.model.set("Category","")},_cancel:function(){},_save:function(){this.model.save()}});return h})