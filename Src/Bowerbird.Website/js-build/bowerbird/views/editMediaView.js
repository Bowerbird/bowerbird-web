define(["jquery","underscore","backbone","app","models/mediaresource","views/mediaresourceitemview","loadimage","fileupload"],function(a,b,c,d,e,f,g){var h=c.View.extend({id:"media-resources-fieldset",initialize:function(a){log("ediMediaView:initialize"),b.extend(this,c.Events),b.bindAll(this,"render","_initMediaUploader","_onUploadDone","_onSubmitUpload","_onUploadAdd"),this.mediaResourceItemViews=[],this.currentUploadKey=0},render:function(){return log("ediMediaView:render"),this._initMediaUploader(),this},_initMediaUploader:function(){log("ediMediaView:_initMediaUploader"),a("#fileupload").fileupload({dataType:"json",paramName:"file",url:"/mediaresources/observationupload",add:this._onUploadAdd,submit:this._onSubmitUpload,done:this._onUploadDone})},filesAdded:0,_onUploadAdd:function(b,c){log("ediMediaView:_onUploadAdd"),this.currentUploadKey++;var d=new e({Key:this.currentUploadKey.toString()});this.model.addMediaResource(d);var h=new f({model:d});h.on("mediaresourceview:remove",this
._onMediaResourceViewRemove),this.mediaResourceItemViews.push(h),a("#media-resource-add-pane").before(h.render().el);var i=this,j=g(c.files[0],function(b){b.type!=="error"&&(i.filesAdded++,h.showTempMedia(b),i._showMediaResourceItemView(i,h,a(b).width(),i.filesAdded===c.originalFiles.length))},{maxHeight:220});j||alert("No support for file/blob API!"),c.submit()},_showMediaResourceItemView:function(b,c,d,e){log("ediMediaView:_showMediaResourceItemView"),a("#media-resource-items").queue("mediaQueue",function(c){b.$el.find("#media-resource-add-pane").animate({left:(d+15).toString()+"px"},{duration:800,queue:!1,easing:"swing",step:function(){a("#media-resource-items").animate({scrollLeft:1e4},1)},complete:c})}).queue("mediaQueue",function(b){a(c.el).animate({top:"+=250px"},{duration:800,easing:"swing",queue:!1,complete:b})}).queue("mediaQueue",function(d){b.$el.find("#media-resource-add-pane").css({left:""}),a(c.el).css({position:"relative",top:""}),a("#media-resource-items").animate({scrollLeft
:1e4},1),d()}),e&&(b.filesAdded=0,a("#media-resource-items").dequeue("mediaQueue"))},_onMediaResourceViewRemove:function(a,b){log("ediMediaView:_onMediaResourceViewRemove"),this.model.removeMediaResource(a.id),b.remove()},_onSubmitUpload:function(a,b){log("ediMediaView:_onSubmitUpload"),b.formData={Key:this.currentUploadKey,OriginalFileName:b.files[0].name}},_onUploadDone:function(a,b){log("ediMediaView:_onUploadDone");var c=this.model.mediaResources.find(function(a){return a.get("Key")===b.result.Key});c.set(b.result)}});return h})