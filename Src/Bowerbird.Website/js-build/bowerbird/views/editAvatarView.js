define(["jquery","underscore","backbone","app","ich","views/avataritemview","loadimage","models/mediaresource"],function(a,b,c,d,e,f,g,h){return EditAvatarView=c.View.extend({id:"avatar-fieldset",initialize:function(a){b.extend(this,c.Events),b.bindAll(this,"render","_initMediaUploader","_onUploadDone","_onSubmitUpload","_onUploadAdd"),this.model=a.model,this.currentUploadKey=0,this.avatarItemView=null},render:function(){return log("editAvatarView:render"),this._initMediaUploader(),a("#avatar-viewer").append('<img src="'+this.model.get("Avatar").UrlToImage+'" />'),this},_initMediaUploader:function(){a("#fileupload").fileupload({dataType:"json",paramName:"file",url:"/mediaresources/avatarupload",add:this._onUploadAd,submit:this._onSubmitUpload,done:this._onUploadDone,limitConcurrentUploads:1})},_onUploadAdd:function(b,c){log("editAvatarView:_onUploadAdd"),this.currentUploadKey++;var d=new h({Key:this.currentUploadKey.toString()}),e=this,f=g(c.files[0],function(b){b.type!=="error"&&(e.filesAdded++
,mediaResourceItemView.showTempMedia(b),e._showMediaResourceItemView(e,mediaResourceItemView,a(b).width(),e.filesAdded===c.originalFiles.length))},{maxHeight:220});f||alert("No support for file/blob API!"),c.submit()},_onSubmitUpload:function(a,b){b.formData={Key:this.currentUploadKey,OriginalFileName:b.files[0].name}},_onUploadDone:function(b,c){log("editAvatarView:_onUploadDone"),this.model.set("Avatar",c.result.Id);var d=new h(c.result);a("#avatar-viewer").empty().append('<img src="'+d.get("MediumImageUri")+'" width="200px;" />')}}),EditAvatarView})