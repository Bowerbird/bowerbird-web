/*!
 * jQuery JavaScript Library v1.7.2
 * http://jquery.com/
 *
 * Copyright 2011, John Resig
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 * Copyright 2011, The Dojo Foundation
 * Released under the MIT, BSD, and GPL Licenses.
 *
 * Date: Wed Mar 21 12:46:34 2012 -0700
 */

/*!
 * Sizzle CSS Selector Engine
 *  Copyright 2011, The Dojo Foundation
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://sizzlejs.com/
 */

//     (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.

//     Underscore is freely distributable under the MIT license.

//     (c) 2010-2012 Jeremy Ashkenas, DocumentCloud Inc.

//     Backbone may be freely distributed under the MIT license.

/*!
ICanHaz.js version 0.10 -- by @HenrikJoreteg
More info at: http://icanhazjs.com
*/

/*!
  ICanHaz.js -- by @HenrikJoreteg
*/

// Copyright (C)2011 Derick Bailey, Muted Solutions, LLC

/*!
    * SignalR JavaScript Library v0.5
    * http://signalr.net/
    *
    * Copyright David Fowler and Damian Edwards 2012
    * Licensed under the MIT.
    * https://github.com/SignalR/SignalR/blob/master/LICENSE.md
    */

/**
 * Timeago is a jQuery plugin that makes it easy to support automatically
 * updating fuzzy timestamps (e.g. "4 minutes ago" or "about 1 day ago").
 *
 * @name timeago
 * @version 0.11.3
 * @requires jQuery v1.2.3+
 * @author Ryan McGeary
 * @license MIT License - http://www.opensource.org/licenses/mit-license.php
 *
 * For usage and examples, visit:
 * http://timeago.yarp.com/
 *
 * Copyright (c) 2008-2012, Ryan McGeary (ryan -[at]- mcgeary [*dot*] org)
 */

/**
* @version: 1.0 Alpha-1
* @author: Coolite Inc. http://www.coolite.com/
* @date: 2008-04-13
* @copyright: Copyright (c) 2006-2008, Coolite Inc. (http://www.coolite.com/). All rights reserved.
* @license: Licensed under The MIT License. See license.txt and http://www.datejs.com/license/. 
* @website: http://www.datejs.com/
*/

/**
    * Get the week number. Week one (1) is the week which contains the first Thursday of the year. Monday is considered the first day of the week.
    * This algorithm is a JavaScript port of the work presented by Claus TÃ¸ndering at http://www.tondering.dk/claus/cal/node8.html#SECTION00880000000000000000
    * .getWeek() Algorithm Copyright (c) 2008 Claus Tondering.
    * The .getWeek() function does NOT convert the date to UTC. The local datetime is used. Please use .getISOWeek() to get the week of the UTC converted date.
    * @return {Number}  1 to 53
    */

/** @license
 * RequireJS plugin for async dependency load like JSONP and Google Maps
 * Author: Miller Medeiros
 * Version: 0.1.1 (2011/11/17)
 * Released under the MIT license
 */

/*!
 * jQuery UI 1.8.14
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI
 */

/*!
 * jQuery UI Widget 1.8.14
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Widget
 */

/*
 * jQuery UI Position 1.8.14
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Position
 */

/*
 * jQuery UI Autocomplete 1.8.14
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Autocomplete
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 *	jquery.ui.position.js
 */

/*
 * jQuery UI Menu (not officially released)
 * 
 * This widget isn't yet finished and the API is subject to change. We plan to finish
 * it for the next release. You're welcome to give it a try anyway and give us feedback,
 * as long as you're okay with migrating your code later on. We can help with that, too.
 *
 * Copyright 2010, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Menu
 *
 * Depends:
 *	jquery.ui.core.js
 *  jquery.ui.widget.js
 */

/*!
 * jQuery UI Mouse 1.8.14
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Mouse
 *
 * Depends:
 *	jquery.ui.widget.js
 */

/*
 * jQuery UI Draggable 1.8.14
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Draggables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */

/*
 * JavaScript Load Image 1.1.6
 * https://github.com/blueimp/JavaScript-Load-Image
 *
 * Copyright 2011, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */

/*
 * jQuery File Upload Plugin 5.8.1
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2010, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */

/* ===========================================================
    * bootstrap-datepicker.js v1.3.0
    * http://twitter.github.com/bootstrap/javascript.html#datepicker
    * ===========================================================
    * Copyright 2011 Twitter, Inc.
    *
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    *
    * Contributed by Scott Torborg - github.com/storborg
    * Loosely based on jquery.date_input.js by Jon Leighton, heavily updated and
    * rewritten to match bootstrap javascript approach and add UI features.
    * =========================================================== */

/*
// jQuery multiSelect
//
// Version 1.2.2 beta
//
// Cory S.N. LaViska
// A Beautiful Site (http://abeautifulsite.net/)
// 09 September 2009
//
// Visit http://abeautifulsite.net/notebook/62 for more information
//
// (Amended by Andy Richmond, Letters & Science Deans' Office, University of California, Davis)
//
// Usage: $('#control_id').multiSelect( options, callback )
//
// Options:  selectAll          - whether or not to display the Select All option; true/false, default = true
//           selectAllText      - text to display for selecting/unselecting all options simultaneously
//           noneSelected       - text to display when there are no selected items in the list
//           oneOrMoreSelected  - text to display when there are one or more selected items in the list
//                                (note: you can use % as a placeholder for the number of items selected).
//                                Use * to show a comma separated list of all selected; default = '% selected'
//           optGroupSelectable - whether or not optgroups are selectable if you use them; true/false, default = false
//           listHeight         - the max height of the droptdown options
//
// Dependencies:  jQuery 1.2.6 or higher (http://jquery.com/)
//
// Change Log:
//
//		1.0.1	- Updated to work with jQuery 1.2.6+ (no longer requires the dimensions plugin)
//				- Changed $(this).offset() to $(this).position(), per James' and Jono's suggestions
//
//		1.0.2	- Fixed issue where dropdown doesn't scroll up/down with keyboard shortcuts
//				- Changed '$' in setTimeout to use 'jQuery' to support jQuery.noConflict
//				- Renamed from jqueryMultiSelect.* to jquery.multiSelect.* per the standard recommended at
//				  http://docs.jquery.com/Plugins/Authoring (does not affect API methods)
//
//		1.0.3	- Now uses the bgiframe plugin (if it exists) to fix the IE6 layering bug.
//              - Forces IE6 to use a min-height of 200px (this needs to be added to the options)
//
//		1.1.0	- Added the ability to update the options dynamically via javascript: multiSelectOptionsUpdate(JSON)
//              - Added a title that displays the whole comma delimited list when using oneOrMoreSelected = *
//              - Moved some of the functions to be closured to make them private
//              - Changed the way the keyboard navigation worked to more closely match how a standard dropdown works
//              - ** by Andy Richmond **
//
//		1.2.0	- Added support for optgroups
//              - Added the ability for selectable optgroups (i.e. select all for an optgroup)
//              - ** by Andy Richmond **
//
//		1.2.1	- Fixed bug where input text overlapped dropdown arrow in IE (i.e. when using oneOrMoreSelected = *)
//              - Added option "listHeight" for min-height of the dropdown
//              - Fixed bug where bgiframe was causing a horizontal scrollbar and on short lists extra whitespace below the options
//              - ** by Andy Richmond **
//
//		1.2.2	- Fixed bug where the keypress stopped showing the dropdown because in jQuery 1.3.2 they changed the way ':visible' works
//              - Fixed some other bugs in the way the keyboard interface worked
//              - Changed the main textbox to an <a> tag (with 'display: inline-block') to prevent the display text from being selected/highlighted
//              - Added the ability to jump to an option by typing the first character of that option (simular to a normal drop down)
//              - ** by Andy Richmond **
//				- Added [] to make each control submit an HTML array so $.serialize() works properly
//
// Licensing & Terms of Use
// 
// This plugin is dual-licensed under the GNU General Public License and the MIT License and
// is copyright 2008 A Beautiful Site, LLC. 
//	
*/

(function(window,undefined){function createFlags(flags){var object=flagsCache[flags]={},i,length;flags=flags.split(/\s+/);for(i=0,length=flags.length;i<length;i++)object[flags[i]]=!0;return object}function dataAttr(elem,key,data){if(data===undefined&&elem.nodeType===1){var name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();data=elem.getAttribute(name);if(typeof data=="string"){try{data=data==="true"?!0:data==="false"?!1:data==="null"?null:jQuery.isNumeric(data)?+data:rbrace.test(data)?jQuery.parseJSON(data):data}catch(e){}jQuery.data(elem,key,data)}else data=undefined}return data}function isEmptyDataObject(obj){for(var name in obj){if(name==="data"&&jQuery.isEmptyObject(obj[name]))continue;if(name!=="toJSON")return!1}return!0}function handleQueueMarkDefer(elem,type,src){var deferDataKey=type+"defer",queueDataKey=type+"queue",markDataKey=type+"mark",defer=jQuery._data(elem,deferDataKey);defer&&(src==="queue"||!jQuery._data(elem,queueDataKey))&&(src==="mark"||!jQuery._data(elem,markDataKey
))&&setTimeout(function(){!jQuery._data(elem,queueDataKey)&&!jQuery._data(elem,markDataKey)&&(jQuery.removeData(elem,deferDataKey,!0),defer.fire())},0)}function returnFalse(){return!1}function returnTrue(){return!0}function isDisconnected(node){return!node||!node.parentNode||node.parentNode.nodeType===11}function winnow(elements,qualifier,keep){qualifier=qualifier||0;if(jQuery.isFunction(qualifier))return jQuery.grep(elements,function(elem,i){var retVal=!!qualifier.call(elem,i,elem);return retVal===keep});if(qualifier.nodeType)return jQuery.grep(elements,function(elem,i){return elem===qualifier===keep});if(typeof qualifier=="string"){var filtered=jQuery.grep(elements,function(elem){return elem.nodeType===1});if(isSimple.test(qualifier))return jQuery.filter(qualifier,filtered,!keep);qualifier=jQuery.filter(qualifier,filtered)}return jQuery.grep(elements,function(elem,i){return jQuery.inArray(elem,qualifier)>=0===keep})}function createSafeFragment(document){var list=nodeNames.split("|"),safeFrag=
document.createDocumentFragment();if(safeFrag.createElement)while(list.length)safeFrag.createElement(list.pop());return safeFrag}function root(elem,cur){return jQuery.nodeName(elem,"table")?elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody")):elem}function cloneCopyEvent(src,dest){if(dest.nodeType!==1||!jQuery.hasData(src))return;var type,i,l,oldData=jQuery._data(src),curData=jQuery._data(dest,oldData),events=oldData.events;if(events){delete curData.handle,curData.events={};for(type in events)for(i=0,l=events[type].length;i<l;i++)jQuery.event.add(dest,type,events[type][i])}curData.data&&(curData.data=jQuery.extend({},curData.data))}function cloneFixAttributes(src,dest){var nodeName;if(dest.nodeType!==1)return;dest.clearAttributes&&dest.clearAttributes(),dest.mergeAttributes&&dest.mergeAttributes(src),nodeName=dest.nodeName.toLowerCase(),nodeName==="object"?dest.outerHTML=src.outerHTML:nodeName!=="input"||src.type!=="checkbox"&&src.type!=="radio"?
nodeName==="option"?dest.selected=src.defaultSelected:nodeName==="input"||nodeName==="textarea"?dest.defaultValue=src.defaultValue:nodeName==="script"&&dest.text!==src.text&&(dest.text=src.text):(src.checked&&(dest.defaultChecked=dest.checked=src.checked),dest.value!==src.value&&(dest.value=src.value)),dest.removeAttribute(jQuery.expando),dest.removeAttribute("_submit_attached"),dest.removeAttribute("_change_attached")}function getAll(elem){return typeof elem.getElementsByTagName!="undefined"?elem.getElementsByTagName("*"):typeof elem.querySelectorAll!="undefined"?elem.querySelectorAll("*"):[]}function fixDefaultChecked(elem){if(elem.type==="checkbox"||elem.type==="radio")elem.defaultChecked=elem.checked}function findInputs(elem){var nodeName=(elem.nodeName||"").toLowerCase();nodeName==="input"?fixDefaultChecked(elem):nodeName!=="script"&&typeof elem.getElementsByTagName!="undefined"&&jQuery.grep(elem.getElementsByTagName("input"),fixDefaultChecked)}function shimCloneNode(elem){var div=
document.createElement("div");return safeFragment.appendChild(div),div.innerHTML=elem.outerHTML,div.firstChild}function getWidthOrHeight(elem,name,extra){var val=name==="width"?elem.offsetWidth:elem.offsetHeight,i=name==="width"?1:0,len=4;if(val>0){if(extra!=="border")for(;i<len;i+=2)extra||(val-=parseFloat(jQuery.css(elem,"padding"+cssExpand[i]))||0),extra==="margin"?val+=parseFloat(jQuery.css(elem,extra+cssExpand[i]))||0:val-=parseFloat(jQuery.css(elem,"border"+cssExpand[i]+"Width"))||0;return val+"px"}val=curCSS(elem,name);if(val<0||val==null)val=elem.style[name];if(rnumnonpx.test(val))return val;val=parseFloat(val)||0;if(extra)for(;i<len;i+=2)val+=parseFloat(jQuery.css(elem,"padding"+cssExpand[i]))||0,extra!=="padding"&&(val+=parseFloat(jQuery.css(elem,"border"+cssExpand[i]+"Width"))||0),extra==="margin"&&(val+=parseFloat(jQuery.css(elem,extra+cssExpand[i]))||0);return val+"px"}function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){typeof dataTypeExpression!="string"&&
(func=dataTypeExpression,dataTypeExpression="*");if(jQuery.isFunction(func)){var dataTypes=dataTypeExpression.toLowerCase().split(rspacesAjax),i=0,length=dataTypes.length,dataType,list,placeBefore;for(;i<length;i++)dataType=dataTypes[i],placeBefore=/^\+/.test(dataType),placeBefore&&(dataType=dataType.substr(1)||"*"),list=structure[dataType]=structure[dataType]||[],list[placeBefore?"unshift":"push"](func)}}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,dataType,inspected){dataType=dataType||options.dataTypes[0],inspected=inspected||{},inspected[dataType]=!0;var list=structure[dataType],i=0,length=list?list.length:0,executeOnly=structure===prefilters,selection;for(;i<length&&(executeOnly||!selection);i++)selection=list[i](options,originalOptions,jqXHR),typeof selection=="string"&&(!executeOnly||inspected[selection]?selection=undefined:(options.dataTypes.unshift(selection),selection=inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,selection
,inspected)));return(executeOnly||!selection)&&!inspected["*"]&&(selection=inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,"*",inspected)),selection}function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src)src[key]!==undefined&&((flatOptions[key]?target:deep||(deep={}))[key]=src[key]);deep&&jQuery.extend(!0,target,deep)}function buildParams(prefix,obj,traditional,add){if(jQuery.isArray(obj))jQuery.each(obj,function(i,v){traditional||rbracket.test(prefix)?add(prefix,v):buildParams(prefix+"["+(typeof v=="object"?i:"")+"]",v,traditional,add)});else if(!traditional&&jQuery.type(obj)==="object")for(var name in obj)buildParams(prefix+"["+name+"]",obj[name],traditional,add);else add(prefix,obj)}function ajaxHandleResponses(s,jqXHR,responses){var contents=s.contents,dataTypes=s.dataTypes,responseFields=s.responseFields,ct,type,finalDataType,firstDataType;for(type in responseFields)type in responses&&(jqXHR[responseFields[type
]]=responses[type]);while(dataTypes[0]==="*")dataTypes.shift(),ct===undefined&&(ct=s.mimeType||jqXHR.getResponseHeader("content-type"));if(ct)for(type in contents)if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}if(dataTypes[0]in responses)finalDataType=dataTypes[0];else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}firstDataType||(firstDataType=type)}finalDataType=finalDataType||firstDataType}if(finalDataType)return finalDataType!==dataTypes[0]&&dataTypes.unshift(finalDataType),responses[finalDataType]}function ajaxConvert(s,response){s.dataFilter&&(response=s.dataFilter(response,s.dataType));var dataTypes=s.dataTypes,converters={},i,key,length=dataTypes.length,tmp,current=dataTypes[0],prev,conversion,conv,conv1,conv2;for(i=1;i<length;i++){if(i===1)for(key in s.converters)typeof key=="string"&&(converters[key.toLowerCase()]=s.converters[key]);prev=current,current=dataTypes[i];if(current==="*")current=prev
;else if(prev!=="*"&&prev!==current){conversion=prev+" "+current,conv=converters[conversion]||converters["* "+current];if(!conv){conv2=undefined;for(conv1 in converters){tmp=conv1.split(" ");if(tmp[0]===prev||tmp[0]==="*"){conv2=converters[tmp[1]+" "+current];if(conv2){conv1=converters[conv1],conv1===!0?conv=conv2:conv2===!0&&(conv=conv1);break}}}}!conv&&!conv2&&jQuery.error("No conversion from "+conversion.replace(" "," to ")),conv!==!0&&(response=conv?conv(response):conv2(conv1(response)))}}return response}function createStandardXHR(){try{return new window.XMLHttpRequest}catch(e){}}function createActiveXHR(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}function createFxNow(){return setTimeout(clearFxNow,0),fxNow=jQuery.now()}function clearFxNow(){fxNow=undefined}function genFx(type,num){var obj={};return jQuery.each(fxAttrs.concat.apply([],fxAttrs.slice(0,num)),function(){obj[this]=type}),obj}function defaultDisplay(nodeName){if(!elemdisplay[nodeName]){var body=
document.body,elem=jQuery("<"+nodeName+">").appendTo(body),display=elem.css("display");elem.remove();if(display==="none"||display===""){iframe||(iframe=document.createElement("iframe"),iframe.frameBorder=iframe.width=iframe.height=0),body.appendChild(iframe);if(!iframeDoc||!iframe.createElement)iframeDoc=(iframe.contentWindow||iframe.contentDocument).document,iframeDoc.write((jQuery.support.boxModel?"<!doctype html>":"")+"<html><body>"),iframeDoc.close();elem=iframeDoc.createElement(nodeName),iframeDoc.body.appendChild(elem),display=jQuery.css(elem,"display"),body.removeChild(iframe)}elemdisplay[nodeName]=display}return elemdisplay[nodeName]}function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9?elem.defaultView||elem.parentWindow:!1}var document=window.document,navigator=window.navigator,location=window.location,jQuery=function(){function doScrollCheck(){if(jQuery.isReady)return;try{document.documentElement.doScroll("left")}catch(e){setTimeout(doScrollCheck,1);return}
jQuery.ready()}var jQuery=function(selector,context){return new jQuery.fn.init(selector,context,rootjQuery)},_jQuery=window.jQuery,_$=window.$,rootjQuery,quickExpr=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,rnotwhite=/\S/,trimLeft=/^\s+/,trimRight=/\s+$/,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,rvalidchars=/^[\],:{}\s]*$/,rvalidescape=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rvalidtokens=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rwebkit=/(webkit)[ \/]([\w.]+)/,ropera=/(opera)(?:.*version)?[ \/]([\w.]+)/,rmsie=/(msie) ([\w.]+)/,rmozilla=/(mozilla)(?:.*? rv:([\w.]+))?/,rdashAlpha=/-([a-z]|[0-9])/ig,rmsPrefix=/^-ms-/,fcamelCase=function(all,letter){return(letter+"").toUpperCase()},userAgent=navigator.userAgent,browserMatch,readyList,DOMContentLoaded,toString=Object.prototype.toString,hasOwn=Object.prototype.hasOwnProperty,push=Array.prototype.push,slice=Array.prototype.slice,trim=String.prototype.trim,indexOf=Array.prototype.indexOf,
class2type={};return jQuery.fn=jQuery.prototype={constructor:jQuery,init:function(selector,context,rootjQuery){var match,elem,ret,doc;if(!selector)return this;if(selector.nodeType)return this.context=this[0]=selector,this.length=1,this;if(selector==="body"&&!context&&document.body)return this.context=document,this[0]=document.body,this.selector=selector,this.length=1,this;if(typeof selector=="string"){selector.charAt(0)==="<"&&selector.charAt(selector.length-1)===">"&&selector.length>=3?match=[null,selector,null]:match=quickExpr.exec(selector);if(match&&(match[1]||!context)){if(match[1])return context=context instanceof jQuery?context[0]:context,doc=context?context.ownerDocument||context:document,ret=rsingleTag.exec(selector),ret?jQuery.isPlainObject(context)?(selector=[document.createElement(ret[1])],jQuery.fn.attr.call(selector,context,!0)):selector=[doc.createElement(ret[1])]:(ret=jQuery.buildFragment([match[1]],[doc]),selector=(ret.cacheable?jQuery.clone(ret.fragment):ret.fragment).
childNodes),jQuery.merge(this,selector);elem=document.getElementById(match[2]);if(elem&&elem.parentNode){if(elem.id!==match[2])return rootjQuery.find(selector);this.length=1,this[0]=elem}return this.context=document,this.selector=selector,this}return!context||context.jquery?(context||rootjQuery).find(selector):this.constructor(context).find(selector)}return jQuery.isFunction(selector)?rootjQuery.ready(selector):(selector.selector!==undefined&&(this.selector=selector.selector,this.context=selector.context),jQuery.makeArray(selector,this))},selector:"",jquery:"1.7.2",length:0,size:function(){return this.length},toArray:function(){return slice.call(this,0)},get:function(num){return num==null?this.toArray():num<0?this[this.length+num]:this[num]},pushStack:function(elems,name,selector){var ret=this.constructor();return jQuery.isArray(elems)?push.apply(ret,elems):jQuery.merge(ret,elems),ret.prevObject=this,ret.context=this.context,name==="find"?ret.selector=this.selector+(this.selector?" ":""
)+selector:name&&(ret.selector=this.selector+"."+name+"("+selector+")"),ret},each:function(callback,args){return jQuery.each(this,callback,args)},ready:function(fn){return jQuery.bindReady(),readyList.add(fn),this},eq:function(i){return i=+i,i===-1?this.slice(i):this.slice(i,i+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(slice.apply(this,arguments),"slice",slice.call(arguments).join(","))},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},end:function(){return this.prevObject||this.constructor(null)},push:push,sort:[].sort,splice:[].splice},jQuery.fn.init.prototype=jQuery.fn,jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=!1;typeof target=="boolean"&&(deep=target,target=arguments[1]||{},i=2),typeof target!="object"&&!jQuery.isFunction(target)&&(target={}),length===
i&&(target=this,--i);for(;i<length;i++)if((options=arguments[i])!=null)for(name in options){src=target[name],copy=options[name];if(target===copy)continue;deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))?(copyIsArray?(copyIsArray=!1,clone=src&&jQuery.isArray(src)?src:[]):clone=src&&jQuery.isPlainObject(src)?src:{},target[name]=jQuery.extend(deep,clone,copy)):copy!==undefined&&(target[name]=copy)}return target},jQuery.extend({noConflict:function(deep){return window.$===jQuery&&(window.$=_$),deep&&window.jQuery===jQuery&&(window.jQuery=_jQuery),jQuery},isReady:!1,readyWait:1,holdReady:function(hold){hold?jQuery.readyWait++:jQuery.ready(!0)},ready:function(wait){if(wait===!0&&!--jQuery.readyWait||wait!==!0&&!jQuery.isReady){if(!document.body)return setTimeout(jQuery.ready,1);jQuery.isReady=!0;if(wait!==!0&&--jQuery.readyWait>0)return;readyList.fireWith(document,[jQuery]),jQuery.fn.trigger&&jQuery(document).trigger("ready").off("ready")}},bindReady:function(){if(readyList
)return;readyList=jQuery.Callbacks("once memory");if(document.readyState==="complete")return setTimeout(jQuery.ready,1);if(document.addEventListener)document.addEventListener("DOMContentLoaded",DOMContentLoaded,!1),window.addEventListener("load",jQuery.ready,!1);else if(document.attachEvent){document.attachEvent("onreadystatechange",DOMContentLoaded),window.attachEvent("onload",jQuery.ready);var toplevel=!1;try{toplevel=window.frameElement==null}catch(e){}document.documentElement.doScroll&&toplevel&&doScrollCheck()}},isFunction:function(obj){return jQuery.type(obj)==="function"},isArray:Array.isArray||function(obj){return jQuery.type(obj)==="array"},isWindow:function(obj){return obj!=null&&obj==obj.window},isNumeric:function(obj){return!isNaN(parseFloat(obj))&&isFinite(obj)},type:function(obj){return obj==null?String(obj):class2type[toString.call(obj)]||"object"},isPlainObject:function(obj){if(!obj||jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj))return!1;try{if(obj.constructor&&!
hasOwn.call(obj,"constructor")&&!hasOwn.call(obj.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}var key;for(key in obj);return key===undefined||hasOwn.call(obj,key)},isEmptyObject:function(obj){for(var name in obj)return!1;return!0},error:function(msg){throw new Error(msg)},parseJSON:function(data){if(typeof data!="string"||!data)return null;data=jQuery.trim(data);if(window.JSON&&window.JSON.parse)return window.JSON.parse(data);if(rvalidchars.test(data.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,"")))return(new Function("return "+data))();jQuery.error("Invalid JSON: "+data)},parseXML:function(data){if(typeof data!="string"||!data)return null;var xml,tmp;try{window.DOMParser?(tmp=new DOMParser,xml=tmp.parseFromString(data,"text/xml")):(xml=new ActiveXObject("Microsoft.XMLDOM"),xml.async="false",xml.loadXML(data))}catch(e){xml=undefined}return(!xml||!xml.documentElement||xml.getElementsByTagName("parsererror").length)&&jQuery.error("Invalid XML: "+
data),xml},noop:function(){},globalEval:function(data){data&&rnotwhite.test(data)&&(window.execScript||function(data){window.eval.call(window,data)})(data)},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toUpperCase()===name.toUpperCase()},each:function(object,callback,args){var name,i=0,length=object.length,isObj=length===undefined||jQuery.isFunction(object);if(args){if(isObj){for(name in object)if(callback.apply(object[name],args)===!1)break}else for(;i<length;)if(callback.apply(object[i++],args)===!1)break}else if(isObj){for(name in object)if(callback.call(object[name],name,object[name])===!1)break}else for(;i<length;)if(callback.call(object[i],i,object[i++])===!1)break;return object},trim:trim?function(text){return text==null?"":trim.call(text)}:function(text){return text==null?"":text.toString().replace(trimLeft,"").replace(trimRight,"")},makeArray:function(array,results
){var ret=results||[];if(array!=null){var type=jQuery.type(array);array.length==null||type==="string"||type==="function"||type==="regexp"||jQuery.isWindow(array)?push.call(ret,array):jQuery.merge(ret,array)}return ret},inArray:function(elem,array,i){var len;if(array){if(indexOf)return indexOf.call(array,elem,i);len=array.length,i=i?i<0?Math.max(0,len+i):i:0;for(;i<len;i++)if(i in array&&array[i]===elem)return i}return-1},merge:function(first,second){var i=first.length,j=0;if(typeof second.length=="number")for(var l=second.length;j<l;j++)first[i++]=second[j];else while(second[j]!==undefined)first[i++]=second[j++];return first.length=i,first},grep:function(elems,callback,inv){var ret=[],retVal;inv=!!inv;for(var i=0,length=elems.length;i<length;i++)retVal=!!callback(elems[i],i),inv!==retVal&&ret.push(elems[i]);return ret},map:function(elems,callback,arg){var value,key,ret=[],i=0,length=elems.length,isArray=elems instanceof jQuery||length!==undefined&&typeof length=="number"&&(length>0&&elems
[0]&&elems[length-1]||length===0||jQuery.isArray(elems));if(isArray)for(;i<length;i++)value=callback(elems[i],i,arg),value!=null&&(ret[ret.length]=value);else for(key in elems)value=callback(elems[key],key,arg),value!=null&&(ret[ret.length]=value);return ret.concat.apply([],ret)},guid:1,proxy:function(fn,context){if(typeof context=="string"){var tmp=fn[context];context=fn,fn=tmp}if(!jQuery.isFunction(fn))return undefined;var args=slice.call(arguments,2),proxy=function(){return fn.apply(context,args.concat(slice.call(arguments)))};return proxy.guid=fn.guid=fn.guid||proxy.guid||jQuery.guid++,proxy},access:function(elems,fn,key,value,chainable,emptyGet,pass){var exec,bulk=key==null,i=0,length=elems.length;if(key&&typeof key=="object"){for(i in key)jQuery.access(elems,fn,i,key[i],1,emptyGet,value);chainable=1}else if(value!==undefined){exec=pass===undefined&&jQuery.isFunction(value),bulk&&(exec?(exec=fn,fn=function(elem,key,value){return exec.call(jQuery(elem),value)}):(fn.call(elems,value)
,fn=null));if(fn)for(;i<length;i++)fn(elems[i],key,exec?value.call(elems[i],i,fn(elems[i],key)):value,pass);chainable=1}return chainable?elems:bulk?fn.call(elems):length?fn(elems[0],key):emptyGet},now:function(){return(new Date).getTime()},uaMatch:function(ua){ua=ua.toLowerCase();var match=rwebkit.exec(ua)||ropera.exec(ua)||rmsie.exec(ua)||ua.indexOf("compatible")<0&&rmozilla.exec(ua)||[];return{browser:match[1]||"",version:match[2]||"0"}},sub:function(){function jQuerySub(selector,context){return new jQuerySub.fn.init(selector,context)}jQuery.extend(!0,jQuerySub,this),jQuerySub.superclass=this,jQuerySub.fn=jQuerySub.prototype=this(),jQuerySub.fn.constructor=jQuerySub,jQuerySub.sub=this.sub,jQuerySub.fn.init=function(selector,context){return context&&context instanceof jQuery&&!(context instanceof jQuerySub)&&(context=jQuerySub(context)),jQuery.fn.init.call(this,selector,context,rootjQuerySub)},jQuerySub.fn.init.prototype=jQuerySub.fn;var rootjQuerySub=jQuerySub(document);return jQuerySub
},browser:{}}),jQuery.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()}),browserMatch=jQuery.uaMatch(userAgent),browserMatch.browser&&(jQuery.browser[browserMatch.browser]=!0,jQuery.browser.version=browserMatch.version),jQuery.browser.webkit&&(jQuery.browser.safari=!0),rnotwhite.test("\u00a0")&&(trimLeft=/^[\s\xA0]+/,trimRight=/[\s\xA0]+$/),rootjQuery=jQuery(document),document.addEventListener?DOMContentLoaded=function(){document.removeEventListener("DOMContentLoaded",DOMContentLoaded,!1),jQuery.ready()}:document.attachEvent&&(DOMContentLoaded=function(){document.readyState==="complete"&&(document.detachEvent("onreadystatechange",DOMContentLoaded),jQuery.ready())}),jQuery}(),flagsCache={};jQuery.Callbacks=function(flags){flags=flags?flagsCache[flags]||createFlags(flags):{};var list=[],stack=[],memory,fired,firing,firingStart,firingLength,firingIndex,add=function(args){var i,length,elem,type,actual
;for(i=0,length=args.length;i<length;i++)elem=args[i],type=jQuery.type(elem),type==="array"?add(elem):type==="function"&&(!flags.unique||!self.has(elem))&&list.push(elem)},fire=function(context,args){args=args||[],memory=!flags.memory||[context,args],fired=!0,firing=!0,firingIndex=firingStart||0,firingStart=0,firingLength=list.length;for(;list&&firingIndex<firingLength;firingIndex++)if(list[firingIndex].apply(context,args)===!1&&flags.stopOnFalse){memory=!0;break}firing=!1,list&&(flags.once?memory===!0?self.disable():list=[]:stack&&stack.length&&(memory=stack.shift(),self.fireWith(memory[0],memory[1])))},self={add:function(){if(list){var length=list.length;add(arguments),firing?firingLength=list.length:memory&&memory!==!0&&(firingStart=length,fire(memory[0],memory[1]))}return this},remove:function(){if(list){var args=arguments,argIndex=0,argLength=args.length;for(;argIndex<argLength;argIndex++)for(var i=0;i<list.length;i++)if(args[argIndex]===list[i]){firing&&i<=firingLength&&(firingLength--
,i<=firingIndex&&firingIndex--),list.splice(i--,1);if(flags.unique)break}}return this},has:function(fn){if(list){var i=0,length=list.length;for(;i<length;i++)if(fn===list[i])return!0}return!1},empty:function(){return list=[],this},disable:function(){return list=stack=memory=undefined,this},disabled:function(){return!list},lock:function(){return stack=undefined,(!memory||memory===!0)&&self.disable(),this},locked:function(){return!stack},fireWith:function(context,args){return stack&&(firing?flags.once||stack.push([context,args]):(!flags.once||!memory)&&fire(context,args)),this},fire:function(){return self.fireWith(this,arguments),this},fired:function(){return!!fired}};return self};var sliceDeferred=[].slice;jQuery.extend({Deferred:function(func){var doneList=jQuery.Callbacks("once memory"),failList=jQuery.Callbacks("once memory"),progressList=jQuery.Callbacks("memory"),state="pending",lists={resolve:doneList,reject:failList,notify:progressList},promise={done:doneList.add,fail:failList.add
,progress:progressList.add,state:function(){return state},isResolved:doneList.fired,isRejected:failList.fired,then:function(doneCallbacks,failCallbacks,progressCallbacks){return deferred.done(doneCallbacks).fail(failCallbacks).progress(progressCallbacks),this},always:function(){return deferred.done.apply(deferred,arguments).fail.apply(deferred,arguments),this},pipe:function(fnDone,fnFail,fnProgress){return jQuery.Deferred(function(newDefer){jQuery.each({done:[fnDone,"resolve"],fail:[fnFail,"reject"],progress:[fnProgress,"notify"]},function(handler,data){var fn=data[0],action=data[1],returned;jQuery.isFunction(fn)?deferred[handler](function(){returned=fn.apply(this,arguments),returned&&jQuery.isFunction(returned.promise)?returned.promise().then(newDefer.resolve,newDefer.reject,newDefer.notify):newDefer[action+"With"](this===deferred?newDefer:this,[returned])}):deferred[handler](newDefer[action])})}).promise()},promise:function(obj){if(obj==null)obj=promise;else for(var key in promise)obj
[key]=promise[key];return obj}},deferred=promise.promise({}),key;for(key in lists)deferred[key]=lists[key].fire,deferred[key+"With"]=lists[key].fireWith;return deferred.done(function(){state="resolved"},failList.disable,progressList.lock).fail(function(){state="rejected"},doneList.disable,progressList.lock),func&&func.call(deferred,deferred),deferred},when:function(firstParam){function resolveFunc(i){return function(value){args[i]=arguments.length>1?sliceDeferred.call(arguments,0):value,--count||deferred.resolveWith(deferred,args)}}function progressFunc(i){return function(value){pValues[i]=arguments.length>1?sliceDeferred.call(arguments,0):value,deferred.notifyWith(promise,pValues)}}var args=sliceDeferred.call(arguments,0),i=0,length=args.length,pValues=new Array(length),count=length,pCount=length,deferred=length<=1&&firstParam&&jQuery.isFunction(firstParam.promise)?firstParam:jQuery.Deferred(),promise=deferred.promise();if(length>1){for(;i<length;i++)args[i]&&args[i].promise&&jQuery.isFunction
(args[i].promise)?args[i].promise().then(resolveFunc(i),deferred.reject,progressFunc(i)):--count;count||deferred.resolveWith(deferred,args)}else deferred!==firstParam&&deferred.resolveWith(deferred,length?[firstParam]:[]);return promise}}),jQuery.support=function(){var support,all,a,select,opt,input,fragment,tds,events,eventName,i,isSupported,div=document.createElement("div"),documentElement=document.documentElement;div.setAttribute("className","t"),div.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",all=div.getElementsByTagName("*"),a=div.getElementsByTagName("a")[0];if(!all||!all.length||!a)return{};select=document.createElement("select"),opt=select.appendChild(document.createElement("option")),input=div.getElementsByTagName("input")[0],support={leadingWhitespace:div.firstChild.nodeType===3,tbody:!div.getElementsByTagName("tbody").length,htmlSerialize:!!div.getElementsByTagName("link").length,style:/top/.test(a.getAttribute
("style")),hrefNormalized:a.getAttribute("href")==="/a",opacity:/^0.55/.test(a.style.opacity),cssFloat:!!a.style.cssFloat,checkOn:input.value==="on",optSelected:opt.selected,getSetAttribute:div.className!=="t",enctype:!!document.createElement("form").enctype,html5Clone:document.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,pixelMargin:!0},jQuery.boxModel=support.boxModel=document.compatMode==="CSS1Compat",input.checked=!0,support.noCloneChecked=input.cloneNode(!0).checked,select.disabled=!0,support.optDisabled=!opt.disabled;try{delete div.test}catch(e){support.deleteExpando=!1}!div.addEventListener&&div.attachEvent&&div.fireEvent&&(div.attachEvent("onclick",function(){support.noCloneEvent=!1}),div.cloneNode(!0).fireEvent("onclick")),input=document.createElement("input"),input.value="t",input.setAttribute("type","radio"
),support.radioValue=input.value==="t",input.setAttribute("checked","checked"),input.setAttribute("name","t"),div.appendChild(input),fragment=document.createDocumentFragment(),fragment.appendChild(div.lastChild),support.checkClone=fragment.cloneNode(!0).cloneNode(!0).lastChild.checked,support.appendChecked=input.checked,fragment.removeChild(input),fragment.appendChild(div);if(div.attachEvent)for(i in{submit:1,change:1,focusin:1})eventName="on"+i,isSupported=eventName in div,isSupported||(div.setAttribute(eventName,"return;"),isSupported=typeof div[eventName]=="function"),support[i+"Bubbles"]=isSupported;return fragment.removeChild(div),fragment=select=opt=div=input=null,jQuery(function(){var container,outer,inner,table,td,offsetSupport,marginDiv,conMarginTop,style,html,positionTopLeftWidthHeight,paddingMarginBorderVisibility,paddingMarginBorder,body=document.getElementsByTagName("body")[0];if(!body)return;conMarginTop=1,paddingMarginBorder="padding:0;margin:0;border:",positionTopLeftWidthHeight="position:absolute;top:0;left:0;width:1px;height:1px;"
,paddingMarginBorderVisibility=paddingMarginBorder+"0;visibility:hidden;",style="style='"+positionTopLeftWidthHeight+paddingMarginBorder+"5px solid #000;",html="<div "+style+"display:block;'><div style='"+paddingMarginBorder+"0;display:block;overflow:hidden;'></div></div>"+"<table "+style+"' cellpadding='0' cellspacing='0'>"+"<tr><td></td></tr></table>",container=document.createElement("div"),container.style.cssText=paddingMarginBorderVisibility+"width:0;height:0;position:static;top:0;margin-top:"+conMarginTop+"px",body.insertBefore(container,body.firstChild),div=document.createElement("div"),container.appendChild(div),div.innerHTML="<table><tr><td style='"+paddingMarginBorder+"0;display:none'></td><td>t</td></tr></table>",tds=div.getElementsByTagName("td"),isSupported=tds[0].offsetHeight===0,tds[0].style.display="",tds[1].style.display="none",support.reliableHiddenOffsets=isSupported&&tds[0].offsetHeight===0,window.getComputedStyle&&(div.innerHTML="",marginDiv=document.createElement("div"
),marginDiv.style.width="0",marginDiv.style.marginRight="0",div.style.width="2px",div.appendChild(marginDiv),support.reliableMarginRight=(parseInt((window.getComputedStyle(marginDiv,null)||{marginRight:0}).marginRight,10)||0)===0),typeof div.style.zoom!="undefined"&&(div.innerHTML="",div.style.width=div.style.padding="1px",div.style.border=0,div.style.overflow="hidden",div.style.display="inline",div.style.zoom=1,support.inlineBlockNeedsLayout=div.offsetWidth===3,div.style.display="block",div.style.overflow="visible",div.innerHTML="<div style='width:5px;'></div>",support.shrinkWrapBlocks=div.offsetWidth!==3),div.style.cssText=positionTopLeftWidthHeight+paddingMarginBorderVisibility,div.innerHTML=html,outer=div.firstChild,inner=outer.firstChild,td=outer.nextSibling.firstChild.firstChild,offsetSupport={doesNotAddBorder:inner.offsetTop!==5,doesAddBorderForTableAndCells:td.offsetTop===5},inner.style.position="fixed",inner.style.top="20px",offsetSupport.fixedPosition=inner.offsetTop===20||inner
.offsetTop===15,inner.style.position=inner.style.top="",outer.style.overflow="hidden",outer.style.position="relative",offsetSupport.subtractsBorderForOverflowNotVisible=inner.offsetTop===-5,offsetSupport.doesNotIncludeMarginInBodyOffset=body.offsetTop!==conMarginTop,window.getComputedStyle&&(div.style.marginTop="1%",support.pixelMargin=(window.getComputedStyle(div,null)||{marginTop:0}).marginTop!=="1%"),typeof container.style.zoom!="undefined"&&(container.style.zoom=1),body.removeChild(container),marginDiv=div=container=null,jQuery.extend(support,offsetSupport)}),support}();var rbrace=/^(?:\{.*\}|\[.*\])$/,rmultiDash=/([A-Z])/g;jQuery.extend({cache:{},uuid:0,expando:"jQuery"+(jQuery.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(elem){return elem=elem.nodeType?jQuery.cache[elem[jQuery.expando]]:elem[jQuery.expando],!!elem&&!isEmptyDataObject(elem)},data:function(elem,name,data,pvt){if(!jQuery.acceptData
(elem))return;var privateCache,thisCache,ret,internalKey=jQuery.expando,getByName=typeof name=="string",isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[internalKey]:elem[internalKey]&&internalKey,isEvents=name==="events";if((!id||!cache[id]||!isEvents&&!pvt&&!cache[id].data)&&getByName&&data===undefined)return;id||(isNode?elem[internalKey]=id=++jQuery.uuid:id=internalKey),cache[id]||(cache[id]={},isNode||(cache[id].toJSON=jQuery.noop));if(typeof name=="object"||typeof name=="function")pvt?cache[id]=jQuery.extend(cache[id],name):cache[id].data=jQuery.extend(cache[id].data,name);return privateCache=thisCache=cache[id],pvt||(thisCache.data||(thisCache.data={}),thisCache=thisCache.data),data!==undefined&&(thisCache[jQuery.camelCase(name)]=data),isEvents&&!thisCache[name]?privateCache.events:(getByName?(ret=thisCache[name],ret==null&&(ret=thisCache[jQuery.camelCase(name)])):ret=thisCache,ret)},removeData:function(elem,name,pvt){if(!jQuery.acceptData(elem))return;var thisCache
,i,l,internalKey=jQuery.expando,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[internalKey]:internalKey;if(!cache[id])return;if(name){thisCache=pvt?cache[id]:cache[id].data;if(thisCache){jQuery.isArray(name)||(name in thisCache?name=[name]:(name=jQuery.camelCase(name),name in thisCache?name=[name]:name=name.split(" ")));for(i=0,l=name.length;i<l;i++)delete thisCache[name[i]];if(!(pvt?isEmptyDataObject:jQuery.isEmptyObject)(thisCache))return}}if(!pvt){delete cache[id].data;if(!isEmptyDataObject(cache[id]))return}jQuery.support.deleteExpando||!cache.setInterval?delete cache[id]:cache[id]=null,isNode&&(jQuery.support.deleteExpando?delete elem[internalKey]:elem.removeAttribute?elem.removeAttribute(internalKey):elem[internalKey]=null)},_data:function(elem,name,data){return jQuery.data(elem,name,data,!0)},acceptData:function(elem){if(elem.nodeName){var match=jQuery.noData[elem.nodeName.toLowerCase()];if(match)return match!==!0&&elem.getAttribute("classid")===match}return!0
}}),jQuery.fn.extend({data:function(key,value){var parts,part,attr,name,l,elem=this[0],i=0,data=null;if(key===undefined){if(this.length){data=jQuery.data(elem);if(elem.nodeType===1&&!jQuery._data(elem,"parsedAttrs")){attr=elem.attributes;for(l=attr.length;i<l;i++)name=attr[i].name,name.indexOf("data-")===0&&(name=jQuery.camelCase(name.substring(5)),dataAttr(elem,name,data[name]));jQuery._data(elem,"parsedAttrs",!0)}}return data}return typeof key=="object"?this.each(function(){jQuery.data(this,key)}):(parts=key.split(".",2),parts[1]=parts[1]?"."+parts[1]:"",part=parts[1]+"!",jQuery.access(this,function(value){if(value===undefined)return data=this.triggerHandler("getData"+part,[parts[0]]),data===undefined&&elem&&(data=jQuery.data(elem,key),data=dataAttr(elem,key,data)),data===undefined&&parts[1]?this.data(parts[0]):data;parts[1]=value,this.each(function(){var self=jQuery(this);self.triggerHandler("setData"+part,parts),jQuery.data(this,key,value),self.triggerHandler("changeData"+part,parts
)})},null,value,arguments.length>1,null,!1))},removeData:function(key){return this.each(function(){jQuery.removeData(this,key)})}}),jQuery.extend({_mark:function(elem,type){elem&&(type=(type||"fx")+"mark",jQuery._data(elem,type,(jQuery._data(elem,type)||0)+1))},_unmark:function(force,elem,type){force!==!0&&(type=elem,elem=force,force=!1);if(elem){type=type||"fx";var key=type+"mark",count=force?0:(jQuery._data(elem,key)||1)-1;count?jQuery._data(elem,key,count):(jQuery.removeData(elem,key,!0),handleQueueMarkDefer(elem,type,"mark"))}},queue:function(elem,type,data){var q;if(elem)return type=(type||"fx")+"queue",q=jQuery._data(elem,type),data&&(!q||jQuery.isArray(data)?q=jQuery._data(elem,type,jQuery.makeArray(data)):q.push(data)),q||[]},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),fn=queue.shift(),hooks={};fn==="inprogress"&&(fn=queue.shift()),fn&&(type==="fx"&&queue.unshift("inprogress"),jQuery._data(elem,type+".run",hooks),fn.call(elem,function(){jQuery.dequeue
(elem,type)},hooks)),queue.length||(jQuery.removeData(elem,type+"queue "+type+".run",!0),handleQueueMarkDefer(elem,type,"queue"))}}),jQuery.fn.extend({queue:function(type,data){var setter=2;return typeof type!="string"&&(data=type,type="fx",setter--),arguments.length<setter?jQuery.queue(this[0],type):data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);type==="fx"&&queue[0]!=="inprogress"&&jQuery.dequeue(this,type)})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},delay:function(time,type){return time=jQuery.fx?jQuery.fx.speeds[time]||time:time,type=type||"fx",this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout)}})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,object){function resolve(){--count||defer.resolveWith(elements,[elements])}typeof type!="string"&&(object=type,type=undefined),type=type||"fx";var defer=jQuery.Deferred(),
elements=this,i=elements.length,count=1,deferDataKey=type+"defer",queueDataKey=type+"queue",markDataKey=type+"mark",tmp;while(i--)if(tmp=jQuery.data(elements[i],deferDataKey,undefined,!0)||(jQuery.data(elements[i],queueDataKey,undefined,!0)||jQuery.data(elements[i],markDataKey,undefined,!0))&&jQuery.data(elements[i],deferDataKey,jQuery.Callbacks("once memory"),!0))count++,tmp.add(resolve);return resolve(),defer.promise(object)}});var rclass=/[\n\t\r]/g,rspace=/\s+/,rreturn=/\r/g,rtype=/^(?:button|input)$/i,rfocusable=/^(?:button|input|object|select|textarea)$/i,rclickable=/^a(?:rea)?$/i,rboolean=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,getSetAttribute=jQuery.support.getSetAttribute,nodeHook,boolHook,fixSpecified;jQuery.fn.extend({attr:function(name,value){return jQuery.access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name
)})},prop:function(name,value){return jQuery.access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){return name=jQuery.propFix[name]||name,this.each(function(){try{this[name]=undefined,delete this[name]}catch(e){}})},addClass:function(value){var classNames,i,l,elem,setClass,c,cl;if(jQuery.isFunction(value))return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className))});if(value&&typeof value=="string"){classNames=value.split(rspace);for(i=0,l=this.length;i<l;i++){elem=this[i];if(elem.nodeType===1)if(!elem.className&&classNames.length===1)elem.className=value;else{setClass=" "+elem.className+" ";for(c=0,cl=classNames.length;c<cl;c++)~setClass.indexOf(" "+classNames[c]+" ")||(setClass+=classNames[c]+" ");elem.className=jQuery.trim(setClass)}}}return this},removeClass:function(value){var classNames,i,l,elem,className,c,cl;if(jQuery.isFunction(value))return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className))});
if(value&&typeof value=="string"||value===undefined){classNames=(value||"").split(rspace);for(i=0,l=this.length;i<l;i++){elem=this[i];if(elem.nodeType===1&&elem.className)if(value){className=(" "+elem.className+" ").replace(rclass," ");for(c=0,cl=classNames.length;c<cl;c++)className=className.replace(" "+classNames[c]+" "," ");elem.className=jQuery.trim(className)}else elem.className=""}}return this},toggleClass:function(value,stateVal){var type=typeof value,isBool=typeof stateVal=="boolean";return jQuery.isFunction(value)?this.each(function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal)}):this.each(function(){if(type==="string"){var className,i=0,self=jQuery(this),state=stateVal,classNames=value.split(rspace);while(className=classNames[i++])state=isBool?state:!self.hasClass(className),self[state?"addClass":"removeClass"](className)}else if(type==="undefined"||type==="boolean")this.className&&jQuery._data(this,"__className__",this.className),this.className=
this.className||value===!1?"":jQuery._data(this,"__className__")||""})},hasClass:function(selector){var className=" "+selector+" ",i=0,l=this.length;for(;i<l;i++)if(this[i].nodeType===1&&(" "+this[i].className+" ").replace(rclass," ").indexOf(className)>-1)return!0;return!1},val:function(value){var hooks,ret,isFunction,elem=this[0];if(!arguments.length){if(elem)return hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()],hooks&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined?ret:(ret=elem.value,typeof ret=="string"?ret.replace(rreturn,""):ret==null?"":ret);return}return isFunction=jQuery.isFunction(value),this.each(function(i){var self=jQuery(this),val;if(this.nodeType!==1)return;isFunction?val=value.call(this,i,self.val()):val=value,val==null?val="":typeof val=="number"?val+="":jQuery.isArray(val)&&(val=jQuery.map(val,function(value){return value==null?"":value+""})),hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!hooks||!
("set"in hooks)||hooks.set(this,val,"value")===undefined)this.value=val})}}),jQuery.extend({valHooks:{option:{get:function(elem){var val=elem.attributes.value;return!val||val.specified?elem.value:elem.text}},select:{get:function(elem){var value,i,max,option,index=elem.selectedIndex,values=[],options=elem.options,one=elem.type==="select-one";if(index<0)return null;i=one?index:0,max=one?index+1:options.length;for(;i<max;i++){option=options[i];if(option.selected&&(jQuery.support.optDisabled?!option.disabled:option.getAttribute("disabled")===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one)return value;values.push(value)}}return one&&!values.length&&options.length?jQuery(options[index]).val():values},set:function(elem,value){var values=jQuery.makeArray(value);return jQuery(elem).find("option").each(function(){this.selected=jQuery.inArray(jQuery(this).val(),values)>=0}),values.length||(elem.selectedIndex=-1),values}}},attrFn
:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(elem,name,value,pass){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2)return;if(pass&&name in jQuery.attrFn)return jQuery(elem)[name](value);if(typeof elem.getAttribute=="undefined")return jQuery.prop(elem,name,value);notxml=nType!==1||!jQuery.isXMLDoc(elem),notxml&&(name=name.toLowerCase(),hooks=jQuery.attrHooks[name]||(rboolean.test(name)?boolHook:nodeHook));if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name);return}return hooks&&"set"in hooks&&notxml&&(ret=hooks.set(elem,value,name))!==undefined?ret:(elem.setAttribute(name,""+value),value)}return hooks&&"get"in hooks&&notxml&&(ret=hooks.get(elem,name))!==null?ret:(ret=elem.getAttribute(name),ret===null?undefined:ret)},removeAttr:function(elem,value){var propName,attrNames,name,l,isBool,i=0;if(value&&elem.nodeType===1){attrNames=value.toLowerCase().split(rspace),l=attrNames.length;for(;i<l;i++)name=attrNames
[i],name&&(propName=jQuery.propFix[name]||name,isBool=rboolean.test(name),isBool||jQuery.attr(elem,name,""),elem.removeAttribute(getSetAttribute?name:propName),isBool&&propName in elem&&(elem[propName]=!1))}},attrHooks:{type:{set:function(elem,value){if(rtype.test(elem.nodeName)&&elem.parentNode)jQuery.error("type property can't be changed");else if(!jQuery.support.radioValue&&value==="radio"&&jQuery.nodeName(elem,"input")){var val=elem.value;return elem.setAttribute("type",value),val&&(elem.value=val),value}}},value:{get:function(elem,name){return nodeHook&&jQuery.nodeName(elem,"button")?nodeHook.get(elem,name):name in elem?elem.value:null},set:function(elem,value,name){if(nodeHook&&jQuery.nodeName(elem,"button"))return nodeHook.set(elem,value,name);elem.value=value}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder
:"frameBorder",contenteditable:"contentEditable"},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2)return;return notxml=nType!==1||!jQuery.isXMLDoc(elem),notxml&&(name=jQuery.propFix[name]||name,hooks=jQuery.propHooks[name]),value!==undefined?hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined?ret:elem[name]=value:hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null?ret:elem[name]},propHooks:{tabIndex:{get:function(elem){var attributeNode=elem.getAttributeNode("tabindex");return attributeNode&&attributeNode.specified?parseInt(attributeNode.value,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:undefined}}}}),jQuery.attrHooks.tabindex=jQuery.propHooks.tabIndex,boolHook={get:function(elem,name){var attrNode,property=jQuery.prop(elem,name);return property===!0||typeof property!="boolean"&&(attrNode=elem.getAttributeNode(name))&&attrNode.nodeValue!==!1?name.toLowerCase():undefined
},set:function(elem,value,name){var propName;return value===!1?jQuery.removeAttr(elem,name):(propName=jQuery.propFix[name]||name,propName in elem&&(elem[propName]=!0),elem.setAttribute(name,name.toLowerCase())),name}},getSetAttribute||(fixSpecified={name:!0,id:!0,coords:!0},nodeHook=jQuery.valHooks.button={get:function(elem,name){var ret;return ret=elem.getAttributeNode(name),ret&&(fixSpecified[name]?ret.nodeValue!=="":ret.specified)?ret.nodeValue:undefined},set:function(elem,value,name){var ret=elem.getAttributeNode(name);return ret||(ret=document.createAttribute(name),elem.setAttributeNode(ret)),ret.nodeValue=value+""}},jQuery.attrHooks.tabindex.set=nodeHook.set,jQuery.each(["width","height"],function(i,name){jQuery.attrHooks[name]=jQuery.extend(jQuery.attrHooks[name],{set:function(elem,value){if(value==="")return elem.setAttribute(name,"auto"),value}})}),jQuery.attrHooks.contenteditable={get:nodeHook.get,set:function(elem,value,name){value===""&&(value="false"),nodeHook.set(elem,value
,name)}}),jQuery.support.hrefNormalized||jQuery.each(["href","src","width","height"],function(i,name){jQuery.attrHooks[name]=jQuery.extend(jQuery.attrHooks[name],{get:function(elem){var ret=elem.getAttribute(name,2);return ret===null?undefined:ret}})}),jQuery.support.style||(jQuery.attrHooks.style={get:function(elem){return elem.style.cssText.toLowerCase()||undefined},set:function(elem,value){return elem.style.cssText=""+value}}),jQuery.support.optSelected||(jQuery.propHooks.selected=jQuery.extend(jQuery.propHooks.selected,{get:function(elem){var parent=elem.parentNode;return parent&&(parent.selectedIndex,parent.parentNode&&parent.parentNode.selectedIndex),null}})),jQuery.support.enctype||(jQuery.propFix.enctype="encoding"),jQuery.support.checkOn||jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={get:function(elem){return elem.getAttribute("value")===null?"on":elem.value}}}),jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]=jQuery.extend(jQuery.valHooks[
this],{set:function(elem,value){if(jQuery.isArray(value))return elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0}})});var rformElems=/^(?:textarea|input|select)$/i,rtypenamespace=/^([^\.]*)?(?:\.(.+))?$/,rhoverHack=/(?:^|\s)hover(\.\S+)?\b/,rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rquickIs=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,quickParse=function(selector){var quick=rquickIs.exec(selector);return quick&&(quick[1]=(quick[1]||"").toLowerCase(),quick[3]=quick[3]&&new RegExp("(?:^|\\s)"+quick[3]+"(?:\\s|$)")),quick},quickIs=function(elem,m){var attrs=elem.attributes||{};return(!m[1]||elem.nodeName.toLowerCase()===m[1])&&(!m[2]||(attrs.id||{}).value===m[2])&&(!m[3]||m[3].test((attrs["class"]||{}).value))},hoverHack=function(events){return jQuery.event.special.hover?events:events.replace(rhoverHack,"mouseenter$1 mouseleave$1")};jQuery.event={add:function(elem,types,handler,data,selector){var elemData,eventHandle,events
,t,tns,type,namespaces,handleObj,handleObjIn,quick,handlers,special;if(elem.nodeType===3||elem.nodeType===8||!types||!handler||!(elemData=jQuery._data(elem)))return;handler.handler&&(handleObjIn=handler,handler=handleObjIn.handler,selector=handleObjIn.selector),handler.guid||(handler.guid=jQuery.guid++),events=elemData.events,events||(elemData.events=events={}),eventHandle=elemData.handle,eventHandle||(elemData.handle=eventHandle=function(e){return typeof jQuery=="undefined"||!!e&&jQuery.event.triggered===e.type?undefined:jQuery.event.dispatch.apply(eventHandle.elem,arguments)},eventHandle.elem=elem),types=jQuery.trim(hoverHack(types)).split(" ");for(t=0;t<types.length;t++){tns=rtypenamespace.exec(types[t])||[],type=tns[1],namespaces=(tns[2]||"").split(".").sort(),special=jQuery.event.special[type]||{},type=(selector?special.delegateType:special.bindType)||type,special=jQuery.event.special[type]||{},handleObj=jQuery.extend({type:type,origType:tns[1],data:data,handler:handler,guid:handler
.guid,selector:selector,quick:selector&&quickParse(selector),namespace:namespaces.join(".")},handleObjIn),handlers=events[type];if(!handlers){handlers=events[type]=[],handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===!1)elem.addEventListener?elem.addEventListener(type,eventHandle,!1):elem.attachEvent&&elem.attachEvent("on"+type,eventHandle)}special.add&&(special.add.call(elem,handleObj),handleObj.handler.guid||(handleObj.handler.guid=handler.guid)),selector?handlers.splice(handlers.delegateCount++,0,handleObj):handlers.push(handleObj),jQuery.event.global[type]=!0}elem=null},global:{},remove:function(elem,types,handler,selector,mappedTypes){var elemData=jQuery.hasData(elem)&&jQuery._data(elem),t,tns,type,origType,namespaces,origCount,j,events,special,handle,eventType,handleObj;if(!elemData||!(events=elemData.events))return;types=jQuery.trim(hoverHack(types||"")).split(" ");for(t=0;t<types.length;t++){tns=rtypenamespace.exec(types[t])||[],type=
origType=tns[1],namespaces=tns[2];if(!type){for(type in events)jQuery.event.remove(elem,type+types[t],handler,selector,!0);continue}special=jQuery.event.special[type]||{},type=(selector?special.delegateType:special.bindType)||type,eventType=events[type]||[],origCount=eventType.length,namespaces=namespaces?new RegExp("(^|\\.)"+namespaces.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(j=0;j<eventType.length;j++)handleObj=eventType[j],(mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!namespaces||namespaces.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)&&(eventType.splice(j--,1),handleObj.selector&&eventType.delegateCount--,special.remove&&special.remove.call(elem,handleObj));eventType.length===0&&origCount!==eventType.length&&((!special.teardown||special.teardown.call(elem,namespaces)===!1)&&jQuery.removeEvent(elem,type,elemData.handle),delete events[type])}jQuery.isEmptyObject
(events)&&(handle=elemData.handle,handle&&(handle.elem=null),jQuery.removeData(elem,["events","handle"],!0))},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(event,data,elem,onlyHandlers){if(!elem||elem.nodeType!==3&&elem.nodeType!==8){var type=event.type||event,namespaces=[],cache,exclusive,i,cur,old,ontype,special,handle,eventPath,bubbleType;if(rfocusMorph.test(type+jQuery.event.triggered))return;type.indexOf("!")>=0&&(type=type.slice(0,-1),exclusive=!0),type.indexOf(".")>=0&&(namespaces=type.split("."),type=namespaces.shift(),namespaces.sort());if((!elem||jQuery.event.customEvent[type])&&!jQuery.event.global[type])return;event=typeof event=="object"?event[jQuery.expando]?event:new jQuery.Event(type,event):new jQuery.Event(type),event.type=type,event.isTrigger=!0,event.exclusive=exclusive,event.namespace=namespaces.join("."),event.namespace_re=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,ontype=type.indexOf(":")<0?"on"+type:""
;if(!elem){cache=jQuery.cache;for(i in cache)cache[i].events&&cache[i].events[type]&&jQuery.event.trigger(event,data,cache[i].handle.elem,!0);return}event.result=undefined,event.target||(event.target=elem),data=data!=null?jQuery.makeArray(data):[],data.unshift(event),special=jQuery.event.special[type]||{};if(special.trigger&&special.trigger.apply(elem,data)===!1)return;eventPath=[[elem,special.bindType||type]];if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type,cur=rfocusMorph.test(bubbleType+type)?elem:elem.parentNode,old=null;for(;cur;cur=cur.parentNode)eventPath.push([cur,bubbleType]),old=cur;old&&old===elem.ownerDocument&&eventPath.push([old.defaultView||old.parentWindow||window,bubbleType])}for(i=0;i<eventPath.length&&!event.isPropagationStopped();i++)cur=eventPath[i][0],event.type=eventPath[i][1],handle=(jQuery._data(cur,"events")||{})[event.type]&&jQuery._data(cur,"handle"),handle&&handle.apply(cur,data),handle=ontype&&cur[ontype],handle&&
jQuery.acceptData(cur)&&handle.apply(cur,data)===!1&&event.preventDefault();return event.type=type,!onlyHandlers&&!event.isDefaultPrevented()&&(!special._default||special._default.apply(elem.ownerDocument,data)===!1)&&(type!=="click"||!jQuery.nodeName(elem,"a"))&&jQuery.acceptData(elem)&&ontype&&elem[type]&&(type!=="focus"&&type!=="blur"||event.target.offsetWidth!==0)&&!jQuery.isWindow(elem)&&(old=elem[ontype],old&&(elem[ontype]=null),jQuery.event.triggered=type,elem[type](),jQuery.event.triggered=undefined,old&&(elem[ontype]=old)),event.result}return},dispatch:function(event){event=jQuery.event.fix(event||window.event);var handlers=(jQuery._data(this,"events")||{})[event.type]||[],delegateCount=handlers.delegateCount,args=[].slice.call(arguments,0),run_all=!event.exclusive&&!event.namespace,special=jQuery.event.special[event.type]||{},handlerQueue=[],i,j,cur,jqcur,ret,selMatch,matched,matches,handleObj,sel,related;args[0]=event,event.delegateTarget=this;if(special.preDispatch&&special.
preDispatch.call(this,event)===!1)return;if(delegateCount&&(!event.button||event.type!=="click")){jqcur=jQuery(this),jqcur.context=this.ownerDocument||this;for(cur=event.target;cur!=this;cur=cur.parentNode||this)if(cur.disabled!==!0){selMatch={},matches=[],jqcur[0]=cur;for(i=0;i<delegateCount;i++)handleObj=handlers[i],sel=handleObj.selector,selMatch[sel]===undefined&&(selMatch[sel]=handleObj.quick?quickIs(cur,handleObj.quick):jqcur.is(sel)),selMatch[sel]&&matches.push(handleObj);matches.length&&handlerQueue.push({elem:cur,matches:matches})}}handlers.length>delegateCount&&handlerQueue.push({elem:this,matches:handlers.slice(delegateCount)});for(i=0;i<handlerQueue.length&&!event.isPropagationStopped();i++){matched=handlerQueue[i],event.currentTarget=matched.elem;for(j=0;j<matched.matches.length&&!event.isImmediatePropagationStopped();j++){handleObj=matched.matches[j];if(run_all||!event.namespace&&!handleObj.namespace||event.namespace_re&&event.namespace_re.test(handleObj.namespace))event.data=
handleObj.data,event.handleObj=handleObj,ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args),ret!==undefined&&(event.result=ret,ret===!1&&(event.preventDefault(),event.stopPropagation()))}}return special.postDispatch&&special.postDispatch.call(this,event),event.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){return event.which==null&&(event.which=original.charCode!=null?original.charCode:original.keyCode),event}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var eventDoc,doc,body,button=original.button,fromElement=original.fromElement;return event.pageX==null&&original.clientX!=null&&(eventDoc=
event.target.ownerDocument||document,doc=eventDoc.documentElement,body=eventDoc.body,event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0),event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)),!event.relatedTarget&&fromElement&&(event.relatedTarget=fromElement===event.target?original.toElement:fromElement),!event.which&&button!==undefined&&(event.which=button&1?1:button&2?3:button&4?2:0),event}},fix:function(event){if(event[jQuery.expando])return event;var i,prop,originalEvent=event,fixHook=jQuery.event.fixHooks[event.type]||{},copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=jQuery.Event(originalEvent);for(i=copy.length;i;)prop=copy[--i],event[prop]=originalEvent[prop];return event.target||(event.target=originalEvent.srcElement||document),event.target.nodeType===3&&(event.target=event.target.parentNode),event.metaKey===undefined&&
(event.metaKey=event.ctrlKey),fixHook.filter?fixHook.filter(event,originalEvent):event},special:{ready:{setup:jQuery.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(data,namespaces,eventHandle){jQuery.isWindow(this)&&(this.onbeforeunload=eventHandle)},teardown:function(namespaces,eventHandle){this.onbeforeunload===eventHandle&&(this.onbeforeunload=null)}}},simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:!0,originalEvent:{}});bubble?jQuery.event.trigger(e,null,elem):jQuery.event.dispatch.call(elem,e),e.isDefaultPrevented()&&event.preventDefault()}},jQuery.event.handle=jQuery.event.dispatch,jQuery.removeEvent=document.removeEventListener?function(elem,type,handle){elem.removeEventListener&&elem.removeEventListener(type,handle,!1)}:function(elem,type,handle){elem.detachEvent&&elem.detachEvent("on"+type,handle)},jQuery.Event=function(src,props){if(!(this instanceof 
jQuery.Event))return new jQuery.Event(src,props);src&&src.type?(this.originalEvent=src,this.type=src.type,this.isDefaultPrevented=src.defaultPrevented||src.returnValue===!1||src.getPreventDefault&&src.getPreventDefault()?returnTrue:returnFalse):this.type=src,props&&jQuery.extend(this,props),this.timeStamp=src&&src.timeStamp||jQuery.now(),this[jQuery.expando]=!0},jQuery.Event.prototype={preventDefault:function(){this.isDefaultPrevented=returnTrue;var e=this.originalEvent;if(!e)return;e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(){this.isPropagationStopped=returnTrue;var e=this.originalEvent;if(!e)return;e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue,this.stopPropagation()},isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse},jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(orig,fix){jQuery.event
.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var target=this,related=event.relatedTarget,handleObj=event.handleObj,selector=handleObj.selector,ret;if(!related||related!==target&&!jQuery.contains(target,related))event.type=handleObj.origType,ret=handleObj.handler.apply(this,arguments),event.type=fix;return ret}}}),jQuery.support.submitBubbles||(jQuery.event.special.submit={setup:function(){if(jQuery.nodeName(this,"form"))return!1;jQuery.event.add(this,"click._submit keypress._submit",function(e){var elem=e.target,form=jQuery.nodeName(elem,"input")||jQuery.nodeName(elem,"button")?elem.form:undefined;form&&!form._submit_attached&&(jQuery.event.add(form,"submit._submit",function(event){event._submit_bubble=!0}),form._submit_attached=!0)})},postDispatch:function(event){event._submit_bubble&&(delete event._submit_bubble,this.parentNode&&!event.isTrigger&&jQuery.event.simulate("submit",this.parentNode,event,!0))},teardown:function(){if(jQuery.nodeName(this,"form"))return!1
;jQuery.event.remove(this,"._submit")}}),jQuery.support.changeBubbles||(jQuery.event.special.change={setup:function(){if(rformElems.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")jQuery.event.add(this,"propertychange._change",function(event){event.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),jQuery.event.add(this,"click._change",function(event){this._just_changed&&!event.isTrigger&&(this._just_changed=!1,jQuery.event.simulate("change",this,event,!0))});return!1}jQuery.event.add(this,"beforeactivate._change",function(e){var elem=e.target;rformElems.test(elem.nodeName)&&!elem._change_attached&&(jQuery.event.add(elem,"change._change",function(event){this.parentNode&&!event.isSimulated&&!event.isTrigger&&jQuery.event.simulate("change",this.parentNode,event,!0)}),elem._change_attached=!0)})},handle:function(event){var elem=event.target;if(this!==elem||event.isSimulated||event.isTrigger||elem.type!=="radio"&&elem.type!=="checkbox")return event.handleObj
.handler.apply(this,arguments)},teardown:function(){return jQuery.event.remove(this,"._change"),rformElems.test(this.nodeName)}}),jQuery.support.focusinBubbles||jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var attaches=0,handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),!0)};jQuery.event.special[fix]={setup:function(){attaches++===0&&document.addEventListener(orig,handler,!0)},teardown:function(){--attaches===0&&document.removeEventListener(orig,handler,!0)}}}),jQuery.fn.extend({on:function(types,selector,data,fn,one){var origFn,type;if(typeof types=="object"){typeof selector!="string"&&(data=data||selector,selector=undefined);for(type in types)this.on(type,selector,data,types[type],one);return this}data==null&&fn==null?(fn=selector,data=selector=undefined):fn==null&&(typeof selector=="string"?(fn=data,data=undefined):(fn=data,data=selector,selector=undefined));if(fn===!1)fn=returnFalse;else if(!fn)return this;return one===1&&(origFn=
fn,fn=function(event){return jQuery().off(event),origFn.apply(this,arguments)},fn.guid=origFn.guid||(origFn.guid=jQuery.guid++)),this.each(function(){jQuery.event.add(this,types,fn,data,selector)})},one:function(types,selector,data,fn){return this.on(types,selector,data,fn,1)},off:function(types,selector,fn){if(types&&types.preventDefault&&types.handleObj){var handleObj=types.handleObj;return jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler),this}if(typeof types=="object"){for(var type in types)this.off(type,selector,types[type]);return this}if(selector===!1||typeof selector=="function")fn=selector,selector=undefined;return fn===!1&&(fn=returnFalse),this.each(function(){jQuery.event.remove(this,types,fn,selector)})},bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},live:function(types,data,fn){return jQuery(this.context
).on(types,this.selector,data,fn),this},die:function(types,fn){return jQuery(this.context).off(types,this.selector||"**",fn),this},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return arguments.length==1?this.off(selector,"**"):this.off(types,selector,fn)},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){if(this[0])return jQuery.event.trigger(type,data,this[0],!0)},toggle:function(fn){var args=arguments,guid=fn.guid||jQuery.guid++,i=0,toggler=function(event){var lastToggle=(jQuery._data(this,"lastToggle"+fn.guid)||0)%i;return jQuery._data(this,"lastToggle"+fn.guid,lastToggle+1),event.preventDefault(),args[lastToggle].apply(this,arguments)||!1};toggler.guid=guid;while(i<args.length)args[i++].guid=guid;return this.click(toggler)},hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)}}),jQuery.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu"
.split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return fn==null&&(fn=data,data=null),arguments.length>0?this.on(name,null,data,fn):this.trigger(name)},jQuery.attrFn&&(jQuery.attrFn[name]=!0),rkeyEvent.test(name)&&(jQuery.event.fixHooks[name]=jQuery.event.keyHooks),rmouseEvent.test(name)&&(jQuery.event.fixHooks[name]=jQuery.event.mouseHooks)}),function(){function dirNodeCheck(dir,cur,doneName,checkSet,nodeCheck,isXML){for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){var match=!1;elem=elem[dir];while(elem){if(elem[expando]===doneName){match=checkSet[elem.sizset];break}elem.nodeType===1&&!isXML&&(elem[expando]=doneName,elem.sizset=i);if(elem.nodeName.toLowerCase()===cur){match=elem;break}elem=elem[dir]}checkSet[i]=match}}}function dirCheck(dir,cur,doneName,checkSet,nodeCheck,isXML){for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){var match=!1;elem=elem[dir];while(elem){if(elem[expando]===doneName){match=checkSet[elem.sizset];break}if(elem
.nodeType===1){isXML||(elem[expando]=doneName,elem.sizset=i);if(typeof cur!="string"){if(elem===cur){match=!0;break}}else if(Sizzle.filter(cur,[elem]).length>0){match=elem;break}}elem=elem[dir]}checkSet[i]=match}}}var chunker=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,expando="sizcache"+(Math.random()+"").replace(".",""),done=0,toString=Object.prototype.toString,hasDuplicate=!1,baseHasDuplicate=!0,rBackslash=/\\/g,rReturn=/\r\n/g,rNonWord=/\W/;[0,0].sort(function(){return baseHasDuplicate=!1,0});var Sizzle=function(selector,context,results,seed){results=results||[],context=context||document;var origContext=context;if(context.nodeType!==1&&context.nodeType!==9)return[];if(!selector||typeof selector!="string")return results;var m,set,checkSet,extra,ret,cur,pop,i,prune=!0,contextXML=Sizzle.isXML(context),parts=[],soFar=selector;do{chunker.exec(""),m=chunker.exec(soFar);if(m){soFar=m[3],parts.push(m[1
]);if(m[2]){extra=m[3];break}}}while(m);if(parts.length>1&&origPOS.exec(selector))if(parts.length===2&&Expr.relative[parts[0]])set=posProcess(parts[0]+parts[1],context,seed);else{set=Expr.relative[parts[0]]?[context]:Sizzle(parts.shift(),context);while(parts.length)selector=parts.shift(),Expr.relative[selector]&&(selector+=parts.shift()),set=posProcess(selector,set,seed)}else{!seed&&parts.length>1&&context.nodeType===9&&!contextXML&&Expr.match.ID.test(parts[0])&&!Expr.match.ID.test(parts[parts.length-1])&&(ret=Sizzle.find(parts.shift(),context,contextXML),context=ret.expr?Sizzle.filter(ret.expr,ret.set)[0]:ret.set[0]);if(context){ret=seed?{expr:parts.pop(),set:makeArray(seed)}:Sizzle.find(parts.pop(),parts.length!==1||parts[0]!=="~"&&parts[0]!=="+"||!context.parentNode?context:context.parentNode,contextXML),set=ret.expr?Sizzle.filter(ret.expr,ret.set):ret.set,parts.length>0?checkSet=makeArray(set):prune=!1;while(parts.length)cur=parts.pop(),pop=cur,Expr.relative[cur]?pop=parts.pop():cur=""
,pop==null&&(pop=context),Expr.relative[cur](checkSet,pop,contextXML)}else checkSet=parts=[]}checkSet||(checkSet=set),checkSet||Sizzle.error(cur||selector);if(toString.call(checkSet)==="[object Array]")if(!prune)results.push.apply(results,checkSet);else if(context&&context.nodeType===1)for(i=0;checkSet[i]!=null;i++)checkSet[i]&&(checkSet[i]===!0||checkSet[i].nodeType===1&&Sizzle.contains(context,checkSet[i]))&&results.push(set[i]);else for(i=0;checkSet[i]!=null;i++)checkSet[i]&&checkSet[i].nodeType===1&&results.push(set[i]);else makeArray(checkSet,results);return extra&&(Sizzle(extra,origContext,results,seed),Sizzle.uniqueSort(results)),results};Sizzle.uniqueSort=function(results){if(sortOrder){hasDuplicate=baseHasDuplicate,results.sort(sortOrder);if(hasDuplicate)for(var i=1;i<results.length;i++)results[i]===results[i-1]&&results.splice(i--,1)}return results},Sizzle.matches=function(expr,set){return Sizzle(expr,null,null,set)},Sizzle.matchesSelector=function(node,expr){return Sizzle(expr
,null,null,[node]).length>0},Sizzle.find=function(expr,context,isXML){var set,i,len,match,type,left;if(!expr)return[];for(i=0,len=Expr.order.length;i<len;i++){type=Expr.order[i];if(match=Expr.leftMatch[type].exec(expr)){left=match[1],match.splice(1,1);if(left.substr(left.length-1)!=="\\"){match[1]=(match[1]||"").replace(rBackslash,""),set=Expr.find[type](match,context,isXML);if(set!=null){expr=expr.replace(Expr.match[type],"");break}}}}return set||(set=typeof context.getElementsByTagName!="undefined"?context.getElementsByTagName("*"):[]),{set:set,expr:expr}},Sizzle.filter=function(expr,set,inplace,not){var match,anyFound,type,found,item,filter,left,i,pass,old=expr,result=[],curLoop=set,isXMLFilter=set&&set[0]&&Sizzle.isXML(set[0]);while(expr&&set.length){for(type in Expr.filter)if((match=Expr.leftMatch[type].exec(expr))!=null&&match[2]){filter=Expr.filter[type],left=match[1],anyFound=!1,match.splice(1,1);if(left.substr(left.length-1)==="\\")continue;curLoop===result&&(result=[]);if(Expr
.preFilter[type]){match=Expr.preFilter[type](match,curLoop,inplace,result,not,isXMLFilter);if(!match)anyFound=found=!0;else if(match===!0)continue}if(match)for(i=0;(item=curLoop[i])!=null;i++)item&&(found=filter(item,match,i,curLoop),pass=not^found,inplace&&found!=null?pass?anyFound=!0:curLoop[i]=!1:pass&&(result.push(item),anyFound=!0));if(found!==undefined){inplace||(curLoop=result),expr=expr.replace(Expr.match[type],"");if(!anyFound)return[];break}}if(expr===old){if(anyFound!=null)break;Sizzle.error(expr)}old=expr}return curLoop},Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)};var getText=Sizzle.getText=function(elem){var i,node,nodeType=elem.nodeType,ret="";if(nodeType){if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent=="string")return elem.textContent;if(typeof elem.innerText=="string")return elem.innerText.replace(rReturn,"");for(elem=elem.firstChild;elem;elem=elem.nextSibling)ret+=getText(elem)}else if(nodeType===3||
nodeType===4)return elem.nodeValue}else for(i=0;node=elem[i];i++)node.nodeType!==8&&(ret+=getText(node));return ret},Expr=Sizzle.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(elem){return elem.getAttribute("href")},type:function(elem){return elem.getAttribute("type")}},relative:{"+":function(checkSet,part){var isPartStr=typeof part=="string",isTag=isPartStr&&!rNonWord
.test(part),isPartStrNotTag=isPartStr&&!isTag;isTag&&(part=part.toLowerCase());for(var i=0,l=checkSet.length,elem;i<l;i++)if(elem=checkSet[i]){while((elem=elem.previousSibling)&&elem.nodeType!==1);checkSet[i]=isPartStrNotTag||elem&&elem.nodeName.toLowerCase()===part?elem||!1:elem===part}isPartStrNotTag&&Sizzle.filter(part,checkSet,!0)},">":function(checkSet,part){var elem,isPartStr=typeof part=="string",i=0,l=checkSet.length;if(isPartStr&&!rNonWord.test(part)){part=part.toLowerCase();for(;i<l;i++){elem=checkSet[i];if(elem){var parent=elem.parentNode;checkSet[i]=parent.nodeName.toLowerCase()===part?parent:!1}}}else{for(;i<l;i++)elem=checkSet[i],elem&&(checkSet[i]=isPartStr?elem.parentNode:elem.parentNode===part);isPartStr&&Sizzle.filter(part,checkSet,!0)}},"":function(checkSet,part,isXML){var nodeCheck,doneName=done++,checkFn=dirCheck;typeof part=="string"&&!rNonWord.test(part)&&(part=part.toLowerCase(),nodeCheck=part,checkFn=dirNodeCheck),checkFn("parentNode",part,doneName,checkSet,nodeCheck
,isXML)},"~":function(checkSet,part,isXML){var nodeCheck,doneName=done++,checkFn=dirCheck;typeof part=="string"&&!rNonWord.test(part)&&(part=part.toLowerCase(),nodeCheck=part,checkFn=dirNodeCheck),checkFn("previousSibling",part,doneName,checkSet,nodeCheck,isXML)}},find:{ID:function(match,context,isXML){if(typeof context.getElementById!="undefined"&&!isXML){var m=context.getElementById(match[1]);return m&&m.parentNode?[m]:[]}},NAME:function(match,context){if(typeof context.getElementsByName!="undefined"){var ret=[],results=context.getElementsByName(match[1]);for(var i=0,l=results.length;i<l;i++)results[i].getAttribute("name")===match[1]&&ret.push(results[i]);return ret.length===0?null:ret}},TAG:function(match,context){if(typeof context.getElementsByTagName!="undefined")return context.getElementsByTagName(match[1])}},preFilter:{CLASS:function(match,curLoop,inplace,result,not,isXML){match=" "+match[1].replace(rBackslash,"")+" ";if(isXML)return match;for(var i=0,elem;(elem=curLoop[i])!=null
;i++)elem&&(not^(elem.className&&(" "+elem.className+" ").replace(/[\t\n\r]/g," ").indexOf(match)>=0)?inplace||result.push(elem):inplace&&(curLoop[i]=!1));return!1},ID:function(match){return match[1].replace(rBackslash,"")},TAG:function(match,curLoop){return match[1].replace(rBackslash,"").toLowerCase()},CHILD:function(match){if(match[1]==="nth"){match[2]||Sizzle.error(match[0]),match[2]=match[2].replace(/^\+|\s*/g,"");var test=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(match[2]==="even"&&"2n"||match[2]==="odd"&&"2n+1"||!/\D/.test(match[2])&&"0n+"+match[2]||match[2]);match[2]=test[1]+(test[2]||1)-0,match[3]=test[3]-0}else match[2]&&Sizzle.error(match[0]);return match[0]=done++,match},ATTR:function(match,curLoop,inplace,result,not,isXML){var name=match[1]=match[1].replace(rBackslash,"");return!isXML&&Expr.attrMap[name]&&(match[1]=Expr.attrMap[name]),match[4]=(match[4]||match[5]||"").replace(rBackslash,""),match[2]==="~="&&(match[4]=" "+match[4]+" "),match},PSEUDO:function(match,curLoop,inplace,result
,not){if(match[1]==="not"){if(!((chunker.exec(match[3])||"").length>1||/^\w/.test(match[3]))){var ret=Sizzle.filter(match[3],curLoop,inplace,!0^not);return inplace||result.push.apply(result,ret),!1}match[3]=Sizzle(match[3],null,null,curLoop)}else if(Expr.match.POS.test(match[0])||Expr.match.CHILD.test(match[0]))return!0;return match},POS:function(match){return match.unshift(!0),match}},filters:{enabled:function(elem){return elem.disabled===!1&&elem.type!=="hidden"},disabled:function(elem){return elem.disabled===!0},checked:function(elem){return elem.checked===!0},selected:function(elem){return elem.parentNode&&elem.parentNode.selectedIndex,elem.selected===!0},parent:function(elem){return!!elem.firstChild},empty:function(elem){return!elem.firstChild},has:function(elem,i,match){return!!Sizzle(match[3],elem).length},header:function(elem){return/h\d/i.test(elem.nodeName)},text:function(elem){var attr=elem.getAttribute("type"),type=elem.type;return elem.nodeName.toLowerCase()==="input"&&"text"===
type&&(attr===type||attr===null)},radio:function(elem){return elem.nodeName.toLowerCase()==="input"&&"radio"===elem.type},checkbox:function(elem){return elem.nodeName.toLowerCase()==="input"&&"checkbox"===elem.type},file:function(elem){return elem.nodeName.toLowerCase()==="input"&&"file"===elem.type},password:function(elem){return elem.nodeName.toLowerCase()==="input"&&"password"===elem.type},submit:function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&"submit"===elem.type},image:function(elem){return elem.nodeName.toLowerCase()==="input"&&"image"===elem.type},reset:function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&"reset"===elem.type},button:function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&"button"===elem.type||name==="button"},input:function(elem){return/input|select|textarea|button/i.test(elem.nodeName)},focus:function(elem){return elem===elem.ownerDocument.activeElement}},setFilters
:{first:function(elem,i){return i===0},last:function(elem,i,match,array){return i===array.length-1},even:function(elem,i){return i%2===0},odd:function(elem,i){return i%2===1},lt:function(elem,i,match){return i<match[3]-0},gt:function(elem,i,match){return i>match[3]-0},nth:function(elem,i,match){return match[3]-0===i},eq:function(elem,i,match){return match[3]-0===i}},filter:{PSEUDO:function(elem,match,i,array){var name=match[1],filter=Expr.filters[name];if(filter)return filter(elem,i,match,array);if(name==="contains")return(elem.textContent||elem.innerText||getText([elem])||"").indexOf(match[3])>=0;if(name==="not"){var not=match[3];for(var j=0,l=not.length;j<l;j++)if(not[j]===elem)return!1;return!0}Sizzle.error(name)},CHILD:function(elem,match){var first,last,doneName,parent,cache,count,diff,type=match[1],node=elem;switch(type){case"only":case"first":while(node=node.previousSibling)if(node.nodeType===1)return!1;if(type==="first")return!0;node=elem;case"last":while(node=node.nextSibling)if(
node.nodeType===1)return!1;return!0;case"nth":first=match[2],last=match[3];if(first===1&&last===0)return!0;doneName=match[0],parent=elem.parentNode;if(parent&&(parent[expando]!==doneName||!elem.nodeIndex)){count=0;for(node=parent.firstChild;node;node=node.nextSibling)node.nodeType===1&&(node.nodeIndex=++count);parent[expando]=doneName}return diff=elem.nodeIndex-last,first===0?diff===0:diff%first===0&&diff/first>=0}},ID:function(elem,match){return elem.nodeType===1&&elem.getAttribute("id")===match},TAG:function(elem,match){return match==="*"&&elem.nodeType===1||!!elem.nodeName&&elem.nodeName.toLowerCase()===match},CLASS:function(elem,match){return(" "+(elem.className||elem.getAttribute("class"))+" ").indexOf(match)>-1},ATTR:function(elem,match){var name=match[1],result=Sizzle.attr?Sizzle.attr(elem,name):Expr.attrHandle[name]?Expr.attrHandle[name](elem):elem[name]!=null?elem[name]:elem.getAttribute(name),value=result+"",type=match[2],check=match[4];return result==null?type==="!=":!type&&Sizzle
.attr?result!=null:type==="="?value===check:type==="*="?value.indexOf(check)>=0:type==="~="?(" "+value+" ").indexOf(check)>=0:check?type==="!="?value!==check:type==="^="?value.indexOf(check)===0:type==="$="?value.substr(value.length-check.length)===check:type==="|="?value===check||value.substr(0,check.length+1)===check+"-":!1:value&&result!==!1},POS:function(elem,match,i,array){var name=match[2],filter=Expr.setFilters[name];if(filter)return filter(elem,i,match,array)}}},origPOS=Expr.match.POS,fescape=function(all,num){return"\\"+(num-0+1)};for(var type in Expr.match)Expr.match[type]=new RegExp(Expr.match[type].source+/(?![^\[]*\])(?![^\(]*\))/.source),Expr.leftMatch[type]=new RegExp(/(^(?:.|\r|\n)*?)/.source+Expr.match[type].source.replace(/\\(\d+)/g,fescape));Expr.match.globalPOS=origPOS;var makeArray=function(array,results){return array=Array.prototype.slice.call(array,0),results?(results.push.apply(results,array),results):array};try{Array.prototype.slice.call(document.documentElement
.childNodes,0)[0].nodeType}catch(e){makeArray=function(array,results){var i=0,ret=results||[];if(toString.call(array)==="[object Array]")Array.prototype.push.apply(ret,array);else if(typeof array.length=="number")for(var l=array.length;i<l;i++)ret.push(array[i]);else for(;array[i];i++)ret.push(array[i]);return ret}}var sortOrder,siblingCheck;document.documentElement.compareDocumentPosition?sortOrder=function(a,b){return a===b?(hasDuplicate=!0,0):!a.compareDocumentPosition||!b.compareDocumentPosition?a.compareDocumentPosition?-1:1:a.compareDocumentPosition(b)&4?-1:1}:(sortOrder=function(a,b){if(a===b)return hasDuplicate=!0,0;if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var al,bl,ap=[],bp=[],aup=a.parentNode,bup=b.parentNode,cur=aup;if(aup===bup)return siblingCheck(a,b);if(!aup)return-1;if(!bup)return 1;while(cur)ap.unshift(cur),cur=cur.parentNode;cur=bup;while(cur)bp.unshift(cur),cur=cur.parentNode;al=ap.length,bl=bp.length;for(var i=0;i<al&&i<bl;i++)if(ap[i]!==bp[i
])return siblingCheck(ap[i],bp[i]);return i===al?siblingCheck(a,bp[i],-1):siblingCheck(ap[i],b,1)},siblingCheck=function(a,b,ret){if(a===b)return ret;var cur=a.nextSibling;while(cur){if(cur===b)return-1;cur=cur.nextSibling}return 1}),function(){var form=document.createElement("div"),id="script"+(new Date).getTime(),root=document.documentElement;form.innerHTML="<a name='"+id+"'/>",root.insertBefore(form,root.firstChild),document.getElementById(id)&&(Expr.find.ID=function(match,context,isXML){if(typeof context.getElementById!="undefined"&&!isXML){var m=context.getElementById(match[1]);return m?m.id===match[1]||typeof m.getAttributeNode!="undefined"&&m.getAttributeNode("id").nodeValue===match[1]?[m]:undefined:[]}},Expr.filter.ID=function(elem,match){var node=typeof elem.getAttributeNode!="undefined"&&elem.getAttributeNode("id");return elem.nodeType===1&&node&&node.nodeValue===match}),root.removeChild(form),root=form=null}(),function(){var div=document.createElement("div");div.appendChild(document
.createComment("")),div.getElementsByTagName("*").length>0&&(Expr.find.TAG=function(match,context){var results=context.getElementsByTagName(match[1]);if(match[1]==="*"){var tmp=[];for(var i=0;results[i];i++)results[i].nodeType===1&&tmp.push(results[i]);results=tmp}return results}),div.innerHTML="<a href='#'></a>",div.firstChild&&typeof div.firstChild.getAttribute!="undefined"&&div.firstChild.getAttribute("href")!=="#"&&(Expr.attrHandle.href=function(elem){return elem.getAttribute("href",2)}),div=null}(),document.querySelectorAll&&function(){var oldSizzle=Sizzle,div=document.createElement("div"),id="__sizzle__";div.innerHTML="<p class='TEST'></p>";if(div.querySelectorAll&&div.querySelectorAll(".TEST").length===0)return;Sizzle=function(query,context,extra,seed){context=context||document;if(!seed&&!Sizzle.isXML(context)){var match=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(query);if(match&&(context.nodeType===1||context.nodeType===9)){if(match[1])return makeArray(context.getElementsByTagName
(query),extra);if(match[2]&&Expr.find.CLASS&&context.getElementsByClassName)return makeArray(context.getElementsByClassName(match[2]),extra)}if(context.nodeType===9){if(query==="body"&&context.body)return makeArray([context.body],extra);if(match&&match[3]){var elem=context.getElementById(match[3]);if(!elem||!elem.parentNode)return makeArray([],extra);if(elem.id===match[3])return makeArray([elem],extra)}try{return makeArray(context.querySelectorAll(query),extra)}catch(qsaError){}}else if(context.nodeType===1&&context.nodeName.toLowerCase()!=="object"){var oldContext=context,old=context.getAttribute("id"),nid=old||id,hasParent=context.parentNode,relativeHierarchySelector=/^\s*[+~]/.test(query);old?nid=nid.replace(/'/g,"\\$&"):context.setAttribute("id",nid),relativeHierarchySelector&&hasParent&&(context=context.parentNode);try{if(!relativeHierarchySelector||hasParent)return makeArray(context.querySelectorAll("[id='"+nid+"'] "+query),extra)}catch(pseudoError){}finally{old||oldContext.removeAttribute
("id")}}}return oldSizzle(query,context,extra,seed)};for(var prop in oldSizzle)Sizzle[prop]=oldSizzle[prop];div=null}(),function(){var html=document.documentElement,matches=html.matchesSelector||html.mozMatchesSelector||html.webkitMatchesSelector||html.msMatchesSelector;if(matches){var disconnectedMatch=!matches.call(document.createElement("div"),"div"),pseudoWorks=!1;try{matches.call(document.documentElement,"[test!='']:sizzle")}catch(pseudoError){pseudoWorks=!0}Sizzle.matchesSelector=function(node,expr){expr=expr.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!Sizzle.isXML(node))try{if(pseudoWorks||!Expr.match.PSEUDO.test(expr)&&!/!=/.test(expr)){var ret=matches.call(node,expr);if(ret||!disconnectedMatch||node.document&&node.document.nodeType!==11)return ret}}catch(e){}return Sizzle(expr,null,null,[node]).length>0}}}(),function(){var div=document.createElement("div");div.innerHTML="<div class='test e'></div><div class='test'></div>";if(!div.getElementsByClassName||div.getElementsByClassName
("e").length===0)return;div.lastChild.className="e";if(div.getElementsByClassName("e").length===1)return;Expr.order.splice(1,0,"CLASS"),Expr.find.CLASS=function(match,context,isXML){if(typeof context.getElementsByClassName!="undefined"&&!isXML)return context.getElementsByClassName(match[1])},div=null}(),document.documentElement.contains?Sizzle.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):!0)}:document.documentElement.compareDocumentPosition?Sizzle.contains=function(a,b){return!!(a.compareDocumentPosition(b)&16)}:Sizzle.contains=function(){return!1},Sizzle.isXML=function(elem){var documentElement=(elem?elem.ownerDocument||elem:0).documentElement;return documentElement?documentElement.nodeName!=="HTML":!1};var posProcess=function(selector,context,seed){var match,tmpSet=[],later="",root=context.nodeType?[context]:context;while(match=Expr.match.PSEUDO.exec(selector))later+=match[0],selector=selector.replace(Expr.match.PSEUDO,"");selector=Expr.relative[selector]?selector+"*"
:selector;for(var i=0,l=root.length;i<l;i++)Sizzle(selector,root[i],tmpSet,seed);return Sizzle.filter(later,tmpSet)};Sizzle.attr=jQuery.attr,Sizzle.selectors.attrMap={},jQuery.find=Sizzle,jQuery.expr=Sizzle.selectors,jQuery.expr[":"]=jQuery.expr.filters,jQuery.unique=Sizzle.uniqueSort,jQuery.text=Sizzle.getText,jQuery.isXMLDoc=Sizzle.isXML,jQuery.contains=Sizzle.contains}();var runtil=/Until$/,rparentsprev=/^(?:parents|prevUntil|prevAll)/,rmultiselector=/,/,isSimple=/^.[^:#\[\.,]*$/,slice=Array.prototype.slice,POS=jQuery.expr.match.globalPOS,guaranteedUnique={children:!0,contents:!0,next:!0,prev:!0};jQuery.fn.extend({find:function(selector){var self=this,i,l;if(typeof selector!="string")return jQuery(selector).filter(function(){for(i=0,l=self.length;i<l;i++)if(jQuery.contains(self[i],this))return!0});var ret=this.pushStack("","find",selector),length,n,r;for(i=0,l=this.length;i<l;i++){length=ret.length,jQuery.find(selector,this[i],ret);if(i>0)for(n=length;n<ret.length;n++)for(r=0;r<length
;r++)if(ret[r]===ret[n]){ret.splice(n--,1);break}}return ret},has:function(target){var targets=jQuery(target);return this.filter(function(){for(var i=0,l=targets.length;i<l;i++)if(jQuery.contains(this,targets[i]))return!0})},not:function(selector){return this.pushStack(winnow(this,selector,!1),"not",selector)},filter:function(selector){return this.pushStack(winnow(this,selector,!0),"filter",selector)},is:function(selector){return!!selector&&(typeof selector=="string"?POS.test(selector)?jQuery(selector,this.context).index(this[0])>=0:jQuery.filter(selector,this).length>0:this.filter(selector).length>0)},closest:function(selectors,context){var ret=[],i,l,cur=this[0];if(jQuery.isArray(selectors)){var level=1;while(cur&&cur.ownerDocument&&cur!==context){for(i=0;i<selectors.length;i++)jQuery(cur).is(selectors[i])&&ret.push({selector:selectors[i],elem:cur,level:level});cur=cur.parentNode,level++}return ret}var pos=POS.test(selectors)||typeof selectors!="string"?jQuery(selectors,context||this.
context):0;for(i=0,l=this.length;i<l;i++){cur=this[i];while(cur){if(pos?pos.index(cur)>-1:jQuery.find.matchesSelector(cur,selectors)){ret.push(cur);break}cur=cur.parentNode;if(!cur||!cur.ownerDocument||cur===context||cur.nodeType===11)break}}return ret=ret.length>1?jQuery.unique(ret):ret,this.pushStack(ret,"closest",selectors)},index:function(elem){return elem?typeof elem=="string"?jQuery.inArray(this[0],jQuery(elem)):jQuery.inArray(elem.jquery?elem[0]:elem,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(selector,context){var set=typeof selector=="string"?jQuery(selector,context):jQuery.makeArray(selector&&selector.nodeType?[selector]:selector),all=jQuery.merge(this.get(),set);return this.pushStack(isDisconnected(set[0])||isDisconnected(all[0])?all:jQuery.unique(all))},andSelf:function(){return this.add(this.prevObject)}}),jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null},parents:function(elem){return jQuery
.dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until)},next:function(elem){return jQuery.nth(elem,2,"nextSibling")},prev:function(elem){return jQuery.nth(elem,2,"previousSibling")},nextAll:function(elem){return jQuery.dir(elem,"nextSibling")},prevAll:function(elem){return jQuery.dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until)},siblings:function(elem){return jQuery.sibling((elem.parentNode||{}).firstChild,elem)},children:function(elem){return jQuery.sibling(elem.firstChild)},contents:function(elem){return jQuery.nodeName(elem,"iframe")?elem.contentDocument||elem.contentWindow.document:jQuery.makeArray(elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var ret=jQuery.map(this,fn,until);return runtil.test(name)||(selector=until),selector&&typeof selector=="string"&&(ret=jQuery
.filter(selector,ret)),ret=this.length>1&&!guaranteedUnique[name]?jQuery.unique(ret):ret,(this.length>1||rmultiselector.test(selector))&&rparentsprev.test(name)&&(ret=ret.reverse()),this.pushStack(ret,name,slice.call(arguments).join(","))}}),jQuery.extend({filter:function(expr,elems,not){return not&&(expr=":not("+expr+")"),elems.length===1?jQuery.find.matchesSelector(elems[0],expr)?[elems[0]]:[]:jQuery.find.matches(expr,elems)},dir:function(elem,dir,until){var matched=[],cur=elem[dir];while(cur&&cur.nodeType!==9&&(until===undefined||cur.nodeType!==1||!jQuery(cur).is(until)))cur.nodeType===1&&matched.push(cur),cur=cur[dir];return matched},nth:function(cur,result,dir,elem){result=result||1;var num=0;for(;cur;cur=cur[dir])if(cur.nodeType===1&&++num===result)break;return cur},sibling:function(n,elem){var r=[];for(;n;n=n.nextSibling)n.nodeType===1&&n!==elem&&r.push(n);return r}});var nodeNames="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video"
,rinlinejQuery=/ jQuery\d+="(?:\d+|null)"/g,rleadingWhitespace=/^\s+/,rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,rtagName=/<([\w:]+)/,rtbody=/<tbody/i,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style)/i,rnocache=/<(?:script|object|embed|option|style)/i,rnoshimcache=new RegExp("<(?:"+nodeNames+")[\\s/>]","i"),rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/\/(java|ecma)script/i,rcleanScript=/^\s*<!(?:\[CDATA\[|\-\-)/,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},safeFragment=createSafeFragment(document);wrapMap.optgroup=wrapMap.option,wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead,wrapMap.th=wrapMap.td,jQuery.support.htmlSerialize||
(wrapMap._default=[1,"div<div>","</div>"]),jQuery.fn.extend({text:function(value){return jQuery.access(this,function(value){return value===undefined?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(value))},null,value,arguments.length)},wrapAll:function(html){if(jQuery.isFunction(html))return this.each(function(i){jQuery(this).wrapAll(html.call(this,i))});if(this[0]){var wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&wrap.insertBefore(this[0]),wrap.map(function(){var elem=this;while(elem.firstChild&&elem.firstChild.nodeType===1)elem=elem.firstChild;return elem}).append(this)}return this},wrapInner:function(html){return jQuery.isFunction(html)?this.each(function(i){jQuery(this).wrapInner(html.call(this,i))}):this.each(function(){var self=jQuery(this),contents=self.contents();contents.length?contents.wrapAll(html):self.append(html)})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(
i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(){return this.parent().each(function(){jQuery.nodeName(this,"body")||jQuery(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(elem){this.nodeType===1&&this.appendChild(elem)})},prepend:function(){return this.domManip(arguments,!0,function(elem){this.nodeType===1&&this.insertBefore(elem,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(elem){this.parentNode.insertBefore(elem,this)});if(arguments.length){var set=jQuery.clean(arguments);return set.push.apply(set,this.toArray()),this.pushStack(set,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(elem){this.parentNode.insertBefore(elem,this.nextSibling)});if(arguments.length){var set=this.pushStack(this,"after",arguments);return set.push.apply(set,jQuery.clean(arguments)),set}},remove:function(
selector,keepData){for(var i=0,elem;(elem=this[i])!=null;i++)if(!selector||jQuery.filter(selector,[elem]).length)!keepData&&elem.nodeType===1&&(jQuery.cleanData(elem.getElementsByTagName("*")),jQuery.cleanData([elem])),elem.parentNode&&elem.parentNode.removeChild(elem);return this},empty:function(){for(var i=0,elem;(elem=this[i])!=null;i++){elem.nodeType===1&&jQuery.cleanData(elem.getElementsByTagName("*"));while(elem.firstChild)elem.removeChild(elem.firstChild)}return this},clone:function(dataAndEvents,deepDataAndEvents){return dataAndEvents=dataAndEvents==null?!1:dataAndEvents,deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents,this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return jQuery.access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined)return elem.nodeType===1?elem.innerHTML.replace(rinlinejQuery,""):null;if(typeof value=="string"&&!rnoInnerhtml.test(value)&&(jQuery.support
.leadingWhitespace||!rleadingWhitespace.test(value))&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=value.replace(rxhtmlTag,"<$1></$2>");try{for(;i<l;i++)elem=this[i]||{},elem.nodeType===1&&(jQuery.cleanData(elem.getElementsByTagName("*")),elem.innerHTML=value);elem=0}catch(e){}}elem&&this.empty().append(value)},null,value,arguments.length)},replaceWith:function(value){return this[0]&&this[0].parentNode?jQuery.isFunction(value)?this.each(function(i){var self=jQuery(this),old=self.html();self.replaceWith(value.call(this,i,old))}):(typeof value!="string"&&(value=jQuery(value).detach()),this.each(function(){var next=this.nextSibling,parent=this.parentNode;jQuery(this).remove(),next?jQuery(next).before(value):jQuery(parent).append(value)})):this.length?this.pushStack(jQuery(jQuery.isFunction(value)?value():value),"replaceWith",value):this},detach:function(selector){return this.remove(selector,!0)},domManip:function(args,table,callback){var results,first,fragment,parent,value=
args[0],scripts=[];if(!jQuery.support.checkClone&&arguments.length===3&&typeof value=="string"&&rchecked.test(value))return this.each(function(){jQuery(this).domManip(args,table,callback,!0)});if(jQuery.isFunction(value))return this.each(function(i){var self=jQuery(this);args[0]=value.call(this,i,table?self.html():undefined),self.domManip(args,table,callback)});if(this[0]){parent=value&&value.parentNode,jQuery.support.parentNode&&parent&&parent.nodeType===11&&parent.childNodes.length===this.length?results={fragment:parent}:results=jQuery.buildFragment(args,this,scripts),fragment=results.fragment,fragment.childNodes.length===1?first=fragment=fragment.firstChild:first=fragment.firstChild;if(first){table=table&&jQuery.nodeName(first,"tr");for(var i=0,l=this.length,lastIndex=l-1;i<l;i++)callback.call(table?root(this[i],first):this[i],results.cacheable||l>1&&i<lastIndex?jQuery.clone(fragment,!0,!0):fragment)}scripts.length&&jQuery.each(scripts,function(i,elem){elem.src?jQuery.ajax({type:"GET"
,global:!1,url:elem.src,async:!1,dataType:"script"}):jQuery.globalEval((elem.text||elem.textContent||elem.innerHTML||"").replace(rcleanScript,"/*$0*/")),elem.parentNode&&elem.parentNode.removeChild(elem)})}return this}}),jQuery.buildFragment=function(args,nodes,scripts){var fragment,cacheable,cacheresults,doc,first=args[0];return nodes&&nodes[0]&&(doc=nodes[0].ownerDocument||nodes[0]),doc.createDocumentFragment||(doc=document),args.length===1&&typeof first=="string"&&first.length<512&&doc===document&&first.charAt(0)==="<"&&!rnocache.test(first)&&(jQuery.support.checkClone||!rchecked.test(first))&&(jQuery.support.html5Clone||!rnoshimcache.test(first))&&(cacheable=!0,cacheresults=jQuery.fragments[first],cacheresults&&cacheresults!==1&&(fragment=cacheresults)),fragment||(fragment=doc.createDocumentFragment(),jQuery.clean(args,doc,fragment,scripts)),cacheable&&(jQuery.fragments[first]=cacheresults?fragment:1),{fragment:fragment,cacheable:cacheable}},jQuery.fragments={},jQuery.each({appendTo
:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var ret=[],insert=jQuery(selector),parent=this.length===1&&this[0].parentNode;if(parent&&parent.nodeType===11&&parent.childNodes.length===1&&insert.length===1)return insert[original](this[0]),this;for(var i=0,l=insert.length;i<l;i++){var elems=(i>0?this.clone(!0):this).get();jQuery(insert[i])[original](elems),ret=ret.concat(elems)}return this.pushStack(ret,name,insert.selector)}}),jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var srcElements,destElements,i,clone=jQuery.support.html5Clone||jQuery.isXMLDoc(elem)||!rnoshimcache.test("<"+elem.nodeName+">")?elem.cloneNode(!0):shimCloneNode(elem);if((!jQuery.support.noCloneEvent||!jQuery.support.noCloneChecked)&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){cloneFixAttributes(elem,clone),srcElements=getAll(elem),destElements=getAll(clone);for(i=0;srcElements
[i];++i)destElements[i]&&cloneFixAttributes(srcElements[i],destElements[i])}if(dataAndEvents){cloneCopyEvent(elem,clone);if(deepDataAndEvents){srcElements=getAll(elem),destElements=getAll(clone);for(i=0;srcElements[i];++i)cloneCopyEvent(srcElements[i],destElements[i])}}return srcElements=destElements=null,clone},clean:function(elems,context,fragment,scripts){var checkScriptType,script,j,ret=[];context=context||document,typeof context.createElement=="undefined"&&(context=context.ownerDocument||context[0]&&context[0].ownerDocument||document);for(var i=0,elem;(elem=elems[i])!=null;i++){typeof elem=="number"&&(elem+="");if(!elem)continue;if(typeof elem=="string")if(!rhtml.test(elem))elem=context.createTextNode(elem);else{elem=elem.replace(rxhtmlTag,"<$1></$2>");var tag=(rtagName.exec(elem)||["",""])[1].toLowerCase(),wrap=wrapMap[tag]||wrapMap._default,depth=wrap[0],div=context.createElement("div"),safeChildNodes=safeFragment.childNodes,remove;context===document?safeFragment.appendChild(div)
:createSafeFragment(context).appendChild(div),div.innerHTML=wrap[1]+elem+wrap[2];while(depth--)div=div.lastChild;if(!jQuery.support.tbody){var hasBody=rtbody.test(elem),tbody=tag==="table"&&!hasBody?div.firstChild&&div.firstChild.childNodes:wrap[1]==="<table>"&&!hasBody?div.childNodes:[];for(j=tbody.length-1;j>=0;--j)jQuery.nodeName(tbody[j],"tbody")&&!tbody[j].childNodes.length&&tbody[j].parentNode.removeChild(tbody[j])}!jQuery.support.leadingWhitespace&&rleadingWhitespace.test(elem)&&div.insertBefore(context.createTextNode(rleadingWhitespace.exec(elem)[0]),div.firstChild),elem=div.childNodes,div&&(div.parentNode.removeChild(div),safeChildNodes.length>0&&(remove=safeChildNodes[safeChildNodes.length-1],remove&&remove.parentNode&&remove.parentNode.removeChild(remove)))}var len;if(!jQuery.support.appendChecked)if(elem[0]&&typeof (len=elem.length)=="number")for(j=0;j<len;j++)findInputs(elem[j]);else findInputs(elem);elem.nodeType?ret.push(elem):ret=jQuery.merge(ret,elem)}if(fragment){checkScriptType=
function(elem){return!elem.type||rscriptType.test(elem.type)};for(i=0;ret[i];i++){script=ret[i];if(scripts&&jQuery.nodeName(script,"script")&&(!script.type||rscriptType.test(script.type)))scripts.push(script.parentNode?script.parentNode.removeChild(script):script);else{if(script.nodeType===1){var jsTags=jQuery.grep(script.getElementsByTagName("script"),checkScriptType);ret.splice.apply(ret,[i+1,0].concat(jsTags))}fragment.appendChild(script)}}}return ret},cleanData:function(elems){var data,id,cache=jQuery.cache,special=jQuery.event.special,deleteExpando=jQuery.support.deleteExpando;for(var i=0,elem;(elem=elems[i])!=null;i++){if(elem.nodeName&&jQuery.noData[elem.nodeName.toLowerCase()])continue;id=elem[jQuery.expando];if(id){data=cache[id];if(data&&data.events){for(var type in data.events)special[type]?jQuery.event.remove(elem,type):jQuery.removeEvent(elem,type,data.handle);data.handle&&(data.handle.elem=null)}deleteExpando?delete elem[jQuery.expando]:elem.removeAttribute&&elem.removeAttribute
(jQuery.expando),delete cache[id]}}}});var ralpha=/alpha\([^)]*\)/i,ropacity=/opacity=([^)]*)/,rupper=/([A-Z]|^ms)/g,rnum=/^[\-+]?(?:\d*\.)?\d+$/i,rnumnonpx=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i,rrelNum=/^([\-+])=([\-+.\de]+)/,rmargin=/^margin/,cssShow={position:"absolute",visibility:"hidden",display:"block"},cssExpand=["Top","Right","Bottom","Left"],curCSS,getComputedStyle,currentStyle;jQuery.fn.css=function(name,value){return jQuery.access(this,function(elem,name,value){return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)},jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return ret===""?"1":ret}return elem.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":jQuery.support.cssFloat?"cssFloat":"styleFloat"},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!
elem.style)return;var ret,type,origName=jQuery.camelCase(name),style=elem.style,hooks=jQuery.cssHooks[origName];name=jQuery.cssProps[origName]||origName;if(value===undefined)return hooks&&"get"in hooks&&(ret=hooks.get(elem,!1,extra))!==undefined?ret:style[name];type=typeof value,type==="string"&&(ret=rrelNum.exec(value))&&(value=+(ret[1]+1)*+ret[2]+parseFloat(jQuery.css(elem,name)),type="number");if(value==null||type==="number"&&isNaN(value))return;type==="number"&&!jQuery.cssNumber[origName]&&(value+="px");if(!hooks||!("set"in hooks)||(value=hooks.set(elem,value))!==undefined)try{style[name]=value}catch(e){}},css:function(elem,name,extra){var ret,hooks;name=jQuery.camelCase(name),hooks=jQuery.cssHooks[name],name=jQuery.cssProps[name]||name,name==="cssFloat"&&(name="float");if(hooks&&"get"in hooks&&(ret=hooks.get(elem,!0,extra))!==undefined)return ret;if(curCSS)return curCSS(elem,name)},swap:function(elem,options,callback){var old={},ret,name;for(name in options)old[name]=elem.style[name
],elem.style[name]=options[name];ret=callback.call(elem);for(name in options)elem.style[name]=old[name];return ret}}),jQuery.curCSS=jQuery.css,document.defaultView&&document.defaultView.getComputedStyle&&(getComputedStyle=function(elem,name){var ret,defaultView,computedStyle,width,style=elem.style;return name=name.replace(rupper,"-$1").toLowerCase(),(defaultView=elem.ownerDocument.defaultView)&&(computedStyle=defaultView.getComputedStyle(elem,null))&&(ret=computedStyle.getPropertyValue(name),ret===""&&!jQuery.contains(elem.ownerDocument.documentElement,elem)&&(ret=jQuery.style(elem,name))),!jQuery.support.pixelMargin&&computedStyle&&rmargin.test(name)&&rnumnonpx.test(ret)&&(width=style.width,style.width=ret,ret=computedStyle.width,style.width=width),ret}),document.documentElement.currentStyle&&(currentStyle=function(elem,name){var left,rsLeft,uncomputed,ret=elem.currentStyle&&elem.currentStyle[name],style=elem.style;return ret==null&&style&&(uncomputed=style[name])&&(ret=uncomputed),rnumnonpx
.test(ret)&&(left=style.left,rsLeft=elem.runtimeStyle&&elem.runtimeStyle.left,rsLeft&&(elem.runtimeStyle.left=elem.currentStyle.left),style.left=name==="fontSize"?"1em":ret,ret=style.pixelLeft+"px",style.left=left,rsLeft&&(elem.runtimeStyle.left=rsLeft)),ret===""?"auto":ret}),curCSS=getComputedStyle||currentStyle,jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed)return elem.offsetWidth!==0?getWidthOrHeight(elem,name,extra):jQuery.swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra)})},set:function(elem,value){return rnum.test(value)?value+"px":value}}}),jQuery.support.opacity||(jQuery.cssHooks.opacity={get:function(elem,computed){return ropacity.test((computed&&elem.currentStyle?elem.currentStyle.filter:elem.style.filter)||"")?parseFloat(RegExp.$1)/100+"":computed?"1":""},set:function(elem,value){var style=elem.style,currentStyle=elem.currentStyle,opacity=jQuery.isNumeric(value)?"alpha(opacity="+value*100+")"
:"",filter=currentStyle&&currentStyle.filter||style.filter||"";style.zoom=1;if(value>=1&&jQuery.trim(filter.replace(ralpha,""))===""){style.removeAttribute("filter");if(currentStyle&&!currentStyle.filter)return}style.filter=ralpha.test(filter)?filter.replace(ralpha,opacity):filter+" "+opacity}}),jQuery(function(){jQuery.support.reliableMarginRight||(jQuery.cssHooks.marginRight={get:function(elem,computed){return jQuery.swap(elem,{display:"inline-block"},function(){return computed?curCSS(elem,"margin-right"):elem.style.marginRight})}})}),jQuery.expr&&jQuery.expr.filters&&(jQuery.expr.filters.hidden=function(elem){var width=elem.offsetWidth,height=elem.offsetHeight;return width===0&&height===0||!jQuery.support.reliableHiddenOffsets&&(elem.style&&elem.style.display||jQuery.css(elem,"display"))==="none"},jQuery.expr.filters.visible=function(elem){return!jQuery.expr.filters.hidden(elem)}),jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]=
{expand:function(value){var i,parts=typeof value=="string"?value.split(" "):[value],expanded={};for(i=0;i<4;i++)expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0];return expanded}}});var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rhash=/#.*$/,rheaders=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,rinput=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,rlocalProtocol=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rquery=/\?/,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,rselectTextarea=/^(?:select|textarea)/i,rspacesAjax=/\s+/,rts=/([?&])_=[^&]*/,rurl=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,_load=jQuery.fn.load,prefilters={},transports={},ajaxLocation,ajaxLocParts,allTypes=["*/"]+["*"];try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a"),ajaxLocation.href="",ajaxLocation=ajaxLocation.href}ajaxLocParts=rurl.exec
(ajaxLocation.toLowerCase())||[],jQuery.fn.extend({load:function(url,params,callback){if(typeof url!="string"&&_load)return _load.apply(this,arguments);if(!this.length)return this;var off=url.indexOf(" ");if(off>=0){var selector=url.slice(off,url.length);url=url.slice(0,off)}var type="GET";params&&(jQuery.isFunction(params)?(callback=params,params=undefined):typeof params=="object"&&(params=jQuery.param(params,jQuery.ajaxSettings.traditional),type="POST"));var self=this;return jQuery.ajax({url:url,type:type,dataType:"html",data:params,complete:function(jqXHR,status,responseText){responseText=jqXHR.responseText,jqXHR.isResolved()&&(jqXHR.done(function(r){responseText=r}),self.html(selector?jQuery("<div>").append(responseText.replace(rscript,"")).find(selector):responseText)),callback&&self.each(callback,[responseText,status,jqXHR])}}),this},serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?jQuery.makeArray
(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||rselectTextarea.test(this.nodeName)||rinput.test(this.type))}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val,i){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}}),jQuery.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(i,o){jQuery.fn[o]=function(f){return this.on(o,f)}}),jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){return jQuery.isFunction(data)&&(type=type||callback,callback=data,data=undefined),jQuery.ajax({type:method,url:url,data:data,success:callback,dataType:type})}}),jQuery.extend({getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script")},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},ajaxSetup:function(target
,settings){return settings?ajaxExtend(target,jQuery.ajaxSettings):(settings=target,target=jQuery.ajaxSettings),ajaxExtend(target,settings),target},ajaxSettings:{url:ajaxLocation,isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":allTypes},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":window.String,"text html":!0,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){function done(status,nativeStatusText,responses,headers){if(state===2)return;state=2,timeoutTimer&&clearTimeout(timeoutTimer),transport=undefined,responseHeadersString=
headers||"",jqXHR.readyState=status>0?4:0;var isSuccess,success,error,statusText=nativeStatusText,response=responses?ajaxHandleResponses(s,jqXHR,responses):undefined,lastModified,etag;if(status>=200&&status<300||status===304){if(s.ifModified){if(lastModified=jqXHR.getResponseHeader("Last-Modified"))jQuery.lastModified[ifModifiedKey]=lastModified;if(etag=jqXHR.getResponseHeader("Etag"))jQuery.etag[ifModifiedKey]=etag}if(status===304)statusText="notmodified",isSuccess=!0;else try{success=ajaxConvert(s,response),statusText="success",isSuccess=!0}catch(e){statusText="parsererror",error=e}}else{error=statusText;if(!statusText||status)statusText="error",status<0&&(status=0)}jqXHR.status=status,jqXHR.statusText=""+(nativeStatusText||statusText),isSuccess?deferred.resolveWith(callbackContext,[success,statusText,jqXHR]):deferred.rejectWith(callbackContext,[jqXHR,statusText,error]),jqXHR.statusCode(statusCode),statusCode=undefined,fireGlobals&&globalEventContext.trigger("ajax"+(isSuccess?"Success"
:"Error"),[jqXHR,s,isSuccess?success:error]),completeDeferred.fireWith(callbackContext,[jqXHR,statusText]),fireGlobals&&(globalEventContext.trigger("ajaxComplete",[jqXHR,s]),--jQuery.active||jQuery.event.trigger("ajaxStop"))}typeof url=="object"&&(options=url,url=undefined),options=options||{};var s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=callbackContext!==s&&(callbackContext.nodeType||callbackContext instanceof jQuery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},ifModifiedKey,requestHeaders={},requestHeadersNames={},responseHeadersString,responseHeaders,transport,timeoutTimer,parts,state=0,fireGlobals,i,jqXHR={readyState:0,setRequestHeader:function(name,value){if(!state){var lname=name.toLowerCase();name=requestHeadersNames[lname]=requestHeadersNames[lname]||name,requestHeaders[name]=value}return this},getAllResponseHeaders:function(){return state===2?responseHeadersString
:null},getResponseHeader:function(key){var match;if(state===2){if(!responseHeaders){responseHeaders={};while(match=rheaders.exec(responseHeadersString))responseHeaders[match[1].toLowerCase()]=match[2]}match=responseHeaders[key.toLowerCase()]}return match===undefined?null:match},overrideMimeType:function(type){return state||(s.mimeType=type),this},abort:function(statusText){return statusText=statusText||"abort",transport&&transport.abort(statusText),done(0,statusText),this}};deferred.promise(jqXHR),jqXHR.success=jqXHR.done,jqXHR.error=jqXHR.fail,jqXHR.complete=completeDeferred.add,jqXHR.statusCode=function(map){if(map){var tmp;if(state<2)for(tmp in map)statusCode[tmp]=[statusCode[tmp],map[tmp]];else tmp=map[jqXHR.status],jqXHR.then(tmp,tmp)}return this},s.url=((url||s.url)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//"),s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().split(rspacesAjax),s.crossDomain==null&&(parts=rurl.exec(s.url.toLowerCase()),s.crossDomain=!(!parts||
parts[1]==ajaxLocParts[1]&&parts[2]==ajaxLocParts[2]&&(parts[3]||(parts[1]==="http:"?80:443))==(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?80:443)))),s.data&&s.processData&&typeof s.data!="string"&&(s.data=jQuery.param(s.data,s.traditional)),inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(state===2)return!1;fireGlobals=s.global,s.type=s.type.toUpperCase(),s.hasContent=!rnoContent.test(s.type),fireGlobals&&jQuery.active++===0&&jQuery.event.trigger("ajaxStart");if(!s.hasContent){s.data&&(s.url+=(rquery.test(s.url)?"&":"?")+s.data,delete s.data),ifModifiedKey=s.url;if(s.cache===!1){var ts=jQuery.now(),ret=s.url.replace(rts,"$1_="+ts);s.url=ret+(ret===s.url?(rquery.test(s.url)?"&":"?")+"_="+ts:"")}}(s.data&&s.hasContent&&s.contentType!==!1||options.contentType)&&jqXHR.setRequestHeader("Content-Type",s.contentType),s.ifModified&&(ifModifiedKey=ifModifiedKey||s.url,jQuery.lastModified[ifModifiedKey]&&jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[ifModifiedKey]),
jQuery.etag[ifModifiedKey]&&jqXHR.setRequestHeader("If-None-Match",jQuery.etag[ifModifiedKey])),jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers)jqXHR.setRequestHeader(i,s.headers[i]);if(!s.beforeSend||s.beforeSend.call(callbackContext,jqXHR,s)!==!1&&state!==2){for(i in{success:1,error:1,complete:1})jqXHR[i](s[i]);transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport)done(-1,"No Transport");else{jqXHR.readyState=1,fireGlobals&&globalEventContext.trigger("ajaxSend",[jqXHR,s]),s.async&&s.timeout>0&&(timeoutTimer=setTimeout(function(){jqXHR.abort("timeout")},s.timeout));try{state=1,transport.send(requestHeaders,done)}catch(e){if(!(state<2))throw e;done(-1,e)}}return jqXHR}return jqXHR.abort(),!1},param:function(a,traditional){var s=[],add=function(key,value){value=jQuery.isFunction(value)?value():value,s[s.length]=encodeURIComponent
(key)+"="+encodeURIComponent(value)};traditional===undefined&&(traditional=jQuery.ajaxSettings.traditional);if(jQuery.isArray(a)||a.jquery&&!jQuery.isPlainObject(a))jQuery.each(a,function(){add(this.name,this.value)});else for(var prefix in a)buildParams(prefix,a[prefix],traditional,add);return s.join("&").replace(r20,"+")}}),jQuery.extend({active:0,lastModified:{},etag:{}});var jsc=jQuery.now(),jsre=/(\=)\?(&|$)|\?\?/i;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return jQuery.expando+"_"+jsc++}}),jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var inspectData=typeof s.data=="string"&&/^application\/x\-www\-form\-urlencoded/.test(s.contentType);if(s.dataTypes[0]==="jsonp"||s.jsonp!==!1&&(jsre.test(s.url)||inspectData&&jsre.test(s.data))){var responseContainer,jsonpCallback=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback,previous=window[jsonpCallback],url=s.url,data=s.data,replace="$1"+jsonpCallback+"$2";return s.jsonp!==!1&&
(url=url.replace(jsre,replace),s.url===url&&(inspectData&&(data=data.replace(jsre,replace)),s.data===data&&(url+=(/\?/.test(url)?"&":"?")+s.jsonp+"="+jsonpCallback))),s.url=url,s.data=data,window[jsonpCallback]=function(response){responseContainer=[response]},jqXHR.always(function(){window[jsonpCallback]=previous,responseContainer&&jQuery.isFunction(previous)&&window[jsonpCallback](responseContainer[0])}),s.converters["script json"]=function(){return responseContainer||jQuery.error(jsonpCallback+" was not called"),responseContainer[0]},s.dataTypes[0]="json","script"}}),jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(text){return jQuery.globalEval(text),text}}}),jQuery.ajaxPrefilter("script",function(s){s.cache===undefined&&(s.cache=!1),s.crossDomain&&(s.type="GET",s.global=!1)}),jQuery.ajaxTransport("script",function(s){if(s.crossDomain
){var script,head=document.head||document.getElementsByTagName("head")[0]||document.documentElement;return{send:function(_,callback){script=document.createElement("script"),script.async="async",s.scriptCharset&&(script.charset=s.scriptCharset),script.src=s.url,script.onload=script.onreadystatechange=function(_,isAbort){if(isAbort||!script.readyState||/loaded|complete/.test(script.readyState))script.onload=script.onreadystatechange=null,head&&script.parentNode&&head.removeChild(script),script=undefined,isAbort||callback(200,"success")},head.insertBefore(script,head.firstChild)},abort:function(){script&&script.onload(0,1)}}}});var xhrOnUnloadAbort=window.ActiveXObject?function(){for(var key in xhrCallbacks)xhrCallbacks[key](0,1)}:!1,xhrId=0,xhrCallbacks;jQuery.ajaxSettings.xhr=window.ActiveXObject?function(){return!this.isLocal&&createStandardXHR()||createActiveXHR()}:createStandardXHR,function(xhr){jQuery.extend(jQuery.support,{ajax:!!xhr,cors:!!xhr&&"withCredentials"in xhr})}(jQuery.ajaxSettings
.xhr()),jQuery.support.ajax&&jQuery.ajaxTransport(function(s){if(!s.crossDomain||jQuery.support.cors){var callback;return{send:function(headers,complete){var xhr=s.xhr(),handle,i;s.username?xhr.open(s.type,s.url,s.async,s.username,s.password):xhr.open(s.type,s.url,s.async);if(s.xhrFields)for(i in s.xhrFields)xhr[i]=s.xhrFields[i];s.mimeType&&xhr.overrideMimeType&&xhr.overrideMimeType(s.mimeType),!s.crossDomain&&!headers["X-Requested-With"]&&(headers["X-Requested-With"]="XMLHttpRequest");try{for(i in headers)xhr.setRequestHeader(i,headers[i])}catch(_){}xhr.send(s.hasContent&&s.data||null),callback=function(_,isAbort){var status,statusText,responseHeaders,responses,xml;try{if(callback&&(isAbort||xhr.readyState===4)){callback=undefined,handle&&(xhr.onreadystatechange=jQuery.noop,xhrOnUnloadAbort&&delete xhrCallbacks[handle]);if(isAbort)xhr.readyState!==4&&xhr.abort();else{status=xhr.status,responseHeaders=xhr.getAllResponseHeaders(),responses={},xml=xhr.responseXML,xml&&xml.documentElement&&
(responses.xml=xml);try{responses.text=xhr.responseText}catch(_){}try{statusText=xhr.statusText}catch(e){statusText=""}!status&&s.isLocal&&!s.crossDomain?status=responses.text?200:404:status===1223&&(status=204)}}}catch(firefoxAccessException){isAbort||complete(-1,firefoxAccessException)}responses&&complete(status,statusText,responses,responseHeaders)},!s.async||xhr.readyState===4?callback():(handle=++xhrId,xhrOnUnloadAbort&&(xhrCallbacks||(xhrCallbacks={},jQuery(window).unload(xhrOnUnloadAbort)),xhrCallbacks[handle]=callback),xhr.onreadystatechange=callback)},abort:function(){callback&&callback(0,1)}}}});var elemdisplay={},iframe,iframeDoc,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,timerId,fxAttrs=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],fxNow;jQuery.fn.extend({show:function(speed,easing,callback){var elem,display;if(speed||speed===0)return this.animate
(genFx("show",3),speed,easing,callback);for(var i=0,j=this.length;i<j;i++)elem=this[i],elem.style&&(display=elem.style.display,!jQuery._data(elem,"olddisplay")&&display==="none"&&(display=elem.style.display=""),(display===""&&jQuery.css(elem,"display")==="none"||!jQuery.contains(elem.ownerDocument.documentElement,elem))&&jQuery._data(elem,"olddisplay",defaultDisplay(elem.nodeName)));for(i=0;i<j;i++){elem=this[i];if(elem.style){display=elem.style.display;if(display===""||display==="none")elem.style.display=jQuery._data(elem,"olddisplay")||""}}return this},hide:function(speed,easing,callback){if(speed||speed===0)return this.animate(genFx("hide",3),speed,easing,callback);var elem,display,i=0,j=this.length;for(;i<j;i++)elem=this[i],elem.style&&(display=jQuery.css(elem,"display"),display!=="none"&&!jQuery._data(elem,"olddisplay")&&jQuery._data(elem,"olddisplay",display));for(i=0;i<j;i++)this[i].style&&(this[i].style.display="none");return this},_toggle:jQuery.fn.toggle,toggle:function(fn,fn2
,callback){var bool=typeof fn=="boolean";return jQuery.isFunction(fn)&&jQuery.isFunction(fn2)?this._toggle.apply(this,arguments):fn==null||bool?this.each(function(){var state=bool?fn:jQuery(this).is(":hidden");jQuery(this)[state?"show":"hide"]()}):this.animate(genFx("toggle",3),fn,fn2,callback),this},fadeTo:function(speed,to,easing,callback){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){function doAnimation(){optall.queue===!1&&jQuery._mark(this);var opt=jQuery.extend({},optall),isElement=this.nodeType===1,hidden=isElement&&jQuery(this).is(":hidden"),name,val,p,e,hooks,replace,parts,start,end,unit,method;opt.animatedProperties={};for(p in prop){name=jQuery.camelCase(p),p!==name&&(prop[name]=prop[p],delete prop[p]);if((hooks=jQuery.cssHooks[name])&&"expand"in hooks){replace=hooks.expand(prop[name]),delete prop[name];for(p in replace)p in prop||(prop[p]=replace[p])}}for(name in prop){val=
prop[name],jQuery.isArray(val)?(opt.animatedProperties[name]=val[1],val=prop[name]=val[0]):opt.animatedProperties[name]=opt.specialEasing&&opt.specialEasing[name]||opt.easing||"swing";if(val==="hide"&&hidden||val==="show"&&!hidden)return opt.complete.call(this);isElement&&(name==="height"||name==="width")&&(opt.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],jQuery.css(this,"display")==="inline"&&jQuery.css(this,"float")==="none"&&(!jQuery.support.inlineBlockNeedsLayout||defaultDisplay(this.nodeName)==="inline"?this.style.display="inline-block":this.style.zoom=1))}opt.overflow!=null&&(this.style.overflow="hidden");for(p in prop)e=new jQuery.fx(this,opt,p),val=prop[p],rfxtypes.test(val)?(method=jQuery._data(this,"toggle"+p)||(val==="toggle"?hidden?"show":"hide":0),method?(jQuery._data(this,"toggle"+p,method==="show"?"hide":"show"),e[method]()):e[val]()):(parts=rfxnum.exec(val),start=e.cur(),parts?(end=parseFloat(parts[2]),unit=parts[3]||(jQuery.cssNumber[p]?"":"px"
),unit!=="px"&&(jQuery.style(this,p,(end||1)+unit),start=(end||1)/e.cur()*start,jQuery.style(this,p,start+unit)),parts[1]&&(end=(parts[1]==="-="?-1:1)*end+start),e.custom(start,end,unit)):e.custom(start,val,""));return!0}var optall=jQuery.speed(speed,easing,callback);return jQuery.isEmptyObject(prop)?this.each(optall.complete,[!1]):(prop=jQuery.extend({},prop),optall.queue===!1?this.each(doAnimation):this.queue(optall.queue,doAnimation))},stop:function(type,clearQueue,gotoEnd){return typeof type!="string"&&(gotoEnd=clearQueue,clearQueue=type,type=undefined),clearQueue&&type!==!1&&this.queue(type||"fx",[]),this.each(function(){function stopQueue(elem,data,index){var hooks=data[index];jQuery.removeData(elem,index,!0),hooks.stop(gotoEnd)}var index,hadTimers=!1,timers=jQuery.timers,data=jQuery._data(this);gotoEnd||jQuery._unmark(!0,this);if(type==null)for(index in data)data[index]&&data[index].stop&&index.indexOf(".run")===index.length-4&&stopQueue(this,data,index);else data[index=type+".run"
]&&data[index].stop&&stopQueue(this,data,index);for(index=timers.length;index--;)timers[index].elem===this&&(type==null||timers[index].queue===type)&&(gotoEnd?timers[index](!0):timers[index].saveState(),hadTimers=!0,timers.splice(index,1));(!gotoEnd||!hadTimers)&&jQuery.dequeue(this,type)})}}),jQuery.each({slideDown:genFx("show",1),slideUp:genFx("hide",1),slideToggle:genFx("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}}),jQuery.extend({speed:function(speed,easing,fn){var opt=speed&&typeof speed=="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration=="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if(opt
.queue==null||opt.queue===!0)opt.queue="fx";return opt.old=opt.complete,opt.complete=function(noUnmark){jQuery.isFunction(opt.old)&&opt.old.call(this),opt.queue?jQuery.dequeue(this,opt.queue):noUnmark!==!1&&jQuery._unmark(this)},opt},easing:{linear:function(p){return p},swing:function(p){return-Math.cos(p*Math.PI)/2+.5}},timers:[],fx:function(elem,options,prop){this.options=options,this.elem=elem,this.prop=prop,options.orig=options.orig||{}}}),jQuery.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(jQuery.fx.step[this.prop]||jQuery.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]==null||!!this.elem.style&&this.elem.style[this.prop]!=null){var parsed,r=jQuery.css(this.elem,this.prop);return isNaN(parsed=parseFloat(r))?!r||r==="auto"?0:r:parsed}return this.elem[this.prop]},custom:function(from,to,unit){function t(gotoEnd){return self.step(gotoEnd)}var self=this,fx=jQuery.fx;this.startTime=fxNow||createFxNow(),this.end=to,this
.now=this.start=from,this.pos=this.state=0,this.unit=unit||this.unit||(jQuery.cssNumber[this.prop]?"":"px"),t.queue=this.options.queue,t.elem=this.elem,t.saveState=function(){jQuery._data(self.elem,"fxshow"+self.prop)===undefined&&(self.options.hide?jQuery._data(self.elem,"fxshow"+self.prop,self.start):self.options.show&&jQuery._data(self.elem,"fxshow"+self.prop,self.end))},t()&&jQuery.timers.push(t)&&!timerId&&(timerId=setInterval(fx.tick,fx.interval))},show:function(){var dataShow=jQuery._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=dataShow||jQuery.style(this.elem,this.prop),this.options.show=!0,dataShow!==undefined?this.custom(this.cur(),dataShow):this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),jQuery(this.elem).show()},hide:function(){this.options.orig[this.prop]=jQuery._data(this.elem,"fxshow"+this.prop)||jQuery.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(gotoEnd){var p,n,complete,t=fxNow||createFxNow
(),done=!0,elem=this.elem,options=this.options;if(gotoEnd||t>=options.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),options.animatedProperties[this.prop]=!0;for(p in options.animatedProperties)options.animatedProperties[p]!==!0&&(done=!1);if(done){options.overflow!=null&&!jQuery.support.shrinkWrapBlocks&&jQuery.each(["","X","Y"],function(index,value){elem.style["overflow"+value]=options.overflow[index]}),options.hide&&jQuery(elem).hide();if(options.hide||options.show)for(p in options.animatedProperties)jQuery.style(elem,p,options.orig[p]),jQuery.removeData(elem,"fxshow"+p,!0),jQuery.removeData(elem,"toggle"+p,!0);complete=options.complete,complete&&(options.complete=!1,complete.call(elem))}return!1}return options.duration==Infinity?this.now=t:(n=t-this.startTime,this.state=n/options.duration,this.pos=jQuery.easing[options.animatedProperties[this.prop]](this.state,n,0,1,options.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update(),!0
}},jQuery.extend(jQuery.fx,{tick:function(){var timer,timers=jQuery.timers,i=0;for(;i<timers.length;i++)timer=timers[i],!timer()&&timers[i]===timer&&timers.splice(i--,1);timers.length||jQuery.fx.stop()},interval:13,stop:function(){clearInterval(timerId),timerId=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(fx){jQuery.style(fx.elem,"opacity",fx.now)},_default:function(fx){fx.elem.style&&fx.elem.style[fx.prop]!=null?fx.elem.style[fx.prop]=fx.now+fx.unit:fx.elem[fx.prop]=fx.now}}}),jQuery.each(fxAttrs.concat.apply([],fxAttrs),function(i,prop){prop.indexOf("margin")&&(jQuery.fx.step[prop]=function(fx){jQuery.style(fx.elem,prop,Math.max(0,fx.now)+fx.unit)})}),jQuery.expr&&jQuery.expr.filters&&(jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length});var getOffset,rtable=/^t(?:able|d|h)$/i,rroot=/^(?:body|html)$/i;"getBoundingClientRect"in document.documentElement?getOffset=function(elem,doc,docElem,box){
try{box=elem.getBoundingClientRect()}catch(e){}if(!box||!jQuery.contains(docElem,elem))return box?{top:box.top,left:box.left}:{top:0,left:0};var body=doc.body,win=getWindow(doc),clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0,scrollTop=win.pageYOffset||jQuery.support.boxModel&&docElem.scrollTop||body.scrollTop,scrollLeft=win.pageXOffset||jQuery.support.boxModel&&docElem.scrollLeft||body.scrollLeft,top=box.top+scrollTop-clientTop,left=box.left+scrollLeft-clientLeft;return{top:top,left:left}}:getOffset=function(elem,doc,docElem){var computedStyle,offsetParent=elem.offsetParent,prevOffsetParent=elem,body=doc.body,defaultView=doc.defaultView,prevComputedStyle=defaultView?defaultView.getComputedStyle(elem,null):elem.currentStyle,top=elem.offsetTop,left=elem.offsetLeft;while((elem=elem.parentNode)&&elem!==body&&elem!==docElem){if(jQuery.support.fixedPosition&&prevComputedStyle.position==="fixed")break;computedStyle=defaultView?defaultView.getComputedStyle
(elem,null):elem.currentStyle,top-=elem.scrollTop,left-=elem.scrollLeft,elem===offsetParent&&(top+=elem.offsetTop,left+=elem.offsetLeft,jQuery.support.doesNotAddBorder&&(!jQuery.support.doesAddBorderForTableAndCells||!rtable.test(elem.nodeName))&&(top+=parseFloat(computedStyle.borderTopWidth)||0,left+=parseFloat(computedStyle.borderLeftWidth)||0),prevOffsetParent=offsetParent,offsetParent=elem.offsetParent),jQuery.support.subtractsBorderForOverflowNotVisible&&computedStyle.overflow!=="visible"&&(top+=parseFloat(computedStyle.borderTopWidth)||0,left+=parseFloat(computedStyle.borderLeftWidth)||0),prevComputedStyle=computedStyle}if(prevComputedStyle.position==="relative"||prevComputedStyle.position==="static")top+=body.offsetTop,left+=body.offsetLeft;return jQuery.support.fixedPosition&&prevComputedStyle.position==="fixed"&&(top+=Math.max(docElem.scrollTop,body.scrollTop),left+=Math.max(docElem.scrollLeft,body.scrollLeft)),{top:top,left:left}},jQuery.fn.offset=function(options){if(arguments
.length)return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)});var elem=this[0],doc=elem&&elem.ownerDocument;return doc?elem===doc.body?jQuery.offset.bodyOffset(elem):getOffset(elem,doc,doc.documentElement):null},jQuery.offset={bodyOffset:function(body){var top=body.offsetTop,left=body.offsetLeft;return jQuery.support.doesNotIncludeMarginInBodyOffset&&(top+=parseFloat(jQuery.css(body,"marginTop"))||0,left+=parseFloat(jQuery.css(body,"marginLeft"))||0),{top:top,left:left}},setOffset:function(elem,options,i){var position=jQuery.css(elem,"position");position==="static"&&(elem.style.position="relative");var curElem=jQuery(elem),curOffset=curElem.offset(),curCSSTop=jQuery.css(elem,"top"),curCSSLeft=jQuery.css(elem,"left"),calculatePosition=(position==="absolute"||position==="fixed")&&jQuery.inArray("auto",[curCSSTop,curCSSLeft])>-1,props={},curPosition={},curTop,curLeft;calculatePosition?(curPosition=curElem.position(),curTop=curPosition.top,curLeft=curPosition
.left):(curTop=parseFloat(curCSSTop)||0,curLeft=parseFloat(curCSSLeft)||0),jQuery.isFunction(options)&&(options=options.call(elem,i,curOffset)),options.top!=null&&(props.top=options.top-curOffset.top+curTop),options.left!=null&&(props.left=options.left-curOffset.left+curLeft),"using"in options?options.using.call(elem,props):curElem.css(props)}},jQuery.fn.extend({position:function(){if(!this[0])return null;var elem=this[0],offsetParent=this.offsetParent(),offset=this.offset(),parentOffset=rroot.test(offsetParent[0].nodeName)?{top:0,left:0}:offsetParent.offset();return offset.top-=parseFloat(jQuery.css(elem,"marginTop"))||0,offset.left-=parseFloat(jQuery.css(elem,"marginLeft"))||0,parentOffset.top+=parseFloat(jQuery.css(offsetParent[0],"borderTopWidth"))||0,parentOffset.left+=parseFloat(jQuery.css(offsetParent[0],"borderLeftWidth"))||0,{top:offset.top-parentOffset.top,left:offset.left-parentOffset.left}},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent||
document.body;while(offsetParent&&!rroot.test(offsetParent.nodeName)&&jQuery.css(offsetParent,"position")==="static")offsetParent=offsetParent.offsetParent;return offsetParent})}}),jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top=/Y/.test(prop);jQuery.fn[method]=function(val){return jQuery.access(this,function(elem,method,val){var win=getWindow(elem);if(val===undefined)return win?prop in win?win[prop]:jQuery.support.boxModel&&win.document.documentElement[method]||win.document.body[method]:elem[method];win?win.scrollTo(top?jQuery(win).scrollLeft():val,top?val:jQuery(win).scrollTop()):elem[method]=val},method,val,arguments.length,null)}}),jQuery.each({Height:"height",Width:"width"},function(name,type){var clientProp="client"+name,scrollProp="scroll"+name,offsetProp="offset"+name;jQuery.fn["inner"+name]=function(){var elem=this[0];return elem?elem.style?parseFloat(jQuery.css(elem,type,"padding")):this[type]():null},jQuery.fn["outer"+name]=function(
margin){var elem=this[0];return elem?elem.style?parseFloat(jQuery.css(elem,type,margin?"margin":"border")):this[type]():null},jQuery.fn[type]=function(value){return jQuery.access(this,function(elem,type,value){var doc,docElemProp,orig,ret;if(jQuery.isWindow(elem))return doc=elem.document,docElemProp=doc.documentElement[clientProp],jQuery.support.boxModel&&docElemProp||doc.body&&doc.body[clientProp]||docElemProp;if(elem.nodeType===9)return doc=elem.documentElement,doc[clientProp]>=doc[scrollProp]?doc[clientProp]:Math.max(elem.body[scrollProp],doc[scrollProp],elem.body[offsetProp],doc[offsetProp]);if(value===undefined)return orig=jQuery.css(elem,type),ret=parseFloat(orig),jQuery.isNumeric(ret)?ret:orig;jQuery(elem).css(type,value)},type,value,arguments.length,null)}}),window.jQuery=window.$=jQuery,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return jQuery})})(window),function(){function eq(a,b,stack){if(a===b)return a!==0||1/a==1/b;if(a==null||b==
null)return a===b;a._chain&&(a=a._wrapped),b._chain&&(b=b._wrapped);if(a.isEqual&&_.isFunction(a.isEqual))return a.isEqual(b);if(b.isEqual&&_.isFunction(b.isEqual))return b.isEqual(a);var className=toString.call(a);if(className!=toString.call(b))return!1;switch(className){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return!1;var length=stack.length;while(length--)if(stack[length]==a)return!0;stack.push(a);var size=0,result=!0;if(className=="[object Array]"){size=a.length,result=size==b.length;if(result)while(size--)if(!(result=size in a==size in b&&eq(a[size],b[size],stack)))break}else{if("constructor"in a!="constructor"in b||a.constructor!=b.constructor)return!1;for(var key in a)if(_.has(a,key)){size++;if(!(result=
_.has(b,key)&&eq(a[key],b[key],stack)))break}if(result){for(key in b)if(_.has(b,key)&&!(size--))break;result=!size}}return stack.pop(),result}var root=this,previousUnderscore=root._,breaker={},ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype,slice=ArrayProto.slice,unshift=ArrayProto.unshift,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,_=function(obj){return new wrapper(obj)};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=_),exports._=_):root._=_,_.VERSION="1.3.2";var each=_.each=_.forEach=function(obj,iterator,context){if(obj==
null)return;if(nativeForEach&&obj.forEach===nativeForEach)obj.forEach(iterator,context);else if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++)if(i in obj&&iterator.call(context,obj[i],i,obj)===breaker)return}else for(var key in obj)if(_.has(obj,key)&&iterator.call(context,obj[key],key,obj)===breaker)return};_.map=_.collect=function(obj,iterator,context){var results=[];return obj==null?results:nativeMap&&obj.map===nativeMap?obj.map(iterator,context):(each(obj,function(value,index,list){results[results.length]=iterator.call(context,value,index,list)}),obj.length===+obj.length&&(results.length=obj.length),results)},_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;obj==null&&(obj=[]);if(nativeReduce&&obj.reduce===nativeReduce)return context&&(iterator=_.bind(iterator,context)),initial?obj.reduce(iterator,memo):obj.reduce(iterator);each(obj,function(value,index,list){initial?memo=iterator.call(context,memo,value,index,list):(memo=value
,initial=!0)});if(!initial)throw new TypeError("Reduce of empty array with no initial value");return memo},_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;obj==null&&(obj=[]);if(nativeReduceRight&&obj.reduceRight===nativeReduceRight)return context&&(iterator=_.bind(iterator,context)),initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator);var reversed=_.toArray(obj).reverse();return context&&!initial&&(iterator=_.bind(iterator,context)),initial?_.reduce(reversed,iterator,memo,context):_.reduce(reversed,iterator)},_.find=_.detect=function(obj,iterator,context){var result;return any(obj,function(value,index,list){if(iterator.call(context,value,index,list))return result=value,!0}),result},_.filter=_.select=function(obj,iterator,context){var results=[];return obj==null?results:nativeFilter&&obj.filter===nativeFilter?obj.filter(iterator,context):(each(obj,function(value,index,list){iterator.call(context,value,index,list)&&(results[results.length
]=value)}),results)},_.reject=function(obj,iterator,context){var results=[];return obj==null?results:(each(obj,function(value,index,list){iterator.call(context,value,index,list)||(results[results.length]=value)}),results)},_.every=_.all=function(obj,iterator,context){var result=!0;return obj==null?result:nativeEvery&&obj.every===nativeEvery?obj.every(iterator,context):(each(obj,function(value,index,list){if(!(result=result&&iterator.call(context,value,index,list)))return breaker}),!!result)};var any=_.some=_.any=function(obj,iterator,context){iterator||(iterator=_.identity);var result=!1;return obj==null?result:nativeSome&&obj.some===nativeSome?obj.some(iterator,context):(each(obj,function(value,index,list){if(result||(result=iterator.call(context,value,index,list)))return breaker}),!!result)};_.include=_.contains=function(obj,target){var found=!1;return obj==null?found:nativeIndexOf&&obj.indexOf===nativeIndexOf?obj.indexOf(target)!=-1:(found=any(obj,function(value){return value===target
}),found)},_.invoke=function(obj,method){var args=slice.call(arguments,2);return _.map(obj,function(value){return(_.isFunction(method)?method||value:value[method]).apply(value,args)})},_.pluck=function(obj,key){return _.map(obj,function(value){return value[key]})},_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0])return Math.max.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return-Infinity;var result={computed:-Infinity};return each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed>=result.computed&&(result={value:value,computed:computed})}),result.value},_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0])return Math.min.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return Infinity;var result={computed:Infinity};return each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed<result.computed&&(result={value:value
,computed:computed})}),result.value},_.shuffle=function(obj){var shuffled=[],rand;return each(obj,function(value,index,list){rand=Math.floor(Math.random()*(index+1)),shuffled[index]=shuffled[rand],shuffled[rand]=value}),shuffled},_.sortBy=function(obj,val,context){var iterator=_.isFunction(val)?val:function(obj){return obj[val]};return _.pluck(_.map(obj,function(value,index,list){return{value:value,criteria:iterator.call(context,value,index,list)}}).sort(function(left,right){var a=left.criteria,b=right.criteria;return a===void 0?1:b===void 0?-1:a<b?-1:a>b?1:0}),"value")},_.groupBy=function(obj,val){var result={},iterator=_.isFunction(val)?val:function(obj){return obj[val]};return each(obj,function(value,index){var key=iterator(value,index);(result[key]||(result[key]=[])).push(value)}),result},_.sortedIndex=function(array,obj,iterator){iterator||(iterator=_.identity);var low=0,high=array.length;while(low<high){var mid=low+high>>1;iterator(array[mid])<iterator(obj)?low=mid+1:high=mid}return low
},_.toArray=function(obj){return obj?_.isArray(obj)?slice.call(obj):_.isArguments(obj)?slice.call(obj):obj.toArray&&_.isFunction(obj.toArray)?obj.toArray():_.values(obj):[]},_.size=function(obj){return _.isArray(obj)?obj.length:_.keys(obj).length},_.first=_.head=_.take=function(array,n,guard){return n!=null&&!guard?slice.call(array,0,n):array[0]},_.initial=function(array,n,guard){return slice.call(array,0,array.length-(n==null||guard?1:n))},_.last=function(array,n,guard){return n!=null&&!guard?slice.call(array,Math.max(array.length-n,0)):array[array.length-1]},_.rest=_.tail=function(array,index,guard){return slice.call(array,index==null||guard?1:index)},_.compact=function(array){return _.filter(array,function(value){return!!value})},_.flatten=function(array,shallow){return _.reduce(array,function(memo,value){return _.isArray(value)?memo.concat(shallow?value:_.flatten(value)):(memo[memo.length]=value,memo)},[])},_.without=function(array){return _.difference(array,slice.call(arguments,1))
},_.uniq=_.unique=function(array,isSorted,iterator){var initial=iterator?_.map(array,iterator):array,results=[];return array.length<3&&(isSorted=!0),_.reduce(initial,function(memo,value,index){if(isSorted?_.last(memo)!==value||!memo.length:!_.include(memo,value))memo.push(value),results.push(array[index]);return memo},[]),results},_.union=function(){return _.uniq(_.flatten(arguments,!0))},_.intersection=_.intersect=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.indexOf(other,item)>=0})})},_.difference=function(array){var rest=_.flatten(slice.call(arguments,1),!0);return _.filter(array,function(value){return!_.include(rest,value)})},_.zip=function(){var args=slice.call(arguments),length=_.max(_.pluck(args,"length")),results=new Array(length);for(var i=0;i<length;i++)results[i]=_.pluck(args,""+i);return results},_.indexOf=function(array,item,isSorted){if(array==null)return-1;var i,l;if(isSorted)return i=
_.sortedIndex(array,item),array[i]===item?i:-1;if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item);for(i=0,l=array.length;i<l;i++)if(i in array&&array[i]===item)return i;return-1},_.lastIndexOf=function(array,item){if(array==null)return-1;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf)return array.lastIndexOf(item);var i=array.length;while(i--)if(i in array&&array[i]===item)return i;return-1},_.range=function(start,stop,step){arguments.length<=1&&(stop=start||0,start=0),step=arguments[2]||1;var len=Math.max(Math.ceil((stop-start)/step),0),idx=0,range=new Array(len);while(idx<len)range[idx++]=start,start+=step;return range};var ctor=function(){};_.bind=function(func,context){var bound,args;if(func.bind===nativeBind&&nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError;return args=slice.call(arguments,2),bound=function(){if(this instanceof bound){ctor.prototype=func.prototype;var self=new ctor,result=
func.apply(self,args.concat(slice.call(arguments)));return Object(result)===result?result:self}return func.apply(context,args.concat(slice.call(arguments)))}},_.bindAll=function(obj){var funcs=slice.call(arguments,1);return funcs.length==0&&(funcs=_.functions(obj)),each(funcs,function(f){obj[f]=_.bind(obj[f],obj)}),obj},_.memoize=function(func,hasher){var memo={};return hasher||(hasher=_.identity),function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:memo[key]=func.apply(this,arguments)}},_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)},_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)))},_.throttle=function(func,wait){var context,args,timeout,throttling,more,result,whenDone=_.debounce(function(){more=throttling=!1},wait);return function(){context=this,args=arguments;var later=function(){timeout=null,more&&func.apply(context,args),whenDone()};return timeout||
(timeout=setTimeout(later,wait)),throttling?more=!0:result=func.apply(context,args),whenDone(),throttling=!0,result}},_.debounce=function(func,wait,immediate){var timeout;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||func.apply(context,args)};immediate&&!timeout&&func.apply(context,args),clearTimeout(timeout),timeout=setTimeout(later,wait)}},_.once=function(func){var ran=!1,memo;return function(){return ran?memo:(ran=!0,memo=func.apply(this,arguments))}},_.wrap=function(func,wrapper){return function(){var args=[func].concat(slice.call(arguments,0));return wrapper.apply(this,args)}},_.compose=function(){var funcs=arguments;return function(){var args=arguments;for(var i=funcs.length-1;i>=0;i--)args=[funcs[i].apply(this,args)];return args[0]}},_.after=function(times,func){return times<=0?func():function(){if(--times<1)return func.apply(this,arguments)}},_.keys=nativeKeys||function(obj){if(obj!==Object(obj))throw new TypeError("Invalid object");var keys=
[];for(var key in obj)_.has(obj,key)&&(keys[keys.length]=key);return keys},_.values=function(obj){return _.map(obj,_.identity)},_.functions=_.methods=function(obj){var names=[];for(var key in obj)_.isFunction(obj[key])&&names.push(key);return names.sort()},_.extend=function(obj){return each(slice.call(arguments,1),function(source){for(var prop in source)obj[prop]=source[prop]}),obj},_.pick=function(obj){var result={};return each(_.flatten(slice.call(arguments,1)),function(key){key in obj&&(result[key]=obj[key])}),result},_.defaults=function(obj){return each(slice.call(arguments,1),function(source){for(var prop in source)obj[prop]==null&&(obj[prop]=source[prop])}),obj},_.clone=function(obj){return _.isObject(obj)?_.isArray(obj)?obj.slice():_.extend({},obj):obj},_.tap=function(obj,interceptor){return interceptor(obj),obj},_.isEqual=function(a,b){return eq(a,b,[])},_.isEmpty=function(obj){if(obj==null)return!0;if(_.isArray(obj)||_.isString(obj))return obj.length===0;for(var key in obj)if(_
.has(obj,key))return!1;return!0},_.isElement=function(obj){return!!obj&&obj.nodeType==1},_.isArray=nativeIsArray||function(obj){return toString.call(obj)=="[object Array]"},_.isObject=function(obj){return obj===Object(obj)},_.isArguments=function(obj){return toString.call(obj)=="[object Arguments]"},_.isArguments(arguments)||(_.isArguments=function(obj){return!!obj&&!!_.has(obj,"callee")}),_.isFunction=function(obj){return toString.call(obj)=="[object Function]"},_.isString=function(obj){return toString.call(obj)=="[object String]"},_.isNumber=function(obj){return toString.call(obj)=="[object Number]"},_.isFinite=function(obj){return _.isNumber(obj)&&isFinite(obj)},_.isNaN=function(obj){return obj!==obj},_.isBoolean=function(obj){return obj===!0||obj===!1||toString.call(obj)=="[object Boolean]"},_.isDate=function(obj){return toString.call(obj)=="[object Date]"},_.isRegExp=function(obj){return toString.call(obj)=="[object RegExp]"},_.isNull=function(obj){return obj===null},_.isUndefined=
function(obj){return obj===void 0},_.has=function(obj,key){return hasOwnProperty.call(obj,key)},_.noConflict=function(){return root._=previousUnderscore,this},_.identity=function(value){return value},_.times=function(n,iterator,context){for(var i=0;i<n;i++)iterator.call(context,i)},_.escape=function(string){return(""+string).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},_.result=function(object,property){if(object==null)return null;var value=object[property];return _.isFunction(value)?value.call(object):value},_.mixin=function(obj){each(_.functions(obj),function(name){addToWrapper(name,_[name]=obj[name])})};var idCounter=0;_.uniqueId=function(prefix){var id=idCounter++;return prefix?prefix+id:id},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/.^/,escapes={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"};for(var p in 
escapes)escapes[escapes[p]]=p;var escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g,unescaper=/\\(\\|'|r|n|t|u2028|u2029)/g,unescape=function(code){return code.replace(unescaper,function(match,escape){return escapes[escape]})};_.template=function(text,data,settings){settings=_.extend(_.templateSettings,settings);var source="__p+='"+text.replace(escaper,function(match){return"\\"+escapes[match]}).replace(settings.escape||noMatch,function(match,code){return"'+\n_.escape("+unescape(code)+")+\n'"}).replace(settings.interpolate||noMatch,function(match,code){return"'+\n("+unescape(code)+")+\n'"}).replace(settings.evaluate||noMatch,function(match,code){return"';\n"+unescape(code)+"\n;__p+='"})+"';\n";settings.variable||(source="with(obj||{}){\n"+source+"}\n"),source="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+source+"return __p;\n";var render=new Function(settings.variable||"obj","_",source);if(data)return render(data,_);var template=function(data){return render.call
(this,data,_)};return template.source="function("+(settings.variable||"obj")+"){\n"+source+"}",template},_.chain=function(obj){return _(obj).chain()};var wrapper=function(obj){this._wrapped=obj};_.prototype=wrapper.prototype;var result=function(obj,chain){return chain?_(obj).chain():obj},addToWrapper=function(name,func){wrapper.prototype[name]=function(){var args=slice.call(arguments);return unshift.call(args,this._wrapped),result(func.apply(_,args),this._chain)}};_.mixin(_),each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];wrapper.prototype[name]=function(){var wrapped=this._wrapped;method.apply(wrapped,arguments);var length=wrapped.length;return(name=="shift"||name=="splice")&&length===0&&delete wrapped[0],result(wrapped,this._chain)}}),each(["concat","join","slice"],function(name){var method=ArrayProto[name];wrapper.prototype[name]=function(){return result(method.apply(this._wrapped,arguments),this._chain)}}),wrapper.prototype.
chain=function(){return this._chain=!0,this},wrapper.prototype.value=function(){return this._wrapped},typeof define=="function"&&define.amd&&define("underscore",[],function(){return _})}.call(this),function(root,factory){typeof exports!="undefined"?factory(root,exports,require("underscore")):typeof define=="function"&&define.amd?define("backbone",["underscore","jquery","exports"],function(_,$,exports){root.Backbone=factory(root,exports,_,$)}):root.Backbone=factory(root,{},root._,root.jQuery||root.Zepto||root.ender)}(this,function(root,Backbone,_,$){var previousBackbone=root.Backbone,slice=Array.prototype.slice,splice=Array.prototype.splice;Backbone.VERSION="0.9.2",Backbone.setDomLibrary=function(lib){$=lib},Backbone.noConflict=function(){return root.Backbone=previousBackbone,Backbone},Backbone.emulateHTTP=!1,Backbone.emulateJSON=!1;var eventSplitter=/\s+/,Events=Backbone.Events={on:function(events,callback,context){var calls,event,node,tail,list;if(!callback)return this;events=events.split
(eventSplitter),calls=this._callbacks||(this._callbacks={});while(event=events.shift())list=calls[event],node=list?list.tail:{},node.next=tail={},node.context=context,node.callback=callback,calls[event]={tail:tail,next:list?list.next:node};return this},off:function(events,callback,context){var event,calls,node,tail,cb,ctx;if(!(calls=this._callbacks))return;if(!(events||callback||context))return delete this._callbacks,this;events=events?events.split(eventSplitter):_.keys(calls);while(event=events.shift()){node=calls[event],delete calls[event];if(!node||!callback&&!context)continue;tail=node.tail;while((node=node.next)!==tail)cb=node.callback,ctx=node.context,(callback&&cb!==callback||context&&ctx!==context)&&this.on(event,cb,ctx)}return this},trigger:function(events){var event,node,calls,tail,args,all,rest;if(!(calls=this._callbacks))return this;all=calls.all,events=events.split(eventSplitter),rest=slice.call(arguments,1);while(event=events.shift()){if(node=calls[event]){tail=node.tail;while(
(node=node.next)!==tail)node.callback.apply(node.context||this,rest)}if(node=all){tail=node.tail,args=[event].concat(rest);while((node=node.next)!==tail)node.callback.apply(node.context||this,args)}}return this}};Events.bind=Events.on,Events.unbind=Events.off;var Model=Backbone.Model=function(attributes,options){var defaults;attributes||(attributes={}),options&&options.parse&&(attributes=this.parse(attributes));if(defaults=getValue(this,"defaults"))attributes=_.extend({},defaults,attributes);options&&options.collection&&(this.collection=options.collection),this.attributes={},this._escapedAttributes={},this.cid=_.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(attributes,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=_.clone(this.attributes),this.initialize.apply(this,arguments)};_.extend(Model.prototype,Events,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(options){return _
.clone(this.attributes)},get:function(attr){return this.attributes[attr]},escape:function(attr){var html;if(html=this._escapedAttributes[attr])return html;var val=this.get(attr);return this._escapedAttributes[attr]=_.escape(val==null?"":""+val)},has:function(attr){return this.get(attr)!=null},set:function(key,value,options){var attrs,attr,val;_.isObject(key)||key==null?(attrs=key,options=value):(attrs={},attrs[key]=value),options||(options={});if(!attrs)return this;attrs instanceof Model&&(attrs=attrs.attributes);if(options.unset)for(attr in attrs)attrs[attr]=void 0;if(!this._validate(attrs,options))return!1;this.idAttribute in attrs&&(this.id=attrs[this.idAttribute]);var changes=options.changes={},now=this.attributes,escaped=this._escapedAttributes,prev=this._previousAttributes||{};for(attr in attrs){val=attrs[attr];if(!_.isEqual(now[attr],val)||options.unset&&_.has(now,attr))delete escaped[attr],(options.silent?this._silent:changes)[attr]=!0;options.unset?delete now[attr]:now[attr]=val
,!_.isEqual(prev[attr],val)||_.has(now,attr)!=_.has(prev,attr)?(this.changed[attr]=val,options.silent||(this._pending[attr]=!0)):(delete this.changed[attr],delete this._pending[attr])}return options.silent||this.change(options),this},unset:function(attr,options){return(options||(options={})).unset=!0,this.set(attr,null,options)},clear:function(options){return(options||(options={})).unset=!0,this.set(_.clone(this.attributes),options)},fetch:function(options){options=options?_.clone(options):{};var model=this,success=options.success;return options.success=function(resp,status,xhr){if(!model.set(model.parse(resp,xhr),options))return!1;success&&success(model,resp)},options.error=Backbone.wrapError(options.error,model,options),(this.sync||Backbone.sync).call(this,"read",this,options)},save:function(key,value,options){var attrs,current;_.isObject(key)||key==null?(attrs=key,options=value):(attrs={},attrs[key]=value),options=options?_.clone(options):{};if(options.wait){if(!this._validate(attrs,
options))return!1;current=_.clone(this.attributes)}var silentOptions=_.extend({},options,{silent:!0});if(attrs&&!this.set(attrs,options.wait?silentOptions:options))return!1;var model=this,success=options.success;options.success=function(resp,status,xhr){var serverAttrs=model.parse(resp,xhr);options.wait&&(delete options.wait,serverAttrs=_.extend(attrs||{},serverAttrs));if(!model.set(serverAttrs,options))return!1;success?success(model,resp):model.trigger("sync",model,resp,options)},options.error=Backbone.wrapError(options.error,model,options);var method=this.isNew()?"create":"update",xhr=(this.sync||Backbone.sync).call(this,method,this,options);return options.wait&&this.set(current,silentOptions),xhr},destroy:function(options){options=options?_.clone(options):{};var model=this,success=options.success,triggerDestroy=function(){model.trigger("destroy",model,model.collection,options)};if(this.isNew())return triggerDestroy(),!1;options.success=function(resp){options.wait&&triggerDestroy(),success?
success(model,resp):model.trigger("sync",model,resp,options)},options.error=Backbone.wrapError(options.error,model,options);var xhr=(this.sync||Backbone.sync).call(this,"delete",this,options);return options.wait||triggerDestroy(),xhr},url:function(){var base=getValue(this,"urlRoot")||getValue(this.collection,"url")||urlError();return this.isNew()?base:base+(base.charAt(base.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(resp,xhr){return resp},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(options){options||(options={});var changing=this._changing;this._changing=!0;for(var attr in this._silent)this._pending[attr]=!0;var changes=_.extend({},options.changes,this._silent);this._silent={};for(var attr in changes)this.trigger("change:"+attr,this,this.get(attr),options);if(changing)return this;while(!_.isEmpty(this._pending)){this._pending={},this.trigger("change",this,options);for(var attr in this.changed
){if(this._pending[attr]||this._silent[attr])continue;delete this.changed[attr]}this._previousAttributes=_.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(attr){return arguments.length?_.has(this.changed,attr):!_.isEmpty(this.changed)},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):!1;var val,changed=!1,old=this._previousAttributes;for(var attr in diff){if(_.isEqual(old[attr],val=diff[attr]))continue;(changed||(changed={}))[attr]=val}return changed},previous:function(attr){return!arguments.length||!this._previousAttributes?null:this._previousAttributes[attr]},previousAttributes:function(){return _.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(attrs,options){if(options.silent||!this.validate)return!0;attrs=_.extend({},this.attributes,attrs);var error=this.validate(attrs,options);return error?(options&&options.error?options.error(this,error,options):this.trigger
("error",this,error,options),!1):!0}});var Collection=Backbone.Collection=function(models,options){options||(options={}),options.model&&(this.model=options.model),options.comparator&&(this.comparator=options.comparator),this._reset(),this.initialize.apply(this,arguments),models&&this.reset(models,{silent:!0,parse:options.parse})};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options)})},add:function(models,options){var i,index,length,model,cid,id,cids={},ids={},dups=[];options||(options={}),models=_.isArray(models)?models.slice():[models];for(i=0,length=models.length;i<length;i++){if(!(model=models[i]=this._prepareModel(models[i],options)))throw new Error("Can't add an invalid model to a collection");cid=model.cid,id=model.id;if(cids[cid]||this._byCid[cid]||id!=null&&(ids[id]||this._byId[id])){dups.push(i);continue}cids[cid]=ids[id]=model}i=dups.length;while(i--)models.splice(dups[i]
,1);for(i=0,length=models.length;i<length;i++)(model=models[i]).on("all",this._onModelEvent,this),this._byCid[model.cid]=model,model.id!=null&&(this._byId[model.id]=model);this.length+=length,index=options.at!=null?options.at:this.models.length,splice.apply(this.models,[index,0].concat(models)),this.comparator&&this.sort({silent:!0});if(options.silent)return this;for(i=0,length=this.models.length;i<length;i++){if(!cids[(model=this.models[i]).cid])continue;options.index=i,model.trigger("add",model,this,options)}return this},remove:function(models,options){var i,l,index,model;options||(options={}),models=_.isArray(models)?models.slice():[models];for(i=0,l=models.length;i<l;i++){model=this.getByCid(models[i])||this.get(models[i]);if(!model)continue;delete this._byId[model.id],delete this._byCid[model.cid],index=this.indexOf(model),this.models.splice(index,1),this.length--,options.silent||(options.index=index,model.trigger("remove",model,this,options)),this._removeReference(model)}return this
},push:function(model,options){return model=this._prepareModel(model,options),this.add(model,options),model},pop:function(options){var model=this.at(this.length-1);return this.remove(model,options),model},unshift:function(model,options){return model=this._prepareModel(model,options),this.add(model,_.extend({at:0},options)),model},shift:function(options){var model=this.at(0);return this.remove(model,options),model},get:function(id){return id==null?void 0:this._byId[id.id!=null?id.id:id]},getByCid:function(cid){return cid&&this._byCid[cid.cid||cid]},at:function(index){return this.models[index]},where:function(attrs){return _.isEmpty(attrs)?[]:this.filter(function(model){for(var key in attrs)if(attrs[key]!==model.get(key))return!1;return!0})},sort:function(options){options||(options={});if(!this.comparator)throw new Error("Cannot sort a set without a comparator");var boundComparator=_.bind(this.comparator,this);return this.comparator.length==1?this.models=this.sortBy(boundComparator):this.
models.sort(boundComparator),options.silent||this.trigger("reset",this,options),this},pluck:function(attr){return _.map(this.models,function(model){return model.get(attr)})},reset:function(models,options){models||(models=[]),options||(options={});for(var i=0,l=this.models.length;i<l;i++)this._removeReference(this.models[i]);return this._reset(),this.add(models,_.extend({silent:!0},options)),options.silent||this.trigger("reset",this,options),this},fetch:function(options){options=options?_.clone(options):{},options.parse===undefined&&(options.parse=!0);var collection=this,success=options.success;return options.success=function(resp,status,xhr){collection[options.add?"add":"reset"](collection.parse(resp,xhr),options),success&&success(collection,resp)},options.error=Backbone.wrapError(options.error,collection,options),(this.sync||Backbone.sync).call(this,"read",this,options)},create:function(model,options){var coll=this;options=options?_.clone(options):{},model=this._prepareModel(model,options
);if(!model)return!1;options.wait||coll.add(model,options);var success=options.success;return options.success=function(nextModel,resp,xhr){options.wait&&coll.add(nextModel,options),success?success(nextModel,resp):nextModel.trigger("sync",model,resp,options)},model.save(null,options),model},parse:function(resp,xhr){return resp},chain:function(){return _(this.models).chain()},_reset:function(options){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(model,options){options||(options={});if(model instanceof Model)model.collection||(model.collection=this);else{var attrs=model;options.collection=this,model=new this.model(attrs,options),model._validate(model.attributes,options)||(model=!1)}return model},_removeReference:function(model){this==model.collection&&delete model.collection,model.off("all",this._onModelEvent,this)},_onModelEvent:function(event,model,collection,options){if((event=="add"||event=="remove")&&collection!=this)return;event=="destroy"&&this.remove
(model,options),model&&event==="change:"+model.idAttribute&&(delete this._byId[model.previous(model.idAttribute)],this._byId[model.id]=model),this.trigger.apply(this,arguments)}});var methods=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];_.each(methods,function(method){Collection.prototype[method]=function(){return _[method].apply(_,[this.models].concat(_.toArray(arguments)))}});var Router=Backbone.Router=function(options){options||(options={}),options.routes&&(this.routes=options.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},namedParam=/:\w+/g,splatParam=/\*\w+/g,escapeRegExp=/[-[\]{}()+?.,\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){return Backbone.history||(Backbone
.history=new History),_.isRegExp(route)||(route=this._routeToRegExp(route)),callback||(callback=this[name]),Backbone.history.route(route,_.bind(function(fragment){var args=this._extractParameters(route,fragment);callback&&callback.apply(this,args),this.trigger.apply(this,["route:"+name].concat(args)),Backbone.history.trigger("route",this,name,args)},this)),this},navigate:function(fragment,options){Backbone.history.navigate(fragment,options)},_bindRoutes:function(){if(!this.routes)return;var routes=[];for(var route in this.routes)routes.unshift([route,this.routes[route]]);for(var i=0,l=routes.length;i<l;i++)this.route(routes[i][0],routes[i][1],this[routes[i][1]])},_routeToRegExp:function(route){return route=route.replace(escapeRegExp,"\\$&").replace(namedParam,"([^/]+)").replace(splatParam,"(.*?)"),new RegExp("^"+route+"$")},_extractParameters:function(route,fragment){return route.exec(fragment).slice(1)}});var History=Backbone.History=function(){this.handlers=[],_.bindAll(this,"checkUrl"
)},routeStripper=/^[#\/]/,isExplorer=/msie [\w.]+/;History.started=!1,_.extend(History.prototype,Events,{interval:50,getHash:function(windowOverride){var loc=windowOverride?windowOverride.location:window.location,match=loc.href.match(/#(.*)$/);return match?match[1]:""},getFragment:function(fragment,forcePushState){if(fragment==null)if(this._hasPushState||forcePushState){fragment=window.location.pathname;var search=window.location.search;search&&(fragment+=search)}else fragment=this.getHash();return fragment.indexOf(this.options.root)||(fragment=fragment.substr(this.options.root.length)),fragment.replace(routeStripper,"")},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=!0,this.options=_.extend({},{root:"/"},this.options,options),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var fragment=
this.getFragment(),docMode=document.documentMode,oldIE=isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||docMode<=7);oldIE&&(this.iframe=$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(fragment)),this._hasPushState?$(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!oldIE?$(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=fragment;var loc=window.location,atRoot=loc.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!atRoot)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&atRoot&&loc.hash&&(this.fragment=this.getHash().replace(routeStripper,""),window.history.replaceState({},document.title,loc.protocol+"//"+loc.host+this.options.root+this.fragment
));if(!this.options.silent)return this.loadUrl()},stop:function(){$(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),History.started=!1},route:function(route,callback){this.handlers.unshift({route:route,callback:callback})},checkUrl:function(e){var current=this.getFragment();current==this.fragment&&this.iframe&&(current=this.getFragment(this.getHash(this.iframe)));if(current==this.fragment)return!1;this.iframe&&this.navigate(current),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(fragmentOverride){var fragment=this.fragment=this.getFragment(fragmentOverride),matched=_.any(this.handlers,function(handler){if(handler.route.test(fragment))return handler.callback(fragment),!0});return matched},navigate:function(fragment,options){if(!History.started)return!1;if(!options||options===!0)options={trigger:options};var frag=(fragment||"").replace(routeStripper,"");if(this.fragment==frag)return;this._hasPushState?(frag.
indexOf(this.options.root)!=0&&(frag=this.options.root+frag),this.fragment=frag,window.history[options.replace?"replaceState":"pushState"]({},document.title,frag)):this._wantsHashChange?(this.fragment=frag,this._updateHash(window.location,frag,options.replace),this.iframe&&frag!=this.getFragment(this.getHash(this.iframe))&&(options.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,frag,options.replace))):window.location.assign(this.options.root+fragment),options.trigger&&this.loadUrl(fragment)},_updateHash:function(location,fragment,replace){replace?location.replace(location.toString().replace(/(javascript:|#).*$/,"")+"#"+fragment):location.hash=fragment}});var View=Backbone.View=function(options){this.cid=_.uniqueId("view"),this._configure(options||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},delegateEventSplitter=/^(\S+)\s*(.*)$/,viewOptions=["model","collection","el","id","attributes","className","tagName"];_.
extend(View.prototype,Events,{tagName:"div",$:function(selector){return this.$el.find(selector)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(tagName,attributes,content){var el=document.createElement(tagName);return attributes&&$(el).attr(attributes),content!=null&&$(el).html(content),el},setElement:function(element,delegate){return this.$el&&this.undelegateEvents(),this.$el=element instanceof $?element:$(element),this.el=this.$el[0],delegate!==!1&&this.delegateEvents(),this},delegateEvents:function(events){if(!events&&!(events=getValue(this,"events")))return;this.undelegateEvents();for(var key in events){var method=events[key];_.isFunction(method)||(method=this[events[key]]);if(!method)throw new Error('Method "'+events[key]+'" does not exist');var match=key.match(delegateEventSplitter),eventName=match[1],selector=match[2];method=_.bind(method,this),eventName+=".delegateEvents"+this.cid,selector===""?this.$el.bind(
eventName,method):this.$el.delegate(selector,eventName,method)}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(options){this.options&&(options=_.extend({},this.options,options));for(var i=0,l=viewOptions.length;i<l;i++){var attr=viewOptions[i];options[attr]&&(this[attr]=options[attr])}this.options=options},_ensureElement:function(){if(!this.el){var attrs=getValue(this,"attributes")||{};this.id&&(attrs.id=this.id),this.className&&(attrs["class"]=this.className),this.setElement(this.make(this.tagName,attrs),!1)}else this.setElement(this.el,!1)}});var extend=function(protoProps,classProps){var child=inherits(this,protoProps,classProps);return child.extend=this.extend,child};Model.extend=Collection.extend=Router.extend=View.extend=extend;var methodMap={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};Backbone.sync=function(method,model,options){var type=methodMap[method];options||(options={});var params={type:type,dataType:"json"};return options
.url||(params.url=getValue(model,"url")||urlError()),!options.data&&model&&(method=="create"||method=="update")&&(params.contentType="application/json",params.data=JSON.stringify(model.toJSON())),Backbone.emulateJSON&&(params.contentType="application/x-www-form-urlencoded",params.data=params.data?{model:params.data}:{}),Backbone.emulateHTTP&&(type==="PUT"||type==="DELETE")&&(Backbone.emulateJSON&&(params.data._method=type),params.type="POST",params.beforeSend=function(xhr){xhr.setRequestHeader("X-HTTP-Method-Override",type)}),params.type!=="GET"&&!Backbone.emulateJSON&&(params.processData=!1),$.ajax(_.extend(params,options))},Backbone.wrapError=function(onError,originalModel,options){return function(model,resp){resp=model===originalModel?resp:model,onError?onError(originalModel,resp,options):originalModel.trigger("error",originalModel,resp,options)}};var ctor=function(){},inherits=function(parent,protoProps,staticProps){var child;return protoProps&&protoProps.hasOwnProperty("constructor"
)?child=protoProps.constructor:child=function(){parent.apply(this,arguments)},_.extend(child,parent),ctor.prototype=parent.prototype,child.prototype=new ctor,protoProps&&_.extend(child.prototype,protoProps),staticProps&&_.extend(child,staticProps),child.prototype.constructor=child,child.__super__=parent.prototype,child},getValue=function(object,prop){return!object||!object[prop]?null:_.isFunction(object[prop])?object[prop]():object[prop]},urlError=function(){throw new Error('A "url" property or function must be specified')};return Backbone}),function(){var Mustache=function(){function escapeHTML(string){return String(string).replace(/&(?!\w+;)|[<>"']/g,function(s){return escapeMap[s]||s})}var _toString=Object.prototype.toString;Array.isArray=Array.isArray||function(obj){return _toString.call(obj)=="[object Array]"};var _trim=String.prototype.trim,trim;if(_trim)trim=function(text){return text==null?"":_trim.call(text)};else{var trimLeft,trimRight;/\S/.test("\u00a0")?(trimLeft=/^[\s\xA0]+/
,trimRight=/[\s\xA0]+$/):(trimLeft=/^\s+/,trimRight=/\s+$/),trim=function(text){return text==null?"":text.toString().replace(trimLeft,"").replace(trimRight,"")}}var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},regexCache={},Renderer=function(){};return Renderer.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":!0},context:{},render:function(template,context,partials,in_recursion){in_recursion||(this.context=context,this.buffer=[]);if(!this.includes("",template)){if(in_recursion)return template;this.send(template);return}template=this.render_pragmas(template);var html=this.render_section(template,context,partials);html===!1&&(html=this.render_tags(template,context,partials,in_recursion));if(in_recursion)return html;this.sendLines(html)},send:function(line){line!==""&&this.buffer.push(line)},sendLines:function(text){if(text){var lines=text.split("\n");for(var i=0;i<lines.length;i++)this.send(lines[i])}},render_pragmas:function(
template){if(!this.includes("%",template))return template;var that=this,regex=this.getCachedRegex("render_pragmas",function(otag,ctag){return new RegExp(otag+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+ctag,"g")});return template.replace(regex,function(match,pragma,options){if(!that.pragmas_implemented[pragma])throw{message:"This implementation of mustache doesn't understand the '"+pragma+"' pragma"};that.pragmas[pragma]={};if(options){var opts=options.split("=");that.pragmas[pragma][opts[0]]=opts[1]}return""})},render_partial:function(name,context,partials){name=trim(name);if(!partials||partials[name]===undefined)throw{message:"unknown_partial '"+name+"'"};return!context||typeof context[name]!="object"?this.render(partials[name],context,partials,!0):this.render(partials[name],context[name],partials,!0)},render_section:function(template,context,partials){if(!this.includes("#",template)&&!this.includes("^",template))return!1;var that=this,regex=this.getCachedRegex("render_section",function(otag,ctag)
{return new RegExp("^([\\s\\S]*?)"+otag+"(\\^|\\#)\\s*(.+)\\s*"+ctag+"\n*([\\s\\S]*?)"+otag+"\\/\\s*\\3\\s*"+ctag+"\\s*([\\s\\S]*)$","g")});return template.replace(regex,function(match,before,type,name,content,after){var renderedBefore=before?that.render_tags(before,context,partials,!0):"",renderedAfter=after?that.render(after,context,partials,!0):"",renderedContent,value=that.find(name,context);return type==="^"?!value||Array.isArray(value)&&value.length===0?renderedContent=that.render(content,context,partials,!0):renderedContent="":type==="#"&&(Array.isArray(value)?renderedContent=that.map(value,function(row){return that.render(content,that.create_context(row),partials,!0)}).join(""):that.is_object(value)?renderedContent=that.render(content,that.create_context(value),partials,!0):typeof value=="function"?renderedContent=value.call(context,content,function(text){return that.render(text,context,partials,!0)}):value?renderedContent=that.render(content,context,partials,!0):renderedContent=""
),renderedBefore+renderedContent+renderedAfter})},render_tags:function(template,context,partials,in_recursion){var that=this,new_regex=function(){return that.getCachedRegex("render_tags",function(otag,ctag){return new RegExp(otag+"(=|!|>|&|\\{|%)?([^#\\^]+?)\\1?"+ctag+"+","g")})},regex=new_regex(),tag_replace_callback=function(match,operator,name){switch(operator){case"!":return"";case"=":return that.set_delimiters(name),regex=new_regex(),"";case">":return that.render_partial(name,context,partials);case"{":case"&":return that.find(name,context);default:return escapeHTML(that.find(name,context))}},lines=template.split("\n");for(var i=0;i<lines.length;i++)lines[i]=lines[i].replace(regex,tag_replace_callback,this),in_recursion||this.send(lines[i]);if(in_recursion)return lines.join("\n")},set_delimiters:function(delimiters){var dels=delimiters.split(" ");this.otag=this.escape_regex(dels[0]),this.ctag=this.escape_regex(dels[1])},escape_regex:function(text){if(!arguments.callee.sRE){var specials=
["/",".","*","+","?","|","(",")","[","]","{","}","\\"];arguments.callee.sRE=new RegExp("(\\"+specials.join("|\\")+")","g")}return text.replace(arguments.callee.sRE,"\\$1")},find:function(name,context){function is_kinda_truthy(bool){return bool===!1||bool===0||bool}name=trim(name);var value;if(name.match(/([a-z_]+)\./ig)){var childValue=this.walk_context(name,context);is_kinda_truthy(childValue)&&(value=childValue)}else is_kinda_truthy(context[name])?value=context[name]:is_kinda_truthy(this.context[name])&&(value=this.context[name]);return typeof value=="function"?value.apply(context):value!==undefined?value:""},walk_context:function(name,context){var path=name.split("."),value_context=context[path[0]]!=undefined?context:this.context,value=value_context[path.shift()];while(value!=undefined&&path.length>0)value_context=value,value=value[path.shift()];return typeof value=="function"?value.apply(value_context):value},includes:function(needle,haystack){return haystack.indexOf(this.otag+needle
)!=-1},create_context:function(_context){if(this.is_object(_context))return _context;var iterator=".";this.pragmas["IMPLICIT-ITERATOR"]&&(iterator=this.pragmas["IMPLICIT-ITERATOR"].iterator);var ctx={};return ctx[iterator]=_context,ctx},is_object:function(a){return a&&typeof a=="object"},map:function(array,fn){if(typeof array.map=="function")return array.map(fn);var r=[],l=array.length;for(var i=0;i<l;i++)r.push(fn(array[i]));return r},getCachedRegex:function(name,generator){var byOtag=regexCache[this.otag];byOtag||(byOtag=regexCache[this.otag]={});var byCtag=byOtag[this.ctag];byCtag||(byCtag=byOtag[this.ctag]={});var regex=byCtag[name];return regex||(regex=byCtag[name]=generator(this.otag,this.ctag)),regex}},{name:"mustache.js",version:"0.4.0",to_html:function(template,view,partials,send_fun){var renderer=new Renderer;send_fun&&(renderer.send=send_fun),renderer.render(template,view||{},partials);if(!send_fun)return renderer.buffer.join("\n")}}}();(function(){function trim(stuff){return""
.trim?stuff.trim():stuff.replace(/^\s+/,"").replace(/\s+$/,"")}var ich={VERSION:"0.10",templates:{},$:typeof window!="undefined"?window.jQuery||window.Zepto||null:null,addTemplate:function(name,templateString){if(typeof name=="object"){for(var template in name)this.addTemplate(template,name[template]);return}ich[name]?console.error("Invalid name: "+name+"."):ich.templates[name]?console.error('Template "'+name+'  " exists'):(ich.templates[name]=templateString,ich[name]=function(data,raw){data=data||{};var result=Mustache.to_html(ich.templates[name],data,ich.templates);return ich.$&&!raw?ich.$(result):result})},clearAll:function(){for(var key in ich.templates)delete ich[key];ich.templates={}},refresh:function(){ich.clearAll(),ich.grabTemplates()},grabTemplates:function(){var i,scripts=document.getElementsByTagName("script"),script,trash=[];for(i=0,l=scripts.length;i<l;i++)script=scripts[i],script&&script.innerHTML&&script.id&&(script.type==="text/html"||script.type==="text/x-icanhaz")&&(ich
.addTemplate(script.id,trim(script.innerHTML)),trash.unshift(script));for(i=0,l=trash.length;i<l;i++)trash[i].parentNode.removeChild(trash[i])}};typeof define!="undefined"&&define.amd?define("ich",[],function(){return ich}):typeof require!="undefined"?module.exports=ich:window.ich=ich,typeof document!="undefined"&&(ich.$?ich.$(function(){ich.grabTemplates()}):document.addEventListener("DOMContentLoaded",function(){ich.grabTemplates()},!0))})()}(),define("models/user",["jquery","underscore","backbone"],function($,_,Backbone){var User=Backbone.Model.extend({defaults:{Status:2},idAttribute:"Id"});return User}),define("collections/usercollection",["jquery","underscore","backbone","models/user"],function($,_,Backbone,User){var UserCollection=Backbone.Collection.extend({model:User,url:"/users",initialize:function(){_.extend(this,Backbone.Events)}});return UserCollection}),define("models/project",["jquery","underscore","backbone"],function($,_,Backbone){var Project=Backbone.Model.extend({defaults
:{Name:"",Description:"",Website:"",Avatar:null,Team:null,Type:"Project"},idAttribute:"Id",urlRoot:"/projects",setAvatar:function(mediaResource){this.set("Avatar",mediaResource.id)}});return Project}),define("collections/projectcollection",["jquery","underscore","backbone","models/project"],function($,_,Backbone,Project){var ProjectCollection=Backbone.Collection.extend({model:Project,url:"/projects",initialize:function(){_.extend(this,Backbone.Events)},toJSONViewModel:function(){var viewModels=[];return _.each(this.models,function(project){viewModels.push(project.toJSONViewModel())}),viewModels}});return ProjectCollection}),define("models/team",["jquery","underscore","backbone"],function($,_,Backbone){var Team=Backbone.Model.extend({defaults:{Name:"",Description:"",Website:"",Avatar:null,Organisation:null,Type:"Team"},idAttribute:"Id",urlRoot:"/teams",toJSON:function(){return{Name:this.get("Name"),Description:this.get("Description"),Website:this.get("Website"),Avatar:this.get("Avatar"),
Organisation:this.get("Organisation"),Type:"Team"}},setAvatar:function(mediaResource){this.set("Avatar",mediaResource.id)}});return Team}),define("collections/teamcollection",["jquery","underscore","backbone","models/team"],function($,_,Backbone,Team){var TeamCollection=Backbone.Collection.extend({model:Team,url:"/teams",initialize:function(){_.extend(this,Backbone.Events)},toJSONViewModel:function(){var viewModels=[];return _.each(this.models,function(team){viewModels.push(team.toJSONViewModel())}),viewModels}});return TeamCollection}),define("models/organisation",["jquery","underscore","backbone"],function($,_,Backbone){var Organisation=Backbone.Model.extend({defaults:{Name:"",Description:"",Website:"",Avatar:null,Type:"Organisation"},idAttribute:"Id",urlRoot:"/organisations",toJSON:function(){return{Name:this.get("Name"),Description:this.get("Description"),Website:this.get("Website"),Avatar:this.get("Avatar"),Type:"Organisation"}},setAvatar:function(mediaResource){this.set("Avatar",mediaResource
.id)}});return Organisation}),define("collections/organisationcollection",["jquery","underscore","backbone","models/organisation"],function($,_,Backbone,Organisation){var OrganisationCollection=Backbone.Collection.extend({model:Organisation,url:"/organisations",initialize:function(){_.extend(this,Backbone.Events)},toJSONViewModel:function(){var viewModels=[];return _.each(this.models,function(organisation){viewModels.push(organisation.toJSONViewModel())}),viewModels}});return OrganisationCollection}),define("models/activity",["jquery","underscore","backbone"],function($,_,Backbone){var Activity=Backbone.Model.extend({idAttribute:"Id"});return Activity}),define("collections/activitycollection",["jquery","underscore","backbone","models/activity"],function($,_,Backbone,Activity){var ActivityCollection=Backbone.Collection.extend({model:Activity,initialize:function(){_.extend(this,Backbone.Events)}});return ActivityCollection}),define("collections/paginatedcollection",["jquery","underscore","backbone"
],function($,_,Backbone){var PaginatedCollection=Backbone.Collection.extend({initialize:function(options){_.extend(this,Backbone.Events),typeof options!="undefined"||(options={}),this.page=1,typeof this.pageSize!="undefined"||(this.pageSize=10)},fetch:function(options){typeof options!="undefined"||(options={}),this.trigger("fetching",this);var self=this,success=options.success;return options.success=function(resp){self.trigger("fetched",self),success&&success(self,resp)},Backbone.Collection.prototype.fetch.call(this,options)},parse:function(resp){return this.page=resp.Model.Page,this.pageSize=resp.Model.PageSize,this.total=resp.Model.TotalResultCount,resp.Model.PagedListItems},url:function(){return this.baseUrl+"?"+$.param({page:this.page,pageSize:this.pageSize})},pageInfo:function(){var info={total:this.total,page:this.page,pageSize:this.pageSize,pages:Math.ceil(this.total/this.pageSize),prev:!1,next:!1},max=Math.min(this.total,this.page*this.pageSize);return this.total==this.pages*this
.pageSize&&(max=this.total),info.range=[(this.page-1)*this.pageSize+1,max],this.page>1&&(info.prev=this.page-1),this.page<info.pages&&(info.next=this.page+1),info},firstPage:function(options){return this.page=1,this.fetch(options)},nextPage:function(options){return this.pageInfo().next?(this.page=this.page+1,this.fetch(options)):!1},previousPage:function(){return this.pageInfo().prev?(this.page=this.page-1,this.fetch(options)):!1}});return PaginatedCollection}),define("collections/exploreprojectcollection",["jquery","underscore","backbone","collections/paginatedcollection","models/user","models/project"],function($,_,Backbone,PaginatedCollection,User,Project){var ExploreProjectCollection=PaginatedCollection.extend({model:Project,baseUrl:"/projects",groupOrUser:null,initialize:function(){_.bindAll(this,"onSuccess","onSuccessWithAddFix","getFetchOptions"),PaginatedCollection.prototype.initialize.apply(this,arguments),typeof options.groupOrUser!="undefined"||(this.groupOrUser=options.groupOrUser
)},comparator:function(streamItem1){return-parseInt(streamItem1.get("CreatedDateTimeOrder"))},fetchFirstPage:function(){this.firstPage(this.getFetchOptions(!0))},fetchNextPage:function(){this.nextPage(this.getFetchOptions(!0))},getFetchOptions:function(add){var options={data:{},add:add,success:null};return add?options.success=this.onSuccess:options.success=this.onSuccessWithAddFix,this.groupOrUser&&(this.groupOrUser instanceof Project?options.data.groupId=this.groupOrUser.id:this.groupOrUser instanceof User&&(options.data.userId=this.groupOrUser.id)),options},onSuccess:function(collection,response){},onSuccessWithAddFix:function(collection,response){this.onSuccess(collection,response);var self=this;response.each(function(item,index){self.trigger("add",item,self,{Index:index})})}});return ExploreProjectCollection}),define("models/chatmessage",["jquery","underscore","backbone","app"],function($,_,Backbone,app){var ChatMessage=Backbone.Model.extend({defaults:{},idAttribute:"Id"});return ChatMessage
}),define("collections/chatmessagecollection",["jquery","underscore","backbone","models/chatmessage"],function($,_,Backbone,ChatMessage){var ChatMessageCollection=Backbone.Collection.extend({model:ChatMessage,url:"/chatmessages",initialize:function(){_.extend(this,Backbone.Events)}});return ChatMessageCollection}),define("models/chat",["jquery","underscore","backbone","app","collections/usercollection","collections/chatmessagecollection","models/user","models/chatmessage"],function($,_,Backbone,app,UserCollection,ChatMessageCollection,User,ChatMessage){var Chat=Backbone.Model.extend({defaults:{},idAttribute:"Id",initialize:function(attributes,options){log("Chat.initialize"),this.chatUsers=options.chatUsers,this.chatMessages=options.chatMessages},addChatUser:function(user){this.chatUsers.add(user)},removeChatUser:function(userId){this.chatUsers.remove(userId)},addChatMessage:function(message){log("chat.addChatMessage",message),this.chatMessages.add(message)}});return Chat}),define("collections/chatcollection"
,["jquery","underscore","backbone","models/chat"],function($,_,Backbone,Chat){var ChatCollection=Backbone.Collection.extend({model:Chat,url:"/chats",initialize:function(){_.extend(this,Backbone.Events)}});return ChatCollection}),function(root,factory){if(typeof exports=="object"){var jquery=require("jquery"),underscore=require("underscore"),backbone=require("backbone");module.exports=factory(jquery,underscore,backbone)}else typeof define=="function"&&define.amd&&define("marionette",["jquery","underscore","backbone"],factory)}(this,function($,_,Backbone){return Backbone.Marionette=function(Backbone,_,$){var Marionette={};Marionette.version="0.7.2",Marionette.View=Backbone.View.extend({getTemplateSelector:function(){var template;return this.options&&this.options.template?template=this.options.template:template=this.template,_.isFunction(template)&&(template=template.call(this)),template},serializeData:function(){var data;return this.model?data=this.model.toJSON():this.collection&&(data={items
:this.collection.toJSON()}),data},close:function(){this.beforeClose&&this.beforeClose(),this.unbindAll(),this.remove(),this.onClose&&this.onClose(),this.trigger("close"),this.unbind()}}),Marionette.ItemView=Marionette.View.extend({constructor:function(){var args=slice.call(arguments);Marionette.View.prototype.constructor.apply(this,args),_.bindAll(this,"render"),this.initialEvents()},initialEvents:function(){this.collection&&this.bindTo(this.collection,"reset",this.render,this)},render:function(){var that=this,deferredRender=$.Deferred(),deferredData=this.serializeData();return this.beforeRender&&this.beforeRender(),this.trigger("item:before:render",that),$.when(deferredData).then(function(data){var asyncRender=that.renderHtml(data);$.when(asyncRender).then(function(html){that.$el.html(html);var onRenderPromise={};that.onRender&&(onRenderPromise=that.onRender()),$.when(onRenderPromise).then(function(){that.trigger("item:rendered",that),that.trigger("render",that),deferredRender.resolve(
)})})}),deferredRender.promise()},renderHtml:function(data){var template=this.getTemplateSelector();return Marionette.Renderer.render(template,data)},close:function(){this.trigger("item:before:close"),Marionette.View.prototype.close.apply(this,arguments),this.trigger("item:closed")}}),Marionette.CollectionView=Marionette.View.extend({constructor:function(){Marionette.View.prototype.constructor.apply(this,arguments),_.bindAll(this,"addItemView","render"),this.initialEvents()},initialEvents:function(){this.collection&&(this.bindTo(this.collection,"add",this.addChildView,this),this.bindTo(this.collection,"remove",this.removeItemView,this),this.bindTo(this.collection,"reset",this.render,this))},addChildView:function(item){var ItemView=this.getItemView();return this.addItemView(item,ItemView)},render:function(){var that=this,deferredRender=$.Deferred(),promises=[],ItemView=this.getItemView();return this.beforeRender&&this.beforeRender(),this.trigger("collection:before:render",this),this.closeChildren
(),this.collection&&this.collection.each(function(item){var promise=that.addItemView(item,ItemView);promises.push(promise)}),deferredRender.done(function(){this.onRender&&this.onRender(),this.trigger("collection:rendered",this)}),$.when.apply(this,promises).then(function(){deferredRender.resolveWith(that)}),deferredRender.promise()},getItemView:function(){var itemView=this.options.itemView||this.itemView;if(!itemView){var err=new Error("An `itemView` must be specified");throw err.name="NoItemViewError",err}return itemView},addItemView:function(item,ItemView){var that=this,view=this.buildItemView(item,ItemView);this.storeChild(view),this.trigger("item:added",view);var viewRendered=view.render();return $.when(viewRendered).then(function(){that.appendHtml(that,view)}),viewRendered},buildItemView:function(item,ItemView){var view=new ItemView({model:item});return view},removeItemView:function(item){var view=this.children[item.cid];view&&(view.close(),delete this.children[item.cid]),this.trigger
("item:removed",view)},appendHtml:function(collectionView,itemView){collectionView.$el.append(itemView.el)},storeChild:function(view){this.children||(this.children={}),this.children[view.model.cid]=view},close:function(){this.trigger("collection:before:close"),this.closeChildren(),Marionette.View.prototype.close.apply(this,arguments),this.trigger("collection:closed")},closeChildren:function(){this.children&&_.each(this.children,function(childView){childView.close()})}}),Marionette.CompositeView=Marionette.CollectionView.extend({constructor:function(options){Marionette.CollectionView.apply(this,arguments),this.itemView=this.getItemView()},getItemView:function(){return this.itemView||this.constructor},render:function(){var that=this,compositeRendered=$.Deferred(),modelIsRendered=this.renderModel();return $.when(modelIsRendered).then(function(html){that.$el.html(html),that.trigger("composite:model:rendered"),that.trigger("render");var collectionIsRendered=that.renderCollection();$.when(collectionIsRendered
).then(function(){compositeRendered.resolve()})}),compositeRendered.done(function(){that.trigger("composite:rendered")}),compositeRendered.promise()},renderCollection:function(){var collectionDeferred=Marionette.CollectionView.prototype.render.apply(this,arguments);return collectionDeferred.done(function(){this.trigger("composite:collection:rendered")}),collectionDeferred.promise()},renderModel:function(){var data={};data=this.serializeData();var template=this.getTemplateSelector();return Marionette.Renderer.render(template,data)}}),Marionette.Region=function(options){this.options=options||{},_.extend(this,options);if(!this.el){var err=new Error("An 'el' must be specified");throw err.name="NoElError",err}this.initialize&&this.initialize.apply(this,arguments)},_.extend(Marionette.Region.prototype,Backbone.Events,{show:function(view,appendMethod){this.ensureEl(),this.close(),this.open(view,appendMethod),this.currentView=view},ensureEl:function(){if(!this.$el||this.$el.length===0)this.$el=
this.getEl(this.el)},getEl:function(selector){return $(selector)},open:function(view,appendMethod){var that=this;appendMethod=appendMethod||"html",$.when(view.render()).then(function(){that.$el[appendMethod](view.el),view.onShow&&view.onShow(),that.onShow&&that.onShow(view),view.trigger("show"),that.trigger("view:show",view)})},close:function(){var view=this.currentView;if(!view)return;view.close&&view.close(),this.trigger("view:closed",view),delete this.currentView},attachView:function(view){this.currentView=view}}),Marionette.Layout=Marionette.ItemView.extend({constructor:function(){this.vent=new Backbone.Marionette.EventAggregator,Backbone.Marionette.ItemView.apply(this,arguments),this.regionManagers={}},render:function(){return this.initializeRegions(),Backbone.Marionette.ItemView.prototype.render.call(this,arguments)},close:function(){this.closeRegions(),Backbone.Marionette.ItemView.prototype.close.call(this,arguments)},initializeRegions:function(){var that=this;_.each(this.regions
,function(selector,name){var regionManager=new Backbone.Marionette.Region({el:selector,getEl:function(selector){return that.$(selector)}});that.regionManagers[name]=regionManager,that[name]=regionManager})},closeRegions:function(){var that=this;_.each(this.regionManagers,function(manager,name){manager.close(),delete that[name]}),this.regionManagers={}}}),Marionette.AppRouter=Backbone.Router.extend({constructor:function(options){Backbone.Router.prototype.constructor.call(this,options);if(this.appRoutes){var controller=this.controller;options&&options.controller&&(controller=options.controller),this.processAppRoutes(controller,this.appRoutes)}},processAppRoutes:function(controller,appRoutes){var method,methodName,route,routesLength,i,routes=[],router=this;for(route in appRoutes)appRoutes.hasOwnProperty(route)&&routes.unshift([route,appRoutes[route]]);routesLength=routes.length;for(i=0;i<routesLength;i++)route=routes[i][0],methodName=routes[i][1],method=_.bind(controller[methodName],controller
),router.route(route,methodName,method)}}),Marionette.Application=function(options){this.initCallbacks=new Marionette.Callbacks,this.vent=new Marionette.EventAggregator,_.extend(this,options)},_.extend(Marionette.Application.prototype,Backbone.Events,{addInitializer:function(initializer){this.initCallbacks.add(initializer)},start:function(options){this.trigger("initialize:before",options),this.initCallbacks.run(this,options),this.trigger("initialize:after",options),this.trigger("start",options)},addRegions:function(regions){var regionValue,regionObj,region;for(region in regions)regions.hasOwnProperty(region)&&(regionValue=regions[region],typeof regionValue=="string"?regionObj=new Marionette.Region({el:regionValue}):regionObj=new regionValue,this[region]=regionObj)}}),Marionette.BindTo={bindTo:function(obj,eventName,callback,context){context=context||this,obj.on(eventName,callback,context),this.bindings||(this.bindings=[]);var binding={obj:obj,eventName:eventName,callback:callback,context
:context};return this.bindings.push(binding),binding},unbindFrom:function(binding){binding.obj.off(binding.eventName,binding.callback);var index=_.indexOf(this.bindings,binding);Array.remove(this.bindings,index)},unbindAll:function(){var that=this;_.each(this.bindings,function(binding,index){that.unbindFrom(binding)}),this.bindings=[]}},Marionette.Callbacks=function(){this.deferred=$.Deferred(),this.promise=this.deferred.promise()},_.extend(Marionette.Callbacks.prototype,{add:function(callback){this.promise.done(function(context,options){callback.call(context,options)})},run:function(context,options){this.deferred.resolve(context,options)}}),Marionette.EventAggregator=function(options){_.extend(this,options)},_.extend(Marionette.EventAggregator.prototype,Backbone.Events,Marionette.BindTo,{bindTo:function(eventName,callback,context){Marionette.BindTo.bindTo.call(this,this,eventName,callback,context)}}),Marionette.TemplateCache={templates:{},loaders:{},get:function(templateId){var that=this
,templateRetrieval=$.Deferred(),cachedTemplate=this.templates[templateId];if(cachedTemplate)templateRetrieval.resolve(cachedTemplate);else{var loader=this.loaders[templateId];loader?templateRetrieval=loader:(this.loaders[templateId]=templateRetrieval,this.loadTemplate(templateId,function(template){delete that.loaders[templateId],that.templates[templateId]=template,templateRetrieval.resolve(template)}))}return templateRetrieval.promise()},loadTemplate:function(templateId,callback){var template=$(templateId).html();if(!template||template.length===0){var msg="Could not find template: '"+templateId+"'",err=new Error(msg);throw err.name="NoTemplateError",err}template=this.compileTemplate(template),callback.call(this,template)},compileTemplate:function(rawTemplate){return _.template(rawTemplate)},clear:function(){var i,length=arguments.length;if(length>0)for(i=0;i<length;i++)delete this.templates[arguments[i]];else this.templates={}}},Marionette.Renderer={render:function(template,data){var that=
this,asyncRender=$.Deferred(),templateRetrieval=Marionette.TemplateCache.get(template);return $.when(templateRetrieval).then(function(template){var html=that.renderTemplate(template,data);asyncRender.resolve(html)}),asyncRender.promise()},renderTemplate:function(template,data){var html=template(data);return html}};var slice=Array.prototype.slice,extend=Marionette.View.extend;return Marionette.Region.extend=extend,Marionette.Application.extend=extend,_.extend(Marionette.View.prototype,Marionette.BindTo),_.extend(Marionette.Application.prototype,Marionette.BindTo),_.extend(Marionette.Region.prototype,Marionette.BindTo),Array.remove||(Array.remove=function(array,from,to){var rest=array.slice((to||from)+1||array.length);return array.length=from<0?array.length+from:from,array.push.apply(array,rest)}),Marionette}(Backbone,_,window.jQuery||window.Zepto||window.ender),Backbone.Marionette}),define("json2",[],function(){var JSON;JSON||(JSON={}),function(){function f(n){return n<10?"0"+n:n}function quote
(string){return escapable.lastIndex=0,escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c=="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];value&&typeof value=="object"&&typeof value.toJSON=="function"&&(value=value.toJSON(key)),typeof rep=="function"&&(value=rep.call(holder,key,value));switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value)return"null";gap+=indent,partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1)partial[i]=str(i,value)||"null";return v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]",gap=mind,v}if(rep&&typeof rep=="object"){length=rep.length;for(i=0;i<length;i+=1)typeof rep[i
]=="string"&&(k=rep[i],v=str(k,value),v&&partial.push(quote(k)+(gap?": ":":")+v))}else for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=str(k,value),v&&partial.push(quote(k)+(gap?": ":":")+v));return v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}",gap=mind,v}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t"
,"\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(value,replacer,space){var i;gap="",indent="";if(typeof space=="number")for(i=0;i<space;i+=1)indent+=" ";else typeof space=="string"&&(indent=space);rep=replacer;if(!replacer||typeof replacer=="function"||typeof replacer=="object"&&typeof replacer.length=="number")return str("",{"":value});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value=="object")for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=walk(value,k),v!==undefined?value[k]=v:delete value[k]);return reviver.call(holder,key,value)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g
,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}()}),define("signalr",["jquery","json2"],function($){(function($,window){if(typeof $!="function")throw"SignalR: jQuery not found. Please ensure jQuery is referenced before the SignalR.js file.";if(!window.JSON)throw"SignalR: No JSON parser found. Please ensure json2.js is referenced before the SignalR.js file if you need to support clients without native JSON parsing support, e.g. IE<8.";var signalR,_connection,events={onStart:"onStart",onStarting:"onStarting",onSending:"onSending",onReceived:"onReceived",onError:"onError",onReconnect:"onReconnect",onDisconnect:"onDisconnect"},log=function(msg,logging){if(logging===!1)return;var m;if(typeof window.console=="undefined")return;m="["+(new Date).toTimeString()+"] SignalR: "+msg,window.console.debug?window.console.debug(m):window.console.log&&window.console.log(m)};signalR=function(url,qs,logging
){return new signalR.fn.init(url,qs,logging)},signalR.fn=signalR.prototype={init:function(url,qs,logging){this.url=url,this.qs=qs,typeof logging=="boolean"&&(this.logging=logging)},ajaxDataType:"json",logging:!1,reconnectDelay:2e3,start:function(options,callback){var connection=this,config={transport:"auto",xdomain:!1},initialize,deferred=$.Deferred();return connection.transport?(deferred.resolve(connection),deferred.promise()):($.type(options)==="function"?callback=options:$.type(options)==="object"&&($.extend(config,options),$.type(config.callback)==="function"&&(callback=config.callback)),connection.ajaxDataType=config.xdomain?"jsonp":"json",$(connection).bind(events.onStart,function(e,data){$.type(callback)==="function"&&callback.call(connection),deferred.resolve(connection)}),initialize=function(transports,index){index=index||0;if(index>=transports.length){connection.transport||deferred.reject("SignalR: No transport could be initialized successfully. Try specifying a different transport or none at all for auto initialization."
);return}var transportName=transports[index],transport=$.type(transportName)==="object"?transportName:signalR.transports[transportName];transport.start(connection,function(){connection.transport=transport,$(connection).trigger(events.onStart)},function(){initialize(transports,index+1)})},window.setTimeout(function(){var url=connection.url+"/negotiate";$.ajax({url:url,global:!1,cache:!1,type:"GET",data:{},dataType:connection.ajaxDataType,error:function(error){$(connection).trigger(events.onError,[error]),deferred.reject("SignalR: Error during negotiation request: "+error)},success:function(res){connection.appRelativeUrl=res.Url,connection.id=res.ConnectionId,connection.webSocketServerUrl=res.WebSocketServerUrl;if(!res.ProtocolVersion||res.ProtocolVersion!=="1.0"){$(connection).trigger(events.onError,"SignalR: Incompatible protocol version."),deferred.reject("SignalR: Incompatible protocol version.");return}$(connection).trigger(events.onStarting);var transports=[],supportedTransports=[];
$.each(signalR.transports,function(key){if(key==="webSockets"&&!res.TryWebSockets)return!0;supportedTransports.push(key)}),$.isArray(config.transport)?$.each(config.transport,function(){var transport=this;($.type(transport)==="object"||$.type(transport)==="string"&&$.inArray(""+transport,supportedTransports)>=0)&&transports.push($.type(transport)==="string"?""+transport:transport)}):$.type(config.transport)==="object"||$.inArray(config.transport,supportedTransports)>=0?transports.push(config.transport):transports=supportedTransports,initialize(transports)}})},0),deferred.promise())},starting:function(callback){var connection=this,$connection=$(connection);return $connection.bind(events.onStarting,function(e,data){callback.call(connection),$connection.unbind(events.onStarting)}),connection},send:function(data){var connection=this;if(!connection.transport)throw"SignalR: Connection must be started before data can be sent. Call .start() before .send()";return connection.transport.send(connection
,data),connection},sending:function(callback){var connection=this;return $(connection).bind(events.onSending,function(e,data){callback.call(connection)}),connection},received:function(callback){var connection=this;return $(connection).bind(events.onReceived,function(e,data){callback.call(connection,data)}),connection},error:function(callback){var connection=this;return $(connection).bind(events.onError,function(e,data){callback.call(connection,data)}),connection},disconnected:function(callback){var connection=this;return $(connection).bind(events.onDisconnect,function(e,data){callback.call(connection)}),connection},reconnected:function(callback){var connection=this;return $(connection).bind(events.onReconnect,function(e,data){callback.call(connection)}),connection},stop:function(){var connection=this;return connection.transport&&(connection.transport.stop(connection),connection.transport=null),delete connection.messageId,delete connection.groups,$(connection).trigger(events.onDisconnect
),connection},log:log},signalR.fn.init.prototype=signalR.fn;var transportLogic={addQs:function(url,connection){return connection.qs?typeof connection.qs=="object"?url+"&"+$.param(connection.qs):typeof connection.qs=="string"?url+"&"+connection.qs:url+"&"+window.escape(connection.qs.toString()):url},getUrl:function(connection,transport,reconnecting,appendReconnectUrl){var url=connection.url,qs="transport="+transport+"&connectionId="+window.escape(connection.id);return connection.data&&(qs+="&connectionData="+window.escape(connection.data)),reconnecting?(appendReconnectUrl&&(url+="/reconnect"),connection.messageId&&(qs+="&messageId="+connection.messageId),connection.groups&&(qs+="&groups="+window.escape(JSON.stringify(connection.groups)))):url+="/connect",url+="?"+qs,url=this.addQs(url,connection),url},ajaxSend:function(connection,data){var url=connection.url+"/send"+"?transport="+connection.transport.name+"&connectionId="+window.escape(connection.id);url=this.addQs(url,connection),$.ajax
({url:url,global:!1,type:"POST",dataType:connection.ajaxDataType,data:{data:data},success:function(result){result&&$(connection).trigger(events.onReceived,[result])},error:function(errData,textStatus){if(textStatus==="abort"||textStatus==="parsererror"&&connection.ajaxDataType==="jsonp")return;$(connection).trigger(events.onError,[errData])}})},processMessages:function(connection,data){var $connection=$(connection);if(data){if(data.Disconnect){log("Disconnect command received from server",connection.logging),connection.stop(),$connection.trigger(events.onDisconnect);return}data.Messages&&$.each(data.Messages,function(){try{$connection.trigger(events.onReceived,[this])}catch(e){log("Error raising received "+e,connection.logging),$(connection).trigger(events.onError,[e])}}),data.MessageId&&(connection.messageId=data.MessageId),data.TransportData&&(connection.groups=data.TransportData.Groups)}},foreverFrame:{count:0,connections:{}}};signalR.transports={webSockets:{name:"webSockets",send:function(
connection,data){connection.socket.send(data)},start:function(connection,onSuccess,onFailed){var url,opened=!1,protocol;window.MozWebSocket&&(window.WebSocket=window.MozWebSocket);if(!window.WebSocket){onFailed();return}connection.socket||(connection.webSocketServerUrl?url=connection.webSocketServerUrl:(protocol=document.location.protocol==="https:"?"wss://":"ws://",url=protocol+document.location.host+connection.appRelativeUrl),$(connection).trigger(events.onSending),connection.data?url+="?connectionData="+connection.data+"&transport=webSockets&connectionId="+connection.id:url+="?transport=webSockets&connectionId="+connection.id,connection.socket=new window.WebSocket(url),connection.socket.onopen=function(){opened=!0,onSuccess&&onSuccess()},connection.socket.onclose=function(event){opened?typeof event.wasClean!="undefined"&&event.wasClean===!1&&$(connection).trigger(events.onError):onFailed&&onFailed(),connection.socket=null},connection.socket.onmessage=function(event){var data=window.JSON
.parse(event.data),$connection;data&&($connection=$(connection),data.Messages?$.each(data.Messages,function(){try{$connection.trigger(events.onReceived,[this])}catch(e){log("Error raising received "+e,connection.logging)}}):$connection.trigger(events.onReceived,[data]))})},stop:function(connection){connection.socket!==null&&(connection.socket.close(),connection.socket=null)}},serverSentEvents:{name:"serverSentEvents",timeOut:3e3,start:function(connection,onSuccess,onFailed){var that=this,opened=!1,$connection=$(connection),reconnecting=!onSuccess,url,connectTimeOut;connection.eventSource&&connection.stop();if(!window.EventSource){onFailed&&onFailed();return}$connection.trigger(events.onSending),url=transportLogic.getUrl(connection,this.name,reconnecting);try{connection.eventSource=new window.EventSource(url)}catch(e){log("EventSource failed trying to connect with error "+e.Message,connection.logging),onFailed?onFailed():($connection.trigger(events.onError,[e]),reconnecting&&(log("EventSource reconnecting"
,connection.logging),that.reconnect(connection)));return}connectTimeOut=window.setTimeout(function(){opened===!1&&(log("EventSource timed out trying to connect",connection.logging),onFailed&&onFailed(),reconnecting?(log("EventSource reconnecting",connection.logging),that.reconnect(connection)):that.stop(connection))},that.timeOut),connection.eventSource.addEventListener("open",function(e){log("EventSource connected",connection.logging),connectTimeOut&&window.clearTimeout(connectTimeOut),opened===!1&&(opened=!0,onSuccess&&onSuccess(),reconnecting&&$connection.trigger(events.onReconnect))},!1),connection.eventSource.addEventListener("message",function(e){if(e.data==="initialized")return;transportLogic.processMessages(connection,window.JSON.parse(e.data))},!1),connection.eventSource.addEventListener("error",function(e){if(!opened){onFailed&&onFailed();return}log("EventSource readyState: "+connection.eventSource.readyState,connection.logging),e.eventPhase===window.EventSource.CLOSED?connection
.eventSource.readyState===window.EventSource.CONNECTING?(log("EventSource reconnecting due to the server connection ending",connection.logging),that.reconnect(connection)):(log("EventSource closed",connection.logging),that.stop(connection)):(log("EventSource error",connection.logging),$connection.trigger(events.onError))},!1)},reconnect:function(connection){var that=this;window.setTimeout(function(){that.stop(connection),that.start(connection)},connection.reconnectDelay)},send:function(connection,data){transportLogic.ajaxSend(connection,data)},stop:function(connection){connection&&connection.eventSource&&(connection.eventSource.close(),connection.eventSource=null,delete connection.eventSource)}},foreverFrame:{name:"foreverFrame",timeOut:3e3,start:function(connection,onSuccess,onFailed){var that=this,frameId=transportLogic.foreverFrame.count+=1,url,connectTimeOut,frame=$("<iframe data-signalr-connection-id='"+connection.id+"' style='position:absolute;top:0;left:0;width:0;height:0;visibility:hidden;'></iframe>"
);if(window.EventSource){onFailed&&onFailed();return}$(connection).trigger(events.onSending),url=transportLogic.getUrl(connection,this.name),url+="&frameId="+frameId,frame.prop("src",url),transportLogic.foreverFrame.connections[frameId]=connection,frame.bind("readystatechange",function(){$.inArray(this.readyState,["loaded","complete"])>=0&&(log("Forever frame iframe readyState changed to "+this.readyState+", reconnecting",connection.logging),that.reconnect(connection))}),connection.frame=frame[0],connection.frameId=frameId,onSuccess&&(connection.onSuccess=onSuccess),$("body").append(frame),connectTimeOut=window.setTimeout(function(){connection.onSuccess&&(that.stop(connection),onFailed&&onFailed())},that.timeOut)},reconnect:function(connection){var that=this;window.setTimeout(function(){var frame=connection.frame,src=transportLogic.getUrl(connection,that.name,!0)+"&frameId="+connection.frameId;frame.src=src},connection.reconnectDelay)},send:function(connection,data){transportLogic.ajaxSend
(connection,data)},receive:transportLogic.processMessages,stop:function(connection){connection.frame&&(connection.frame.stop?connection.frame.stop():connection.frame.document&&connection.frame.document.execCommand&&connection.frame.document.execCommand("Stop"),$(connection.frame).remove(),delete transportLogic.foreverFrame.connections[connection.frameId],connection.frame=null,connection.frameId=null,delete connection.frame,delete connection.frameId)},getConnection:function(id){return transportLogic.foreverFrame.connections[id]},started:function(connection){connection.onSuccess?(connection.onSuccess(),connection.onSuccess=null,delete connection.onSuccess):$(connection).trigger(events.onReconnect)}},longPolling:{name:"longPolling",reconnectDelay:3e3,start:function(connection,onSuccess,onFailed){var that=this;connection.pollXhr&&connection.stop(),connection.messageId=null,window.setTimeout(function(){(function e(instance,raiseReconnect){$(instance).trigger(events.onSending);var messageId=instance
.messageId,connect=messageId===null,url=transportLogic.getUrl(instance,that.name,!connect,raiseReconnect),reconnectTimeOut=null,reconnectFired=!1;instance.pollXhr=$.ajax({url:url,global:!1,type:"GET",dataType:connection.ajaxDataType,success:function(data){var delay=0,timedOutReceived=!1;raiseReconnect===!0&&reconnectFired===!1&&($(instance).trigger(events.onReconnect),reconnectFired=!0),transportLogic.processMessages(instance,data),data&&data.TransportData&&$.type(data.TransportData.LongPollDelay)==="number"&&(delay=data.TransportData.LongPollDelay),data&&data.TimedOut&&(timedOutReceived=data.TimedOut),delay>0?window.setTimeout(function(){poll(instance,timedOutReceived)},delay):poll(instance,timedOutReceived)},error:function(data,textStatus){if(textStatus==="abort")return;reconnectTimeOut&&clearTimeout(reconnectTimeOut),$(instance).trigger(events.onError,[data]),window.setTimeout(function(){poll(instance,!0)},connection.reconnectDelay)}}),raiseReconnect===!0&&(reconnectTimeOut=window.setTimeout
(function(){reconnectFired===!1&&($(instance).trigger(events.onReconnect),reconnectFired=!0)},that.reconnectDelay))})(connection),window.setTimeout(onSuccess,150)},250)},send:function(connection,data){transportLogic.ajaxSend(connection,data)},stop:function(connection){connection.pollXhr&&(connection.pollXhr.abort(),connection.pollXhr=null,delete connection.pollXhr)}}},signalR.noConflict=function(){return $.connection===signalR&&($.connection=_connection),signalR},$.connection&&(_connection=$.connection),$.connection=$.signalR=signalR})(window.jQuery,window)}),define("app",["jquery","underscore","backbone","ich","bootstrap-data","models/user","collections/usercollection","collections/projectcollection","collections/teamcollection","collections/organisationcollection","collections/activitycollection","collections/exploreprojectcollection","collections/chatcollection","marionette","signalr"],function($,_,Backbone,ich,bootstrapData,User,UserCollection,ProjectCollection,TeamCollection,OrganisationCollection
,ActivityCollection,ExploreProjectCollection,ChatCollection){var app=new Backbone.Marionette.Application;window.Bowerbird=window.Bowerbird||{version:"1.0.0",app:app};var AuthenticatedUser=function(data){this.user=new User(data.User),this.memberships=data.Memberships,this.projects=new ProjectCollection(data.Projects),this.teams=new TeamCollection(data.Teams),this.organisations=new OrganisationCollection(data.Organisations),this.appRoot=data.Application,this.hasGroupPermission=function(groupId,permissionId){var membership=_.find(this.memberships,function(m){return m.GroupId===groupId});return membership?_.any(membership.PermissionIds,function(p){return p===permissionId}):!1},app.vent.on("newactivity:groupadded",function(activity){var group=activity.get("GroupAdded").Group;group.GroupType==="project"&&app.authenticatedUser.projects.add(group)},this)};return app.addRegions({header:"header",footer:"footer",sidebar:"#sidebar",content:"#content",notifications:"#notifications",usersonline:"#onlineusers"
,chatarea:"#chatarea"}),app.chatRegions=[],app.showChat=function(chatView){var chatRegion=new Backbone.Marionette.Region},app.isPrerendering=function(name){return name===app.prerenderedView.name&&!app.prerenderedView.isBound},app.setPrerenderComplete=function(){app.prerenderedView.isBound=!0},app.getShowViewMethodName=function(name){if(!name){var err=new Error("A name must be provided!");throw err.name="BowerbirdNoViewNameProvidedError",err}return app.isPrerendering(name)?"attachView":"show"},app.routeHistory=[],app.previousContent=null,app.showFormContentView=function(view,name){app.content.currentView&&(app.previousContent={view:app.content.currentView,$el:app.content.currentView.$el.detach()},app.content.currentView=null),app.content[app.getShowViewMethodName(name)](view)},app.showPreviousContentView=function(){app.previousContent?(app.content.close(),app.content.$el.append(app.previousContent.$el),app.content.currentView=app.previousContent.view,app.routeHistory.shift(),app.homeRouter
.navigate(_.first(app.routeHistory)),app.previousContent=null):app.homeRouter.navigate("",{trigger:!0})},app.bind("initialize:before",function(){Backbone.Marionette.Renderer.render=function(template,data){if(template)return ich[template](data)},bootstrapData.AuthenticatedUser&&(app.authenticatedUser=new AuthenticatedUser(bootstrapData.AuthenticatedUser),app.onlineUsers=new UserCollection,app.chats=new ChatCollection,app.activities=new ActivityCollection,app.activities.on("add",function(activity){this.vent.trigger("newactivity",activity),this.vent.trigger("newactivity:"+activity.get("Type"),activity),_.each(activity.get("Groups"),function(group){this.vent.trigger("newactivity:"+group.Id)},app)},this)),app.prerenderedView={name:bootstrapData.PrerenderedView,isBound:!1,data:bootstrapData.Model}}),app.bind("initialize:after",function(){$(function(){Backbone.history&&(Backbone.history.on("route",function(route,name){app.routeHistory.unshift(Backbone.history.fragment)}),Backbone.history.start
({pushState:!0})),$.connection.hub.start({transport:"longPolling"},function(){app.clientId=$.signalR.hub.id,log("browser connected via signalr as "+app.clientId);if(app.authenticatedUser){var memberships=[];_.each(app.authenticatedUser.memberships,function(membership){(membership.GroupType==="project"||membership.GroupType==="team"||membership.GroupType==="organisation")&&memberships.push(membership)},memberships),$.connection.activityHub.registerUserClient(app.authenticatedUser.user.id).done(function(){log("Added user to hub")}).fail(function(e){log("could not register client with hub",e)})}}),$("body").click(function(){$(".sub-menu-button").removeClass("active")})})}),app}),define("log",[],function(){var logger=function(){log.history=log.history||[],log.history.push(arguments),this.console&&console.log(Array.prototype.slice.call(arguments))};return window.log=logger,logger}),define("controllers/activitycontroller",["jquery","underscore","backbone","app","models/activity"],function($,_
,Backbone,app,Activity){var ActivityRouter=function(options){this.hub=$.connection.activityHub,this.controller=options.controller,this.hub.newActivity=this.controller.newActivity,this.hub.userStatusUpdate=this.controller.userStatusUpdate,this.hub.setupOnlineUsers=this.controller.setupOnlineUsers,this.hub.debugToLog=this.controller.debugToLog},ActivityController={};return ActivityController.debugToLog=function(message){log(message)},ActivityController.newActivity=function(data){log("activityController.newActivity",this,data),app.activities.add(data)},ActivityController.userStatusUpdate=function(data){log("activityController.userStatusUpdate",this,data),app.onlineUsers.add(data),app.onlineUsers.get(data.Id).set("Status",data.Status)},ActivityController.setupOnlineUsers=function(data){log("activityController.setupOnlineUsers",this,data),app.onlineUsers.add(data)},app.addInitializer(function(){this.activityRouter=new ActivityRouter({controller:ActivityController})}),ActivityController}),define
("timeago",["jquery"],function($){(function($){function refresh(){var data=prepareData(this);return isNaN(data.datetime)||$(this).text(inWords(data.datetime)),this}function prepareData(element){element=$(element);if(!element.data("timeago")){element.data("timeago",{datetime:$t.datetime(element)});var text=$.trim(element.text());text.length>0&&(!$t.isTime(element)||!element.attr("title"))&&element.attr("title",text)}return element.data("timeago")}function inWords(date){return $t.inWords(distance(date))}function distance(date){return(new Date).getTime()-date.getTime()}$.timeago=function(timestamp){return timestamp instanceof Date?inWords(timestamp):typeof timestamp=="string"?inWords($.timeago.parse(timestamp)):typeof timestamp=="number"?inWords(new Date(timestamp)):inWords($.timeago.datetime(timestamp))};var $t=$.timeago;$.extend($.timeago,{settings:{refreshMillis:6e4,allowFuture:!1,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute"
,minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(distanceMillis){function substitute(stringOrFunction,number){var string=$.isFunction(stringOrFunction)?stringOrFunction(number,distanceMillis):stringOrFunction,value=$l.numbers&&$l.numbers[number]||number;return string.replace(/%d/i,value)}var $l=this.settings.strings,prefix=$l.prefixAgo,suffix=$l.suffixAgo;this.settings.allowFuture&&distanceMillis<0&&(prefix=$l.prefixFromNow,suffix=$l.suffixFromNow);var seconds=Math.abs(distanceMillis)/1e3,minutes=seconds/60,hours=minutes/60,days=hours/24,years=days/365,words=seconds<45&&substitute($l.seconds,Math.round(seconds))||seconds<90&&substitute($l.minute,1)||minutes<45&&substitute($l.minutes,Math.round(minutes))||minutes<90&&substitute($l.hour,1)||hours<24&&substitute($l.hours,Math.round(hours))||hours<42&&
substitute($l.day,1)||days<30&&substitute($l.days,Math.round(days))||days<45&&substitute($l.month,1)||days<365&&substitute($l.months,Math.round(days/30))||years<1.5&&substitute($l.year,1)||substitute($l.years,Math.round(years)),separator=$l.wordSeparator===undefined?" ":$l.wordSeparator;return $.trim([prefix,words,suffix].join(separator))},parse:function(iso8601){var s=$.trim(iso8601);return s=s.replace(/\.\d\d\d+/,""),s=s.replace(/-/,"/").replace(/-/,"/"),s=s.replace(/T/," ").replace(/Z/," UTC"),s=s.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),new Date(s)},datetime:function(elem){var iso8601=$t.isTime(elem)?$(elem).attr("datetime"):$(elem).attr("title");return $t.parse(iso8601)},isTime:function(elem){return $(elem).get(0).tagName.toLowerCase()==="time"}}),$.fn.timeago=function(){var self=this;self.each(refresh);var $s=$t.settings;return $s.refreshMillis>0&&setInterval(function(){self.each(refresh)},$s.refreshMillis),self},document.createElement("abbr"),document.createElement("time")})(jQuery
)}),define("views/streamitemview",["jquery","underscore","backbone","app","timeago"],function($,_,Backbone,app){var parseISO8601=function(str){var parts=str.split("T"),dateParts=parts[0].split("-"),timeParts=parts[1].split("Z"),timeSubParts=timeParts[0].split(":"),timeSecParts=timeSubParts[2].split("."),timeHours=Number(timeSubParts[0]),_date=new Date;return _date.setUTCFullYear(Number(dateParts[0])),_date.setUTCMonth(Number(dateParts[1])-1),_date.setUTCDate(Number(dateParts[2])),_date.setUTCHours(Number(timeHours)),_date.setUTCMinutes(Number(timeSubParts[1])),_date.setUTCSeconds(Number(timeSecParts[0])),timeSecParts[1]&&_date.setUTCMilliseconds(Number(timeSecParts[1])),_date},StreamItemView=Backbone.Marionette.ItemView.extend({tagName:"li",className:"stream-item observation-stream-item",template:"StreamItem",serializeData:function(){var model=this.model.toJSON();return model.CreatedDateTimeDescription=parseISO8601(this.model.get("CreatedDateTime")+"Z"),model.ObservedOnDescription="",{Model
:model}},onRender:function(){this.$el.find(".time-description").timeago()}});return StreamItemView}),define("date",[],function(){Date.CultureInfo={name:"en-AU",englishName:"English (Australia)",nativeName:"English (Australia)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:1,twoDigitYearMax:2029,dateElementOrder:"dmy",formatPatterns:{shortDate:"d/MM/yyyy",longDate:"dddd, d MMMM yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, d MMMM yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime
:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"dd MMMM",yearMonth:"MMMM yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|aft(er)?|from|hence)/i,subtract:/^(\-|bef(ore)?|ago)/i,yesterday:/^yes(terday)?/i,today:/^t(od(ay)?)?/i,tomorrow:/^tom(orrow)?/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^mn|min(ute)?s?/i,hour:/^h(our)?s?/i,week:/^w(eek)?s?/i,month:/^m(onth)?s?/i,day:/^d(ay)?s?/i,year:/^y(ear)?s?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt|utc)/i
,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a(?!u|p)|p)/i},timezones:[{name:"UTC",offset:"-000"},{name:"GMT",offset:"-000"},{name:"EST",offset:"-0500"},{name:"EDT",offset:"-0400"},{name:"CST",offset:"-0600"},{name:"CDT",offset:"-0500"},{name:"MST",offset:"-0700"},{name:"MDT",offset:"-0600"},{name:"PST",offset:"-0800"},{name:"PDT",offset:"-0700"}]},function(){var $D=Date,$P=$D.prototype,$C=$D.CultureInfo,p=function(s,l){return l||(l=2),("000"+s).slice(l*-1)};$P.clearTime=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this},$P.setTimeToNow=function(){var n=new Date;return this.setHours(n.getHours()),this.setMinutes(n.getMinutes()),this.setSeconds(n.getSeconds()),this.setMilliseconds(n.getMilliseconds()),this},$D.today=function(){return(new Date).clearTime()},$D.compare=function(date1,date2){if(isNaN(date1)||isNaN(date2))throw new Error(date1+" - "+date2);if(date1 instanceof Date&&date2 instanceof Date)return date1<date2?-1:date1>
date2?1:0;throw new TypeError(date1+" - "+date2)},$D.equals=function(date1,date2){return date1.compareTo(date2)===0},$D.getDayNumberFromName=function(name){var n=$C.dayNames,m=$C.abbreviatedDayNames,o=$C.shortestDayNames,s=name.toLowerCase();for(var i=0;i<n.length;i++)if(n[i].toLowerCase()==s||m[i].toLowerCase()==s||o[i].toLowerCase()==s)return i;return-1},$D.getMonthNumberFromName=function(name){var n=$C.monthNames,m=$C.abbreviatedMonthNames,s=name.toLowerCase();for(var i=0;i<n.length;i++)if(n[i].toLowerCase()==s||m[i].toLowerCase()==s)return i;return-1},$D.isLeapYear=function(year){return year%4===0&&year%100!==0||year%400===0},$D.getDaysInMonth=function(year,month){return[31,$D.isLeapYear(year)?29:28,31,30,31,30,31,31,30,31,30,31][month]},$D.getTimezoneAbbreviation=function(offset){var z=$C.timezones,p;for(var i=0;i<z.length;i++)if(z[i].offset===offset)return z[i].name;return null},$D.getTimezoneOffset=function(name){var z=$C.timezones,p;for(var i=0;i<z.length;i++)if(z[i].name===name
.toUpperCase())return z[i].offset;return null},$P.clone=function(){return new Date(this.getTime())},$P.compareTo=function(date){return Date.compare(this,date)},$P.equals=function(date){return Date.equals(this,date||new Date)},$P.between=function(start,end){return this.getTime()>=start.getTime()&&this.getTime()<=end.getTime()},$P.isAfter=function(date){return this.compareTo(date||new Date)===1},$P.isBefore=function(date){return this.compareTo(date||new Date)===-1},$P.isToday=$P.isSameDay=function(date){return this.clone().clearTime().equals((date||new Date).clone().clearTime())},$P.addMilliseconds=function(value){return this.setMilliseconds(this.getMilliseconds()+value*1),this},$P.addSeconds=function(value){return this.addMilliseconds(value*1e3)},$P.addMinutes=function(value){return this.addMilliseconds(value*6e4)},$P.addHours=function(value){return this.addMilliseconds(value*36e5)},$P.addDays=function(value){return this.setDate(this.getDate()+value*1),this},$P.addWeeks=function(value){return this
.addDays(value*7)},$P.addMonths=function(value){var n=this.getDate();return this.setDate(1),this.setMonth(this.getMonth()+value*1),this.setDate(Math.min(n,$D.getDaysInMonth(this.getFullYear(),this.getMonth()))),this},$P.addYears=function(value){return this.addMonths(value*12)},$P.add=function(config){if(typeof config=="number")return this._orient=config,this;var x=config;return x.milliseconds&&this.addMilliseconds(x.milliseconds),x.seconds&&this.addSeconds(x.seconds),x.minutes&&this.addMinutes(x.minutes),x.hours&&this.addHours(x.hours),x.weeks&&this.addWeeks(x.weeks),x.months&&this.addMonths(x.months),x.years&&this.addYears(x.years),x.days&&this.addDays(x.days),this};var $y,$m,$d;$P.getWeek=function(){var a,b,c,d,e,f,g,n,s,w;return $y=$y?$y:this.getFullYear(),$m=$m?$m:this.getMonth()+1,$d=$d?$d:this.getDate(),$m<=2?(a=$y-1,b=(a/4|0)-(a/100|0)+(a/400|0),c=((a-1)/4|0)-((a-1)/100|0)+((a-1)/400|0),s=b-c,e=0,f=$d-1+31*($m-1)):(a=$y,b=(a/4|0)-(a/100|0)+(a/400|0),c=((a-1)/4|0)-((a-1)/100|0)+((
a-1)/400|0),s=b-c,e=s+1,f=$d+(153*($m-3)+2)/5+58+s),g=(a+b)%7,d=(f+g-e)%7,n=f+3-d|0,n<0?w=53-((g-s)/5|0):n>364+s?w=1:w=(n/7|0)+1,$y=$m=$d=null,w},$P.getISOWeek=function(){return $y=this.getUTCFullYear(),$m=this.getUTCMonth()+1,$d=this.getUTCDate(),p(this.getWeek())},$P.setWeek=function(n){return this.moveToDayOfWeek(1).addWeeks(n-this.getWeek())};var validate=function(n,min,max,name){if(typeof n=="undefined")return!1;if(typeof n!="number")throw new TypeError(n+" is not a Number.");if(n<min||n>max)throw new RangeError(n+" is not a valid value for "+name+".");return!0};$D.validateMillisecond=function(value){return validate(value,0,999,"millisecond")},$D.validateSecond=function(value){return validate(value,0,59,"second")},$D.validateMinute=function(value){return validate(value,0,59,"minute")},$D.validateHour=function(value){return validate(value,0,23,"hour")},$D.validateDay=function(value,year,month){return validate(value,1,$D.getDaysInMonth(year,month),"day")},$D.validateMonth=function(value
){return validate(value,0,11,"month")},$D.validateYear=function(value){return validate(value,0,9999,"year")},$P.set=function(config){return $D.validateMillisecond(config.millisecond)&&this.addMilliseconds(config.millisecond-this.getMilliseconds()),$D.validateSecond(config.second)&&this.addSeconds(config.second-this.getSeconds()),$D.validateMinute(config.minute)&&this.addMinutes(config.minute-this.getMinutes()),$D.validateHour(config.hour)&&this.addHours(config.hour-this.getHours()),$D.validateMonth(config.month)&&this.addMonths(config.month-this.getMonth()),$D.validateYear(config.year)&&this.addYears(config.year-this.getFullYear()),$D.validateDay(config.day,this.getFullYear(),this.getMonth())&&this.addDays(config.day-this.getDate()),config.timezone&&this.setTimezone(config.timezone),config.timezoneOffset&&this.setTimezoneOffset(config.timezoneOffset),config.week&&validate(config.week,0,53,"week")&&this.setWeek(config.week),this},$P.moveToFirstDayOfMonth=function(){return this.set({day:1
})},$P.moveToLastDayOfMonth=function(){return this.set({day:$D.getDaysInMonth(this.getFullYear(),this.getMonth())})},$P.moveToNthOccurrence=function(dayOfWeek,occurrence){var shift=0;if(occurrence>0)shift=occurrence-1;else if(occurrence===-1)return this.moveToLastDayOfMonth(),this.getDay()!==dayOfWeek&&this.moveToDayOfWeek(dayOfWeek,-1),this;return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(dayOfWeek,1).addWeeks(shift)},$P.moveToDayOfWeek=function(dayOfWeek,orient){var diff=(dayOfWeek-this.getDay()+7*(orient||1))%7;return this.addDays(diff===0?diff+=7*(orient||1):diff)},$P.moveToMonth=function(month,orient){var diff=(month-this.getMonth()+12*(orient||1))%12;return this.addMonths(diff===0?diff+=12*(orient||1):diff)},$P.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/864e5)+1},$P.getTimezone=function(){return $D.getTimezoneAbbreviation(this.getUTCOffset())},$P.setTimezoneOffset=function(offset){var here=this.getTimezoneOffset
(),there=Number(offset)*-6/10;return this.addMinutes(there-here)},$P.setTimezone=function(offset){return this.setTimezoneOffset($D.getTimezoneOffset(offset))},$P.hasDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset()},$P.isDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!=this.getTimezoneOffset()},$P.getUTCOffset=function(){var n=this.getTimezoneOffset()*-10/6,r;return n<0?(r=(n-1e4).toString(),r.charAt(0)+r.substr(2)):(r=(n+1e4).toString(),"+"+r.substr(1))},$P.getElapsed=function(date){return(date||new Date)-this},$P.toISOString||($P.toISOString=function(){function f(n){return n<10?"0"+n:n}return'"'+this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+'Z"'}),$P._toString=$P.toString,$P.toString=function(format){var x=this;if(format&&format.length==1
){var c=$C.formatPatterns;x.t=x.toString;switch(format){case"d":return x.t(c.shortDate);case"D":return x.t(c.longDate);case"F":return x.t(c.fullDateTime);case"m":return x.t(c.monthDay);case"r":return x.t(c.rfc1123);case"s":return x.t(c.sortableDateTime);case"t":return x.t(c.shortTime);case"T":return x.t(c.longTime);case"u":return x.t(c.universalSortableDateTime);case"y":return x.t(c.yearMonth)}}var ord=function(n){switch(n*1){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}};return format?format.replace(/(\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S)/g,function(m){if(m.charAt(0)==="\\")return m.replace("\\","");x.h=x.getHours;switch(m){case"hh":return p(x.h()<13?x.h()===0?12:x.h():x.h()-12);case"h":return x.h()<13?x.h()===0?12:x.h():x.h()-12;case"HH":return p(x.h());case"H":return x.h();case"mm":return p(x.getMinutes());case"m":return x.getMinutes();case"ss":return p(x.getSeconds());case"s":return x.getSeconds();case"yyyy":return p
(x.getFullYear(),4);case"yy":return p(x.getFullYear());case"dddd":return $C.dayNames[x.getDay()];case"ddd":return $C.abbreviatedDayNames[x.getDay()];case"dd":return p(x.getDate());case"d":return x.getDate();case"MMMM":return $C.monthNames[x.getMonth()];case"MMM":return $C.abbreviatedMonthNames[x.getMonth()];case"MM":return p(x.getMonth()+1);case"M":return x.getMonth()+1;case"t":return x.h()<12?$C.amDesignator.substring(0,1):$C.pmDesignator.substring(0,1);case"tt":return x.h()<12?$C.amDesignator:$C.pmDesignator;case"S":return ord(x.getDate());default:return m}}):this._toString()}}(),function(){Date.Parsing={Exception:function(s){this.message="Parse error at '"+s.substring(0,10)+" ...'"}};var $P=Date.Parsing,_=$P.Operators={rtoken:function(r){return function(s){var mx=s.match(r);if(mx)return[mx[0],s.substring(mx[0].length)];throw new $P.Exception(s)}},token:function(s){return function(s){return _.rtoken(new RegExp("^s*"+s+"s*"))(s)}},stoken:function(s){return _.rtoken(new RegExp("^"+s))},
until:function(p){return function(s){var qx=[],rx=null;while(s.length){try{rx=p.call(this,s)}catch(e){qx.push(rx[0]),s=rx[1];continue}break}return[qx,s]}},many:function(p){return function(s){var rx=[],r=null;while(s.length){try{r=p.call(this,s)}catch(e){return[rx,s]}rx.push(r[0]),s=r[1]}return[rx,s]}},optional:function(p){return function(s){var r=null;try{r=p.call(this,s)}catch(e){return[null,s]}return[r[0],r[1]]}},not:function(p){return function(s){try{p.call(this,s)}catch(e){return[null,s]}throw new $P.Exception(s)}},ignore:function(p){return p?function(s){var r=null;return r=p.call(this,s),[null,r[1]]}:null},product:function(){var px=arguments[0],qx=Array.prototype.slice.call(arguments,1),rx=[];for(var i=0;i<px.length;i++)rx.push(_.each(px[i],qx));return rx},cache:function(rule){var cache={},r=null;return function(s){try{r=cache[s]=cache[s]||rule.call(this,s)}catch(e){r=cache[s]=e}if(r instanceof $P.Exception)throw r;return r}},any:function(){var px=arguments;return function(s){var r=
null;for(var i=0;i<px.length;i++){if(px[i]==null)continue;try{r=px[i].call(this,s)}catch(e){r=null}if(r)return r}throw new $P.Exception(s)}},each:function(){var px=arguments;return function(s){var rx=[],r=null;for(var i=0;i<px.length;i++){if(px[i]==null)continue;try{r=px[i].call(this,s)}catch(e){throw new $P.Exception(s)}rx.push(r[0]),s=r[1]}return[rx,s]}},all:function(){var px=arguments,_=_;return _.each(_.optional(px))},sequence:function(px,d,c){return d=d||_.rtoken(/^\s*/),c=c||null,px.length==1?px[0]:function(s){var r=null,q=null,rx=[];for(var i=0;i<px.length;i++){try{r=px[i].call(this,s)}catch(e){break}rx.push(r[0]);try{q=d.call(this,r[1])}catch(ex){q=null;break}s=q[1]}if(!r)throw new $P.Exception(s);if(q)throw new $P.Exception(q[1]);if(c)try{r=c.call(this,r[1])}catch(ey){throw new $P.Exception(r[1])}return[rx,r?r[1]:s]}},between:function(d1,p,d2){d2=d2||d1;var _fn=_.each(_.ignore(d1),p,_.ignore(d2));return function(s){var rx=_fn.call(this,s);return[[rx[0][0],r[0][2]],rx[1]]}},list
:function(p,d,c){return d=d||_.rtoken(/^\s*/),c=c||null,p instanceof Array?_.each(_.product(p.slice(0,-1),_.ignore(d)),p.slice(-1),_.ignore(c)):_.each(_.many(_.each(p,_.ignore(d))),px,_.ignore(c))},set:function(px,d,c){return d=d||_.rtoken(/^\s*/),c=c||null,function(s){var r=null,p=null,q=null,rx=null,best=[[],s],last=!1;for(var i=0;i<px.length;i++){q=null,p=null,r=null,last=px.length==1;try{r=px[i].call(this,s)}catch(e){continue}rx=[[r[0]],r[1]];if(r[1].length>0&&!last)try{q=d.call(this,r[1])}catch(ex){last=!0}else last=!0;!last&&q[1].length===0&&(last=!0);if(!last){var qx=[];for(var j=0;j<px.length;j++)i!=j&&qx.push(px[j]);p=_.set(qx,d).call(this,q[1]),p[0].length>0&&(rx[0]=rx[0].concat(p[0]),rx[1]=p[1])}rx[1].length<best[1].length&&(best=rx);if(best[1].length===0)break}if(best[0].length===0)return best;if(c){try{q=c.call(this,best[1])}catch(ey){throw new $P.Exception(best[1])}best[1]=q[1]}return best}},forward:function(gr,fname){return function(s){return gr[fname].call(this,s)}},replace
:function(rule,repl){return function(s){var r=rule.call(this,s);return[repl,r[1]]}},process:function(rule,fn){return function(s){var r=rule.call(this,s);return[fn.call(this,r[0]),r[1]]}},min:function(min,rule){return function(s){var rx=rule.call(this,s);if(rx[0].length<min)throw new $P.Exception(s);return rx}}},_generator=function(op){return function(){var args=null,rx=[];arguments.length>1?args=Array.prototype.slice.call(arguments):arguments[0]instanceof Array&&(args=arguments[0]);if(!args)return op.apply(null,arguments);for(var i=0,px=args.shift();i<px.length;i++)return args.unshift(px[i]),rx.push(op.apply(null,args)),args.shift(),rx}},gx="optional not ignore cache".split(/\s/);for(var i=0;i<gx.length;i++)_[gx[i]]=_generator(_[gx[i]]);var _vector=function(op){return function(){return arguments[0]instanceof Array?op.apply(null,arguments[0]):op.apply(null,arguments)}},vx="each any all".split(/\s/);for(var j=0;j<vx.length;j++)_[vx[j]]=_vector(_[vx[j]])}(),function(){var $D=Date,$P=$D.prototype
,$C=$D.CultureInfo,flattenAndCompact=function(ax){var rx=[];for(var i=0;i<ax.length;i++)ax[i]instanceof Array?rx=rx.concat(flattenAndCompact(ax[i])):ax[i]&&rx.push(ax[i]);return rx};$D.Grammar={},$D.Translator={hour:function(s){return function(){this.hour=Number(s)}},minute:function(s){return function(){this.minute=Number(s)}},second:function(s){return function(){this.second=Number(s)}},meridian:function(s){return function(){this.meridian=s.slice(0,1).toLowerCase()}},timezone:function(s){return function(){var n=s.replace(/[^\d\+\-]/g,"");n.length?this.timezoneOffset=Number(n):this.timezone=s.toLowerCase()}},day:function(x){var s=x[0];return function(){this.day=Number(s.match(/\d+/)[0])}},month:function(s){return function(){this.month=s.length==3?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(s)/4:Number(s)-1}},year:function(s){return function(){var n=Number(s);this.year=s.length>2?n:n+(n+2e3<$C.twoDigitYearMax?2e3:1900)}},rday:function(s){return function(){switch(s){case"yesterday"
:this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0,this.now=!0}}},finishExact:function(x){x=x instanceof Array?x:[x];for(var i=0;i<x.length;i++)x[i]&&x[i].call(this);var now=new Date;(this.hour||this.minute)&&!this.month&&!this.year&&!this.day&&(this.day=now.getDate()),this.year||(this.year=now.getFullYear()),!this.month&&this.month!==0&&(this.month=now.getMonth()),this.day||(this.day=1),this.hour||(this.hour=0),this.minute||(this.minute=0),this.second||(this.second=0),this.meridian&&this.hour&&(this.meridian=="p"&&this.hour<12?this.hour=this.hour+12:this.meridian=="a"&&this.hour==12&&(this.hour=0));if(this.day>$D.getDaysInMonth(this.year,this.month))throw new RangeError(this.day+" is not a valid value for days.");var r=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);return this.timezone?r.set({timezone:this.timezone}):this.timezoneOffset&&r.set({timezoneOffset:this.timezoneOffset}),r},finish:function(x){x=x instanceof 
Array?flattenAndCompact(x):[x];if(x.length===0)return null;for(var i=0;i<x.length;i++)typeof x[i]=="function"&&x[i].call(this);var today=$D.today();if(this.now&&!this.unit&&!this.operator)return new Date;this.now&&(today=new Date);var expression=!!(this.days&&this.days!==null||this.orient||this.operator),gap,mod,orient;orient=this.orient=="past"||this.operator=="subtract"?-1:1,!this.now&&"hour minute second".indexOf(this.unit)!=-1&&today.setTimeToNow(),(this.month||this.month===0)&&"year day hour minute second".indexOf(this.unit)!=-1&&(this.value=this.month+1,this.month=null,expression=!0);if(!expression&&this.weekday&&!this.day&&!this.days){var temp=Date[this.weekday]();this.day=temp.getDate(),this.month||(this.month=temp.getMonth()),this.year=temp.getFullYear()}expression&&this.weekday&&this.unit!="month"&&(this.unit="day",gap=$D.getDayNumberFromName(this.weekday)-today.getDay(),mod=7,this.days=gap?(gap+orient*mod)%mod:orient*mod),this.month&&this.unit=="day"&&this.operator&&(this.value=
this.month+1,this.month=null),this.value!=null&&this.month!=null&&this.year!=null&&(this.day=this.value*1),this.month&&!this.day&&this.value&&(today.set({day:this.value*1}),expression||(this.day=this.value*1)),!this.month&&this.value&&this.unit=="month"&&!this.now&&(this.month=this.value,expression=!0),expression&&(this.month||this.month===0)&&this.unit!="year"&&(this.unit="month",gap=this.month-today.getMonth(),mod=12,this.months=gap?(gap+orient*mod)%mod:orient*mod,this.month=null),this.unit||(this.unit="day");if(!this.value&&this.operator&&this.operator!==null&&this[this.unit+"s"]&&this[this.unit+"s"]!==null)this[this.unit+"s"]=this[this.unit+"s"]+(this.operator=="add"?1:-1)+(this.value||0)*orient;else if(this[this.unit+"s"]==null||this.operator!=null)this.value||(this.value=1),this[this.unit+"s"]=this.value*orient;this.meridian&&this.hour&&(this.meridian=="p"&&this.hour<12?this.hour=this.hour+12:this.meridian=="a"&&this.hour==12&&(this.hour=0));if(this.weekday&&!this.day&&!this.days)
{var temp=Date[this.weekday]();this.day=temp.getDate(),temp.getMonth()!==today.getMonth()&&(this.month=temp.getMonth())}return(this.month||this.month===0)&&!this.day&&(this.day=1),!this.orient&&!this.operator&&this.unit=="week"&&this.value&&!this.day&&!this.month?Date.today().setWeek(this.value):(expression&&this.timezone&&this.day&&this.days&&(this.day=this.days),expression?today.add(this):today.set(this))}};var _=$D.Parsing.Operators,g=$D.Grammar,t=$D.Translator,_fn;g.datePartDelimiter=_.rtoken(/^([\s\-\.\,\/\x27]+)/),g.timePartDelimiter=_.stoken(":"),g.whiteSpace=_.rtoken(/^\s*/),g.generalDelimiter=_.rtoken(/^(([\s\,]|at|@|on)+)/);var _C={};g.ctoken=function(keys){var fn=_C[keys];if(!fn){var c=$C.regexPatterns,kx=keys.split(/\s+/),px=[];for(var i=0;i<kx.length;i++)px.push(_.replace(_.rtoken(c[kx[i]]),kx[i]));fn=_C[keys]=_.any.apply(null,px)}return fn},g.ctoken2=function(key){return _.rtoken($C.regexPatterns[key])},g.h=_.cache(_.process(_.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),t.hour)),g.hh=
_.cache(_.process(_.rtoken(/^(0[0-9]|1[0-2])/),t.hour)),g.H=_.cache(_.process(_.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),t.hour)),g.HH=_.cache(_.process(_.rtoken(/^([0-1][0-9]|2[0-3])/),t.hour)),g.m=_.cache(_.process(_.rtoken(/^([0-5][0-9]|[0-9])/),t.minute)),g.mm=_.cache(_.process(_.rtoken(/^[0-5][0-9]/),t.minute)),g.s=_.cache(_.process(_.rtoken(/^([0-5][0-9]|[0-9])/),t.second)),g.ss=_.cache(_.process(_.rtoken(/^[0-5][0-9]/),t.second)),g.hms=_.cache(_.sequence([g.H,g.m,g.s],g.timePartDelimiter)),g.t=_.cache(_.process(g.ctoken2("shortMeridian"),t.meridian)),g.tt=_.cache(_.process(g.ctoken2("longMeridian"),t.meridian)),g.z=_.cache(_.process(_.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),t.timezone)),g.zz=_.cache(_.process(_.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),t.timezone)),g.zzz=_.cache(_.process(g.ctoken2("timezone"),t.timezone)),g.timeSuffix=_.each(_.ignore(g.whiteSpace),_.set([g.tt,g.zzz])),g.time=_.each(_.optional(_.ignore(_.stoken("T"))),g.hms,g.timeSuffix),g.d=_
.cache(_.process(_.each(_.rtoken(/^([0-2]\d|3[0-1]|\d)/),_.optional(g.ctoken2("ordinalSuffix"))),t.day)),g.dd=_.cache(_.process(_.each(_.rtoken(/^([0-2]\d|3[0-1])/),_.optional(g.ctoken2("ordinalSuffix"))),t.day)),g.ddd=g.dddd=_.cache(_.process(g.ctoken("sun mon tue wed thu fri sat"),function(s){return function(){this.weekday=s}})),g.M=_.cache(_.process(_.rtoken(/^(1[0-2]|0\d|\d)/),t.month)),g.MM=_.cache(_.process(_.rtoken(/^(1[0-2]|0\d)/),t.month)),g.MMM=g.MMMM=_.cache(_.process(g.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),t.month)),g.y=_.cache(_.process(_.rtoken(/^(\d\d?)/),t.year)),g.yy=_.cache(_.process(_.rtoken(/^(\d\d)/),t.year)),g.yyy=_.cache(_.process(_.rtoken(/^(\d\d?\d?\d?)/),t.year)),g.yyyy=_.cache(_.process(_.rtoken(/^(\d\d\d\d)/),t.year)),_fn=function(){return _.each(_.any.apply(null,arguments),_.not(g.ctoken2("timeContext")))},g.day=_fn(g.d,g.dd),g.month=_fn(g.M,g.MMM),g.year=_fn(g.yyyy,g.yy),g.orientation=_.process(g.ctoken("past future"),function(s){return function(
){this.orient=s}}),g.operator=_.process(g.ctoken("add subtract"),function(s){return function(){this.operator=s}}),g.rday=_.process(g.ctoken("yesterday tomorrow today now"),t.rday),g.unit=_.process(g.ctoken("second minute hour day week month year"),function(s){return function(){this.unit=s}}),g.value=_.process(_.rtoken(/^\d\d?(st|nd|rd|th)?/),function(s){return function(){this.value=s.replace(/\D/g,"")}}),g.expression=_.set([g.rday,g.operator,g.value,g.unit,g.orientation,g.ddd,g.MMM]),_fn=function(){return _.set(arguments,g.datePartDelimiter)},g.mdy=_fn(g.ddd,g.month,g.day,g.year),g.ymd=_fn(g.ddd,g.year,g.month,g.day),g.dmy=_fn(g.ddd,g.day,g.month,g.year),g.date=function(s){return(g[$C.dateElementOrder]||g.mdy).call(this,s)},g.format=_.process(_.many(_.any(_.process(_.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(fmt){if(g[fmt])return g[fmt];throw $D.Parsing.Exception(fmt)}),_.process(_.rtoken(/^[^dMyhHmstz]+/),function(s){return _.ignore(_.stoken(s))}))),function(
rules){return _.process(_.each.apply(null,rules),t.finishExact)});var _F={},_get=function(f){return _F[f]=_F[f]||g.format(f)[0]};g.formats=function(fx){if(fx instanceof Array){var rx=[];for(var i=0;i<fx.length;i++)rx.push(_get(fx[i]));return _.any.apply(null,rx)}return _get(fx)},g._formats=g.formats(['"yyyy-MM-ddTHH:mm:ssZ"',"yyyy-MM-ddTHH:mm:ssZ","yyyy-MM-ddTHH:mm:ssz","yyyy-MM-ddTHH:mm:ss","yyyy-MM-ddTHH:mmZ","yyyy-MM-ddTHH:mmz","yyyy-MM-ddTHH:mm","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","MMddyyyy","ddMMyyyy","Mddyyyy","ddMyyyy","Mdyyyy","dMyyyy","yyyy","Mdyy","dMyy","d"]),g._start=_.process(_.set([g.date,g.time,g.expression],g.generalDelimiter,g.whiteSpace),t.finish),g.start=function(s){try{var r=g._formats.call({},s);if(r[1].length===0)return r}catch(e){}return g._start.call({},s)},$D._parse=$D.parse,$D.parse=function(s){var r=null;if(!s)return null;if(s instanceof Date)return s;try{r=$D.Grammar.start.call({},s.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"))}catch(e){return null
}return r[1].length===0?r[0]:null},$D.getParseFunction=function(fx){var fn=$D.Grammar.formats(fx);return function(s){var r=null;try{r=fn.call({},s)}catch(e){return null}return r[1].length===0?r[0]:null}},$D.parseExact=function(s,fx){return $D.getParseFunction(fx)(s)}}(),function(){var $D=Date,$P=$D.prototype,$C=$D.CultureInfo,$N=Number.prototype;$P._orient=1,$P._nth=null,$P._is=!1,$P._same=!1,$P._isSecond=!1,$N._dateElement="day",$P.next=function(){return this._orient=1,this},$D.next=function(){return $D.today().next()},$P.last=$P.prev=$P.previous=function(){return this._orient=-1,this},$D.last=$D.prev=$D.previous=function(){return $D.today().last()},$P.is=function(){return this._is=!0,this},$P.same=function(){return this._same=!0,this._isSecond=!1,this},$P.today=function(){return this.same().day()},$P.weekday=function(){return this._is?(this._is=!1,!this.is().sat()&&!this.is().sun()):!1},$P.at=function(time){return typeof time=="string"?$D.parse(this.toString("d")+" "+time):this.set(time
)},$N.fromNow=$N.after=function(date){var c={};return c[this._dateElement]=this,(date?date.clone():new Date).add(c)},$N.ago=$N.before=function(date){var c={};return c[this._dateElement]=this*-1,(date?date.clone():new Date).add(c)};var dx="sunday monday tuesday wednesday thursday friday saturday".split(/\s/),mx="january february march april may june july august september october november december".split(/\s/),px="Millisecond Second Minute Hour Day Week Month Year".split(/\s/),pxf="Milliseconds Seconds Minutes Hours Date Week Month FullYear".split(/\s/),nth="final first second third fourth fifth".split(/\s/),de;$P.toObject=function(){var o={};for(var i=0;i<px.length;i++)o[px[i].toLowerCase()]=this["get"+pxf[i]]();return o},$D.fromObject=function(config){return config.week=null,Date.today().set(config)};var df=function(n){return function(){if(this._is)return this._is=!1,this.getDay()==n;if(this._nth!==null){this._isSecond&&this.addSeconds(this._orient*-1),this._isSecond=!1;var ntemp=this._nth
;this._nth=null;var temp=this.clone().moveToLastDayOfMonth();this.moveToNthOccurrence(n,ntemp);if(this>temp)throw new RangeError($D.getDayName(n)+" does not occur "+ntemp+" times in the month of "+$D.getMonthName(temp.getMonth())+" "+temp.getFullYear()+".");return this}return this.moveToDayOfWeek(n,this._orient)}},sdf=function(n){return function(){var t=$D.today(),shift=n-t.getDay();return n===0&&$C.firstDayOfWeek===1&&t.getDay()!==0&&(shift+=7),t.addDays(shift)}};for(var i=0;i<dx.length;i++)$D[dx[i].toUpperCase()]=$D[dx[i].toUpperCase().substring(0,3)]=i,$D[dx[i]]=$D[dx[i].substring(0,3)]=sdf(i),$P[dx[i]]=$P[dx[i].substring(0,3)]=df(i);var mf=function(n){return function(){return this._is?(this._is=!1,this.getMonth()===n):this.moveToMonth(n,this._orient)}},smf=function(n){return function(){return $D.today().set({month:n,day:1})}};for(var j=0;j<mx.length;j++)$D[mx[j].toUpperCase()]=$D[mx[j].toUpperCase().substring(0,3)]=j,$D[mx[j]]=$D[mx[j].substring(0,3)]=smf(j),$P[mx[j]]=$P[mx[j].substring
(0,3)]=mf(j);var ef=function(j){return function(){if(this._isSecond)return this._isSecond=!1,this;if(this._same){this._same=this._is=!1;var o1=this.toObject(),o2=(arguments[0]||new Date).toObject(),v="",k=j.toLowerCase();for(var m=px.length-1;m>-1;m--){v=px[m].toLowerCase();if(o1[v]!=o2[v])return!1;if(k==v)break}return!0}return j.substring(j.length-1)!="s"&&(j+="s"),this["add"+j](this._orient)}},nf=function(n){return function(){return this._dateElement=n,this}};for(var k=0;k<px.length;k++)de=px[k].toLowerCase(),$P[de]=$P[de+"s"]=ef(px[k]),$N[de]=$N[de+"s"]=nf(de);$P._ss=ef("Second");var nthfn=function(n){return function(dayOfWeek){return this._same?this._ss(arguments[0]):dayOfWeek||dayOfWeek===0?this.moveToNthOccurrence(dayOfWeek,n):(this._nth=n,n!==2||dayOfWeek!==undefined&&dayOfWeek!==null?this:(this._isSecond=!0,this.addSeconds(this._orient)))}};for(var l=0;l<nth.length;l++)$P[nth[l]]=l===0?nthfn(-1):nthfn(l)}()}),define("views/streamview",["jquery","underscore","backbone","app","ich"
,"views/streamitemview","date"],function($,_,Backbone,app,ich,StreamItemView){var StreamView=Backbone.Marionette.CompositeView.extend({template:"Stream",itemView:StreamItemView,className:"stream",events:{"click #stream-load-more-button":"onLoadMoreClicked","click #stream-load-new-button":"onLoadNewClicked"},initialize:function(options){_.bindAll(this,"onNewStreamItemReceived","appendHtml"),this.newItemsCount=0,this.isHomeStream=options.isHomeStream&&options.isHomeStream===!0?!0:!1,this.collection.on("fetching",this.onStreamLoadingStart,this),this.collection.on("fetched",this.onStreamLoadingComplete,this),this.newStreamItemsCache=[],this.isHomeStream?app.vent.on("newactivity",this.onNewStreamItemReceived):app.vent.on("newactivity:"+this.model.id,this.onNewStreamItemReceived)},showBootstrappedDetails:function(){},appendHtml:function(collectionView,itemView){var items=this.collection.pluck("Id"),index=_.indexOf(items,itemView.model.id);log(index);var $li=collectionView.$el.find(".stream-list > li:eq("+
index+")");$li.length===0?collectionView.$el.find(".stream-list").append(itemView.el):$li.before(itemView.el)},onLoadMoreClicked:function(){this.$el.find(".stream-load-more").remove(),this.collection.fetchNextPage()},onLoadNewClicked:function(){this.$el.find(".stream-load-new").remove(),this.collection.add(this.newStreamItemsCache),this.newStreamItemsCache=[]},onStreamLoadingStart:function(collection){this.$el.append(ich.StreamMessage({Text:"Loading",ShowLoader:!0}))},onStreamLoadingComplete:function(collection){this.$el.find(".stream-message").remove(),collection.length===0&&this.$el.append(ich.StreamMessage({Text:"No activity yet! Start now by adding an observation.",ShowLoader:!1})),collection.pageInfo().next&&this.$el.append(ich.StreamLoadMore())},onNewStreamItemReceived:function(streamItem){var streamItemCreatedDateTime=Date.parseExact(streamItem.get("CreatedDateTime"),"yyyy-MM-ddTHH:mm:ssZ");log("streamItemCreatedDateTime",streamItemCreatedDateTime),log("baselineDateTime",this.collection
.baselineDateTime),streamItemCreatedDateTime.isAfter(this.collection.baselineDateTime)&&(log("is after!"),this.newItemsCount++,this.newStreamItemsCache.push(streamItem)),this.newItemsCount>0&&(this.$el.find(".stream-load-new").length===0?this.$el.prepend(ich.StreamLoadNew()):this.$el.find("#stream-load-new-button").val("Load "+this.newItemsCount+" New Items"))}});return StreamView}),define("models/streamitem",["jquery","underscore","backbone"],function($,_,Backbone){var StreamItem=Backbone.Model.extend({idAttribute:"Id"});return StreamItem}),define("collections/streamitemcollection",["jquery","underscore","backbone","collections/paginatedcollection","models/streamitem","models/user","models/project"],function($,_,Backbone,PaginatedCollection,StreamItem,User,Project){var StreamItemCollection=PaginatedCollection.extend({model:StreamItem,baseUrl:"/stream",groupOrUser:null,initialize:function(models,options){_.bindAll(this,"onSuccess","onSuccessWithAddFix","getFetchOptions"),PaginatedCollection
.prototype.initialize.apply(this,arguments),typeof options!="undefined"||(options={}),options.groupOrUser&&(this.groupOrUser=options.groupOrUser,this.baseUrl="/"+options.groupOrUser.id+"/activity",log(this.baseUrl));var now=new Date;this.baselineDateTime=new Date(now.getUTCFullYear(),now.getUTCMonth(),now.getUTCDate(),now.getUTCHours(),now.getUTCMinutes(),now.getUTCSeconds())},comparator:function(streamItem1){return-parseInt(streamItem1.get("CreatedDateTimeOrder"))},fetchFirstPage:function(){this.firstPage(this.getFetchOptions(!0,"olderThan"))},fetchNextPage:function(){this.nextPage(this.getFetchOptions(!0,"olderThan"))},fetchNewItems:function(){this.fetch(this.getFetchOptions(!0,"newerThan"))},getFetchOptions:function(add,newerOrOlder){var options={data:{},add:add,success:null};return add?options.success=this.onSuccess:options.success=this.onSuccessWithAddFix,this.groupOrUser&&(this.groupOrUser instanceof Project?options.data.groupId=this.groupOrUser.id:this.groupOrUser instanceof User&&
(options.data.userId=this.groupOrUser.id)),options.data[newerOrOlder]=this.baselineDateTime,options},onSuccess:function(collection,response){},onSuccessWithAddFix:function(collection,response){this.onSuccess(collection,response);var self=this;response.each(function(item,index){self.trigger("add",item,self,{Index:index})})}});return StreamItemCollection}),define("views/projectlayoutview",["jquery","underscore","backbone","app","views/streamview","collections/streamitemcollection"],function($,_,Backbone,app,StreamView,StreamItemCollection){var ProjectLayoutView=Backbone.Marionette.Layout.extend({className:"project",template:"Project",regions:{summary:".summary",details:".details"},showBootstrappedDetails:function(){this.initializeRegions(),this.$el=$("#content .project")},showStream:function(){var streamItemCollection=new StreamItemCollection(null,{groupOrUser:this.model}),options={model:this.model,collection:streamItemCollection};app.isPrerendering("projects")&&(options.el=".stream");var streamView=new 
StreamView(options);app.isPrerendering("projects")?(this.details.attachView(streamView),streamView.showBootstrappedDetails()):this.details.show(streamView),streamItemCollection.fetchFirstPage()}});return ProjectLayoutView}),define("controllers/groupusercontroller",["jquery","underscore","backbone","app","views/projectlayoutview","models/project","collections/streamitemcollection"],function($,_,Backbone,app,ProjectLayoutView,Project,StreamItemCollection){var GroupUserRouter=Backbone.Marionette.AppRouter.extend({appRoutes:{"projects/:id":"showProjectStream","users/:id":"showUser"}}),GroupUserController={},getModel=function(id){var deferred=new $.Deferred;if(app.isPrerendering("projects"))deferred.resolve(app.prerenderedView.data);else{var params={};$.ajax({url:"/projects/"+id,data:params}).done(function(data){deferred.resolve(data.Model)})}return deferred.promise()};return GroupUserController.showTeam=function(){log("team:show")},GroupUserController.showProjectStream=function(id){log("showing projects home stream"
,this,this),$.when(getModel(id)).done(function(model){var project=new Project(model.Project),projectLayoutView=new ProjectLayoutView({model:project});app.content[app.getShowViewMethodName("projects")](projectLayoutView),app.isPrerendering("projects")&&projectLayoutView.showBootstrappedDetails(),projectLayoutView.showStream(),app.setPrerenderComplete()})},GroupUserController.showProjectObservations=function(id){log("project:show:observations");var projectLayoutView=showProjectLayoutView(id)},GroupUserController.showProjectAbout=function(id){log("project:show:about");var projectLayoutView=showProjectLayoutView(id)},GroupUserController.showProjectMembers=function(id){log("project:show:members");var projectLayoutView=showProjectLayoutView(id)},GroupUserController.showUser=function(){log("user:show")},app.vent.on("home:show",function(id){}),app.vent.on("project:show:stream",function(id){}),app.vent.on("project:show:observations",function(id){}),app.addInitializer(function(){this.groupUserRouter=new 
GroupUserRouter({controller:GroupUserController})}),GroupUserController}),define("views/homepubliclayoutview",["jquery","underscore","backbone","app"],function($,_,Backbone,app){var HomePublicLayoutView=Backbone.Marionette.Layout.extend({className:"home",template:"Home",showBootstrappedDetails:function(){this.initializeRegions(),this.$el=$("#content .home")}});return HomePublicLayoutView}),define("views/homeprivatelayoutview",["jquery","underscore","backbone","app","views/streamview","collections/streamitemcollection"],function($,_,Backbone,app,StreamView,StreamItemCollection){var HomePrivateLayoutView=Backbone.Marionette.Layout.extend({className:"home",template:"Home",regions:{summary:".summary",details:".details"},showBootstrappedDetails:function(){this.initializeRegions(),this.$el=$("#content .home")},showStream:function(){var streamItemCollection=new StreamItemCollection,options={model:app.authenticatedUser.user,collection:streamItemCollection,isHomeStream:!0};app.isPrerendering("home"
)&&(options.el=".stream");var streamView=new StreamView(options);app.isPrerendering("home")?(this.details.attachView(streamView),streamView.showBootstrappedDetails()):this.details.show(streamView),streamItemCollection.fetchFirstPage()}});return HomePrivateLayoutView}),define("controllers/homecontroller",["jquery","underscore","backbone","app","views/homepubliclayoutview","views/homeprivatelayoutview"],function($,_,Backbone,app,HomePublicLayoutView,HomePrivateLayoutView){var HomeRouter=Backbone.Marionette.AppRouter.extend({appRoutes:{"":"showHomeStream"}}),HomeController={};return HomeController.showHomeStream=function(){$(function(){log("showing home stream",this,this);var homeLayoutView=null;if(app.authenticatedUser)var homeLayoutView=new HomePrivateLayoutView({model:app.authenticatedUser.user});else var homeLayoutView=new HomePublicLayoutView;app.content[app.getShowViewMethodName("home")](homeLayoutView),app.isPrerendering("home")&&homeLayoutView.showBootstrappedDetails(),app.authenticatedUser&&
homeLayoutView.showStream(),app.setPrerenderComplete()})},app.addInitializer(function(){this.homeRouter=new HomeRouter({controller:HomeController})}),HomeController}),define("async",[],function(){function injectScript(src){var s,t;s=document.createElement("script"),s.type="text/javascript",s.async=!0,s.src=src,t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(s,t)}function formatUrl(name,id){var paramRegex=/!(.+)/,url=name.replace(paramRegex,""),param=paramRegex.test(name)?name.replace(/.+!/,""):DEFAULT_PARAM_NAME;return url+=url.indexOf("?")<0?"?":"&",url+param+"="+id}function uid(){return _uid+=1,"__async_req_"+_uid+"__"}var DEFAULT_PARAM_NAME="callback",_uid=0;return{load:function(name,req,onLoad,config){if(config.isBuild)onLoad(null);else{var id=uid();window[id]=onLoad,injectScript(formatUrl(name,id))}}}}),define("views/dummyoverlayview",["jquery","underscore","backbone","app","async!http://maps.google.com/maps/api/js?sensor=false&region=AU"],function($,_,Backbone
,app){var DummyOverlayView=function(map){this.setMap(map),this.draw=function(){}};return DummyOverlayView.prototype=new google.maps.OverlayView,DummyOverlayView}),define("jqueryui/core",["jquery"],function(jQuery){(function($,undefined){function focusable(element,isTabIndexNotNaN){var nodeName=element.nodeName.toLowerCase();if("area"===nodeName){var map=element.parentNode,mapName=map.name,img;return!element.href||!mapName||map.nodeName.toLowerCase()!=="map"?!1:(img=$("img[usemap=#"+mapName+"]")[0],!!img&&visible(img))}return(/input|select|textarea|button|object/.test(nodeName)?!element.disabled:"a"==nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN)&&visible(element)}function visible(element){return!$(element).parents().andSelf().filter(function(){return $.curCSS(this,"visibility")==="hidden"||$.expr.filters.hidden(this)}).length}$.ui=$.ui||{};if($.ui.version)return;$.extend($.ui,{version:"1.8.14",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT
:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),$.fn.extend({_focus:$.fn.focus,focus:function(delay,fn){return typeof delay=="number"?this.each(function(){var elem=this;setTimeout(function(){$(elem).focus(),fn&&fn.call(elem)},delay)}):this._focus.apply(this,arguments)},scrollParent:function(){var scrollParent;return $.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?scrollParent=this.parents().filter(function(){return/(relative|absolute|fixed)/.test($.curCSS(this,"position",1))&&/(auto|scroll)/.test($.curCSS(this,"overflow",1)+$.curCSS(this,"overflow-y",1)+$.curCSS(this,"overflow-x",1))}).eq(0):scrollParent=this.parents().filter(function(){return/(auto|scroll)/.test($.curCSS(this,"overflow",1)+$.curCSS
(this,"overflow-y",1)+$.curCSS(this,"overflow-x",1))}).eq(0),/fixed/.test(this.css("position"))||!scrollParent.length?$(document):scrollParent},zIndex:function(zIndex){if(zIndex!==undefined)return this.css("zIndex",zIndex);if(this.length){var elem=$(this[0]),position,value;while(elem.length&&elem[0]!==document){position=elem.css("position");if(position==="absolute"||position==="relative"||position==="fixed"){value=parseInt(elem.css("zIndex"),10);if(!isNaN(value)&&value!==0)return value}elem=elem.parent()}}return 0},disableSelection:function(){return this.bind(($.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(event){event.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),$.each(["Width","Height"],function(i,name){function reduce(elem,size,border,margin){return $.each(side,function(){size-=parseFloat($.curCSS(elem,"padding"+this,!0))||0,border&&(size-=parseFloat($.curCSS(elem,"border"+this+"Width",!0))||0),margin&&
(size-=parseFloat($.curCSS(elem,"margin"+this,!0))||0)}),size}var side=name==="Width"?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};$.fn["inner"+name]=function(size){return size===undefined?orig["inner"+name].call(this):this.each(function(){$(this).css(type,reduce(this,size)+"px")})},$.fn["outer"+name]=function(size,margin){return typeof size!="number"?orig["outer"+name].call(this,size):this.each(function(){$(this).css(type,reduce(this,size,!0,margin)+"px")})}}),$.extend($.expr[":"],{data:function(elem,i,match){return!!$.data(elem,match[3])},focusable:function(element){return focusable(element,!isNaN($.attr(element,"tabindex")))},tabbable:function(element){var tabIndex=$.attr(element,"tabindex"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&focusable(element,!isTabIndexNaN)}}),$(function(){var body=document.body,div=body.appendChild(div=document
.createElement("div"));$.extend(div.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),$.support.minHeight=div.offsetHeight===100,$.support.selectstart="onselectstart"in div,body.removeChild(div).style.display="none"}),$.extend($.ui,{plugin:{add:function(module,option,set){var proto=$.ui[module].prototype;for(var i in set)proto.plugins[i]=proto.plugins[i]||[],proto.plugins[i].push([option,set[i]])},call:function(instance,name,args){var set=instance.plugins[name];if(!set||!instance.element[0].parentNode)return;for(var i=0;i<set.length;i++)instance.options[set[i][0]]&&set[i][1].apply(instance.element,args)}},contains:function(a,b){return document.compareDocumentPosition?a.compareDocumentPosition(b)&16:a!==b&&a.contains(b)},hasScroll:function(el,a){if($(el).css("overflow")==="hidden")return!1;var scroll=a&&a==="left"?"scrollLeft":"scrollTop",has=!1;return el[scroll]>0?!0:(el[scroll]=1,has=el[scroll]>0,el[scroll]=0,has)},isOverAxis:function(x,reference,size){return x>reference&&
x<reference+size},isOver:function(y,x,top,left,height,width){return $.ui.isOverAxis(y,top,height)&&$.ui.isOverAxis(x,left,width)}})})(jQuery)}),define("jqueryui/widget",["jquery"],function(jQuery){(function($,undefined){if($.cleanData){var _cleanData=$.cleanData;$.cleanData=function(elems){for(var i=0,elem;(elem=elems[i])!=null;i++)$(elem).triggerHandler("remove");_cleanData(elems)}}else{var _remove=$.fn.remove;$.fn.remove=function(selector,keepData){return this.each(function(){return keepData||(!selector||$.filter(selector,[this]).length)&&$("*",this).add([this]).each(function(){$(this).triggerHandler("remove")}),_remove.call($(this),selector,keepData)})}}$.widget=function(name,base,prototype){var namespace=name.split(".")[0],fullName;name=name.split(".")[1],fullName=namespace+"-"+name,prototype||(prototype=base,base=$.Widget),$.expr[":"][fullName]=function(elem){return!!$.data(elem,name)},$[namespace]=$[namespace]||{},$[namespace][name]=function(options,element){arguments.length&&this
._createWidget(options,element)};var basePrototype=new base;basePrototype.options=$.extend(!0,{},basePrototype.options),$[namespace][name].prototype=$.extend(!0,basePrototype,{namespace:namespace,widgetName:name,widgetEventPrefix:$[namespace][name].prototype.widgetEventPrefix||name,widgetBaseClass:fullName},prototype),$.widget.bridge(name,$[namespace][name])},$.widget.bridge=function(name,object){$.fn[name]=function(options){var isMethodCall=typeof options=="string",args=Array.prototype.slice.call(arguments,1),returnValue=this;return options=!isMethodCall&&args.length?$.extend.apply(null,[!0,options].concat(args)):options,isMethodCall&&options.charAt(0)==="_"?returnValue:(isMethodCall?this.each(function(){var instance=$.data(this,name),methodValue=instance&&$.isFunction(instance[options])?instance[options].apply(instance,args):instance;if(methodValue!==instance&&methodValue!==undefined)return returnValue=methodValue,!1}):this.each(function(){var instance=$.data(this,name);instance?instance
.option(options||{})._init():$.data(this,name,new object(options,this))}),returnValue)}},$.Widget=function(options,element){arguments.length&&this._createWidget(options,element)},$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(options,element){$.data(element,this.widgetName,this),this.element=$(element),this.options=$.extend(!0,{},this.options,this._getCreateOptions(),options);var self=this;this.element.bind("remove."+this.widgetName,function(){self.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return $.metadata&&$.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+"ui-state-disabled")},widget:function(){return this.element},option:function(key,value
){var options=key;if(arguments.length===0)return $.extend({},this.options);if(typeof key=="string"){if(value===undefined)return this.options[key];options={},options[key]=value}return this._setOptions(options),this},_setOptions:function(options){var self=this;return $.each(options,function(key,value){self._setOption(key,value)}),this},_setOption:function(key,value){return this.options[key]=value,key==="disabled"&&this.widget()[value?"addClass":"removeClass"](this.widgetBaseClass+"-disabled"+" "+"ui-state-disabled").attr("aria-disabled",value),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(type,event,data){var callback=this.options[type];event=$.Event(event),event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase(),data=data||{};if(event.originalEvent)for(var i=$.event.props.length,prop;i;)prop=$.event.props[--i],event[prop]=event.originalEvent[prop];return this.element
.trigger(event,data),!($.isFunction(callback)&&callback.call(this.element[0],event,data)===!1||event.isDefaultPrevented())}}})(jQuery)}),define("jqueryui/position",["jquery"],function(jQuery){(function($,undefined){$.ui=$.ui||{};var horizontalPositions=/left|center|right/,verticalPositions=/top|center|bottom/,center="center",_position=$.fn.position,_offset=$.fn.offset;$.fn.position=function(options){if(!options||!options.of)return _position.apply(this,arguments);options=$.extend({},options);var target=$(options.of),targetElem=target[0],collision=(options.collision||"flip").split(" "),offset=options.offset?options.offset.split(" "):[0,0],targetWidth,targetHeight,basePosition;return targetElem.nodeType===9?(targetWidth=target.width(),targetHeight=target.height(),basePosition={top:0,left:0}):targetElem.setTimeout?(targetWidth=target.width(),targetHeight=target.height(),basePosition={top:target.scrollTop(),left:target.scrollLeft()}):targetElem.preventDefault?(options.at="left top",targetWidth=
targetHeight=0,basePosition={top:options.of.pageY,left:options.of.pageX}):(targetWidth=target.outerWidth(),targetHeight=target.outerHeight(),basePosition=target.offset()),$.each(["my","at"],function(){var pos=(options[this]||"").split(" ");pos.length===1&&(pos=horizontalPositions.test(pos[0])?pos.concat([center]):verticalPositions.test(pos[0])?[center].concat(pos):[center,center]),pos[0]=horizontalPositions.test(pos[0])?pos[0]:center,pos[1]=verticalPositions.test(pos[1])?pos[1]:center,options[this]=pos}),collision.length===1&&(collision[1]=collision[0]),offset[0]=parseInt(offset[0],10)||0,offset.length===1&&(offset[1]=offset[0]),offset[1]=parseInt(offset[1],10)||0,options.at[0]==="right"?basePosition.left+=targetWidth:options.at[0]===center&&(basePosition.left+=targetWidth/2),options.at[1]==="bottom"?basePosition.top+=targetHeight:options.at[1]===center&&(basePosition.top+=targetHeight/2),basePosition.left+=offset[0],basePosition.top+=offset[1],this.each(function(){var elem=$(this),elemWidth=
elem.outerWidth(),elemHeight=elem.outerHeight(),marginLeft=parseInt($.curCSS(this,"marginLeft",!0))||0,marginTop=parseInt($.curCSS(this,"marginTop",!0))||0,collisionWidth=elemWidth+marginLeft+(parseInt($.curCSS(this,"marginRight",!0))||0),collisionHeight=elemHeight+marginTop+(parseInt($.curCSS(this,"marginBottom",!0))||0),position=$.extend({},basePosition),collisionPosition;options.my[0]==="right"?position.left-=elemWidth:options.my[0]===center&&(position.left-=elemWidth/2),options.my[1]==="bottom"?position.top-=elemHeight:options.my[1]===center&&(position.top-=elemHeight/2),position.left=Math.round(position.left),position.top=Math.round(position.top),collisionPosition={left:position.left-marginLeft,top:position.top-marginTop},$.each(["left","top"],function(i,dir){$.ui.position[collision[i]]&&$.ui.position[collision[i]][dir](position,{targetWidth:targetWidth,targetHeight:targetHeight,elemWidth:elemWidth,elemHeight:elemHeight,collisionPosition:collisionPosition,collisionWidth:collisionWidth
,collisionHeight:collisionHeight,offset:offset,my:options.my,at:options.at})}),$.fn.bgiframe&&elem.bgiframe(),elem.offset($.extend(position,{using:options.using}))})},$.ui.position={fit:{left:function(position,data){var win=$(window),over=data.collisionPosition.left+data.collisionWidth-win.width()-win.scrollLeft();position.left=over>0?position.left-over:Math.max(position.left-data.collisionPosition.left,position.left)},top:function(position,data){var win=$(window),over=data.collisionPosition.top+data.collisionHeight-win.height()-win.scrollTop();position.top=over>0?position.top-over:Math.max(position.top-data.collisionPosition.top,position.top)}},flip:{left:function(position,data){if(data.at[0]===center)return;var win=$(window),over=data.collisionPosition.left+data.collisionWidth-win.width()-win.scrollLeft(),myOffset=data.my[0]==="left"?-data.elemWidth:data.my[0]==="right"?data.elemWidth:0,atOffset=data.at[0]==="left"?data.targetWidth:-data.targetWidth,offset=-2*data.offset[0];position.left+=
data.collisionPosition.left<0?myOffset+atOffset+offset:over>0?myOffset+atOffset+offset:0},top:function(position,data){if(data.at[1]===center)return;var win=$(window),over=data.collisionPosition.top+data.collisionHeight-win.height()-win.scrollTop(),myOffset=data.my[1]==="top"?-data.elemHeight:data.my[1]==="bottom"?data.elemHeight:0,atOffset=data.at[1]==="top"?data.targetHeight:-data.targetHeight,offset=-2*data.offset[1];position.top+=data.collisionPosition.top<0?myOffset+atOffset+offset:over>0?myOffset+atOffset+offset:0}}},$.offset.setOffset||($.offset.setOffset=function(elem,options){/static/.test($.curCSS(elem,"position"))&&(elem.style.position="relative");var curElem=$(elem),curOffset=curElem.offset(),curTop=parseInt($.curCSS(elem,"top",!0),10)||0,curLeft=parseInt($.curCSS(elem,"left",!0),10)||0,props={top:options.top-curOffset.top+curTop,left:options.left-curOffset.left+curLeft};"using"in options?options.using.call(elem,props):curElem.css(props)},$.fn.offset=function(options){var elem=
this[0];return!elem||!elem.ownerDocument?null:options?this.each(function(){$.offset.setOffset(this,options)}):_offset.call(this)})})(jQuery)}),define("jqueryui/autocomplete",["jquery","jqueryui/core","jqueryui/widget","jqueryui/position"],function(jQuery){(function($,undefined){var requestIndex=0;$.widget("ui.autocomplete",{options:{appendTo:"body",autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null},pending:0,_create:function(){var self=this,doc=this.element[0].ownerDocument,suppressKeyPress;this.element.addClass("ui-autocomplete-input").attr("autocomplete","off").attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}).bind("keydown.autocomplete",function(event){if(self.options.disabled||self.element.attr("readonly"))return;suppressKeyPress=!1;var keyCode=$.ui.keyCode;switch(event.keyCode){case keyCode.PAGE_UP:self._move("previousPage",event);break;case keyCode.PAGE_DOWN:self._move("nextPage",event);break;case keyCode
.UP:self._move("previous",event),event.preventDefault();break;case keyCode.DOWN:self._move("next",event),event.preventDefault();break;case keyCode.ENTER:case keyCode.NUMPAD_ENTER:self.menu.active&&(suppressKeyPress=!0,event.preventDefault());case keyCode.TAB:if(!self.menu.active)return;self.menu.select(event);break;case keyCode.ESCAPE:self.element.val(self.term),self.close(event);break;default:clearTimeout(self.searching),self.searching=setTimeout(function(){self.term!=self.element.val()&&(self.selectedItem=null,self.search(null,event))},self.options.delay)}}).bind("keypress.autocomplete",function(event){suppressKeyPress&&(suppressKeyPress=!1,event.preventDefault())}).bind("focus.autocomplete",function(){if(self.options.disabled)return;self.selectedItem=null,self.previous=self.element.val()}).bind("blur.autocomplete",function(event){if(self.options.disabled)return;clearTimeout(self.searching),self.closing=setTimeout(function(){self.close(event),self._change(event)},150)}),this._initSource
(),this.response=function(){return self._response.apply(self,arguments)},this.menu=$("<ul></ul>").addClass("ui-autocomplete").appendTo($(this.options.appendTo||"body",doc)[0]).mousedown(function(event){var menuElement=self.menu.element[0];$(event.target).closest(".ui-menu-item").length||setTimeout(function(){$(document).one("mousedown",function(event){event.target!==self.element[0]&&event.target!==menuElement&&!$.ui.contains(menuElement,event.target)&&self.close()})},1),setTimeout(function(){clearTimeout(self.closing)},13)}).menu({focus:function(event,ui){var item=ui.item.data("item.autocomplete");!1!==self._trigger("focus",event,{item:item})&&/^key/.test(event.originalEvent.type)&&self.element.val(item.value)},selected:function(event,ui){var item=ui.item.data("item.autocomplete"),previous=self.previous;self.element[0]!==doc.activeElement&&(self.element.focus(),self.previous=previous,setTimeout(function(){self.previous=previous,self.selectedItem=item},1)),!1!==self._trigger("select",event
,{item:item})&&self.element.val(item.value),self.term=self.element.val(),self.close(event),self.selectedItem=item},blur:function(event,ui){self.menu.element.is(":visible")&&self.element.val()!==self.term&&self.element.val(self.term)}}).zIndex(this.element.zIndex()+1).css({top:0,left:0}).hide().data("menu"),$.fn.bgiframe&&this.menu.element.bgiframe()},destroy:function(){this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup"),this.menu.element.remove(),$.Widget.prototype.destroy.call(this)},_setOption:function(key,value){$.Widget.prototype._setOption.apply(this,arguments),key==="source"&&this._initSource(),key==="appendTo"&&this.menu.element.appendTo($(value||"body",this.element[0].ownerDocument)[0]),key==="disabled"&&value&&this.xhr&&this.xhr.abort()},_initSource:function(){var self=this,array,url;$.isArray(this.options.source)?(array=this.options.source,this.source=function(request,response
){response($.ui.autocomplete.filter(array,request.term))}):typeof this.options.source=="string"?(url=this.options.source,this.source=function(request,response){self.xhr&&self.xhr.abort(),self.xhr=$.ajax({url:url,data:request,dataType:"json",autocompleteRequest:++requestIndex,success:function(data,status){this.autocompleteRequest===requestIndex&&response(data)},error:function(){this.autocompleteRequest===requestIndex&&response([])}})}):this.source=this.options.source},search:function(value,event){value=value!=null?value:this.element.val(),this.term=this.element.val();if(value.length<this.options.minLength)return this.close(event);clearTimeout(this.closing);if(this._trigger("search",event)===!1)return;return this._search(value)},_search:function(value){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.source({term:value},this.response)},_response:function(content){!this.options.disabled&&content&&content.length?(content=this._normalize(content),this._suggest(content),this
._trigger("open")):this.close(),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading")},close:function(event){clearTimeout(this.closing),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.deactivate(),this._trigger("close",event))},_change:function(event){this.previous!==this.element.val()&&this._trigger("change",event,{item:this.selectedItem})},_normalize:function(items){return items.length&&items[0].label&&items[0].value?items:$.map(items,function(item){return typeof item=="string"?{label:item,value:item}:$.extend({label:item.label||item.value,value:item.value||item.label},item)})},_suggest:function(items){var ul=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(ul,items),this.menu.deactivate(),this.menu.refresh(),ul.show(),this._resizeMenu(),ul.position($.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(new $.Event("mouseover"))},_resizeMenu:function(){var ul=this.menu.element
;ul.outerWidth(Math.max(ul.width("").outerWidth(),this.element.outerWidth()))},_renderMenu:function(ul,items){var self=this;$.each(items,function(index,item){self._renderItem(ul,item)})},_renderItem:function(ul,item){return $("<li></li>").data("item.autocomplete",item).append($("<a></a>").text(item.label)).appendTo(ul)},_move:function(direction,event){if(!this.menu.element.is(":visible")){this.search(null,event);return}if(this.menu.first()&&/^previous/.test(direction)||this.menu.last()&&/^next/.test(direction)){this.element.val(this.term),this.menu.deactivate();return}this.menu[direction](event)},widget:function(){return this.menu.element}}),$.extend($.ui.autocomplete,{escapeRegex:function(value){return value.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},filter:function(array,term){var matcher=new RegExp($.ui.autocomplete.escapeRegex(term),"i");return $.grep(array,function(value){return matcher.test(value.label||value.value||value)})}})})(jQuery),function($){$.widget("ui.menu",{_create:function(
){var self=this;this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({role:"listbox","aria-activedescendant":"ui-active-menuitem"}).click(function(event){if(!$(event.target).closest(".ui-menu-item a").length)return;event.preventDefault(),self.select(event)}),this.refresh()},refresh:function(){var self=this,items=this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","menuitem");items.children("a").addClass("ui-corner-all").attr("tabindex",-1).mouseenter(function(event){self.activate(event,$(this).parent())}).mouseleave(function(){self.deactivate()})},activate:function(event,item){this.deactivate();if(this.hasScroll()){var offset=item.offset().top-this.element.offset().top,scroll=this.element.scrollTop(),elementHeight=this.element.height();offset<0?this.element.scrollTop(scroll+offset):offset>=elementHeight&&this.element.scrollTop(scroll+offset-elementHeight+item.height())}this.active=item.eq(0).children("a").addClass("ui-state-hover"
).attr("id","ui-active-menuitem").end(),this._trigger("focus",event,{item:item})},deactivate:function(){if(!this.active)return;this.active.children("a").removeClass("ui-state-hover").removeAttr("id"),this._trigger("blur"),this.active=null},next:function(event){this.move("next",".ui-menu-item:first",event)},previous:function(event){this.move("prev",".ui-menu-item:last",event)},first:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},last:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},move:function(direction,edge,event){if(!this.active){this.activate(event,this.element.children(edge));return}var next=this.active[direction+"All"](".ui-menu-item").eq(0);next.length?this.activate(event,next):this.activate(event,this.element.children(edge))},nextPage:function(event){if(this.hasScroll()){if(!this.active||this.last()){this.activate(event,this.element.children(".ui-menu-item:first"));return}var base=this.active.offset().top,height=this.element
.height(),result=this.element.children(".ui-menu-item").filter(function(){var close=$(this).offset().top-base-height+$(this).height();return close<10&&close>-10});result.length||(result=this.element.children(".ui-menu-item:last")),this.activate(event,result)}else this.activate(event,this.element.children(".ui-menu-item").filter(!this.active||this.last()?":first":":last"))},previousPage:function(event){if(this.hasScroll()){if(!this.active||this.first()){this.activate(event,this.element.children(".ui-menu-item:last"));return}var base=this.active.offset().top,height=this.element.height();result=this.element.children(".ui-menu-item").filter(function(){var close=$(this).offset().top-base+height-$(this).height();return close<10&&close>-10}),result.length||(result=this.element.children(".ui-menu-item:first")),this.activate(event,result)}else this.activate(event,this.element.children(".ui-menu-item").filter(!this.active||this.first()?":last":":first"))},hasScroll:function(){return this.element.
height()<this.element[$.fn.prop?"prop":"attr"]("scrollHeight")},select:function(event){this._trigger("selected",event,{item:this.active})}})}(jQuery)}),define("jqueryui/mouse",["jquery","jqueryui/widget"],function(jQuery){(function($,undefined){var mouseHandled=!1;$(document).mousedown(function(e){mouseHandled=!1}),$.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var self=this;this.element.bind("mousedown."+this.widgetName,function(event){return self._mouseDown(event)}).bind("click."+this.widgetName,function(event){if(!0===$.data(event.target,self.widgetName+".preventClickEvent"))return $.removeData(event.target,self.widgetName+".preventClickEvent"),event.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName)},_mouseDown:function(event){if(mouseHandled)return;this._mouseStarted&&this._mouseUp(event),this._mouseDownEvent=event;var self=this,btnIsLeft=event.which==1,elIsCancel=typeof 
this.options.cancel=="string"?$(event.target).closest(this.options.cancel).length:!1;if(!btnIsLeft||elIsCancel||!this._mouseCapture(event))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){self.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=this._mouseStart(event)!==!1;if(!this._mouseStarted)return event.preventDefault(),!0}return!0===$.data(event.target,this.widgetName+".preventClickEvent")&&$.removeData(event.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(event){return self._mouseMove(event)},this._mouseUpDelegate=function(event){return self._mouseUp(event)},$(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),event.preventDefault(),mouseHandled=!0,!0},_mouseMove:function(event){return!$.browser.msie||document.documentMode>=9||!!event.button?this._mouseStarted?
(this._mouseDrag(event),event.preventDefault()):(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,event)!==!1,this._mouseStarted?this._mouseDrag(event):this._mouseUp(event)),!this._mouseStarted):this._mouseUp(event)},_mouseUp:function(event){return $(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,event.target==this._mouseDownEvent.target&&$.data(event.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(event)),!1},_mouseDistanceMet:function(event){return Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance},_mouseDelayMet:function(event){return this.mouseDelayMet},_mouseStart:function(event){},_mouseDrag:function(event){},_mouseStop:function(event){},_mouseCapture:function(event){return!0}})})(jQuery)}),define
("jqueryui/draggable",["jquery","jqueryui/core","jqueryui/mouse","jqueryui/widget"],function(jQuery){(function($,undefined){$.widget("ui.draggable",$.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){this.options.helper=="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},destroy:function(){if(!this.element.data("draggable"))return;return this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"
),this._mouseDestroy(),this},_mouseCapture:function(event){var o=this.options;return this.helper||o.disabled||$(event.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(event),this.handle?($(o.iframeFix===!0?"iframe":o.iframeFix).each(function(){$('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css($(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(event){var o=this.options;return this.helper=this._createHelper(event),this._cacheHelperProportions(),$.ui.ddmanager&&($.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this
.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(event),this.originalPageX=event.pageX,this.originalPageY=event.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),o.containment&&this._setContainment(),this._trigger("start",event)===!1?(this._clear(),!1):(this._cacheHelperProportions(),$.ui.ddmanager&&!o.dropBehaviour&&$.ui.ddmanager.prepareOffsets(this,event),this.helper.addClass("ui-draggable-dragging"),this._mouseDrag(event,!0),$.ui.ddmanager&&$.ui.ddmanager.dragStart(this,event),!0)},_mouseDrag:function(event,noPropagation){this.position=this._generatePosition(event),this.positionAbs=this._convertPositionTo("absolute");if(!noPropagation){var ui=this._uiHash();if(this._trigger("drag",event,ui)===!1)return this._mouseUp({}),!1;this.position=ui.position}if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x"
)this.helper[0].style.top=this.position.top+"px";return $.ui.ddmanager&&$.ui.ddmanager.drag(this,event),!1},_mouseStop:function(event){var dropped=!1;$.ui.ddmanager&&!this.options.dropBehaviour&&(dropped=$.ui.ddmanager.drop(this,event)),this.dropped&&(dropped=this.dropped,this.dropped=!1);if((!this.element[0]||!this.element[0].parentNode)&&this.options.helper=="original")return!1;if(this.options.revert=="invalid"&&!dropped||this.options.revert=="valid"&&dropped||this.options.revert===!0||$.isFunction(this.options.revert)&&this.options.revert.call(this.element,dropped)){var self=this;$(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){self._trigger("stop",event)!==!1&&self._clear()})}else this._trigger("stop",event)!==!1&&this._clear();return!1},_mouseUp:function(event){return this.options.iframeFix===!0&&$("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),$.ui.ddmanager&&$.ui.ddmanager.dragStop(this,event),$.ui
.mouse.prototype._mouseUp.call(this,event)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(event){var handle=!this.options.handle||!$(this.options.handle,this.element).length?!0:!1;return $(this.options.handle,this.element).find("*").andSelf().each(function(){this==event.target&&(handle=!0)}),handle},_createHelper:function(event){var o=this.options,helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event])):o.helper=="clone"?this.element.clone().removeAttr("id"):this.element;return helper.parents("body").length||helper.appendTo(o.appendTo=="parent"?this.element[0].parentNode:o.appendTo),helper[0]!=this.element[0]&&!/(fixed|absolute)/.test(helper.css("position"))&&helper.css("position","absolute"),helper},_adjustOffsetFromHelper:function(obj){typeof obj=="string"&&(obj=obj.split(" ")),$.isArray(obj)&&(obj={left:+obj[0],top:+obj[1]||0}),"left"in obj&&(this.offset.click.left=obj.left+this.margins.left
),"right"in obj&&(this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left),"top"in obj&&(this.offset.click.top=obj.top+this.margins.top),"bottom"in obj&&(this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var po=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&$.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(po.left+=this.scrollParent.scrollLeft(),po.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&$.browser.msie)po={top:0,left:0};return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var p=this.element.position();return{top:p.top-(parseInt(this.helper
.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var o=this.options;o.containment=="parent"&&(o.containment=this.helper[0].parentNode);if(o.containment=="document"||o.containment=="window")this.containment=[o.containment=="document"?0:$(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,o.containment=="document"?0:$(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(o.containment=="document"?0:$(window).scrollLeft())+$(o.containment=="document"?
document:window).width()-this.helperProportions.width-this.margins.left,(o.containment=="document"?0:$(window).scrollTop())+($(o.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(o.containment)&&o.containment.constructor!=Array){var c=$(o.containment),ce=c[0];if(!ce)return;var co=c.offset(),over=$(ce).css("overflow")!="hidden";this.containment=[(parseInt($(ce).css("borderLeftWidth"),10)||0)+(parseInt($(ce).css("paddingLeft"),10)||0),(parseInt($(ce).css("borderTopWidth"),10)||0)+(parseInt($(ce).css("paddingTop"),10)||0),(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt($(ce).css("borderLeftWidth"),10)||0)-(parseInt($(ce).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt($(ce).css("borderTopWidth"),10)||0)-(parseInt($(ce).css("paddingBottom"
),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=c}else o.containment.constructor==Array&&(this.containment=o.containment)},_convertPositionTo:function(d,pos){pos||(pos=this.position);var mod=d=="absolute"?1:-1,o=this.options,scroll=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!$.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,scrollIsRootNode=/(html|body)/i.test(scroll[0].tagName);return{top:pos.top+this.offset.relative.top*mod+this.offset.parent.top*mod-($.browser.safari&&$.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():scrollIsRootNode?0:scroll.scrollTop())*mod),left:pos.left+this.offset.relative.left*mod+this.offset.parent.left*mod-($.browser.safari&&$.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())*mod)}},_generatePosition
:function(event){var o=this.options,scroll=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!$.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,scrollIsRootNode=/(html|body)/i.test(scroll[0].tagName),pageX=event.pageX,pageY=event.pageY;if(this.originalPosition){var containment;if(this.containment){if(this.relative_container){var co=this.relative_container.offset();containment=[this.containment[0]+co.left,this.containment[1]+co.top,this.containment[2]+co.left,this.containment[3]+co.top]}else containment=this.containment;event.pageX-this.offset.click.left<containment[0]&&(pageX=containment[0]+this.offset.click.left),event.pageY-this.offset.click.top<containment[1]&&(pageY=containment[1]+this.offset.click.top),event.pageX-this.offset.click.left>containment[2]&&(pageX=containment[2]+this.offset.click.left),event.pageY-this.offset.click.top>containment[3]&&(pageY=containment[3]+this.offset.click.top)}if(o.grid){var top=o.grid[1]?this.originalPageY+
Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY;pageY=containment?top-this.offset.click.top<containment[1]||top-this.offset.click.top>containment[3]?top-this.offset.click.top<containment[1]?top+o.grid[1]:top-o.grid[1]:top:top;var left=o.grid[0]?this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX;pageX=containment?left-this.offset.click.left<containment[0]||left-this.offset.click.left>containment[2]?left-this.offset.click.left<containment[0]?left+o.grid[0]:left-o.grid[0]:left:left}}return{top:pageY-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+($.browser.safari&&$.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():scrollIsRootNode?0:scroll.scrollTop()),left:pageX-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+($.browser.safari&&$.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent
.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(type,event,ui){return ui=ui||this._uiHash(),$.ui.plugin.call(this,type,[event,ui]),type=="drag"&&(this.positionAbs=this._convertPositionTo("absolute")),$.Widget.prototype._trigger.call(this,type,event,ui)},plugins:{},_uiHash:function(event){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),$.extend($.ui.draggable,{version:"1.8.14"}),$.ui.plugin.add("draggable","connectToSortable",{start:function(event,ui){var inst=$(this).data("draggable"),o=inst.options,uiSortable=$.extend({},ui,{item:inst.element});inst.sortables=[],$(o.connectToSortable).each(function(){var sortable=$.data(this,"sortable");sortable&&!sortable.options.disabled&&(inst.sortables.push({instance
:sortable,shouldRevert:sortable.options.revert}),sortable.refreshPositions(),sortable._trigger("activate",event,uiSortable))})},stop:function(event,ui){var inst=$(this).data("draggable"),uiSortable=$.extend({},ui,{item:inst.element});$.each(inst.sortables,function(){this.instance.isOver?(this.instance.isOver=0,inst.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(event),this.instance.options.helper=this.instance.options._helper,inst.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",event,uiSortable))})},drag:function(event,ui){var inst=$(this).data("draggable"),self=this,checkPos=function(o){var dyClick=this.offset.click.top,dxClick=this.offset.click.left,helperTop=this.positionAbs.top,helperLeft=this.positionAbs.left,itemHeight=o.height,itemWidth=o.width,itemTop=o.top,itemLeft=o.left;return $
.ui.isOver(helperTop+dyClick,helperLeft+dxClick,itemTop,itemLeft,itemHeight,itemWidth)};$.each(inst.sortables,function(i){this.instance.positionAbs=inst.positionAbs,this.instance.helperProportions=inst.helperProportions,this.instance.offset.click=inst.offset.click,this.instance._intersectsWith(this.instance.containerCache)?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=$(self).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return ui.helper[0]},event.target=this.instance.currentItem[0],this.instance._mouseCapture(event,!0),this.instance._mouseStart(event,!0,!0),this.instance.offset.click.top=inst.offset.click.top,this.instance.offset.click.left=inst.offset.click.left,this.instance.offset.parent.left-=inst.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=inst.offset.parent.top-this.instance.offset
.parent.top,inst._trigger("toSortable",event),inst.dropped=this.instance.element,inst.currentItem=inst.element,this.instance.fromOutside=inst),this.instance.currentItem&&this.instance._mouseDrag(event)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",event,this.instance._uiHash(this.instance)),this.instance._mouseStop(event,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),inst._trigger("fromSortable",event),inst.dropped=!1)})}}),$.ui.plugin.add("draggable","cursor",{start:function(event,ui){var t=$("body"),o=$(this).data("draggable").options;t.css("cursor")&&(o._cursor=t.css("cursor")),t.css("cursor",o.cursor)},stop:function(event,ui){var o=$(this).data("draggable").options;o._cursor&&$("body").css("cursor",o._cursor)}}),$.ui.plugin.add("draggable","opacity",{start:function(event,ui)
{var t=$(ui.helper),o=$(this).data("draggable").options;t.css("opacity")&&(o._opacity=t.css("opacity")),t.css("opacity",o.opacity)},stop:function(event,ui){var o=$(this).data("draggable").options;o._opacity&&$(ui.helper).css("opacity",o._opacity)}}),$.ui.plugin.add("draggable","scroll",{start:function(event,ui){var i=$(this).data("draggable");i.scrollParent[0]!=document&&i.scrollParent[0].tagName!="HTML"&&(i.overflowOffset=i.scrollParent.offset())},drag:function(event,ui){var i=$(this).data("draggable"),o=i.options,scrolled=!1;if(i.scrollParent[0]!=document&&i.scrollParent[0].tagName!="HTML"){if(!o.axis||o.axis!="x")i.overflowOffset.top+i.scrollParent[0].offsetHeight-event.pageY<o.scrollSensitivity?i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop+o.scrollSpeed:event.pageY-i.overflowOffset.top<o.scrollSensitivity&&(i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop-o.scrollSpeed);if(!o.axis||o.axis!="y")i.overflowOffset.left+i.scrollParent[0].offsetWidth-event
.pageX<o.scrollSensitivity?i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft+o.scrollSpeed:event.pageX-i.overflowOffset.left<o.scrollSensitivity&&(i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft-o.scrollSpeed)}else{if(!o.axis||o.axis!="x")event.pageY-$(document).scrollTop()<o.scrollSensitivity?scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed):$(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity&&(scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed));if(!o.axis||o.axis!="y")event.pageX-$(document).scrollLeft()<o.scrollSensitivity?scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed):$(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity&&(scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed))}scrolled!==!1&&$.ui.ddmanager&&!o.dropBehaviour&&$.ui.ddmanager.prepareOffsets(i,event)}}),$.ui.plugin.add("draggable","snap",{start:function(event
,ui){var i=$(this).data("draggable"),o=i.options;i.snapElements=[],$(o.snap.constructor!=String?o.snap.items||":data(draggable)":o.snap).each(function(){var $t=$(this),$o=$t.offset();this!=i.element[0]&&i.snapElements.push({item:this,width:$t.outerWidth(),height:$t.outerHeight(),top:$o.top,left:$o.left})})},drag:function(event,ui){var inst=$(this).data("draggable"),o=inst.options,d=o.snapTolerance,x1=ui.offset.left,x2=x1+inst.helperProportions.width,y1=ui.offset.top,y2=y1+inst.helperProportions.height;for(var i=inst.snapElements.length-1;i>=0;i--){var l=inst.snapElements[i].left,r=l+inst.snapElements[i].width,t=inst.snapElements[i].top,b=t+inst.snapElements[i].height;if(!(l-d<x1&&x1<r+d&&t-d<y1&&y1<b+d||l-d<x1&&x1<r+d&&t-d<y2&&y2<b+d||l-d<x2&&x2<r+d&&t-d<y1&&y1<b+d||l-d<x2&&x2<r+d&&t-d<y2&&y2<b+d)){inst.snapElements[i].snapping&&inst.options.snap.release&&inst.options.snap.release.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})),inst.snapElements[i]
.snapping=!1;continue}if(o.snapMode!="inner"){var ts=Math.abs(t-y2)<=d,bs=Math.abs(b-y1)<=d,ls=Math.abs(l-x2)<=d,rs=Math.abs(r-x1)<=d;ts&&(ui.position.top=inst._convertPositionTo("relative",{top:t-inst.helperProportions.height,left:0}).top-inst.margins.top),bs&&(ui.position.top=inst._convertPositionTo("relative",{top:b,left:0}).top-inst.margins.top),ls&&(ui.position.left=inst._convertPositionTo("relative",{top:0,left:l-inst.helperProportions.width}).left-inst.margins.left),rs&&(ui.position.left=inst._convertPositionTo("relative",{top:0,left:r}).left-inst.margins.left)}var first=ts||bs||ls||rs;if(o.snapMode!="outer"){var ts=Math.abs(t-y1)<=d,bs=Math.abs(b-y2)<=d,ls=Math.abs(l-x1)<=d,rs=Math.abs(r-x2)<=d;ts&&(ui.position.top=inst._convertPositionTo("relative",{top:t,left:0}).top-inst.margins.top),bs&&(ui.position.top=inst._convertPositionTo("relative",{top:b-inst.helperProportions.height,left:0}).top-inst.margins.top),ls&&(ui.position.left=inst._convertPositionTo("relative",{top:0,left:l}
).left-inst.margins.left),rs&&(ui.position.left=inst._convertPositionTo("relative",{top:0,left:r-inst.helperProportions.width}).left-inst.margins.left)}!inst.snapElements[i].snapping&&(ts||bs||ls||rs||first)&&inst.options.snap.snap&&inst.options.snap.snap.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})),inst.snapElements[i].snapping=ts||bs||ls||rs||first}}}),$.ui.plugin.add("draggable","stack",{start:function(event,ui){var o=$(this).data("draggable").options,group=$.makeArray($(o.stack)).sort(function(a,b){return(parseInt($(a).css("zIndex"),10)||0)-(parseInt($(b).css("zIndex"),10)||0)});if(!group.length)return;var min=parseInt(group[0].style.zIndex)||0;$(group).each(function(i){this.style.zIndex=min+i}),this[0].style.zIndex=min+group.length}}),$.ui.plugin.add("draggable","zIndex",{start:function(event,ui){var t=$(ui.helper),o=$(this).data("draggable").options;t.css("zIndex")&&(o._zIndex=t.css("zIndex")),t.css("zIndex",o.zIndex)},stop:function(event,
ui){var o=$(this).data("draggable").options;o._zIndex&&$(ui.helper).css("zIndex",o._zIndex)}})})(jQuery)}),define("views/editmapview",["jquery","underscore","backbone","app","views/dummyoverlayview","jqueryui/autocomplete","jqueryui/draggable","async!http://maps.google.com/maps/api/js?sensor=false&region=AU"],function($,_,Backbone,app,DummyOverlayView){var EditMapView=Backbone.View.extend({id:"location-fieldset",initialize:function(options){this.observation=options.observation,this.mapMarker=null,this.zIndex=0},render:function(){return this._initMap(),this._initAddressField(),this._initLocationPin(),this},_initMap:function(){var g=google.maps,mapSettings={center:new g.LatLng(-29.191427,134.472126),zoom:4,panControl:!1,streetViewControl:!1,mapTypeControl:!0,scrollwheel:!1,mapTypeId:g.MapTypeId.TERRAIN};this.map=new g.Map(document.getElementById("location-map"),mapSettings),this.iw=new g.InfoWindow,this.geocoder=new g.Geocoder,this.dummy=new DummyOverlayView(this.map)},_initAddressField:function(
){var self=this;this.$el.find("#Address").autocomplete({source:function(request,response){self.geocoder.geocode({address:request.term,region:"AU"},function(results,status){response($.map(results,function(item){return{label:item.formatted_address,value:item.formatted_address,latitude:item.geometry.location.lat(),longitude:item.geometry.location.lng()}}))})},select:function(event,ui){var location=new google.maps.LatLng(ui.item.latitude,ui.item.longitude);self._positionMarker(location),self._removeMarkerFromPlaceholder(),self._reverseGeocode();var position=self.mapMarker.getPosition(),newPoint=new google.maps.LatLng(position.lat()+.02,position.lng());self.map.panTo(newPoint)}})},_initLocationPin:function(){var self=this;$("#location-pin").draggable({stop:function(event,ui){var $mapDiv=$(self.map.getDiv()),mapDivLeft=$mapDiv.offset().left,mapDivTop=$mapDiv.offset().top,mapDivWidth=$mapDiv.width(),mapDivHeight=$mapDiv.height(),locationPinLeft=ui.helper.offset().left,locationPinTop=ui.helper.
offset().top,locationPinWidth=ui.helper.width(),locationPinHeight=ui.helper.height(),locationX=locationPinLeft+locationPinWidth/2,locationY=locationPinTop+locationPinHeight/2-6;if(locationX>mapDivLeft&&locationX<mapDivLeft+mapDivWidth&&locationY>mapDivTop&&locationY<mapDivTop+mapDivHeight){var g=google.maps,pixelpoint=new g.Point(locationX-mapDivLeft,locationY-mapDivTop+locationPinHeight/2),proj=self.dummy.getProjection(),latlng=proj.fromContainerPixelToLatLng(pixelpoint);self._positionMarker(latlng),self._removeMarkerFromPlaceholder(),self._reverseGeocode()}}})},_positionMarker:function(point){this.mapMarker&&(this.mapMarker.setMap(null),this.mapMarker=null);var g=google.maps,image=new g.MarkerImage("http://maps.gstatic.com/mapfiles/ms/icons/blue-dot.png",new g.Size(32,32),new g.Point(0,0),new g.Point(15,32)),shadow=new g.MarkerImage("http://maps.gstatic.com/mapfiles/kml/paddle/A_maps.shadow.png",new g.Size(59,32),new g.Point(0,0),new g.Point(15,32));this.mapMarker=new g.Marker({position
:point,map:this.map,clickable:!0,draggable:!0,raiseOnDrag:!1,icon:image,shadow:shadow,zIndex:this._highestOrder()});var self=this;g.event.addListener(this.mapMarker,"drag",function(){self._displayLatLong(!1)}),g.event.addListener(this.mapMarker,"dragstart",function(){self.zIndex++,self.mapMarker.setZIndex(self._highestOrder())}),g.event.addListener(this.mapMarker,"dragend",function(){self._displayLatLong(!0),self._reverseGeocode()}),this._displayLatLong()},_highestOrder:function(){return this.zIndex},changeMarkerPosition:function(lat,long){var latlng=new google.maps.LatLng(lat,long);this.mapMarker===null?(this._positionMarker(latlng),this._removeMarkerFromPlaceholder(),this._reverseGeocode()):(this._positionMarker(latlng),this._reverseGeocode());if(!this.map.getBounds().contains(this.mapMarker.getPosition())){var position=this.mapMarker.getPosition(),newPoint=new google.maps.LatLng(position.lat()+.02,position.lng());this.map.panTo(newPoint)}},_displayLatLong:function(fireLatLongFieldsChangeEvent
){if(!this.mapMarker)return;var lat=this.mapMarker.getPosition().lat(),lng=this.mapMarker.getPosition().lng();$("#Latitude").val(lat),$("#Longitude").val(lng),fireLatLongFieldsChangeEvent&&$("#Longitude").change()},_removeMarkerFromPlaceholder:function(){$("#location-pin").remove()},_reverseGeocode:function(){this.mapMarker&&this.geocoder.geocode({latLng:this.mapMarker.getPosition()},this._reverseGeocodeResult)},_reverseGeocodeResult:function(results,status){if(status=="OK")if(results.length==0)$("#Address").val("");else{var addressResult=results[0].formatted_address;$("#Address").val(addressResult)}else $("#Address").val("");$("#Address").change()}});return EditMapView}),define("models/mediaresource",["jquery","underscore","backbone"],function($,_,Backbone){var MediaResource=Backbone.Model.extend({defaults:{Key:0,MediumImageUri:"/img/image-upload.png"},idAttribute:"Id"});return MediaResource}),define("views/mediaresourceitemview",["jquery","underscore","backbone","app","ich"],function(
$,_,Backbone,app,ich){var MediaResourceItemView=Backbone.View.extend({className:"media-resource-uploaded",events:{"click .view-media-resource-button":"viewMediaResource","click .add-caption-button":"viewMediaResource","click .remove-media-resource-button":"removeMediaResource"},initialize:function(options){_.extend(this,Backbone.Events),_.bindAll(this,"showTempMedia","showUploadedMedia","removeMediaResource"),this.model.on("change:Files",this.showUploadedMedia)},render:function(){return this.$el.append(ich.ObservationMediaResourceUploaded(this.model.toJSON())).css({position:"absolute",top:"-250px"}),this},viewMediaResource:function(){alert("Coming soon")},removeMediaResource:function(){this.trigger("mediaresourceview:remove",this.model,this)},showTempMedia:function(img){var $image=$(img);this.$el.find("div:first-child img").replaceWith($image),this.$el.width($image.width()),this.imageWidth=$image.width()},showUploadedMedia:function(mediaResource){log("showing uploaded media",mediaResource
),this.$el.find("div:first-child img").replaceWith($('<img src="'+mediaResource.get("Files").FullMedium.RelativeUri+'" alt="" />'))}});return MediaResourceItemView}),function($){var loadImage=function(file,callback,options){var img=document.createElement("img"),url,oUrl;return img.onerror=callback,img.onload=function(){oUrl&&loadImage.revokeObjectURL(oUrl),callback(loadImage.scale(img,options))},window.Blob&&file instanceof Blob||window.File&&file instanceof File?url=oUrl=loadImage.createObjectURL(file):url=file,url?(img.src=url,img):loadImage.readFile(file,function(url){img.src=url})},urlAPI=window.createObjectURL&&window||window.URL&&URL||window.webkitURL&&webkitURL;loadImage.scale=function(img,options){options=options||{};var canvas=document.createElement("canvas"),width=img.width,height=img.height,scale=Math.max((options.minWidth||width)/width,(options.minHeight||height)/height);return scale>1&&(width=parseInt(width*scale,10),height=parseInt(height*scale,10)),scale=Math.min((options
.maxWidth||width)/width,(options.maxHeight||height)/height),scale<1&&(width=parseInt(width*scale,10),height=parseInt(height*scale,10)),img.getContext||options.canvas&&canvas.getContext?(canvas.width=width,canvas.height=height,canvas.getContext("2d").drawImage(img,0,0,width,height),canvas):(img.width=width,img.height=height,img)},loadImage.createObjectURL=function(file){return urlAPI?urlAPI.createObjectURL(file):!1},loadImage.revokeObjectURL=function(url){return urlAPI?urlAPI.revokeObjectURL(url):!1},loadImage.readFile=function(file,callback){if(window.FileReader&&FileReader.prototype.readAsDataURL){var fileReader=new FileReader;return fileReader.onload=function(e){callback(e.target.result)},fileReader.readAsDataURL(file),fileReader}return!1},typeof define!="undefined"&&define.amd?define("loadimage",[],function(){return loadImage}):$.loadImage=loadImage}(this),function(factory){typeof define=="function"&&define.amd?define("fileupload",["jquery","jqueryui/widget"],factory):factory(window.
jQuery)}(function($){$.widget("blueimp.fileupload",{options:{namespace:undefined,dropZone:$(document),fileInput:undefined,replaceFileInput:!0,paramName:undefined,singleFileUploads:!0,limitMultiFileUploads:undefined,sequentialUploads:!1,limitConcurrentUploads:undefined,forceIframeTransport:!1,redirect:undefined,redirectParamName:undefined,postMessage:undefined,multipart:!0,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:!0,formData:function(form){return form.serializeArray()},add:function(e,data){data.submit()},processData:!1,contentType:!1,cache:!1},_refreshOptionsList:["namespace","dropZone","fileInput"],_isXHRUpload:function(options){var undef="undefined";return!options.forceIframeTransport&&typeof XMLHttpRequestUpload!==undef&&typeof File!==undef&&(!options.multipart||typeof FormData!==undef)},_getFormData:function(options){var formData;return typeof options.formData=="function"?options.formData(options.form):$.isArray(options.formData)?options.formData:options.formData?
(formData=[],$.each(options.formData,function(name,value){formData.push({name:name,value:value})}),formData):[]},_getTotal:function(files){var total=0;return $.each(files,function(index,file){total+=file.size||1}),total},_onProgress:function(e,data){if(e.lengthComputable){var total=data.total||this._getTotal(data.files),loaded=parseInt(e.loaded/e.total*(data.chunkSize||total),10)+(data.uploadedBytes||0);this._loaded+=loaded-(data.loaded||data.uploadedBytes||0),data.lengthComputable=!0,data.loaded=loaded,data.total=total,this._trigger("progress",e,data),this._trigger("progressall",e,{lengthComputable:!0,loaded:this._loaded,total:this._total})}},_initProgressListener:function(options){var that=this,xhr=options.xhr?options.xhr():$.ajaxSettings.xhr();xhr.upload&&($(xhr.upload).bind("progress",function(e){var oe=e.originalEvent;e.lengthComputable=oe.lengthComputable,e.loaded=oe.loaded,e.total=oe.total,that._onProgress(e,options)}),options.xhr=function(){return xhr})},_initXHRData:function(options
){var formData,file=options.files[0];if(!options.multipart||options.blob)options.headers=$.extend(options.headers,{"X-File-Name":file.name,"X-File-Type":file.type,"X-File-Size":file.size}),options.blob?options.multipart||(options.contentType="application/octet-stream",options.data=options.blob):(options.contentType=file.type,options.data=file);options.multipart&&typeof FormData!="undefined"&&(options.postMessage?(formData=this._getFormData(options),options.blob?formData.push({name:options.paramName,value:options.blob}):$.each(options.files,function(index,file){formData.push({name:options.paramName,value:file})})):(options.formData instanceof FormData?formData=options.formData:(formData=new FormData,$.each(this._getFormData(options),function(index,field){formData.append(field.name,field.value)})),options.blob?formData.append(options.paramName,options.blob,file.name):$.each(options.files,function(index,file){file instanceof Blob&&formData.append(options.paramName,file,file.name)})),options
.data=formData),options.blob=null},_initIframeSettings:function(options){options.dataType="iframe "+(options.dataType||""),options.formData=this._getFormData(options),options.redirect&&$("<a></a>").prop("href",options.url).prop("host")!==location.host&&options.formData.push({name:options.redirectParamName||"redirect",value:options.redirect})},_initDataSettings:function(options){this._isXHRUpload(options)?(this._chunkedUpload(options,!0)||(options.data||this._initXHRData(options),this._initProgressListener(options)),options.postMessage&&(options.dataType="postmessage "+(options.dataType||""))):this._initIframeSettings(options,"iframe")},_initFormSettings:function(options){if(!options.form||!options.form.length)options.form=$(options.fileInput.prop("form"));options.paramName||(options.paramName=options.fileInput.prop("name")||"files[]"),options.url||(options.url=options.form.prop("action")||location.href),options.type=(options.type||options.form.prop("method")||"").toUpperCase(),options.type!=="POST"&&
options.type!=="PUT"&&(options.type="POST")},_getAJAXSettings:function(data){var options=$.extend({},this.options,data);return this._initFormSettings(options),this._initDataSettings(options),options},_enhancePromise:function(promise){return promise.success=promise.done,promise.error=promise.fail,promise.complete=promise.always,promise},_getXHRPromise:function(resolveOrReject,context,args){var dfd=$.Deferred(),promise=dfd.promise();return context=context||this.options.context||promise,resolveOrReject===!0?dfd.resolveWith(context,args):resolveOrReject===!1&&dfd.rejectWith(context,args),promise.abort=dfd.promise,this._enhancePromise(promise)},_chunkedUpload:function(options,testOnly){var that=this,file=options.files[0],fs=file.size,ub=options.uploadedBytes=options.uploadedBytes||0,mcs=options.maxChunkSize||fs,slice=file.webkitSlice||file.mozSlice||file.slice,upload,n,jqXHR,pipe;return!(this._isXHRUpload(options)&&slice&&(ub||mcs<fs))||options.data?!1:testOnly?!0:ub>=fs?(file.error="uploadedBytes"
,this._getXHRPromise(!1,options.context,[null,"error",file.error])):(n=Math.ceil((fs-ub)/mcs),upload=function(i){return i?upload(i-=1).pipe(function(){var o=$.extend({},options);return o.blob=slice.call(file,ub+i*mcs,ub+(i+1)*mcs),o.chunkSize=o.blob.size,that._initXHRData(o),that._initProgressListener(o),jqXHR=($.ajax(o)||that._getXHRPromise(!1,o.context)).done(function(){o.loaded||that._onProgress($.Event("progress",{lengthComputable:!0,loaded:o.chunkSize,total:o.chunkSize}),o),options.uploadedBytes=o.uploadedBytes+=o.chunkSize}),jqXHR}):that._getXHRPromise(!0,options.context)},pipe=upload(n),pipe.abort=function(){return jqXHR.abort()},this._enhancePromise(pipe))},_beforeSend:function(e,data){this._active===0&&this._trigger("start"),this._active+=1,this._loaded+=data.uploadedBytes||0,this._total+=this._getTotal(data.files)},_onDone:function(result,textStatus,jqXHR,options){this._isXHRUpload(options)||this._onProgress($.Event("progress",{lengthComputable:!0,loaded:1,total:1}),options),options
.result=result,options.textStatus=textStatus,options.jqXHR=jqXHR,this._trigger("done",null,options)},_onFail:function(jqXHR,textStatus,errorThrown,options){options.jqXHR=jqXHR,options.textStatus=textStatus,options.errorThrown=errorThrown,this._trigger("fail",null,options),options.recalculateProgress&&(this._loaded-=options.loaded||options.uploadedBytes||0,this._total-=options.total||this._getTotal(options.files))},_onAlways:function(jqXHRorResult,textStatus,jqXHRorError,options){this._active-=1,options.textStatus=textStatus,jqXHRorError&&jqXHRorError.always?(options.jqXHR=jqXHRorError,options.result=jqXHRorResult):(options.jqXHR=jqXHRorResult,options.errorThrown=jqXHRorError),this._trigger("always",null,options),this._active===0&&(this._trigger("stop"),this._loaded=this._total=0)},_onSend:function(e,data){var that=this,jqXHR,slot,pipe,options=that._getAJAXSettings(data),send=function(resolve,args){return that._sending+=1,jqXHR=jqXHR||(resolve!==!1&&that._trigger("send",e,options)!==!1&&
(that._chunkedUpload(options)||$.ajax(options))||that._getXHRPromise(!1,options.context,args)).done(function(result,textStatus,jqXHR){that._onDone(result,textStatus,jqXHR,options)}).fail(function(jqXHR,textStatus,errorThrown){that._onFail(jqXHR,textStatus,errorThrown,options)}).always(function(jqXHRorResult,textStatus,jqXHRorError){that._sending-=1,that._onAlways(jqXHRorResult,textStatus,jqXHRorError,options);if(options.limitConcurrentUploads&&options.limitConcurrentUploads>that._sending){var nextSlot=that._slots.shift();while(nextSlot){if(!nextSlot.isRejected()){nextSlot.resolve();break}nextSlot=that._slots.shift()}}}),jqXHR};return this._beforeSend(e,options),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(slot=$.Deferred(),this._slots.push(slot),pipe=slot.pipe(send)):pipe=this._sequence=this._sequence.pipe(send,send),pipe.abort=function(){var args=[undefined,"abort","abort"
];return jqXHR?jqXHR.abort():(slot&&slot.rejectWith(args),send(!1,args))},this._enhancePromise(pipe)):send()},_onAdd:function(e,data){var that=this,result=!0,options=$.extend({},this.options,data),limit=options.limitMultiFileUploads,fileSet,i;if(!options.singleFileUploads&&!limit||!this._isXHRUpload(options))fileSet=[data.files];else if(!options.singleFileUploads&&limit){fileSet=[];for(i=0;i<data.files.length;i+=limit)fileSet.push(data.files.slice(i,i+limit))}return data.originalFiles=data.files,$.each(fileSet||data.files,function(index,element){var files=fileSet?element:[element],newData=$.extend({},data,{files:files});return newData.submit=function(){return newData.jqXHR=this.jqXHR=that._trigger("submit",e,this)!==!1&&that._onSend(e,this),this.jqXHR},result=that._trigger("add",e,newData)}),result},_normalizeFile:function(index,file){file.name===undefined&&file.size===undefined&&(file.name=file.fileName,file.size=file.fileSize)},_replaceFileInput:function(input){var inputClone=input.clone
(!0);$("<form></form>").append(inputClone)[0].reset(),input.after(inputClone).detach(),$.cleanData(input.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(i,el){return el===input[0]?inputClone[0]:el}),input[0]===this.element[0]&&(this.element=inputClone)},_onChange:function(e){var that=e.data.fileupload,data={files:$.each($.makeArray(e.target.files),that._normalizeFile),fileInput:$(e.target),form:$(e.target.form)};data.files.length||(data.files=[{name:e.target.value.replace(/^.*\\/,"")}]),that.options.replaceFileInput&&that._replaceFileInput(data.fileInput);if(that._trigger("change",e,data)===!1||that._onAdd(e,data)===!1)return!1},_onPaste:function(e){var that=e.data.fileupload,cbd=e.originalEvent.clipboardData,items=cbd&&cbd.items||[],data={files:[]};$.each(items,function(index,item){var file=item.getAsFile&&item.getAsFile();file&&data.files.push(file)});if(that._trigger("paste",e,data)===!1||that._onAdd(e,data)===!1)return!1},_onDrop:function(e){var that=e.data
.fileupload,dataTransfer=e.dataTransfer=e.originalEvent.dataTransfer,data={files:$.each($.makeArray(dataTransfer&&dataTransfer.files),that._normalizeFile)};if(that._trigger("drop",e,data)===!1||that._onAdd(e,data)===!1)return!1;e.preventDefault()},_onDragOver:function(e){var that=e.data.fileupload,dataTransfer=e.dataTransfer=e.originalEvent.dataTransfer;if(that._trigger("dragover",e)===!1)return!1;dataTransfer&&(dataTransfer.dropEffect=dataTransfer.effectAllowed="copy"),e.preventDefault()},_initEventHandlers:function(){var ns=this.options.namespace;this.options.dropZone.bind("dragover."+ns,{fileupload:this},this._onDragOver).bind("drop."+ns,{fileupload:this},this._onDrop).bind("paste."+ns,{fileupload:this},this._onPaste),this.options.fileInput.bind("change."+ns,{fileupload:this},this._onChange)},_destroyEventHandlers:function(){var ns=this.options.namespace;this.options.dropZone.unbind("dragover."+ns,this._onDragOver).unbind("drop."+ns,this._onDrop).unbind("paste."+ns,this._onPaste),this
.options.fileInput.unbind("change."+ns,this._onChange)},_setOption:function(key,value){var refresh=$.inArray(key,this._refreshOptionsList)!==-1;refresh&&this._destroyEventHandlers(),$.Widget.prototype._setOption.call(this,key,value),refresh&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var options=this.options;options.fileInput===undefined?options.fileInput=this.element.is("input:file")?this.element:this.element.find("input:file"):options.fileInput instanceof $||(options.fileInput=$(options.fileInput)),options.dropZone instanceof $||(options.dropZone=$(options.dropZone))},_create:function(){var options=this.options,dataOpts=$.extend({},this.element.data());dataOpts[this.widgetName]=undefined,$.extend(options,dataOpts),options.namespace=options.namespace||this.widgetName,this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=this._loaded=this._total=0,this._initEventHandlers()},destroy:function(
){this._destroyEventHandlers(),$.Widget.prototype.destroy.call(this)},enable:function(){$.Widget.prototype.enable.call(this),this._initEventHandlers()},disable:function(){this._destroyEventHandlers(),$.Widget.prototype.disable.call(this)},add:function(data){if(!data||this.options.disabled)return;data.files=$.each($.makeArray(data.files),this._normalizeFile),this._onAdd(null,data)},send:function(data){if(data&&!this.options.disabled){data.files=$.each($.makeArray(data.files),this._normalizeFile);if(data.files.length)return this._onSend(null,data)}return this._getXHRPromise(!1,data&&data.context)}})}),define("views/editmediaview",["jquery","underscore","backbone","app","models/mediaresource","views/mediaresourceitemview","loadimage","fileupload"],function($,_,Backbone,app,MediaResource,MediaResourceItemView,loadImage){var EditMediaView=Backbone.View.extend({id:"media-resources-fieldset",initialize:function(options){log("ediMediaView:initialize"),_.extend(this,Backbone.Events),_.bindAll(this
,"render","_initMediaUploader","_onUploadDone","_onSubmitUpload","_onUploadAdd"),this.mediaResourceItemViews=[],this.currentUploadKey=0},render:function(){return log("ediMediaView:render"),this._initMediaUploader(),this},_initMediaUploader:function(){log("ediMediaView:_initMediaUploader"),$("#fileupload").fileupload({dataType:"json",paramName:"file",url:"/mediaresources/observationupload",add:this._onUploadAdd,submit:this._onSubmitUpload,done:this._onUploadDone})},filesAdded:0,_onUploadAdd:function(e,data){log("ediMediaView:_onUploadAdd"),this.currentUploadKey++;var mediaResource=new MediaResource({Key:this.currentUploadKey.toString()});this.model.addMediaResource(mediaResource);var mediaResourceItemView=new MediaResourceItemView({model:mediaResource});mediaResourceItemView.on("mediaresourceview:remove",this._onMediaResourceViewRemove),this.mediaResourceItemViews.push(mediaResourceItemView),this.$el.find("#media-resource-add-pane").before(mediaResourceItemView.render().el);var self=this
,tempImage=loadImage(data.files[0],function(img){img.type!=="error"&&(self.filesAdded++,mediaResourceItemView.showTempMedia(img),self._showMediaResourceItemView(self,mediaResourceItemView,$(img).width(),self.filesAdded===data.originalFiles.length))},{maxHeight:220});tempImage||($(mediaResourceItemView.el).width(280),this.filesAdded++,this._showMediaResourceItemView(this,mediaResourceItemView,280,this.filesAdded===data.originalFiles.length)),data.submit()},_showMediaResourceItemView:function(self,mediaResourceItemView,imageWidth,beginAnimation){log("ediMediaView:_showMediaResourceItemView"),self.$el.find("#media-resource-items").queue("mediaQueue",function(next){self.$el.find("#media-resource-add-pane").animate({left:(imageWidth+15).toString()+"px"},{duration:800,queue:!1,easing:"swing",step:function(){$("#media-resource-items").animate({scrollLeft:1e4},1)},complete:next})}).queue("mediaQueue",function(next){$(mediaResourceItemView.el).animate({top:"+=250px"},{duration:800,easing:"swing"
,queue:!1,complete:next})}).queue("mediaQueue",function(next){self.$el.find("#media-resource-add-pane").css({left:""}),$(mediaResourceItemView.el).css({position:"relative",top:""}),$("#media-resource-items").animate({scrollLeft:1e4},1),next()}),beginAnimation&&(log("beginnning animation"),self.filesAdded=0,self.$el.find("#media-resource-items").dequeue("mediaQueue"))},_onMediaResourceViewRemove:function(model,view){log("ediMediaView:_onMediaResourceViewRemove"),this.model.removeMediaResource(model.id),view.remove()},_onSubmitUpload:function(e,data){log("ediMediaView:_onSubmitUpload"),data.formData={Key:this.currentUploadKey,OriginalFileName:data.files[0].name}},_onUploadDone:function(e,data){log("ediMediaView:_onUploadDone",this.model);var mediaResource=this.model.mediaResources.find(function(item){return item.get("Key")===data.result.Key});mediaResource.set(data.result)}});return EditMediaView}),define("datepicker",["jquery","date"],function(jQuery){!function($){function clearDatePickers
(except){var ii;for(ii=0;ii<all.length;ii++)all[ii]!=except&&all[ii].hide()}function DatePicker(element,options){this.$el=$(element),this.proxy("show").proxy("ahead").proxy("hide").proxy("keyHandler").proxy("selectDate");var options=$.extend({},$.fn.datepicker.defaults,options);if(!!options.parse||!!options.format||!this.detectNative())$.extend(this,options),this.$el.data("datepicker",this),all.push(this),this.init()}var selector="[data-datepicker]",all=[];DatePicker.prototype={detectNative:function(el){if(navigator.userAgent.match(/(iPad|iPhone); CPU(\ iPhone)? OS 5_\d/i)){var $marker=$("<span>").insertBefore(this.$el);return this.$el.detach().attr("type","date").insertAfter($marker),$marker.remove(),!0}return!1},init:function(){var $months=this.nav("months",1),$years=this.nav("years",12),$nav=$("<div>").addClass("nav").append($months,$years);this.$month=$(".name",$months),this.$year=$(".name",$years),$calendar=$("<div>").addClass("calendar");for(var i=0;i<this.shortDayNames.length;i++
)$calendar.append('<div class="dow">'+this.shortDayNames[(i+this.startOfWeek)%7]+"</div>");this.$days=$("<div>").addClass("days"),$calendar.append(this.$days),this.$picker=$("<div>").click(function(e){e.stopPropagation()}).mousedown(function(e){e.preventDefault()}).addClass("datepicker").append($nav,$calendar).insertAfter(this.$el),this.$el.focus(this.show).click(this.show).change($.proxy(function(){this.selectDate()},this)),this.selectDate(),this.hide()},nav:function(c,months){var $subnav=$('<div><button type="button" class="prev button"><i></i> &larr;</button><span class="name"></span><button type="button" class="next button"><i></i> &rarr;</button></div>').addClass(c);return $(".prev",$subnav).click($.proxy(function(){this.ahead(-months,0)},this)),$(".next",$subnav).click($.proxy(function(){this.ahead(months,0)},this)),$subnav},updateName:function($area,s){var cur=$area.find(".fg").text(),$fg=$("<div>").addClass("fg").append(s);$area.empty();if(cur!=s){var $bg=$("<div>").addClass("bg"
);$area.append($bg,$fg),$bg.fadeOut("slow",function(){$(this).remove()})}else $area.append($fg)},selectMonth:function(date){var newMonth=new Date(date.getFullYear(),date.getMonth(),1);if(!this.curMonth||this.curMonth.getFullYear()!=newMonth.getFullYear()||this.curMonth.getMonth()!=newMonth.getMonth()){this.curMonth=newMonth;var rangeStart=this.rangeStart(date),rangeEnd=this.rangeEnd(date),num_days=this.daysBetween(rangeStart,rangeEnd);this.$days.empty();for(var ii=0;ii<=num_days;ii++){var thisDay=new Date(rangeStart.getFullYear(),rangeStart.getMonth(),rangeStart.getDate()+ii,12,0),$day=$("<div>").attr("date",this.format(thisDay));$day.text(thisDay.getDate()),thisDay.getMonth()!=date.getMonth()&&$day.addClass("overlap"),this.$days.append($day)}this.updateName(this.$month,this.monthNames[date.getMonth()]),this.updateName(this.$year,this.curMonth.getFullYear()),$("div",this.$days).click($.proxy(function(e){var $targ=$(e.target);this.update($targ.attr("date")),$targ.hasClass("overlap")||this
.hide()},this)),$("[date='"+this.format(new Date)+"']",this.$days).addClass("today")}$(".selected",this.$days).removeClass("selected"),$('[date="'+this.selectedDateStr+'"]',this.$days).addClass("selected")},selectDate:function(date){typeof date=="undefined"&&(date=this.parse(this.$el.val())),date||(date=new Date),this.selectedDate=date,this.selectedDateStr=this.format(this.selectedDate),this.selectMonth(this.selectedDate)},update:function(s){this.$el.val(s).change()},show:function(e){e&&e.stopPropagation(),clearDatePickers(this);var offset=this.$el.offset();this.$picker.show(),$("html").on("keydown",this.keyHandler)},hide:function(){this.$picker.hide(),$("html").off("keydown",this.keyHandler)},keyHandler:function(e){switch(e.keyCode){case 9:case 27:this.hide();return;case 13:this.update(this.selectedDateStr),this.hide();break;case 38:this.ahead(0,-7);break;case 40:this.ahead(0,7);break;case 37:this.ahead(0,-1);break;case 39:this.ahead(0,1);break;default:return}e.preventDefault()},parse:
function(s){return Date.parseExact(s,"d MMM yyyy")},format:function(date){return date.toString("d MMM yyyy")},ahead:function(months,days){this.selectDate(new Date(this.selectedDate.getFullYear(),this.selectedDate.getMonth()+months,this.selectedDate.getDate()+days))},proxy:function(meth){return this[meth]=$.proxy(this[meth],this),this},daysBetween:function(start,end){var start=Date.UTC(start.getFullYear(),start.getMonth(),start.getDate()),end=Date.UTC(end.getFullYear(),end.getMonth(),end.getDate());return(end-start)/864e5},findClosest:function(dow,date,direction){var difference=direction*(Math.abs(date.getDay()-dow-direction*7)%7);return new Date(date.getFullYear(),date.getMonth(),date.getDate()+difference)},rangeStart:function(date){return this.findClosest(this.startOfWeek,new Date(date.getFullYear(),date.getMonth()),-1)},rangeEnd:function(date){return this.findClosest((this.startOfWeek-1)%7,new Date(date.getFullYear(),date.getMonth()+1,0),1)}},$.fn.datepicker=function(options){return this
.each(function(){new DatePicker(this,options)})},$(function(){$(selector).datepicker(),$("html").click(clearDatePickers)}),$.fn.datepicker.DatePicker=DatePicker,$.fn.datepicker.defaults={monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],shortDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],startOfWeek:1}}(window.jQuery||window.ender)}),define("multiselect",["jquery"],function(jQuery){jQuery&&function($){function renderOption(id,option){var html='<label><input style="display:none;" type="checkbox" name="'+id+'[]" value="'+option.value+'"';return option.selected&&(html+=' checked="checked"'),html+=" />"+option.text+"</label>",html}function renderOptions(id,options,o){var html="";for(var i=0;i<options.length;i++)options[i].optgroup?(html+='<label class="optGroup">',o.optGroupSelectable?html+='<input type="checkbox" class="optGroup" />'+options[i].optgroup:html+=options[i].optgroup,html+='</label><div class="optGroupContainer">'
,html+=renderOptions(id,options[i].options,o),html+="</div>"):html+=o.renderOption(id,options[i]);return options.length==0&&(html+='<label style="padding:0 13px">'+(o.noOptionsText?o.noOptionsText:"-")+"</label>"),html}function buildOptions(options){var multiSelect=$(this),multiSelectOptions=multiSelect.next(".multiSelectOptions"),o=multiSelect.data("config"),callback=multiSelect.data("callback");multiSelectOptions.html("");var html="";o.messageText&&(html+='<div class="selectMessage">'+o.messageText+"</div>"),o.selectAll&&(html+='<label class="selectAll"><input type="checkbox" class="selectAll" />'+o.selectAllText+"</label>"),html+=renderOptions(multiSelect.attr("id"),options,o),multiSelectOptions.html(html);var initialWidth=multiSelectOptions.width(),hasScrollbar=!1;multiSelectOptions.height()>o.listHeight?(multiSelectOptions.css("height",o.listHeight+"px"),hasScrollbar=!0):multiSelectOptions.css("height","");var scrollbarWidth=hasScrollbar&&initialWidth==multiSelectOptions.width()?17
:0;multiSelectOptions.width()+scrollbarWidth<multiSelect.outerWidth()?multiSelectOptions.css("width",multiSelect.outerWidth()-2+"px"):multiSelectOptions.css("width",multiSelectOptions.width()+scrollbarWidth+"px"),$.fn.bgiframe&&multiSelect.next(".multiSelectOptions").bgiframe({width:multiSelectOptions.width(),height:multiSelectOptions.height()}),o.selectAll&&multiSelectOptions.find("INPUT.selectAll").click(function(){multiSelectOptions.find("INPUT:checkbox").attr("checked",$(this).attr("checked")).parent("LABEL").toggleClass("checked",$(this).attr("checked"))}),o.optGroupSelectable&&(multiSelectOptions.addClass("optGroupHasCheckboxes"),multiSelectOptions.find("INPUT.optGroup").click(function(){$(this).parent().next().find("INPUT:checkbox").attr("checked",$(this).attr("checked")).parent("LABEL").toggleClass("checked",$(this).attr("checked"))})),multiSelectOptions.find("INPUT:checkbox").click(function(){var o=multiSelect.data("config"),multiSelectOptions=multiSelect.next(".multiSelectOptions"
);o.singleSelect&&multiSelectOptions.find("INPUT:checkbox").not($(this)).attr("checked",!1).parent("LABEL").toggleClass("checked",!1),$(this).parent("LABEL").toggleClass("checked",$(this).attr("checked")),updateSelected.call(multiSelect),multiSelect.focus(),$(this).parent().parent().hasClass("optGroupContainer")&&updateOptGroup.call(multiSelect,$(this).parent().parent().prev()),callback&&callback($(this)),o.singleSelect&&multiSelect.multiSelectOptionsHide()}),multiSelectOptions.each(function(){$(this).find("INPUT:checked").parent().addClass("checked")}),updateSelected.call(multiSelect),o.optGroupSelectable&&multiSelectOptions.find("LABEL.optGroup").each(function(){updateOptGroup.call(multiSelect,$(this))}),multiSelectOptions.find("LABEL:has(INPUT)").hover(function(){$(this).parent().find("LABEL").removeClass("hover"),$(this).addClass("hover")},function(){$(this).parent().find("LABEL").removeClass("hover")}),multiSelect.keydown(function(e){var multiSelectOptions=$(this).next(".multiSelectOptions"
);if(multiSelectOptions.css("visibility")!="hidden"){if(e.keyCode==9)return $(this).addClass("focus").trigger("click"),$(this).focus().next(":input").focus(),!0;(e.keyCode==27||e.keyCode==37||e.keyCode==39)&&$(this).addClass("focus").trigger("click");if(e.keyCode==40||e.keyCode==38){var allOptions=multiSelectOptions.find("LABEL"),oldHoverIndex=allOptions.index(allOptions.filter(".hover")),newHoverIndex=-1;return oldHoverIndex<0?multiSelectOptions.find("LABEL:first").addClass("hover"):e.keyCode==40&&oldHoverIndex<allOptions.length-1?newHoverIndex=oldHoverIndex+1:e.keyCode==38&&oldHoverIndex>0&&(newHoverIndex=oldHoverIndex-1),newHoverIndex>=0&&($(allOptions.get(oldHoverIndex)).removeClass("hover"),$(allOptions.get(newHoverIndex)).addClass("hover"),adjustViewPort(multiSelectOptions)),!1}if(e.keyCode==13||e.keyCode==32){var selectedCheckbox=multiSelectOptions.find("LABEL.hover INPUT:checkbox");return o.singleSelect&&multiSelectOptions.find("INPUT:checkbox").not(selectedCheckbox).attr("checked"
,!1).parent("LABEL").toggleClass("checked",!1),selectedCheckbox.attr("checked",!selectedCheckbox.attr("checked")).parent("LABEL").toggleClass("checked",selectedCheckbox.attr("checked")),selectedCheckbox.hasClass("selectAll")&&multiSelectOptions.find("INPUT:checkbox").attr("checked",selectedCheckbox.attr("checked")).parent("LABEL").addClass("checked").toggleClass("checked",selectedCheckbox.attr("checked")),updateSelected.call(multiSelect),callback&&callback($(this)),o.singleSelect&&multiSelect.multiSelectOptionsHide(),!1}if(e.keyCode>=33&&e.keyCode<=126){var match=multiSelectOptions.find("LABEL:startsWith("+String.fromCharCode(e.keyCode)+")"),currentHoverIndex=match.index(match.filter("LABEL.hover")),afterHoverMatch=match.filter(function(index){return index>currentHoverIndex});match=(afterHoverMatch.length>=1?afterHoverMatch:match).filter("LABEL:first"),match.length==1&&(multiSelectOptions.find("LABEL.hover").removeClass("hover"),match.addClass("hover"),adjustViewPort(multiSelectOptions)
)}}else{if(e.keyCode==38||e.keyCode==40||e.keyCode==13||e.keyCode==32)return $(this).removeClass("focus").trigger("click"),multiSelectOptions.find("LABEL:first").addClass("hover"),!1;if(e.keyCode==9)return multiSelectOptions.next(":input").focus(),!0}if(e.keyCode==13)return!1})}function adjustViewPort(multiSelectOptions){var selectionBottom=multiSelectOptions.find("LABEL.hover").position().top+multiSelectOptions.find("LABEL.hover").outerHeight();selectionBottom>multiSelectOptions.innerHeight()&&multiSelectOptions.scrollTop(multiSelectOptions.scrollTop()+selectionBottom-multiSelectOptions.innerHeight()),multiSelectOptions.find("LABEL.hover").position().top<0&&multiSelectOptions.scrollTop(multiSelectOptions.scrollTop()+multiSelectOptions.find("LABEL.hover").position().top)}function updateOptGroup(optGroup){var multiSelect=$(this),o=multiSelect.data("config");if(o.optGroupSelectable){var optGroupSelected=!0;$(optGroup).next().find("INPUT:checkbox").each(function(){if(!$(this).attr("checked"
))return optGroupSelected=!1,!1}),$(optGroup).find("INPUT.optGroup").attr("checked",optGroupSelected).parent("LABEL").toggleClass("checked",optGroupSelected)}}function updateSelected(){var multiSelect=$(this),multiSelectOptions=multiSelect.next(".multiSelectOptions"),o=multiSelect.data("config"),i=0,selectAll=!0,display="",selectedOptions=[];multiSelectOptions.find("INPUT:checkbox").not(".selectAll, .optGroup").each(function(){$(this).attr("checked")?(i++,display=display+$(this).parent().text()+", ",selectedOptions.push({text:$(this).parent().text(),value:$(this).attr("value")})):selectAll=!1}),display=display.replace(/\s*\,\s*$/,""),i==0?multiSelect.find("span").html(o.noneSelected):typeof o.oneOrMoreSelected=="function"?multiSelect.find("span").html(o.oneOrMoreSelected(selectedOptions)):o.oneOrMoreSelected=="*"?(multiSelect.find("span").html(display),multiSelect.attr("title",display)):multiSelect.find("span").html(o.oneOrMoreSelected.replace("%",i)),o.selectAll&&multiSelectOptions.find
("INPUT.selectAll").attr("checked",selectAll).parent("LABEL").toggleClass("checked",selectAll)}$.extend($.fn,{multiSelect:function(o,callback){o||(o={}),o.selectAll==undefined&&(o.selectAll=!0),o.selectAllText==undefined&&(o.selectAllText="Select All"),o.noneSelected==undefined&&(o.noneSelected="Select options"),o.oneOrMoreSelected==undefined&&(o.oneOrMoreSelected="% selected"),o.optGroupSelectable==undefined&&(o.optGroupSelectable=!1),o.listHeight==undefined&&(o.listHeight=150),o.renderOption==undefined&&(o.renderOption=renderOption),o.singleSelect==undefined&&(o.singleSelect=!1),$(this).each(function(){var select=$(this),html='<a href="javascript:;" class="multiSelect"><span></span><i></i></a>';html+='<div class="multiSelectOptions" style="position: absolute; z-index: 99999; visibility: hidden;"></div>',$(select).after(html);var multiSelect=$(select).next(".multiSelect"),multiSelectOptions=multiSelect.next(".multiSelectOptions");multiSelect.data("config",o),multiSelect.data("callback"
,callback);var options=[];$(select).children().each(function(){if(this.tagName.toUpperCase()=="OPTGROUP"){var suboptions=[];options.push({optgroup:$(this).attr("label"),options:suboptions}),$(this).children("OPTION").each(function(){$(this).val()!=""&&suboptions.push({text:$(this).html(),value:$(this).val(),selected:$(this).attr("selected")})})}else this.tagName.toUpperCase()=="OPTION"&&$(this).val()!=""&&options.push({text:$(this).html(),value:$(this).val(),selected:$(this).attr("selected")})}),$(select).remove(),multiSelect.attr("id",$(select).attr("id")),buildOptions.call(multiSelect,options),multiSelect.hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")}).click(function(){return $(this).hasClass("active")?$(this).multiSelectOptionsHide():$(this).multiSelectOptionsShow(),!1}).focus(function(){$(this).addClass("focus")}).blur(function(){$(this).removeClass("focus")}),$(document).click(function(event){$(event.target).parents().andSelf().is(".multiSelectOptions"
)||multiSelect.multiSelectOptionsHide()})})},multiSelectOptionsUpdate:function(options){buildOptions.call($(this),options)},multiSelectOptionsHide:function(){$(this).removeClass("active").removeClass("hover").next(".multiSelectOptions").css("visibility","hidden"),$(this).removeClass("active").removeClass("hover").next(".multiSelectOptions").css("display","none")},multiSelectOptionsShow:function(){var multiSelect=$(this),multiSelectOptions=multiSelect.next(".multiSelectOptions"),o=multiSelect.data("config");$(".multiSelect").multiSelectOptionsHide(),multiSelectOptions.find("LABEL").removeClass("hover"),multiSelect.addClass("active").next(".multiSelectOptions").css("visibility","visible"),multiSelect.addClass("active").next(".multiSelectOptions").css("display","block"),multiSelect.focus(),multiSelect.next(".multiSelectOptions").scrollTop(0),multiSelectOptions.height()>o.listHeight?multiSelectOptions.css("height",o.listHeight+"px"):multiSelectOptions.css("height",""),multiSelectOptions.css
("width",multiSelect.outerWidth()-2+"px");var offset=multiSelect.position();multiSelect.next(".multiSelectOptions").css({top:offset.top+$(this).outerHeight()+"px"}),multiSelect.next(".multiSelectOptions").css({left:offset.left+"px"})},selectedValuesString:function(){var selectedValues="";return $(this).next(".multiSelectOptions").find("INPUT:checkbox:checked").not(".optGroup, .selectAll").each(function(){selectedValues+=$(this).attr("value")+","}),selectedValues.replace(/\s*\,\s*$/,"")}}),$.expr[":"].startsWith=function(el,i,m){var search=m[3];return search?eval("/^[/s]*"+search+"/i").test($(el).text()):!1}}(jQuery)}),define("views/observationformlayoutview",["jquery","underscore","backbone","app","ich","views/editmapview","views/editmediaview","datepicker","multiselect"],function($,_,Backbone,app,ich,EditMapView,EditMediaView){var ObservationFormLayoutView=Backbone.Marionette.Layout.extend({className:"form observation-form",template:"ObservationForm",regions:{media:"#media-resources-fieldset"
,map:"#location-fieldset"},events:{"click #cancel":"_cancel","click #save":"_save","change input#Title":"_contentChanged","change input#ObservedOn":"_contentChanged","change input#Address":"_contentChanged","change input#Latitude":"_latLongChanged","change input#Longitude":"_latLongChanged","change input#IsIdentificationRequired":"_isIdentificationRequiredChanged","change input#AnonymiseLocation":"_anonymiseLocationChanged","change #projects-field input:checkbox":"_projectsChanged","change #category-field input:checkbox":"_categoryChanged","click #media-resource-import-button":"_showImportMedia"},initialize:function(options){log("observationFormLayoutView:initialize"),this.categories=options.categories},serializeData:function(){return log("observationFormLayoutView:serializeData"),{Model:{Observation:this.model.toJSON(),Categories:this.categories}}},onShow:function(){log("observationFormLayoutView:onShow"),this._showDetails()},showBootstrappedDetails:function(){log("observationFormLayoutView:showBootStrappedDetails"
),this.initializeRegions(),this._showDetails()},_showDetails:function(){log("observationFormLayoutView:_showDetails");var editMapView=new EditMapView({el:"#location-fieldset",model:this.model});this.map.attachView(editMapView),editMapView.render();var editMediaView=new EditMediaView({el:"#media-resources-fieldset",model:this.model});this.media.attachView(editMediaView),editMediaView.render(),this.observedOnDatePicker=this.$el.find("#ObservedOn").datepicker(),this.categoryListSelectView=this.$el.find("#Category").multiSelect({selectAll:!1,singleSelect:!0,noOptionsText:"No Categories",noneSelected:"<span>Select Category</span>",oneOrMoreSelected:function(selectedOptions){var $selectedHtml=$("<span />");return _.each(selectedOptions,function(option){$selectedHtml.append("<span>"+option.text+"</span> ")}),$selectedHtml.children()}}),ich.templates.ProjectSelectItem||ich.addTemplate("ProjectSelectItem",'{{#Projects}}<option value="{{Id}}">{{Name}}</option>{{/Projects}}'),this.$el.find("#Projects"
).append(ich.ProjectSelectItem({Projects:app.authenticatedUser.projects.toJSON()})),this.projectListSelectView=this.$el.find("#Projects").multiSelect({selectAll:!1,messageText:"You can select more than one project",noOptionsText:"No Projects",noneSelected:"<span>Select Projects</span>",renderOption:function(id,option){var html='<label><input style="display:none;" type="checkbox" name="'+id+'[]" value="'+option.value+'"';option.selected&&(html+=' checked="checked"');var project=app.authenticatedUser.projects.get(option.value);return html+=' /><img src="'+project.get("Avatar").Files.thumbnail.RelativeUri+'" alt="" />'+project.get("Name")+"</label>",html},oneOrMoreSelected:function(selectedOptions){var $selectedHtml=$("<div />");return _.each(selectedOptions,function(option){var project=app.authenticatedUser.projects.get(option.value);$selectedHtml.append('<span class="selected-project"><img src="'+project.get("Avatar").Files.thumbnail.RelativeUri+'" alt="" />'+option.text+"</span> ")}),$selectedHtml
.children()}})},_showImportMedia:function(){alert("Coming soon")},_contentChanged:function(e){var target=$(e.currentTarget),data={};data[target.attr("id")]=target.attr("value"),this.model.set(data),target.attr("id")==="Address"&&this._latLongChanged(e)},_latLongChanged:function(e){var oldPosition={latitude:this.model.get("Latitude"),longitude:this.model.get("Longitude")},newPosition={latitude:$("#Latitude").val(),longitude:$("#Longitude").val()};this.model.set("Latitude",newPosition.latitude),this.model.set("Longitude",newPosition.longitude),newPosition.Latitude!=null&&newPosition.Longitude!=null&&(oldPosition.Latitude!==newPosition.Latitude||oldPosition.Longitude!==newPosition.Longitude)&&this.editMapView.changeMarkerPosition(this.model.get("Latitude"),this.model.get("Longitude"))},_isIdentificationRequiredChanged:function(e){var $checkbox=$(e.currentTarget);this.model.set({IsIdentificationRequired:$checkbox.attr("checked")=="checked"?!0:!1})},_anonymiseLocationChanged:function(e){var $checkbox=
$(e.currentTarget);this.model.set({AnonymiseLocation:$checkbox.attr("checked")=="checked"?!0:!1})},_projectsChanged:function(e){var $checkbox=$(e.currentTarget);if($checkbox.attr("checked")==="checked"){var projectId=$checkbox.attr("value");this.model.addProject(projectId)}else this.model.removeProject($checkbox.attr("value"))},_categoryChanged:function(e){var $checkbox=$(e.currentTarget);$checkbox.attr("checked")==="checked"?this.model.set("Category",$checkbox.attr("value")):this.model.set("Category","")},_cancel:function(){app.showPreviousContentView()},_save:function(){this.model.save(),app.showPreviousContentView()}});return ObservationFormLayoutView}),define("views/observationlayoutview",["jquery","underscore","backbone","app","views/observationformlayoutview"],function($,_,Backbone,app,ObservationFormLayoutView){var ObservationLayoutView=Backbone.Marionette.Layout.extend({className:"observation",template:"Observation",regions:{main:".main",notes:".notes",comments:".comments"},showBootstrappedDetails
:function(){this.initializeRegions(),this.$el=$("#content .observation")},showObservationForm:function(observation,categories){var options={model:observation,categories:categories};app.isPrerendering("observations")&&(options.el=".observation-form");var observationFormLayoutView=new ObservationFormLayoutView(options);this.main[app.getShowViewMethodName("observations")](observationFormLayoutView),app.isPrerendering("observations")&&observationFormLayoutView.showBootstrappedDetails()}});return ObservationLayoutView}),define("collections/mediaresourcecollection",["jquery","underscore","backbone","models/mediaresource"],function($,_,Backbone,MediaResource){var MediaResourceCollection=Backbone.Collection.extend({model:MediaResource,url:"/mediaresources",initialize:function(){_.extend(this,Backbone.Events)}});return MediaResourceCollection}),define("models/observation",["jquery","underscore","backbone","collections/projectcollection","collections/mediaresourcecollection"],function($,_,Backbone
,ProjectCollection,MediaResourceCollection){var Observation=Backbone.Model.extend({defaults:{Title:"",ObservedOn:null,Address:"",Latitude:null,Longitude:null,Category:"",AnonymiseLocation:!1,Projects:[],IsIdentificationRequired:!1,Media:[]},urlRoot:"/observations",idAttribute:"Id",initialize:function(options){this.mediaResources=new MediaResourceCollection},toJSON:function(){return{Title:this.get("Title"),ObservedOn:this.get("ObservedOn"),Address:this.get("Address"),Latitude:this.get("Latitude"),Longitude:this.get("Longitude"),Category:this.get("Category"),AnonymiseLocation:this.get("AnonymiseLocation"),Projects:this.get("Projects"),IsIdentificationRequired:this.get("IsIdentificationRequired"),Media:this.get("Media")}},addProject:function(id){var projects=this.get("Projects");projects.push(id),this.set("Projects",projects)},removeProject:function(id){var projects=this.get("Projects");this.set("Projects",_.without(projects,id))},addMediaResource:function(mediaResource){mediaResource.on("change"
,this._setMedia,this),this.mediaResources.add(mediaResource),this._setMedia()},removeMediaResource:function(id){this.mediaResources.remove(this.mediaResources.get(id)),this._setMedia()},_setMedia:function(){var media=this.mediaResources.map(function(mediaResource){return{MediaResourceId:mediaResource.id,Description:"stuff",Licence:"licenceX"}});this.set("Media",media)}});return Observation}),define("controllers/observationcontroller",["jquery","underscore","backbone","app","views/observationlayoutview","models/observation"],function($,_,Backbone,app,ObservationLayoutView,Observation){var ObservationRouter=Backbone.Marionette.AppRouter.extend({appRoutes:{"observations/create":"showObservationForm","observations/:id/update":"showObservationForm"}}),ObservationController={},showObservationLayoutView=function(observation){var observationLayoutView=new ObservationLayoutView({model:observation});return app.showFormContentView(observationLayoutView,"observations"),app.isPrerendering("observations"
)&&observationLayoutView.showBootstrappedDetails(),observationLayoutView},getModel=function(id){var deferred=new $.Deferred;if(app.isPrerendering("observations"))deferred.resolve(app.prerenderedView.data);else{var params={};id&&(params.id=id),$.ajax({url:"/observations/create",data:params}).done(function(data){deferred.resolve(data.Model)})}return deferred.promise()};return ObservationController.showObservationForm=function(id){$.when(getModel(id)).done(function(model){var observation=new Observation(model.Observation),observationLayoutView=showObservationLayoutView(observation);observationLayoutView.showObservationForm(observation,model.Categories),app.setPrerenderComplete()})},app.addInitializer(function(){this.observationRouter=new ObservationRouter({controller:ObservationController})}),ObservationController}),define("views/avataritemview",["jquery","underscore","backbone","app","ich"],function($,_,Backbone,app,ich){var AvatarItemView=Backbone.View.extend({className:"avatar-uploaded"
,events:{"click .view-media-resource-button":"viewMediaResource","click .add-caption-button":"viewMediaResource","click .remove-media-resource-button":"removeMediaResource"},initialize:function(options){_.extend(this,Backbone.Events),_.bindAll(this,"showTempMedia","_showUploadedMedia"),this.mediaResource=options.model,log("avatarItemView.initialize: mediaResource >"),log(this.mediaResource)},render:function(){log("avatarItemView:render"),this._showUploadedMedia()},viewMediaResource:function(){alert("Coming soon")},removeMediaResource:function(){this.remove(),$("#avatar-add-pane").show()},showTempMedia:function(img){log("avatarItemView:_showTempMedia"),this.$el.find("div:first-child img").replaceWith($(img))},_showUploadedMedia:function(mediaResource){log("avatarItemView:_showUploadedMedia"),this.$el.find("div:first-child img").replaceWith($('<img src="'+this.mediaResource.get("MediumImageUri")+'" alt="" />'))}});return AvatarItemView}),define("views/editavatarview",["jquery","underscore"
,"backbone","app","ich","views/avataritemview","loadimage","models/mediaresource"],function($,_,Backbone,app,ich,AvatarItemView,loadImage,MediaResource){var EditAvatarView=Backbone.View.extend({id:"avatar-fieldset",initialize:function(options){_.extend(this,Backbone.Events),_.bindAll(this,"render","_initMediaUploader","_onUploadDone","_onSubmitUpload","_onUploadAdd"),this.model=options.model,this.currentUploadKey=0,this.avatarItemView=null},render:function(){return log("editAvatarView:render"),this._initMediaUploader(),$("#avatar-viewer").append('<img src="'+this.model.get("Avatar").Files.medium.RelativeUri+'" />'),this},_initMediaUploader:function(){$("#fileupload").fileupload({dataType:"json",paramName:"file",url:"/mediaresources/avatarupload",add:this._onUploadAd,submit:this._onSubmitUpload,done:this._onUploadDone,limitConcurrentUploads:1})},_onUploadAdd:function(e,data){log("editAvatarView:_onUploadAdd"),this.currentUploadKey++;var mediaResource=new MediaResource({Key:this.currentUploadKey
.toString()}),self=this,tempImage=loadImage(data.files[0],function(img){img.type!=="error"&&(self.filesAdded++,mediaResourceItemView.showTempMedia(img),self._showMediaResourceItemView(self,mediaResourceItemView,$(img).width(),self.filesAdded===data.originalFiles.length))},{maxHeight:220});tempImage||alert("No support for file/blob API!"),data.submit()},_onSubmitUpload:function(e,data){data.formData={Key:this.currentUploadKey,OriginalFileName:data.files[0].name}},_onUploadDone:function(e,data){log("editAvatarView:_onUploadDone"),this.model.set("Avatar",data.result.Id);var mediaResource=new MediaResource(data.result);$("#avatar-viewer").empty().append('<img src="'+mediaResource.get("Files").medium.RelativeUri+'" width="200px;" />')}});return EditAvatarView}),define("views/organisationformlayoutview",["jquery","underscore","backbone","app","ich","loadimage","views/editavatarview","fileupload","multiselect"],function($,_,Backbone,app,ich,loadImage,EditAvatarView){var OrganisationFormLayoutView=
Backbone.Marionette.Layout.extend({className:"form single-medium organisation-form",tempalte:"OrganisationForm",regions:{avatar:"#avatar-fieldset"},events:{"click #cancel":"_cancel","click #save":"_save","change input#Name":"_contentChanged","change textarea#Description":"_contentChanged","change input#Website":"_contentChanged"},initialize:function(options){log("organisationFormLayoutView.initialize")},serializeData:function(){return log("organisationFormLayoutView:serializeData"),{Model:{Organisation:this.model.toJSON()}}},onShow:function(){log("organisationFormLayoutView:onShow"),this._showDetails()},showBootstrappedDetails:function(){log("organisationFormLayoutView:showBootstrappedDetails"),this.initializeRegions(),this._showDetails()},_showDetails:function(){log("organisationFormLayoutView:_showDetails");var editAvatarView=new EditAvatarView({el:"#avatar-fieldset",model:this.model});editAvatarView.render()},_contentChanged:function(e){log("organisationFormLayoutView:_contentChanged"
);var target=$(e.currentTarget),data={};data[target.attr("id")]=target.attr("value"),this.model.set(data)},_cancel:function(){},_save:function(){this.model.save()}});return OrganisationFormLayoutView}),define("controllers/organisationcontroller",["jquery","underscore","backbone","app","models/team","views/organisationformlayoutview"],function($,_,Backbone,app,Organisation,OrganisationFormLayoutView){var OrganisationRouter=Backbone.Marionette.AppRouter.extend({appRoutes:{"organisations/create":"showOrganisationForm"}}),OrganisationController={},getModel=function(id){var deferred=new $.Deferred;if(app.isPrerendering("organisations"))deferred.resolve(app.prerenderedView.data);else{var params={};id&&(params.id=id),$.ajax({url:"/organisations/create",data:params}).done(function(data){deferred.resolve(data.Model)})}return deferred.promise()};return OrganisationController.showOrganisationForm=function(id){log("organisationController:showOrganisationForm"),$.when(getModel(id)).done(function(model
){var organisation=new Organisation(model.Organisation),organisationFormLayoutView=new OrganisationFormLayoutView({model:organisation});app.content[app.getShowViewMethodName("organisations")](organisationFormLayoutView),app.isPrerendering("organisations")&&organisationFormLayoutView.showBootstrappedDetails(),app.setPrerenderComplete()})},app.addInitializer(function(){this.organisationRouter=new OrganisationRouter({controller:OrganisationController})}),OrganisationController}),define("views/postformlayoutview",["jquery","underscore","backbone","app","ich"],function($,_,Backbone,app,ich){var PostFormLayoutView=Backbone.Marionette.Layout.extend({className:"form single-medium post-form",template:"PostForm",events:{"click #cancel":"_cancel","click #save":"_save","change input#Subject":"_contentChanged","change textarea#Message":"_contentChanged"},initialize:function(options){log("postFormLayoutView:initialize")},serializeData:function(){return log("postFormLayoutView:serializeData"),{Model:{
Post:this.model.toJSON()}}},onShow:function(){log("postFormLayoutView:onShow"),this._showDetails()},showBootstrappedDetails:function(){log("postFormLayoutView:showBootstrappedDetails"),this.initializeRegions(),this._showDetails()},_showDetails:function(){log("postFormLayoutView:_showDetails")},_contentChanged:function(e){log("postFormLayoutView:_contentChanged");var target=$(e.currentTarget),data={};data[target.attr("id")]=target.attr("value"),this.model.set(data)},_cancel:function(){},_save:function(){this.model.save()}});return PostFormLayoutView}),define("models/post",["jquery","underscore","backbone"],function($,_,Backbone){var Post=Backbone.Model.extend({defaults:{Subject:"",Message:""},idAttribute:"Id",urlRoot:"/posts",toJSON:function(){return{Subject:this.get("Subject"),Message:this.get("Message")}}});return Post}),define("controllers/postcontroller",["jquery","underscore","backbone","app","views/postformlayoutview","models/post"],function($,_,Backbone,app,PostFormLayoutView,Post
){var PostRouter=Backbone.Marionette.AppRouter.extend({appRoutes:{"posts/create":"showPostForm","posts/:id/update":"showPostForm"}}),PostController={},getModel=function(id){var deferred=new $.Deferred;if(app.isPrerendering("posts"))deferred.resolve(app.prerenderedView.data);else{var params={};id&&(params.id=id),$.ajax({url:"/posts/create",data:params}).done(function(data){deferred.resolve(data.Model)})}return deferred.promise()};return PostController.showPostForm=function(id){log("postController:showPostForm"),$.when(getModel(id)).done(function(model){var post=new Post(model.Post),postFormLayoutView=new PostFormLayoutView({model:post});app.content[app.getShowViewMethodName()](postFormLayoutView),app.isPrerendering("posts")&&postFormLayoutView.showBootstrappedDetails(),app.setPrerenderComplete()})},app.addInitializer(function(){this.postRouter=new PostRouter({controller:PostController})}),PostController}),define("views/projectformlayoutview",["jquery","underscore","backbone","app","ich","loadimage"
,"views/editavatarview","fileupload","multiselect"],function($,_,Backbone,app,ich,loadImage,EditAvatarView){var ProjectFormLayoutView=Backbone.Marionette.Layout.extend({className:"form single-medium project-form",template:"ProjectForm",regions:{avatar:"#avatar-fieldset"},events:{"click #cancel":"_cancel","click #save":"_save","change input#Name":"_contentChanged","change textarea#Description":"_contentChanged","change input#Website":"_contentChanged","change #team-field input:checkbox":"_teamChanged"},initialize:function(options){log("projectFormLayoutView:initialize"),this.teams=options.teams},serializeData:function(){return log("projectFormLayoutView:serializeData"),{Model:{Project:this.model.toJSON(),Teams:this.teams}}},onShow:function(){log("projectFormLayoutView:onShow"),this._showDetails()},showBootstrappedDetails:function(){log("projectFormLayoutView:showBootstrappedDetails"),this.initializeRegions(),this.$el=$("#content .project-form"),this._showDetails()},_showDetails:function(
){log("projectFormLayoutView:_showDetails");var editAvatarView=new EditAvatarView({el:"#avatar-fieldset",model:this.model});editAvatarView.render(),this.teamListSelectView=this.$el.find("#Team").multiSelect({selectAll:!1,singleSelect:!0,noOptionsText:"No Teams",noneSelected:"Select A Team",oneOrMoreSelected:function(selectedOptions){var $selectedHtml=$("<span />");return _.each(selectedOptions,function(option){$selectedHtml.append("<span>"+option.text+"</span> ")}),$selectedHtml.children()}})},_contentChanged:function(e){log("projectFormLayoutView:_contentChanged");var target=$(e.currentTarget),data={};data[target.attr("id")]=target.attr("value"),this.model.set(data)},_teamChanged:function(e){log("projectFormLayoutView:_teamChanged");var $checkbox=$(e.currentTarget);$checkbox.attr("checked")==="checked"?this.model.set("Team",$checkbox.attr("value")):this.model.set("Team","")},_cancel:function(){log("hello"),app.showPreviousContentView()},_save:function(){this.model.save(),app.showPreviousContentView
()}});return ProjectFormLayoutView}),define("controllers/projectcontroller",["jquery","underscore","backbone","app","views/projectformlayoutview","collections/exploreprojectcollection","models/project"],function($,_,Backbone,app,ProjectFormLayoutView,ExploreProjectCollection,Project){var ProjectRouter=Backbone.Marionette.AppRouter.extend({appRoutes:{"projects/explore":"showProjectExplorer","projects/create":"showProjectForm","projects/:id/update":"showProjectForm"}}),ProjectController={},getModel=function(id){var deferred=new $.Deferred;if(app.isPrerendering("projects"))deferred.resolve(app.prerenderedView.data);else{var params={};id&&(params.id=id),$.ajax({url:"/projects/create",data:params}).done(function(data){deferred.resolve(data.Model)})}return deferred.promise()},getExploreList=function(page,pageSize,sortField,sortDirection,searchQuery){var deferred=new $.Deferred;if(app.isPrerendering("projects"))deferred.resolve(app.prerenderedView.data);else{var params={};$.ajax({url:"/projects/explore"
,data:params}).done(function(data){deferred.resolve(data.Model)})}return deferred.promise()};return ProjectController.showProjectForm=function(id){log("projectController:showProjectForm"),$.when(getModel(id)).done(function(model){var project=new Project(model.Project),projectFormLayoutView=new ProjectFormLayoutView({model:project,teams:model.Teams});app.showFormContentView(projectFormLayoutView,"projects"),app.isPrerendering("projects")&&projectFormLayoutView.showBootstrappedDetails(),app.setPrerenderComplete()})},ProjectController.showProjectExplorer=function(){log("projectController:showProjects"),$.when(getExploreList()).done(function(model){log("got to the ProjectController.showProjects function")})},app.addInitializer(function(){this.projectRouter=new ProjectRouter({controller:ProjectController})}),ProjectController}),define("models/referencespecies",["jquery","underscore","backbone"],function($,_,Backbone){var ReferenceSpecies=Backbone.Model.extend({defaults:{Species:null,SmartTags
:[]},idAttribute:"Id",url:"/referencespecies/",toJSON:function(){return{Id:this.id,Species:this.get("Species"),SmartTags:this.get("SmartTags")}}});return ReferenceSpecies}),define("views/referencespeciesformlayoutview",["jquery","underscore","backbone","app","ich","multiselect"],function($,_,Backbone,app,ich){var ReferenceSpeciesFormLayoutView=Backbone.Marionette.Layout.extend({tagName:"section",className:"form single-medium",id:"reference-species-form",regions:{avatar:"#avatar-fieldset"},events:{"click #cancel":"_cancel","click #save":"_save","change input#species":"_contentChanged","change input#smarttags":"_contentChanged"},onRender:function(){alert("referenceSpeciesFormLayoutView "+Date())},_contentChanged:function(e){var target=$(e.currentTarget),data={};data[target.attr("id")]=target.attr("value"),this.model.set(data)},_cancel:function(){},_save:function(){this.model.save()}});return ReferenceSpeciesFormLayoutView}),define("controllers/referencespeciescontroller",["jquery","underscore"
,"backbone","app","models/referencespecies","views/referencespeciesformlayoutview"],function($,_,Backbone,app,ReferenceSpecies,ReferenceSpeciesFormLayoutView){var ReferenceSpeciesRouter=Backbone.Marionette.AppRouter.extend({appRoutes:{"referencespecies/create":"showReferenceSpeciesForm"}}),ReferenceSpeciesController={};return ReferenceSpeciesController.showReferenceSpeciesForm=function(){var referenceSpeciesFormLayoutView=new ReferenceSpeciesFormLayoutView({el:$(".reference-species-create-form"),model:new ReferenceSpecies(app.prerenderedView.ReferenceSpecies)});referenceSpeciesFormLayoutView.render(),app.prerenderedView.isBound=!0},app.vent.on("referencespecies:show",function(){ReferenceSpeciesController.showReferenceSpeciesForm()}),app.addInitializer(function(){this.referenceSpeciesRouter=new ReferenceSpeciesRouter({controller:ReferenceSpeciesController})}),ReferenceSpeciesController}),define("models/species",["jquery","underscore","backbone"],function($,_,Backbone){var Species=Backbone
.Model.extend({defaults:{Kingdom:"",Group:"",CommonNames:[],Taxonomy:"",Order:"",Family:"",GenusName:"",SpeciesName:"",ProposedAsNewSpecies:!1},idAttribute:"Id",url:"/species/",toJSON:function(){return{Id:this.id,Kingdom:this.get("Kingdom"),Group:this.get("Group"),CommonNames:this.get("CommonNames"),Taxonomy:this.get("Taxonomy"),Order:this.get("Order"),Family:this.get("Family"),GenusName:this.get("GenusName"),SpeciesName:this.get("SpeciesName"),ProposedAsNewSpecies:this.get("ProposedAsNewSpecies")}}});return Species}),define("views/speciesformitemview",["jquery","underscore","backbone","app","ich","multiselect"],function($,_,Backbone,app,ich){var SpeciesFormItemView=Backbone.Marionette.ItemView.extend({tagName:"section",className:"form single-medium",id:"species-form",template:"SpeciesCreate",events:{"click #cancel":"_cancel","click #save":"_save","change input#kingdom":"_contentChanged","change input#group":"_contentChanged","change input#commonnames":"_contentChanged","change input#taxonomy"
:"_contentChanged","change input#order":"_contentChanged","change input#family":"_contentChanged","change input#genusname":"_contentChanged","change input#speciesname":"_contentChanged","change #proposed-new-species-field input:checkbox":"_proposedNewSpeciesChanged"},onRender:function(){},_contentChanged:function(e){var target=$(e.currentTarget),data={};data[target.attr("id")]=target.attr("value"),this.model.set(data)},_proposedNewSpeciesChanged:function(e){},_cancel:function(){},_save:function(){this.model.save()}});return SpeciesFormItemView}),define("controllers/speciescontroller",["jquery","underscore","backbone","app","models/species","views/speciesformitemview"],function($,_,Backbone,app,Species,SpeciesFormItemView){var SpeciesRouter=Backbone.Marionette.AppRouter.extend({appRoutes:{"species/create":"showSpeciesForm"}}),SpeciesController={},getModel=function(id){var deferred=new $.Deferred;if(app.isPrerendering("species"))deferred.resolve(app.prerenderedView.data);else{var params={
};id&&(params.id=id),$.ajax({url:"/species/create",data:params}).done(function(data){deferred.resolve(data.Model)})}return deferred.promise()};return SpeciesController.showSpeciesForm=function(){var speciesFormItemView=new SpeciesFormItemView({el:$(".species-create-form"),model:new Species(app.prerenderedView.Species)});speciesFormItemView.render(),app.prerenderedView.isBound=!0},app.vent.on("species:show",function(){SpeciesController.showSpeciesForm()}),app.addInitializer(function(){this.speciesRouter=new SpeciesRouter({controller:SpeciesController})}),SpeciesController}),define("views/teamformlayoutview",["jquery","underscore","backbone","app","ich","loadimage","views/editavatarview","multiselect","fileupload"],function($,_,Backbone,app,ich,loadImage,EditAvatarView){var TeamFormLayoutView=Backbone.Marionette.Layout.extend({className:"form single-medium team-form",template:"TeamForm",regions:{avatar:"#avatar-fieldset"},events:{"click #cancel":"_cancel","click #save":"_save","change input#Name"
:"_contentChanged","change textarea#Description":"_contentChanged","change input#Website":"_contentChanged","change #organisation-field input:checkbox":"_organisationChanged"},initialize:function(options){log("teamFormLayoutView.initialize"),this.organisations=options.organisations},serializeData:function(){return log("teamFormLayoutView.serializeData"),{Model:{Team:this.model.toJSON(),Organisations:this.organisations}}},onShow:function(){log("teamFormLayoutView.onShow"),this._showDetails()},showBootstrappedDetails:function(){log("teamFormLayoutView.showBootstrappedDetails"),this.initializeRegions(),this._showDetails()},_showDetails:function(){log("teamFormLayoutView._showDetails");var editAvatarView=new EditAvatarView({el:"#avatar-fieldset",model:this.model});editAvatarView.render(),this.organisationListSelectView=this.$el.find("#Organisation").multiSelect({selectAll:!1,singleSelect:!0,noOptionsText:"No Organisations",noneSelected:"Select An Organisation",oneOrMoreSelected:function(selectedOptions
){var $selectedHtml=$("<span />");return _.each(selectedOptions,function(option){$selectedHtml.append("<span>"+option.text+"</span> ")}),$selectedHtml.children()}})},_contentChanged:function(e){log("teamFormLayoutView._contentChanged");var target=$(e.currentTarget),data={};data[target.attr("id")]=target.attr("value"),this.model.set(data)},_organisationChanged:function(e){log("teamFormLayoutView._organisationChanged");var $checkbox=$(e.currentTarget);$checkbox.attr("checked")==="checked"?this.model.set("Organisation",$checkbox.attr("value")):this.model.set("Organisation","")},_cancel:function(){},_save:function(){this.model.save()}});return TeamFormLayoutView}),define("controllers/teamcontroller",["jquery","underscore","backbone","app","models/team","views/teamformlayoutview"],function($,_,Backbone,app,Team,TeamFormLayoutView){var TeamRouter=Backbone.Marionette.AppRouter.extend({appRoutes:{"teams/create":"showTeamForm"}}),TeamController={},getModel=function(id){var deferred=new $.Deferred
;if(app.isPrerendering("teams"))deferred.resolve(app.prerenderedView.data);else{var params={};id&&(params.id=id),$.ajax({url:"/teams/create",data:params}).done(function(data){deferred.resolve(data.Model)})}return deferred.promise()};return TeamController.showTeamForm=function(id){log("teamController:showTeamForm"),$.when(getModel(id)).done(function(model){var team=new Team(model.Team),teamFormLayoutView=new TeamFormLayoutView({model:team,organisations:model.Organisations});app.content[app.getShowViewMethodName("teams")](teamFormLayoutView),app.isPrerendering("teams")&&teamFormLayoutView.showBootstrappedDetails(),app.setPrerenderComplete()})},app.addInitializer(function(){this.teamRouter=new TeamRouter({controller:TeamController})}),TeamController}),define("controllers/accountcontroller",["jquery","underscore","backbone","app"],function($,_,Backbone,app,HomeLayoutView){var AccountRouter=Backbone.Marionette.AppRouter.extend({appRoutes:{"account/login":"showLogin","account/register":"showRegister"
}}),AccountController={};return AccountController.showLogin=function(){},AccountController.showRegister=function(){},app.addInitializer(function(){this.accountRouter=new AccountRouter({controller:AccountController})}),AccountController}),define("views/chatmessageitemview",["jquery","underscore","backbone","app","models/chatmessage"],function($,_,Backbone,app){var ChatMessageItemView=Backbone.Marionette.ItemView.extend({tagName:"li",className:"chat-message",template:"ChatMessage",serializeData:function(){return{Model:this.model.toJSON()}}});return ChatMessageItemView}),define("views/chatmessagecollectionview",["jquery","underscore","backbone","app","ich","views/chatmessageitemview"],function($,_,Backbone,app,ich,ChatMessageItemView){var ChatMessageCollectionView=Backbone.Marionette.CollectionView.extend({tagName:"ul",itemView:ChatMessageItemView});return ChatMessageCollectionView}),define("views/useritemview",["jquery","underscore","backbone","app","models/user"],function($,_,Backbone,app
){var UserItemView=Backbone.Marionette.ItemView.extend({tagName:"li",className:"online-user",template:"UserItem",events:{"click .user-chat-icon":"startChat"},onRender:function(){},serializeData:function(){return{Id:this.model.id,Name:this.model.get("Name"),Avatar:this.model.get("Avatar"),Type:"User"}},startChat:function(e){var id=e.target.id.split("-")[1];app.vent.trigger("chats:startPrivateChat",id)},generateGuid:function(){var S4=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()}});return UserItemView}),define("views/chatusercollectionview",["jquery","underscore","backbone","app","ich","collections/usercollection","views/useritemview"],function($,_,Backbone,app,ich,UserCollection,UserItemView){var ChatUserCollectionView=Backbone.Marionette.CollectionView.extend({tagName:"ul",itemView:UserItemView});return ChatUserCollectionView}),define("views/chatcompositeview",["jquery","underscore","backbone","app"
,"ich","views/chatmessagecollectionview","views/chatusercollectionview"],function($,_,Backbone,app,ich,ChatMessageCollectionView,ChatUserCollectionView){var ChatLayoutView=Backbone.Marionette.Layout.extend({template:"Chat",className:"chat-window",events:{"click .chat-send-message-button":"sendMessage","click .window-close":"closeWindow"},regions:{messages:".chat-messages",users:".chat-users"},serializeData:function(){return{Model:{Title:this.model.get("Title")}}},onShow:function(){log("chatView.onRender");var chatMessageCollectionView=new ChatMessageCollectionView({collection:this.model.chatMessages});this.messages.show(chatMessageCollectionView),chatMessageCollectionView.render();var chatUserCollectionView=new ChatUserCollectionView({collection:this.model.chatUsers});this.users.show(chatUserCollectionView),chatUserCollectionView.render()},sendMessage:function(){log("chatView.sendMessage");var message=this.$el.find(".new-chat-message").val(),chatId=this.model.id;log(message,chatId),app.
vent.trigger("chats:sendMessage",chatId,message)},closeWindow:function(){app.chats.remove(this.model.id),this.$el.remove()}});return ChatLayoutView}),define("controllers/chatcontroller",["jquery","underscore","backbone","app","models/chat","collections/usercollection","collections/chatmessagecollection","views/chatcompositeview"],function($,_,Backbone,app,Chat,UserCollection,ChatMessageCollection,ChatCompositeView){var ChatRouter=function(options){this.hub=$.connection.chatHub,this.controller=options.controller,this.hub.chatMessageReceived=this.controller.chatMessageReceived,this.hub.typing=this.controller.typing,this.hub.userExitedChat=this.controller.userExitedChat,this.hub.chatRequest=this.controller.chatRequest,this.hub.userJoinedChat=this.controller.userJoinedChat,this.hub.setupChat=this.controller.setupChat,this.hub.debugToLog=this.controller.debugToLog},ChatController={};return ChatController.hub=$.connection.chatHub,app.vent.on("chats:startGroupChat",function(id){log("chats.startGroupChat with group: "+
id),ChatController.joinChat(id)}),app.vent.on("chats:startPrivateChat",function(id){log("chats.startPrivateChat with user: "+id),ChatController.joinChat(id)}),app.vent.on("chats:sendMessage",function(chatId,message){ChatController.sendMessage(chatId,message)}),ChatController.debugToLog=function(message){log(message)},ChatController.joinChat=function(id){log("chatController.joinChat: with "+id);if(id.split("/")[0]=="users"){var chatId=ChatController.generateGuid(),userId=id;ChatController.hub.startChat(chatId,userId)}else ChatController.hub.joinChat(id)},ChatController.exitChat=function(chat){log("chatRouter.exitChat"),this.hub.exitChat(chat.Id)},ChatController.typing=function(id,isTyping){log("chatRouter.typing"),this.hub.typing(id,isTyping)},ChatController.sendMessage=function(chatId,message){log("chatController.sendMessage message:"+message+" to: "+chatId),this.hub.sendChatMessage(chatId,message)},ChatController.setupChat=function(data){log("chatController.setupChat",this,data);var chatUsers=new 
UserCollection(data.Users),chatMessages=new ChatMessageCollection(data.Messages),chat=new Chat({Id:data.ChatId,Title:data.Title},{chatUsers:chatUsers,chatMessages:chatMessages});app.chats.add(chat);var chatView=new ChatCompositeView({model:chat});log(chatView),app.chatarea.show(chatView)},ChatController.chatRequest=function(data){log("chatController.chatRequest",this,data);var chatUsers=new UserCollection(data.Users),chatMessages=new ChatMessageCollection(data.Messages),chat=new Chat({Id:data.ChatId,Title:data.Title},{chatUsers:chatUsers,chatMessages:chatMessages});app.chats.add(chat);var chatView=new ChatCompositeView({model:chat,collection:chat.chatMessages});log(chatView),app.chatarea.show(chatView)},ChatController.userJoinedChat=function(data){log("chatController.userJoinedChat",this,data)},ChatController.chatMessageReceived=function(data){log("chatController.chatMessageReceived",this,data);var chat=app.chats.get(data.ChatId);chat.chatMessages.add(data)},ChatController.typing=function(
data){log("chatController.typing",this,data)},ChatController.userExitedChat=function(data){log("chatController.userExitedChat",this,data)},ChatController.generateGuid=function(){var S4=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()},app.addInitializer(function(){this.chatRouter=new ChatRouter({controller:ChatController})}),ChatController}),define("views/headerview",["jquery","underscore","backbone","app"],function($,_,Backbone,app){var HeaderView=Backbone.Marionette.ItemView.extend({el:"header",showBootstrappedDetails:function(){this.$el.find("#explore-menu a").on("click",function(e){return e.preventDefault(),app.observationRouter.navigate($(this).attr("href"),{trigger:!0}),!1})}});return app.addInitializer(function(options){$(function(){var headerView=new HeaderView;headerView.on("show",function(){app.vent.trigger("headerView:rendered")}),app.header.attachView(headerView),headerView.showBootstrappedDetails
()})}),HeaderView}),define("views/footerview",["jquery","underscore","backbone","app"],function($,_,Backbone,app){var FooterView=Backbone.Marionette.ItemView.extend({el:"footer"});return app.addInitializer(function(options){$(function(){var footerView=new FooterView;footerView.on("show",function(){Bowerbird.app.vent.trigger("footerView:rendered")}),Bowerbird.app.footer.attachView(footerView)})}),FooterView}),define("views/sidebarmenugroupcompositeview",["jquery","underscore","backbone","app"],function($,_,Backbone,app){var SidebarMenuGroupCompositeView=Backbone.Marionette.CompositeView.extend({className:"menu-group",template:"SidebarMenuGroup",initialize:function(options){this.type=options.type,this.label=options.label},appendHtml:function(collectionView,itemView){collectionView.$el.find("#"+this.type+"-menu-group-list").append(itemView.el)},serializeData:function(){return{Model:{Name:this.type,Label:this.label}}}});return SidebarMenuGroupCompositeView}),define("views/sidebarprojectitemview"
,["jquery","underscore","backbone","app","models/project"],function($,_,Backbone,app,Project){var SidebarProjectItemView=Backbone.Marionette.ItemView.extend({tagName:"li",className:"menu-group-item",template:"SidebarProjectItem",events:{"click .chat-menu-item":"startChat","click .sub-menu-button":"showMenu","click .sub-menu-button li":"selectMenuItem"},initialize:function(){this.activityCount=0},onRender:function(){var that=this;$(this.el).children("a").on("click",function(e){return e.preventDefault(),app.groupUserRouter.navigate($(this).attr("href")),!1}),app.vent.on("newactivity:observationadded",this.observationAdded,this)},serializeData:function(){return{Id:this.model.id,Name:this.model.get("Name"),Avatar:this.model.get("Avatar"),Permissions:{UpdateProject:app.authenticatedUser.hasGroupPermission(this.model.id,"permissions/updateproject")}}},showMenu:function(e){$(".sub-menu-button").removeClass("active"),$(e.currentTarget).addClass("active"),e.stopPropagation()},selectMenuItem:function(
e){$(".sub-menu-button").removeClass("active"),e.stopPropagation()},startChat:function(e){e.preventDefault(),app.vent.trigger("chats:startGroupChat",e.currentTarget.id.split("-")[1])},observationAdded:function(activity){_.each(activity.get("Groups"),function(group){if(group.Id==this.model.id){this.activityCount++,this.activityCount==1&&this.$el.find("p").append('<span title=""></span>');var title=this.activityCount.toString()+" New Item"+(this.activityCount>1?"s":"");this.$el.find("p span").text(this.activityCount).attr("title",title)}},this)}});return SidebarProjectItemView}),define("views/sidebarteamitemview",["jquery","underscore","backbone","app","models/team"],function($,_,Backbone,app,Team){var SidebarTeamItemView=Backbone.Marionette.ItemView.extend({tagName:"li",className:"menu-group-item",template:"SidebarTeamItem",events:{"click .chat-menu-item":"startChat","click .sub-menu-button":"showMenu","click .sub-menu-button li":"selectMenuItem"},onRender:function(){var that=this;$(this
.el).children("a").on("click",function(e){return e.preventDefault(),app.groupUserRouter.navigate($(this).attr("href")),app.vent.trigger("team:show:stream",that.model.id),!1})},serializeData:function(){return{Id:this.model.id,Name:this.model.get("Name"),Avatar:this.model.get("Avatar"),Permissions:{CreateProject:app.authenticatedUser.hasGroupPermission(this.model.id,"permissions/createproject"),UpdateTeam:app.authenticatedUser.hasGroupPermission(this.model.id,"permissions/updateteam")}}},showMenu:function(e){$(".sub-menu-button").removeClass("active"),$(e.currentTarget).addClass("active"),e.stopPropagation()},selectMenuItem:function(e){$(".sub-menu-button").removeClass("active"),e.stopPropagation()},startChat:function(e){e.preventDefault(),app.vent.trigger("chats:startGroupChat",e.currentTarget.id.split("-")[1])}});return SidebarTeamItemView}),define("views/sidebarorganisationitemview",["jquery","underscore","backbone","app","models/organisation"],function($,_,Backbone,app,Organisation){var SidebarOrganisationItemView=
Backbone.Marionette.ItemView.extend({tagName:"li",className:"menu-group-item",template:"SidebarOrganisationItem",events:{"click .chat-menu-item":"startChat","click .sub-menu-button":"showMenu","click .sub-menu-button li":"selectMenuItem"},onRender:function(){var that=this;$(this.el).children("a").on("click",function(e){return e.preventDefault(),app.groupUserRouter.navigate($(this).attr("href")),app.vent.trigger("organisation:show:stream",that.model.id),!1})},serializeData:function(){return{Id:this.model.id,Name:this.model.get("Name"),Description:this.model.get("Description"),Website:this.model.get("Website"),Avatar:this.model.get("Avatar"),Type:"Organisation"}},showMenu:function(e){$(".sub-menu-button").removeClass("active"),$(e.currentTarget).addClass("active"),e.stopPropagation()},selectMenuItem:function(e){$(".sub-menu-button").removeClass("active"),e.stopPropagation()},startChat:function(e){e.preventDefault(),app.vent.trigger("chats:startGroupChat",e.currentTarget.id.split("-")[1])}
});return SidebarOrganisationItemView}),define("views/sidebarlayoutview",["jquery","underscore","backbone","app","views/sidebarmenugroupcompositeview","views/sidebarprojectitemview","views/sidebarteamitemview","views/sidebarorganisationitemview"],function($,_,Backbone,app,SidebarMenuGroupCompositeView,SidebarProjectItemView,SidebarTeamItemView,SidebarOrganisationItemView){var SidebarLayoutView=Backbone.Marionette.Layout.extend({tagName:"section",id:"sidebar",className:"triple-1",template:"Sidebar",regions:{projectsMenu:".menu-projects",watchlistsMenu:"#watch-menu-group #watch-list",teamsMenu:".menu-teams",organisationsMenu:".menu-organisations"},events:{"click .menu-group-options .sub-menu-button":"showMenu","click .menu-group-options .sub-menu-button li":"selectMenuItem"},onRender:function(){$("article").prepend(this.el);var sidebarProjectCompositeView=new SidebarMenuGroupCompositeView({id:"project-menu-group",collection:this.model.projects,type:"project",label:"Projects"});sidebarProjectCompositeView
.itemView=SidebarProjectItemView,this.projectsMenu.show(sidebarProjectCompositeView);if(this.model.teams.length>0){var sidebarTeamCompositeView=new SidebarMenuGroupCompositeView({id:"team-menu-group",collection:this.model.teams,type:"team",label:"Teams"});sidebarTeamCompositeView.itemView=SidebarTeamItemView,this.teamsMenu.show(sidebarTeamCompositeView)}if(this.model.organisations.length>0){var sidebarOrganisationCompositeView=new SidebarMenuGroupCompositeView({id:"organisation-menu-group",collection:this.model.organisations,type:"organisation",label:"Organisations"});sidebarOrganisationCompositeView.itemView=SidebarOrganisationItemView,this.organisationsMenu.show(sidebarOrganisationCompositeView)}var that=this;this.$el.find("#action-menu .new-project-button").on("click",function(e){return e.preventDefault(),app.projectRouter.navigate($(this).attr("href"),{trigger:!0}),!1}),this.$el.find("#action-menu .new-observation-button").on("click",function(e){return e.preventDefault(),app.projectRouter
.navigate($(this).attr("href"),{trigger:!0}),!1}),this.$el.find("a.user-stream").on("click",function(e){return e.preventDefault(),app.groupUserRouter.navigate($(this).attr("href"),{trigger:!0}),!1}),this.$el.find("#project-menu-group-list a").on("click",function(e){return e.preventDefault(),app.projectRouter.navigate($(this).attr("href"),{trigger:!0}),!1}),this.$el.find("#team-menu-group-list a").on("click",function(e){return e.preventDefault(),app.teamRouter.navigate($(this).attr("href"),{trigger:!0}),!1}),this.$el.find("#organisation-menu-group-list a").on("click",function(e){return e.preventDefault(),app.organisationRouter.navigate($(this).attr("href"),{trigger:!0}),!1}),app.authenticatedUser.projects.on("add",this.addProject,this)},serializeData:function(){return{Model:{User:this.model.user.toJSON(),Teams:this.model.teams.length>0,Organisations:this.model.organisations.length>0,AppRoot:this.model.appRoot!=null}}},showMenu:function(e){$(".sub-menu-button").removeClass("active"),$(e.currentTarget
).addClass("active"),e.stopPropagation()},selectMenuItem:function(e){$(".sub-menu-button").removeClass("active"),e.stopPropagation()},addProject:function(project){log("project added",this,project)}});return app.addInitializer(function(options){$(function(){if(app.authenticatedUser){var model={user:app.authenticatedUser.user,projects:app.authenticatedUser.projects,teams:app.authenticatedUser.teams,organisations:app.authenticatedUser.organisations,appRoot:app.authenticatedUser.appRoot},sidebarLayoutView=new SidebarLayoutView({model:model});sidebarLayoutView.on("show",function(){app.vent.trigger("sidebar:rendered")}),app.sidebar.show(sidebarLayoutView)}})}),SidebarLayoutView}),define("views/notificationitemview",["jquery","underscore","backbone","app","timeago"],function($,_,Backbone,app){var parseISO8601=function(str){var parts=str.split("T"),dateParts=parts[0].split("-"),timeParts=parts[1].split("Z"),timeSubParts=timeParts[0].split(":"),timeSecParts=timeSubParts[2].split("."),timeHours=Number
(timeSubParts[0]),_date=new Date;return _date.setUTCFullYear(Number(dateParts[0])),_date.setUTCMonth(Number(dateParts[1])-1),_date.setUTCDate(Number(dateParts[2])),_date.setUTCHours(Number(timeHours)),_date.setUTCMinutes(Number(timeSubParts[1])),_date.setUTCSeconds(Number(timeSecParts[0])),timeSecParts[1]&&_date.setUTCMilliseconds(Number(timeSecParts[1])),_date},NotificationItemView=Backbone.Marionette.ItemView.extend({tagName:"li",className:"notification-item",template:"NotificationItem",serializeData:function(){var model=this.model.toJSON();return model.CreatedDateTimeDescription=parseISO8601(this.model.get("CreatedDateTime")+"Z"),{Model:model}},onRender:function(){this.$el.find(".time-description").timeago()}});return NotificationItemView}),define("views/notificationscompositeview",["jquery","underscore","backbone","app","views/notificationitemview"],function($,_,Backbone,app,NotificationItemView){var NotificationsCompositeView=Backbone.Marionette.CompositeView.extend({tagName:"section"
,id:"notifications",className:"triple-3",template:"Notifications",itemView:NotificationItemView,onRender:function(){$("article").append(this.el)},appendHtml:function(collectionView,itemView){collectionView.$el.find("ul").prepend(itemView.el)}});return app.addInitializer(function(options){$(function(){if(app.authenticatedUser){var notificationsCompositeView=new NotificationsCompositeView({model:app.authenticatedUser.user,collection:app.activities});notificationsCompositeView.on("show",function(){app.vent.trigger("notifications:rendered")}),app.notifications.show(notificationsCompositeView)}})}),NotificationsCompositeView}),define("views/onlineusercompositeview",["jquery","underscore","backbone","app","views/useritemview"],function($,_,Backbone,app,UserItemView){var OnlineUserCompositeView=Backbone.Marionette.CompositeView.extend({itemView:UserItemView,template:"OnlineUserList",className:"onlineusers",regions:{summary:"#online-user-summary",users:"#online-users"},initialize:function(options
){this.collection.on("add",this.updateUserCount,this),this.collection.on("remove",this.updateUserCount,this)},serializeData:function(){return{Count:this.collection.length}},updateUserCount:function(model,collection){this.$el.find("#users-online").text(collection.length)}});return app.addInitializer(function(options){$(function(){if(app.authenticatedUser){var onlineUserCompositeView=new OnlineUserCompositeView({model:app.onlineUsers,collection:app.onlineUsers});onlineUserCompositeView.on("show",function(){app.vent.trigger("onlineUsers:rendered")}),app.usersonline.show(onlineUserCompositeView)}})}),OnlineUserCompositeView}),require.config({baseUrl:"/js/bowerbird",paths:{jquery:"http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery",json2:"../libs/json/json2",underscore:"../libs/underscore/underscore",backbone:"../libs/backbone/backbone",marionette:"../libs/backbone.marionette/backbone.marionette",noext:"../libs/require/noext",async:"../libs/require/async",goog:"../libs/require/goog",propertyParser
:"../libs/require/propertyparser",ich:"../libs/icanhaz/icanhaz",jqueryui:"../libs/jqueryui",datepicker:"../libs/bootstrap/bootstrap-datepicker",date:"../libs/date/date",multiselect:"../libs/jquery.multiselect/jquery.multiselect",loadimage:"../libs/jquery.fileupload/load-image",fileupload:"../libs/jquery.fileupload/jquery.fileupload",signalr:"../libs/jquery.signalr/jquery.signalr",timeago:"../libs/jquery.timeago/jquery.timeago",log:"../libs/log/log"},shim:{"/signalr/hubs?noext":["signalr","jquery"]}}),require(["app","bootstrap-data","log","backbone","jquery","ich","marionette","/templates?noext","controllers/activitycontroller","controllers/groupusercontroller","controllers/homecontroller","controllers/observationcontroller","controllers/organisationcontroller","controllers/postcontroller","controllers/projectcontroller","controllers/referencespeciescontroller","controllers/speciescontroller","controllers/teamcontroller","controllers/accountcontroller","controllers/chatcontroller","views/headerview"
,"views/footerview","views/sidebarlayoutview","views/notificationscompositeview","views/onlineusercompositeview","views/chatcompositeview","/signalr/hubs?noext"],function(app,bootstrapData){log(bootstrapData),$(function(){app.start(bootstrapData)})}),define("../main",function(){}),define("controllers/accountController",["jquery","underscore","backbone","app"],function($,_,Backbone,app,HomeLayoutView){var AccountRouter=Backbone.Marionette.AppRouter.extend({appRoutes:{"account/login":"showLogin","account/register":"showRegister"}}),AccountController={};return AccountController.showLogin=function(){},AccountController.showRegister=function(){},app.addInitializer(function(){this.accountRouter=new AccountRouter({controller:AccountController})}),AccountController})